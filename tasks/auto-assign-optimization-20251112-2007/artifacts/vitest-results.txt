
> ship-fast-code@0.1.0 test /Users/amankumarshrestha/Downloads/SajiloReserveX
> vitest run --config reserve/vitest.config.ts


 RUN  v3.2.4 /Users/amankumarshrestha/Downloads/SajiloReserveX/reserve

 âœ“ tests/features/restaurant-browser.test.tsx (5 tests) 1189ms
   âœ“ <RestaurantBrowser /> > filters restaurants by search term  712ms
 âœ“ tests/features/wizard/details-step.analytics.test.tsx (1 test) 308ms
   âœ“ <DetailsStep /> analytics > uses dependency-provided analytics tracker on submit  306ms
 âœ“ tests/unit/CustomerNavbar.test.tsx (2 tests) 1453ms
   âœ“ <CustomerNavbar /> > renders sign-in button for anonymous visitors  525ms
   âœ“ <CustomerNavbar /> > shows avatar menu and triggers sign out for authenticated users  927ms
stdout | tests/unit/MyBookingsClient.analytics.test.tsx > MyBookingsClient analytics > tracks cancel dialog open event when cancel action is invoked
[analytics] dashboard_viewed { totalBookings: [33m1[39m, filter: [32m'upcoming'[39m }
[analytics] dashboard_cancel_opened { bookingId: [32m'booking-abc'[39m, status: [32m'confirmed'[39m }

 âœ“ tests/unit/MyBookingsClient.analytics.test.tsx (1 test) 92ms
 âœ“ tests/profile/ProfileManageForm.test.tsx (8 tests) 2923ms
   âœ“ ProfileManageForm > shows validation error and focuses name when too short  444ms
   âœ“ ProfileManageForm > submits trimmed name and surfaces success status  374ms
   âœ“ ProfileManageForm > submits phone changes  549ms
   âœ“ ProfileManageForm > surfaces idempotent status when duplicate request detected  398ms
   âœ“ ProfileManageForm > shows warning message when idempotency key conflicts  669ms
 âœ“ tests/unit/EditBookingDialog.test.tsx (5 tests) 2670ms
   âœ“ EditBookingDialog > submits derived end time when editing details  847ms
   âœ“ EditBookingDialog > displays mapped server error message  356ms
   âœ“ EditBookingDialog > disables editing when restaurant slug is missing  338ms
   âœ“ EditBookingDialog > re-disables saving when the picker clears its value  581ms
   âœ“ EditBookingDialog > prevents saving when party size exceeds the online limit  547ms
stdout | features/reservations/wizard/ui/steps/plan-step/__tests__/PlanStepForm.test.tsx > <PlanStepForm /> > disables time selection and surfaces an alert when the schedule is closed
[analytics] selection.blocked.closed { restaurantSlug: [32m'white-horse-pub-waterbeach'[39m, date: [32m'2025-05-11'[39m }

 âœ“ tests/features/booking-state-machine/ScheduleAwareTimestampPicker.test.tsx (8 tests) 4161ms
   âœ“ <ScheduleAwareTimestampPicker /> manual entry > prefills the saved date and time on initial render  433ms
   âœ“ <ScheduleAwareTimestampPicker /> manual entry > rejects manual times that are not available and surfaces an inline error  676ms
   âœ“ <ScheduleAwareTimestampPicker /> manual entry > clears the error once a valid slot is chosen  524ms
   âœ“ <ScheduleAwareTimestampPicker /> manual entry > keeps all time options visible after selecting a different slot on the same date  354ms
   âœ“ <ScheduleAwareTimestampPicker /> manual entry > clears the time and shows loading feedback when the date changes  1266ms
   âœ“ <ScheduleAwareTimestampPicker /> manual entry > surfaces closed-date messaging in the slot region and blocks selection  723ms
 âœ“ features/reservations/wizard/ui/steps/plan-step/components/__tests__/Calendar24Field.test.tsx (7 tests) 5078ms
   âœ“ <Calendar24Field /> > invokes onSelect when a date is chosen from the calendar  1837ms
   âœ“ <Calendar24Field /> > prevents selection for dates flagged by the matcher  1045ms
   âœ“ <Calendar24Field /> > notifies visible month changes  1383ms
   âœ“ <Calendar24Field /> > treats loading dates as disabled until schedules resolve  634ms
 âœ“ features/reservations/wizard/ui/steps/plan-step/__tests__/PlanStepForm.test.tsx (8 tests) 5071ms
   âœ“ <PlanStepForm /> > updates party size and occasion via handlers  2637ms
   âœ“ <PlanStepForm /> > normalizes manual times beyond the last seating buffer  798ms
   âœ“ <PlanStepForm /> > disables dates included in the initial calendar mask before schedules load  641ms
 âœ“ app/__tests__/router.test.tsx (2 tests) 1375ms
   âœ“ ReserveRouter > uses the default /reserve basename when no override is provided  1360ms
 âœ“ tests/unit/CancelBookingDialog.test.tsx (2 tests) 1833ms
   âœ“ CancelBookingDialog > calls cancel mutation when confirming  1654ms
 âœ“ features/reservations/wizard/ui/__tests__/WizardProgress.test.tsx (1 test) 437ms
   âœ“ WizardProgress > announces the current step for screen readers  435ms
 âœ“ features/reservations/wizard/ui/steps/plan-step/components/__tests__/OccasionPicker.responsive.test.tsx (2 tests) 907ms
   âœ“ OccasionPicker responsive layout > uses responsive grid classes and 44px targets  506ms
   âœ“ OccasionPicker responsive layout > disables options that are not available for the selected date  398ms
 âœ“ features/reservations/wizard/ui/__tests__/BookingWizard.offline.test.tsx (1 test) 1016ms
   âœ“ BookingWizard offline banner > shows offline banner, disables actions, and tracks analytics  1015ms
 âœ“ features/reservations/wizard/ui/__tests__/BookingWizard.plan-review.test.tsx (3 tests) 6694ms
   âœ“ BookingWizard plan to review flow > persists selections through review and triggers confirmation mutation  3797ms
   âœ“ BookingWizard plan to review flow > returns to review step and surfaces error when booking submission fails  1884ms
   âœ“ BookingWizard plan to review flow > shows booking-in-past guidance when API rejects due to past start time  1010ms
stdout | tests/unit/BookingsListMobile.test.tsx > BookingsListMobile > shows empty state when no bookings and not loading
[analytics] dashboard_empty_state_viewed {}

 âœ“ tests/unit/BookingsListMobile.test.tsx (4 tests) 1509ms
   âœ“ BookingsListMobile > renders booking summary and triggers actions  1359ms
 âœ“ tests/features/wizard/review-step.analytics.test.tsx (1 test) 109ms
 âœ“ shared/config/__tests__/reservations.test.ts (3 tests) 117ms
 âœ“ features/reservations/wizard/ui/steps/plan-step/components/__tests__/TimeSlotGrid.test.tsx (3 tests) 564ms
   âœ“ <TimeSlotGrid /> > renders grouped time buttons and invokes onSelect  356ms
 âœ“ tests/unit/useBookingsTableState.test.tsx (4 tests) 104ms
 âœ“ tests/features/wizard/plan-step-form.analytics.test.tsx (4 tests) 295ms
 âœ“ features/reservations/wizard/services/__tests__/useTimeSlots.test.tsx (2 tests) 138ms
 âœ“ shared/api/__tests__/client.test.ts (3 tests) 292ms
stdout | tests/unit/analytics.emit.test.ts > analytics emitter > queues events and flushes via fetch on timer
[analytics] booking_edit_submitted { bookingId: [32m'booking-42'[39m }

stdout | tests/unit/analytics.emit.test.ts > analytics emitter > queues events and flushes via fetch on timer
[analytics] flushing events timer [
  {
    name: [32m'booking_edit_submitted'[39m,
    ts: [32m'2025-11-12T22:59:03.475Z'[39m,
    user: { anonId: [32m'anon-123'[39m, emailHash: [32m'deadbeef'[39m },
    context: { route: [32m'/my-bookings'[39m, version: [32m'web-dev'[39m },
    props: { bookingId: [32m'booking-42'[39m }
  }
]

stdout | tests/unit/analytics.emit.test.ts > analytics emitter > prefers sendBeacon when available
[analytics] booking_cancelled { bookingId: [32m'booking-99'[39m }

stdout | tests/unit/analytics.emit.test.ts > analytics emitter > prefers sendBeacon when available
[analytics] flushing events manual [
  {
    name: [32m'booking_cancelled'[39m,
    ts: [32m'2025-11-12T22:59:03.503Z'[39m,
    user: { anonId: [32m'anon-123'[39m, emailHash: [32m'deadbeef'[39m },
    context: { route: [32m'/my-bookings'[39m, version: [32m'web-dev'[39m },
    props: { bookingId: [32m'booking-99'[39m }
  }
]

stdout | tests/unit/analytics.emit.test.ts > analytics emitter > reuses resolved identity across emits
[analytics] booking_cancelled { bookingId: [32m'booking-123'[39m }

stdout | tests/unit/analytics.emit.test.ts > analytics emitter > reuses resolved identity across emits
[analytics] filter_changed {}

stdout | tests/unit/analytics.emit.test.ts > analytics emitter > reuses resolved identity across emits
[analytics] flushing events manual [
  {
    name: [32m'booking_cancelled'[39m,
    ts: [32m'2025-11-12T22:59:03.508Z'[39m,
    user: { anonId: [32m'anon-123'[39m, emailHash: [32m'deadbeef'[39m },
    context: { route: [32m'/my-bookings'[39m, version: [32m'web-dev'[39m },
    props: { bookingId: [32m'booking-123'[39m }
  },
  {
    name: [32m'filter_changed'[39m,
    ts: [32m'2025-11-12T22:59:03.508Z'[39m,
    user: { anonId: [32m'anon-123'[39m, emailHash: [32m'deadbeef'[39m },
    context: { route: [32m'/my-bookings'[39m, version: [32m'web-dev'[39m },
    props: {}
  }
]

 âœ“ tests/unit/analytics.emit.test.ts (3 tests) 39ms
 âœ“ features/reservations/wizard/model/__tests__/store.test.ts (5 tests) 94ms
 âœ“ features/reservations/wizard/api/__tests__/useCreateReservation.test.tsx (1 test) 26ms
stdout | tests/unit/api-v1-alias.test.ts > API v1 alias routes > POST /api/v1/events forwards to existing handler
[events] [
  {
    name: [32m'test'[39m,
    ts: [32m'2025-11-12T22:59:04.513Z'[39m,
    user: { anonId: [32m'x'[39m },
    context: { route: [32m'/'[39m, version: [32m'v'[39m },
    props: {}
  }
]

 âœ“ tests/unit/api-v1-alias.test.ts (2 tests) 31ms
 âœ“ tests/unit/fetchJson.test.ts (4 tests) 31ms
 âœ“ tests/hooks/useOnlineStatus.test.tsx (2 tests) 66ms
 âœ“ tests/unit/api-events.route.test.ts (2 tests) 32ms
 âœ“ tests/unit/reservation-share.test.ts (3 tests) 27ms
 âœ“ shared/schedule/__tests__/availability.test.ts (7 tests) 31ms
 âœ“ features/reservations/wizard/di/__tests__/context.test.tsx (2 tests) 47ms
 âœ“ shared/formatting/__tests__/booking.test.ts (4 tests) 22ms
 âœ“ tests/server/getReservation.test.ts (4 tests) 18ms
 âœ“ tests/profile/useUpdateProfile.test.tsx (1 test) 92ms
 âœ“ features/reservations/wizard/model/__tests__/schemas.test.ts (6 tests) 10ms
 âœ“ tests/profile/api.test.ts (4 tests) 93ms
 âœ“ shared/time/__tests__/reservations.test.ts (3 tests) 3ms
 âœ“ tests/server/bookings/history.test.ts (3 tests) 5ms
 âœ“ tests/unit/reservation.adapter.test.ts (1 test) 8ms
 âœ“ tests/server/ops/customers.test.ts (4 tests) 12ms
 âœ“ shared/time/__tests__/time.test.ts (4 tests) 18ms
 âœ“ features/reservations/wizard/services/__tests__/timeSlots.test.ts (3 tests) 20ms
 âœ“ features/reservations/wizard/model/__tests__/transformers.test.ts (4 tests) 14ms
 âœ“ tests/profile/ensureProfileRow.hydration.test.ts (2 tests) 13ms
 âœ“ shared/error/__tests__/error.test.ts (8 tests) 3ms
 âœ“ shared/api/__tests__/queryKeys.test.ts (3 tests) 4ms
 âœ“ tests/profile/schema.test.ts (5 tests) 9ms
 âœ“ shared/validation/__tests__/contact.test.ts (2 tests) 4ms
 âœ“ tests/unit/my-bookings-api.test.ts (2 tests) 16ms

 Test Files  51 passed (51)
      Tests  174 passed (174)
   Start at  22:58:44
   Duration  24.47s (transform 9.51s, setup 23.08s, collect 59.97s, tests 39.12s, environment 77.96s, prepare 14.23s)

