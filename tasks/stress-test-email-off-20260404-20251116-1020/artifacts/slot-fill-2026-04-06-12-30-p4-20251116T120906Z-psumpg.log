
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 12\:30 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar
[2025-11-16T12:09:06.869Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"62e12d60-67d1-43f3-9f32-f046f4b4d552","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:06.869Z] [INFO] [submit] Submitting booking request {"correlationId":"62e12d60-67d1-43f3-9f32-f046f4b4d552","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:09:13.587Z] [INFO] [submit] Booking created {"correlationId":"62e12d60-67d1-43f3-9f32-f046f4b4d552","bookingId":"50b6991b-c510-4f92-8b90-7d2a241f3653","duplicate":false,"initialStatus":"confirmed","durationMs":6717,"maskedEmail":"bo***0@example.com","maskedPhone":"********2360"}
[2025-11-16T12:09:13.854Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"62e12d60-67d1-43f3-9f32-f046f4b4d552","bookingId":"50b6991b-c510-4f92-8b90-7d2a241f3653","reference":"8XZ9MHWZHX","bookingDate":"2026-04-06","startTime":"12:30:00","endTime":"14:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:13.181Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2090,"attemptId":"1a8db3aa-9640-477b-93fc-82d4e8b15daf","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6717,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6985,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"821ba142-6a5e-4952-82a9-98ce14b4e78e","tableId":"38694eb6-cde9-4253-8b8a-cdcd4b74084e","tableNumber":"MD-03","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:09:13.855Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"fc832e15-ccc2-4663-892f-4242bcca5d43","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:13.855Z] [INFO] [submit] Submitting booking request {"correlationId":"fc832e15-ccc2-4663-892f-4242bcca5d43","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:09:20.344Z] [INFO] [submit] Booking created {"correlationId":"fc832e15-ccc2-4663-892f-4242bcca5d43","bookingId":"1e3995ea-0867-44ff-91a9-e97c30fd8829","duplicate":false,"initialStatus":"confirmed","durationMs":6488,"maskedEmail":"bo***5@example.com","maskedPhone":"********2415"}
[2025-11-16T12:09:20.650Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"fc832e15-ccc2-4663-892f-4242bcca5d43","bookingId":"1e3995ea-0867-44ff-91a9-e97c30fd8829","reference":"QQLEQHCGQV","bookingDate":"2026-04-06","startTime":"12:30:00","endTime":"14:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:19.921Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2034,"attemptId":"e396614a-00c8-4526-9207-ef5168c7bd9e","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6488,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6795,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a2a8c8e3-d577-4651-8eeb-1a1cc56c12e3","tableId":"c5d016d2-7c61-4038-afc3-220a2fc91ea3","tableNumber":"MD-04","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:09:20.651Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9d5270a2-c53f-41d3-87db-a36745383d4f","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:20.651Z] [INFO] [submit] Submitting booking request {"correlationId":"9d5270a2-c53f-41d3-87db-a36745383d4f","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:09:27.227Z] [INFO] [submit] Booking created {"correlationId":"9d5270a2-c53f-41d3-87db-a36745383d4f","bookingId":"e2185168-a37a-428d-8417-ba2f6fbe25d4","duplicate":false,"initialStatus":"confirmed","durationMs":6575,"maskedEmail":"bo***2@example.com","maskedPhone":"********7002"}
[2025-11-16T12:09:27.540Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9d5270a2-c53f-41d3-87db-a36745383d4f","bookingId":"e2185168-a37a-428d-8417-ba2f6fbe25d4","reference":"58N4VJAKGP","bookingDate":"2026-04-06","startTime":"12:30:00","endTime":"14:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:26.656Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1886,"attemptId":"0b93a7e2-d8b5-47ca-a0df-3992af535f6e","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6575,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6889,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b97775df-6f28-406e-abe1-fa06baea832e","tableId":"79590af2-90f6-40d8-8a32-e27579e5b949","tableNumber":"MD-05","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:09:27.540Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b6a1fb54-dccc-4b9b-a188-c57ada168b28","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:27.541Z] [INFO] [submit] Submitting booking request {"correlationId":"b6a1fb54-dccc-4b9b-a188-c57ada168b28","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:09:35.389Z] [INFO] [submit] Booking created {"correlationId":"b6a1fb54-dccc-4b9b-a188-c57ada168b28","bookingId":"7fe7adfd-6ace-495a-970a-8755165cb879","duplicate":false,"initialStatus":"confirmed","durationMs":7848,"maskedEmail":"bo***4@example.com","maskedPhone":"********5154"}
[2025-11-16T12:09:35.611Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b6a1fb54-dccc-4b9b-a188-c57ada168b28","bookingId":"7fe7adfd-6ace-495a-970a-8755165cb879","reference":"WC4JRQNF9E","bookingDate":"2026-04-06","startTime":"12:30:00","endTime":"14:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:34.867Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2297,"attemptId":"8570a258-ffed-4721-b7e2-7587b660c64d","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7848,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8071,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e656c9bd-1d50-4a91-b2a6-c0d45ae86b14","tableId":"e581bf2d-4baa-4263-b5db-ce6e415010cc","tableNumber":"MD-06","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6795, max: 8071, avg: 7185, p95: 6985 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-03', 'MD-04', 'MD-05', 'MD-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
