
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 14\:30 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2025-11-16T12:13:01.362Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"83f61b5b-9823-4f96-a765-f734fa0518b4","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:01.362Z] [INFO] [submit] Submitting booking request {"correlationId":"83f61b5b-9823-4f96-a765-f734fa0518b4","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:13:08.341Z] [INFO] [submit] Booking created {"correlationId":"83f61b5b-9823-4f96-a765-f734fa0518b4","bookingId":"2cf1557d-05da-48f0-9737-c6bead6ae1e5","duplicate":false,"initialStatus":"confirmed","durationMs":6978,"maskedEmail":"bo***b@example.com","maskedPhone":"********1151"}
[2025-11-16T12:13:08.573Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"83f61b5b-9823-4f96-a765-f734fa0518b4","bookingId":"2cf1557d-05da-48f0-9737-c6bead6ae1e5","reference":"FHK6E7BNY7","bookingDate":"2026-04-06","startTime":"14:30:00","endTime":"16:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:07.886Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1920,"attemptId":"20d4d37b-a727-4511-92dc-05cbbd140d6d","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6978,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7210,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2c96f012-84a9-4f4c-a10d-f45424599dd0","tableId":"49d15284-c41d-449a-96f5-45a01dbb19f8","tableNumber":"BA-01","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:13:08.573Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0223947f-5611-4864-8577-78017b723348","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:08.573Z] [INFO] [submit] Submitting booking request {"correlationId":"0223947f-5611-4864-8577-78017b723348","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:13:15.249Z] [INFO] [submit] Booking created {"correlationId":"0223947f-5611-4864-8577-78017b723348","bookingId":"3c732943-d750-4857-a1e9-4154b16215ed","duplicate":false,"initialStatus":"confirmed","durationMs":6675,"maskedEmail":"bo***f@example.com","maskedPhone":"********9475"}
[2025-11-16T12:13:15.517Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0223947f-5611-4864-8577-78017b723348","bookingId":"3c732943-d750-4857-a1e9-4154b16215ed","reference":"VAZD3A53YE","bookingDate":"2026-04-06","startTime":"14:30:00","endTime":"16:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:14.811Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2206,"attemptId":"9e8198aa-5698-4c7f-a4ec-23e5e2c0a2b3","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6675,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6944,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"31623bf7-9944-4ca0-85a3-c552b11745a4","tableId":"6d20353b-fbb2-48c2-9335-b68bc235db7c","tableNumber":"BA-02","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:13:15.518Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7a46a73c-a047-43d1-aa29-d082284504a3","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:15.518Z] [INFO] [submit] Submitting booking request {"correlationId":"7a46a73c-a047-43d1-aa29-d082284504a3","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:13:22.963Z] [INFO] [submit] Booking created {"correlationId":"7a46a73c-a047-43d1-aa29-d082284504a3","bookingId":"e5e9c542-0f48-4bc3-bfa9-06d5f78e6514","duplicate":false,"initialStatus":"confirmed","durationMs":7444,"maskedEmail":"bo***c@example.com","maskedPhone":"********0732"}
[2025-11-16T12:13:23.201Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7a46a73c-a047-43d1-aa29-d082284504a3","bookingId":"e5e9c542-0f48-4bc3-bfa9-06d5f78e6514","reference":"KSUX4SMLBU","bookingDate":"2026-04-06","startTime":"14:30:00","endTime":"16:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:22.346Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2356,"attemptId":"a4fd5f0f-1b55-44fa-8e22-d6a9dd7e84ae","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7444,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7683,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["PT-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0275f0bc-9725-494d-8184-a5455bdff104","tableId":"31c0e865-f5ef-453b-a3ef-fe994c8561fa","tableNumber":"PT-01","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:13:23.202Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6811d088-1142-4339-bc18-795576376df8","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:23.202Z] [INFO] [submit] Submitting booking request {"correlationId":"6811d088-1142-4339-bc18-795576376df8","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:13:31.679Z] [INFO] [submit] Booking created {"correlationId":"6811d088-1142-4339-bc18-795576376df8","bookingId":"aec26024-61ec-4387-8bf0-f3ad262bdfb9","duplicate":false,"initialStatus":"confirmed","durationMs":8476,"maskedEmail":"bo***8@example.com","maskedPhone":"********3088"}
[2025-11-16T12:13:31.989Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6811d088-1142-4339-bc18-795576376df8","bookingId":"aec26024-61ec-4387-8bf0-f3ad262bdfb9","reference":"VU5EJ26RRG","bookingDate":"2026-04-06","startTime":"14:30:00","endTime":"16:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:31.044Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2607,"attemptId":"760263f1-5f93-4c6e-8688-e423d9602a6a","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":8476,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8787,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["MD-05"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6af0c985-b8d3-404f-a709-d9e62ab5eeb2","tableId":"79590af2-90f6-40d8-8a32-e27579e5b949","tableNumber":"MD-05","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6944, max: 8787, avg: 7656, p95: 7683 },
  seatWaste: { count: 4, min: 0, max: 2, avg: 0.5, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-05', 'PT-01' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
