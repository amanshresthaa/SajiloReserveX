
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-03 --time 12\:15 --party-size 8 --stress --stress-max 6 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  override existing env vars with { override: true }
[2025-11-16T10:52:57.586Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0721ef74-0f58-4b70-92c8-2a6770be88d9","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T10:52:57.587Z] [INFO] [submit] Submitting booking request {"correlationId":"0721ef74-0f58-4b70-92c8-2a6770be88d9","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-03","time":"12:15","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T10:53:05.621Z] [INFO] [submit] Booking created {"correlationId":"0721ef74-0f58-4b70-92c8-2a6770be88d9","bookingId":"25255fdc-5db9-4fb2-a038-524acde26cad","duplicate":false,"initialStatus":"confirmed","durationMs":8032,"maskedEmail":"bo***4@example.com","maskedPhone":"********4574"}
[2025-11-16T10:53:05.924Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0721ef74-0f58-4b70-92c8-2a6770be88d9","bookingId":"25255fdc-5db9-4fb2-a038-524acde26cad","reference":"6ZYGCHTPAK","bookingDate":"2026-04-03","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T10:53:05.059Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2318,"attemptId":"b58ba328-20b5-490b-99b0-1614128fafdc","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":8032,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8338,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-09"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f4727232-a535-47bb-b0df-d37d3cefdda6","tableId":"df31eae2-3159-4194-a843-d9bb9b56121a","tableNumber":"MD-09","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T10:53:05.925Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4909b65f-122b-42c3-b304-19197c88ce00","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T10:53:05.925Z] [INFO] [submit] Submitting booking request {"correlationId":"4909b65f-122b-42c3-b304-19197c88ce00","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-03","time":"12:15","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T10:53:12.454Z] [INFO] [submit] Booking created {"correlationId":"4909b65f-122b-42c3-b304-19197c88ce00","bookingId":"80b59112-7776-41be-8157-c20ee48f519e","duplicate":false,"initialStatus":"confirmed","durationMs":6528,"maskedEmail":"bo***f@example.com","maskedPhone":"********1655"}
[2025-11-16T10:53:12.659Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4909b65f-122b-42c3-b304-19197c88ce00","bookingId":"80b59112-7776-41be-8157-c20ee48f519e","reference":"Q65KL2ET64","bookingDate":"2026-04-03","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T10:53:11.964Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1942,"attemptId":"b299260e-6a46-4636-9452-62d4842249f2","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6528,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6734,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-10"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f2dfdf4d-c9f8-496f-83d0-270c1abb5fb9","tableId":"d1f34cf1-07da-4171-84f7-71b4490a7276","tableNumber":"MD-10","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T10:53:12.660Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"966c1623-4fa3-4454-b3b5-2e993c8a3fb8","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T10:53:12.660Z] [INFO] [submit] Submitting booking request {"correlationId":"966c1623-4fa3-4454-b3b5-2e993c8a3fb8","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-03","time":"12:15","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T10:53:19.431Z] [INFO] [submit] Booking created {"correlationId":"966c1623-4fa3-4454-b3b5-2e993c8a3fb8","bookingId":"a9f20605-2aef-4d5d-8142-f92a98d9fc3a","duplicate":false,"initialStatus":"confirmed","durationMs":6770,"maskedEmail":"bo***3@example.com","maskedPhone":"********1623"}
[2025-11-16T10:53:19.676Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"966c1623-4fa3-4454-b3b5-2e993c8a3fb8","bookingId":"a9f20605-2aef-4d5d-8142-f92a98d9fc3a","reference":"HQQ9XMKM7M","bookingDate":"2026-04-03","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T10:53:18.973Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2044,"attemptId":"5169f406-c429-4326-a3c1-78d21b49c14a","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6770,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7016,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["OG-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"33fb6bd2-157a-4391-8abf-008fc00ea030","tableId":"4545d5f6-817b-468c-8e32-264c9fdd9213","tableNumber":"OG-06","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T10:53:19.677Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7b5c38cd-9fb2-446b-bcef-408833f5fcc4","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T10:53:19.677Z] [INFO] [submit] Submitting booking request {"correlationId":"7b5c38cd-9fb2-446b-bcef-408833f5fcc4","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-03","time":"12:15","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T10:53:26.035Z] [INFO] [submit] Booking created {"correlationId":"7b5c38cd-9fb2-446b-bcef-408833f5fcc4","bookingId":"a766d21c-82e3-4e96-ab2a-86219ba378e0","duplicate":false,"initialStatus":"confirmed","durationMs":6358,"maskedEmail":"bo***d@example.com","maskedPhone":"********3823"}
[2025-11-16T10:53:26.286Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7b5c38cd-9fb2-446b-bcef-408833f5fcc4","bookingId":"a766d21c-82e3-4e96-ab2a-86219ba378e0","reference":"6UCQ5SYCEP","bookingDate":"2026-04-03","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T10:53:25.538Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1878,"attemptId":"5781ea0a-1a7b-424c-8f80-ffff6b742062","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6358,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6609,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-07"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e219b256-309f-4bd3-89d9-68d7387ace26","tableId":"092429df-9dd0-42e7-8c32-5eb8f84bd418","tableNumber":"PT-07","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T10:53:26.287Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"105769aa-e3c4-4911-a9e7-32ef000186f8","bookingId":null,"iteration":5,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T10:53:26.287Z] [INFO] [submit] Submitting booking request {"correlationId":"105769aa-e3c4-4911-a9e7-32ef000186f8","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-03","time":"12:15","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T10:53:32.907Z] [INFO] [submit] Booking created {"correlationId":"105769aa-e3c4-4911-a9e7-32ef000186f8","bookingId":"2dcdf724-1aa3-4375-8a9c-5d578d344ba3","duplicate":false,"initialStatus":"confirmed","durationMs":6619,"maskedEmail":"bo***a@example.com","maskedPhone":"********6900"}
[2025-11-16T10:53:33.121Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"105769aa-e3c4-4911-a9e7-32ef000186f8","bookingId":"2dcdf724-1aa3-4375-8a9c-5d578d344ba3","reference":"YKTKYBBKKA","bookingDate":"2026-04-03","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T10:53:32.472Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1853,"attemptId":"270090e8-4da2-4c35-96c7-3d7335e5aacf","emailSent":false,"emailVariant":"standard"},"iteration":5,"submitDurationMs":6619,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6834,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-08"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5733d5aa-8537-4896-b559-53ab5a9888cf","tableId":"c0b9bf36-a98b-4837-b650-6a6ee50bb5ca","tableNumber":"PT-08","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T10:53:33.121Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"09abec2a-7c71-40e7-98f9-19054d36d0ff","bookingId":null,"iteration":6,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T10:53:33.121Z] [INFO] [submit] Submitting booking request {"correlationId":"09abec2a-7c71-40e7-98f9-19054d36d0ff","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-03","time":"12:15","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T10:53:39.706Z] [INFO] [submit] Booking created {"correlationId":"09abec2a-7c71-40e7-98f9-19054d36d0ff","bookingId":"ffccb009-6ab6-45bc-a24a-826685cae12d","duplicate":false,"initialStatus":"confirmed","durationMs":6584,"maskedEmail":"bo***a@example.com","maskedPhone":"********4220"}
[2025-11-16T10:53:39.965Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"09abec2a-7c71-40e7-98f9-19054d36d0ff","bookingId":"ffccb009-6ab6-45bc-a24a-826685cae12d","reference":"5EWA3XDULY","bookingDate":"2026-04-03","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T10:53:39.266Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1898,"attemptId":"47e65369-d235-47db-abed-8e2e04cd4405","emailSent":false,"emailVariant":"standard"},"iteration":6,"submitDurationMs":6584,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6843,"tablesAssigned":2,"totalCapacity":8,"seatWaste":0,"tableNumbers":["OG-02","OG-03"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"cff2e2fe-c4b9-4e31-bffa-4475bea1548e","tableId":"32fd3505-2418-4a8f-9b4a-4e18eae92b50","tableNumber":"OG-02","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null},{"id":"939ac4e8-c17f-4ac4-87ec-c67c4f9b2321","tableId":"438ffaac-0215-4817-8ff6-e1516d67ce53","tableNumber":"OG-03","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 6,
  successes: 6,
  failures: 0,
  maxRuns: 6,
  completedTarget: true,
  durationMs: { count: 6, min: 6609, max: 8338, avg: 7062.333333333333, p95: 7016 },
  seatWaste: { count: 6, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 6, min: 1, max: 2, avg: 1.1666666666666667, p95: 1 },
  uniqueTables: [
    'MD-09', 'MD-10',
    'OG-02', 'OG-03',
    'OG-06', 'PT-07',
    'PT-08'
  ]
}
✅ Stress run completed 6 booking(s) without failure.
