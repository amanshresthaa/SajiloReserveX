
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 17\:45 --party-size 6 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-16T12:20:12.216Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1df38791-9253-4502-b807-bce67cb9342b","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:12.216Z] [INFO] [submit] Submitting booking request {"correlationId":"1df38791-9253-4502-b807-bce67cb9342b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:20:18.934Z] [INFO] [submit] Booking created {"correlationId":"1df38791-9253-4502-b807-bce67cb9342b","bookingId":"4abdaf4d-dede-45ac-a54b-74837c887779","duplicate":false,"initialStatus":"confirmed","durationMs":6717,"maskedEmail":"bo***1@example.com","maskedPhone":"********8791"}
[2025-11-16T12:20:19.154Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1df38791-9253-4502-b807-bce67cb9342b","bookingId":"4abdaf4d-dede-45ac-a54b-74837c887779","reference":"2KSMM83W9X","bookingDate":"2026-04-06","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:18.453Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2048,"attemptId":"37e51f4e-fef2-480e-a419-7170bf80fafd","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6717,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6937,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8702d353-9584-4f5f-b20c-c07fad3b7791","tableId":"2dcab6f8-ccbc-4d31-bc47-fb82bcdf3122","tableNumber":"BA-08","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:20:19.154Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8d926d8e-06d5-4795-a9b6-2fd24197aedf","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:19.154Z] [INFO] [submit] Submitting booking request {"correlationId":"8d926d8e-06d5-4795-a9b6-2fd24197aedf","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:20:25.989Z] [INFO] [submit] Booking created {"correlationId":"8d926d8e-06d5-4795-a9b6-2fd24197aedf","bookingId":"67c78381-e989-43ca-99c9-d9b890fd7fc1","duplicate":false,"initialStatus":"confirmed","durationMs":6834,"maskedEmail":"bo***e@example.com","maskedPhone":"********6384"}
[2025-11-16T12:20:26.211Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8d926d8e-06d5-4795-a9b6-2fd24197aedf","bookingId":"67c78381-e989-43ca-99c9-d9b890fd7fc1","reference":"MS5GK8UWHM","bookingDate":"2026-04-06","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:25.432Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1979,"attemptId":"5c460730-3e6d-4f71-a762-1993ffc73dc1","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6834,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7057,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"02f499cc-7c27-4e87-962b-e77726682fe2","tableId":"36a18791-8339-42c5-a43f-996e2560b240","tableNumber":"MD-07","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:20:26.212Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7f7c3772-9bbf-4fe9-afa5-235b5f7d9744","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:26.213Z] [INFO] [submit] Submitting booking request {"correlationId":"7f7c3772-9bbf-4fe9-afa5-235b5f7d9744","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:20:32.845Z] [INFO] [submit] Booking created {"correlationId":"7f7c3772-9bbf-4fe9-afa5-235b5f7d9744","bookingId":"56ba52b7-87c1-4810-b661-ea828fe90c10","duplicate":false,"initialStatus":"confirmed","durationMs":6632,"maskedEmail":"bo***2@example.com","maskedPhone":"********3772"}
[2025-11-16T12:20:33.056Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7f7c3772-9bbf-4fe9-afa5-235b5f7d9744","bookingId":"56ba52b7-87c1-4810-b661-ea828fe90c10","reference":"3R6U7PJNEF","bookingDate":"2026-04-06","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:32.391Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1990,"attemptId":"1cc36d96-bff9-403f-b40a-a485520b87ef","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6632,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6844,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d75c9792-400d-45bc-882c-5eda1daf2f39","tableId":"94040fa4-ae8f-44eb-9298-cba491e3d204","tableNumber":"MD-08","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:20:33.056Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d39544d1-15a5-46f1-b34f-911f606e915e","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:33.056Z] [INFO] [submit] Submitting booking request {"correlationId":"d39544d1-15a5-46f1-b34f-911f606e915e","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:20:40.289Z] [INFO] [submit] Booking created {"correlationId":"d39544d1-15a5-46f1-b34f-911f606e915e","bookingId":"9a6b8ce2-d335-4075-a19e-9d2626c5f27e","duplicate":false,"initialStatus":"confirmed","durationMs":7232,"maskedEmail":"bo***1@example.com","maskedPhone":"********4431"}
[2025-11-16T12:20:40.556Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"d39544d1-15a5-46f1-b34f-911f606e915e","bookingId":"9a6b8ce2-d335-4075-a19e-9d2626c5f27e","reference":"ZDF32ENNJK","bookingDate":"2026-04-06","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:39.844Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2531,"attemptId":"95cedf55-0dec-4bf4-a9a6-72e5583c6a68","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7232,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7500,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-04"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d389e11c-e834-40be-8fac-9f25e208afbc","tableId":"42a3ad2c-e3a3-453e-940a-f5e8405f601a","tableNumber":"OG-04","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6844, max: 7500, avg: 7084.5, p95: 7057 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-08', 'MD-07', 'MD-08', 'OG-04' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
