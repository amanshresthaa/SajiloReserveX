
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 16\:30 --party-size 1 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2025-11-16T12:17:04.635Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"da1e8e34-df6a-4300-879f-b89ce34b576f","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:04.635Z] [INFO] [submit] Submitting booking request {"correlationId":"da1e8e34-df6a-4300-879f-b89ce34b576f","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:30","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:17:11.903Z] [INFO] [submit] Booking created {"correlationId":"da1e8e34-df6a-4300-879f-b89ce34b576f","bookingId":"c82dc3e6-82e3-4ad2-9be2-1b21a7dbe25c","duplicate":false,"initialStatus":"confirmed","durationMs":7266,"maskedEmail":"bo***4@example.com","maskedPhone":"********8434"}
[2025-11-16T12:17:12.538Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"da1e8e34-df6a-4300-879f-b89ce34b576f","bookingId":"c82dc3e6-82e3-4ad2-9be2-1b21a7dbe25c","reference":"JYSECJK2VC","bookingDate":"2026-04-06","startTime":"16:30:00","endTime":"18:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:11.369Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2097,"attemptId":"bf14d784-1701-4193-babf-23934822b1d6","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7266,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7903,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["PT-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"79fe1f64-9926-4ce9-8826-3358bb6ca638","tableId":"25bd4b9f-53cf-44ab-8210-6598e8a8b8fb","tableNumber":"PT-02","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:17:12.539Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cfa380bc-16ae-4fdb-bc7f-c457a37a1d9d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:12.539Z] [INFO] [submit] Submitting booking request {"correlationId":"cfa380bc-16ae-4fdb-bc7f-c457a37a1d9d","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:30","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:17:20.171Z] [INFO] [submit] Booking created {"correlationId":"cfa380bc-16ae-4fdb-bc7f-c457a37a1d9d","bookingId":"f51f8cb5-a190-42f0-a9e9-165d81cdc4a5","duplicate":false,"initialStatus":"confirmed","durationMs":7631,"maskedEmail":"bo***c@example.com","maskedPhone":"********8012"}
[2025-11-16T12:17:20.410Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cfa380bc-16ae-4fdb-bc7f-c457a37a1d9d","bookingId":"f51f8cb5-a190-42f0-a9e9-165d81cdc4a5","reference":"5ER5SLZFBA","bookingDate":"2026-04-06","startTime":"16:30:00","endTime":"18:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:19.566Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2330,"attemptId":"5821557d-af35-4156-812f-016cb9a17474","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7631,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7871,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["MD-05"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"89ccba4e-825e-4b8b-88a4-c3a64c87a0ec","tableId":"79590af2-90f6-40d8-8a32-e27579e5b949","tableNumber":"MD-05","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:17:20.411Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cb668d0d-1b7f-4b2e-a016-2059f3d0e9bb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:20.411Z] [INFO] [submit] Submitting booking request {"correlationId":"cb668d0d-1b7f-4b2e-a016-2059f3d0e9bb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:30","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:17:27.423Z] [INFO] [submit] Booking created {"correlationId":"cb668d0d-1b7f-4b2e-a016-2059f3d0e9bb","bookingId":"522eea2f-de2b-464a-a460-677b4a89478a","duplicate":false,"initialStatus":"confirmed","durationMs":7011,"maskedEmail":"bo***d@example.com","maskedPhone":"********8303"}
[2025-11-16T12:17:27.629Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cb668d0d-1b7f-4b2e-a016-2059f3d0e9bb","bookingId":"522eea2f-de2b-464a-a460-677b4a89478a","reference":"4DXAPYEZDP","bookingDate":"2026-04-06","startTime":"16:30:00","endTime":"18:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:26.836Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2104,"attemptId":"95f41246-3144-4f66-8bb7-c16c3d7a3c9e","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7011,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7218,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["MD-06"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"14907e37-d5df-4b1c-adec-56484f5e788f","tableId":"e581bf2d-4baa-4263-b5db-ce6e415010cc","tableNumber":"MD-06","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:17:27.630Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f2dc38dc-47b3-45be-844f-12078d0f37bd","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:27.630Z] [INFO] [submit] Submitting booking request {"correlationId":"f2dc38dc-47b3-45be-844f-12078d0f37bd","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:30","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:17:34.432Z] [INFO] [submit] Booking created {"correlationId":"f2dc38dc-47b3-45be-844f-12078d0f37bd","bookingId":"b3e7206d-2466-4544-8688-46968dac6ba6","duplicate":false,"initialStatus":"confirmed","durationMs":6801,"maskedEmail":"bo***c@example.com","maskedPhone":"********3832"}
[2025-11-16T12:17:34.665Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f2dc38dc-47b3-45be-844f-12078d0f37bd","bookingId":"b3e7206d-2466-4544-8688-46968dac6ba6","reference":"QRD64LPZ3A","bookingDate":"2026-04-06","startTime":"16:30:00","endTime":"18:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:33.924Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2164,"attemptId":"728a87db-6c56-4641-a8dd-440634b8ca6f","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6801,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7035,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["OG-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3792a861-3510-4b12-bd16-8e3ab77d16f5","tableId":"32fd3505-2418-4a8f-9b4a-4e18eae92b50","tableNumber":"OG-02","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 7035, max: 7903, avg: 7506.75, p95: 7871 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2.5, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-05', 'MD-06', 'OG-02', 'PT-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
