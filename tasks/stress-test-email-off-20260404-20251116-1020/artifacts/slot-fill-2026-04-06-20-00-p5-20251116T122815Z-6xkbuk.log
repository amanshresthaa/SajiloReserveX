
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 20\:00 --party-size 5 --stress --stress-max 3 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-16T12:28:16.138Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5b536038-f60b-4642-b914-8e09c64c78a1","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:28:16.138Z] [INFO] [submit] Submitting booking request {"correlationId":"5b536038-f60b-4642-b914-8e09c64c78a1","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"20:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:28:22.799Z] [INFO] [submit] Booking created {"correlationId":"5b536038-f60b-4642-b914-8e09c64c78a1","bookingId":"9cca1f9a-de1e-4236-b188-fdee14bc4a6e","duplicate":false,"initialStatus":"confirmed","durationMs":6659,"maskedEmail":"bo***8@example.com","maskedPhone":"********6038"}
[2025-11-16T12:28:23.026Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5b536038-f60b-4642-b914-8e09c64c78a1","bookingId":"9cca1f9a-de1e-4236-b188-fdee14bc4a6e","reference":"JSXNTBCBGL","bookingDate":"2026-04-06","startTime":"20:00:00","endTime":"22:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:28:22.348Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2100,"attemptId":"efda2058-c1dd-47b2-9394-bc4a34d581e7","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6659,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6888,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"55299e0b-fbda-491f-afff-dc04bcddcccf","tableId":"42a3ad2c-e3a3-453e-940a-f5e8405f601a","tableNumber":"OG-04","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:28:23.027Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b6dda3e6-314d-4f32-a0ad-d0ecb88f1f01","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:28:23.027Z] [INFO] [submit] Submitting booking request {"correlationId":"b6dda3e6-314d-4f32-a0ad-d0ecb88f1f01","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"20:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:28:29.495Z] [INFO] [submit] Booking created {"correlationId":"b6dda3e6-314d-4f32-a0ad-d0ecb88f1f01","bookingId":"aa91c323-639d-470d-aec8-d3456e2ec0da","duplicate":false,"initialStatus":"confirmed","durationMs":6468,"maskedEmail":"bo***6@example.com","maskedPhone":"********0346"}
[2025-11-16T12:28:29.721Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b6dda3e6-314d-4f32-a0ad-d0ecb88f1f01","bookingId":"aa91c323-639d-470d-aec8-d3456e2ec0da","reference":"TBRFLLT24F","bookingDate":"2026-04-06","startTime":"20:00:00","endTime":"22:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:28:29.081Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2009,"attemptId":"86c6dfed-c6ee-4d7f-85b6-1dd1546f8e65","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6468,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6694,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b627ab48-e98a-4064-964f-123785345f03","tableId":"bcc8a889-eb19-4197-a188-83269fa3f7b1","tableNumber":"PR-04","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:28:29.722Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"589d1d40-76fc-4323-b22c-862964e69f85","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:28:29.722Z] [INFO] [submit] Submitting booking request {"correlationId":"589d1d40-76fc-4323-b22c-862964e69f85","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"20:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:28:36.481Z] [INFO] [submit] Booking created {"correlationId":"589d1d40-76fc-4323-b22c-862964e69f85","bookingId":"3a326e26-3fe6-4740-a0a6-9024e6b0561c","duplicate":false,"initialStatus":"confirmed","durationMs":6758,"maskedEmail":"bo***0@example.com","maskedPhone":"********1340"}
[2025-11-16T12:28:36.785Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"589d1d40-76fc-4323-b22c-862964e69f85","bookingId":"3a326e26-3fe6-4740-a0a6-9024e6b0561c","reference":"JWEEBBMR5X","bookingDate":"2026-04-06","startTime":"20:00:00","endTime":"22:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:28:35.935Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1910,"attemptId":"4a3d6591-0d77-4d28-8e0e-282db60740fa","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6758,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7063,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PT-05"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b73528a1-a0ba-436b-a90f-4eb106e35eff","tableId":"1cc1d9b7-a560-48d0-b290-3c63bf6e7dba","tableNumber":"PT-05","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 3,
  successes: 3,
  failures: 0,
  maxRuns: 3,
  completedTarget: true,
  durationMs: { count: 3, min: 6694, max: 7063, avg: 6881.666666666667, p95: 6888 },
  seatWaste: { count: 3, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 3, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-04', 'PR-04', 'PT-05' ]
}
‚úÖ Stress run completed 3 booking(s) without failure.
