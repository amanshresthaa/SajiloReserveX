
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 14\:00 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[2025-11-16T12:12:00.608Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a00b1bc0-40a3-4a3c-b98f-7a0258adc292","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:00.609Z] [INFO] [submit] Submitting booking request {"correlationId":"a00b1bc0-40a3-4a3c-b98f-7a0258adc292","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:12:09.005Z] [INFO] [submit] Booking created {"correlationId":"a00b1bc0-40a3-4a3c-b98f-7a0258adc292","bookingId":"7284e4e7-0c30-47fa-95cd-dccf0be54a72","duplicate":false,"initialStatus":"confirmed","durationMs":8395,"maskedEmail":"bo***0@example.com","maskedPhone":"********1120"}
[2025-11-16T12:12:09.286Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a00b1bc0-40a3-4a3c-b98f-7a0258adc292","bookingId":"7284e4e7-0c30-47fa-95cd-dccf0be54a72","reference":"63VCD8DC6Q","bookingDate":"2026-04-06","startTime":"14:00:00","endTime":"15:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:08.236Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2196,"attemptId":"bd85e60e-5831-409e-b3f3-f17e82bb2bab","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":8395,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8678,"tablesAssigned":2,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-03","MD-01"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"93eada8f-fd46-426a-802b-dd6f93d8e0c6","tableId":"38694eb6-cde9-4253-8b8a-cdcd4b74084e","tableNumber":"MD-03","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null},{"id":"88442102-779c-47d4-ae07-037daa11ae60","tableId":"75329c85-efdc-40cb-87fe-bb4f2242b802","tableNumber":"MD-01","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:12:09.287Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6a3990f7-715c-450f-b8b8-55fe68cad4aa","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:09.287Z] [INFO] [submit] Submitting booking request {"correlationId":"6a3990f7-715c-450f-b8b8-55fe68cad4aa","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:12:17.365Z] [INFO] [submit] Booking created {"correlationId":"6a3990f7-715c-450f-b8b8-55fe68cad4aa","bookingId":"82eeaa4c-43c3-43b4-9595-b687f28580fd","duplicate":false,"initialStatus":"confirmed","durationMs":8078,"maskedEmail":"bo***7@example.com","maskedPhone":"********9057"}
[2025-11-16T12:12:17.587Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6a3990f7-715c-450f-b8b8-55fe68cad4aa","bookingId":"82eeaa4c-43c3-43b4-9595-b687f28580fd","reference":"UFCT886B2S","bookingDate":"2026-04-06","startTime":"14:00:00","endTime":"15:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:16.747Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2394,"attemptId":"5f68204a-9b9a-4696-b030-7c9758f6b4d3","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":8078,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8300,"tablesAssigned":1,"totalCapacity":8,"seatWaste":3,"tableNumbers":["MD-09"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3542769a-34e8-497a-b280-752cc2dbb671","tableId":"df31eae2-3159-4194-a843-d9bb9b56121a","tableNumber":"MD-09","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:12:17.588Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8d89b5e9-0e38-4225-9670-1b750cdeb99c","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:17.588Z] [INFO] [submit] Submitting booking request {"correlationId":"8d89b5e9-0e38-4225-9670-1b750cdeb99c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:12:24.340Z] [INFO] [submit] Booking created {"correlationId":"8d89b5e9-0e38-4225-9670-1b750cdeb99c","bookingId":"5b2f58a8-10ec-4e4a-a084-6c92110f8ae0","duplicate":false,"initialStatus":"confirmed","durationMs":6751,"maskedEmail":"bo***9@example.com","maskedPhone":"********1549"}
[2025-11-16T12:12:24.557Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8d89b5e9-0e38-4225-9670-1b750cdeb99c","bookingId":"5b2f58a8-10ec-4e4a-a084-6c92110f8ae0","reference":"A99T6ZD2TW","bookingDate":"2026-04-06","startTime":"14:00:00","endTime":"15:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:23.685Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1964,"attemptId":"ba86ffb4-e29d-4693-b9f9-d0f1ed09770d","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6751,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6969,"tablesAssigned":1,"totalCapacity":8,"seatWaste":3,"tableNumbers":["MD-10"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ef4cd958-0967-40e3-ae3e-3b423d736ca8","tableId":"d1f34cf1-07da-4171-84f7-71b4490a7276","tableNumber":"MD-10","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:12:24.557Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b727bfcc-961b-4342-9947-fbef91d901ba","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:24.557Z] [INFO] [submit] Submitting booking request {"correlationId":"b727bfcc-961b-4342-9947-fbef91d901ba","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:12:31.566Z] [INFO] [submit] Booking created {"correlationId":"b727bfcc-961b-4342-9947-fbef91d901ba","bookingId":"9fefe451-b81c-435d-9a36-fdff273fd0a7","duplicate":false,"initialStatus":"confirmed","durationMs":7008,"maskedEmail":"bo***c@example.com","maskedPhone":"********1522"}
[2025-11-16T12:12:31.821Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b727bfcc-961b-4342-9947-fbef91d901ba","bookingId":"9fefe451-b81c-435d-9a36-fdff273fd0a7","reference":"QVFBNHYATW","bookingDate":"2026-04-06","startTime":"14:00:00","endTime":"15:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:31.086Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2019,"attemptId":"ca15eb99-d55d-4352-8ae0-0349de759579","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7008,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7264,"tablesAssigned":1,"totalCapacity":8,"seatWaste":3,"tableNumbers":["OG-06"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"fe607dda-96f5-4a3b-8645-03e5126dbd4c","tableId":"4545d5f6-817b-468c-8e32-264c9fdd9213","tableNumber":"OG-06","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6969, max: 8678, avg: 7802.75, p95: 8300 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2.5, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.25, p95: 1 },
  uniqueTables: [ 'MD-01', 'MD-03', 'MD-09', 'MD-10', 'OG-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
