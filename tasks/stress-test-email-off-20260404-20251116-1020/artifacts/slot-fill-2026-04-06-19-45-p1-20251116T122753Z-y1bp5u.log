
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 19\:45 --party-size 1 --stress --stress-max 3 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[2025-11-16T12:27:54.270Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"73132558-56de-4c5f-8446-01ad60095861","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:27:54.270Z] [INFO] [submit] Submitting booking request {"correlationId":"73132558-56de-4c5f-8446-01ad60095861","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"19:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:28:01.265Z] [INFO] [submit] Booking created {"correlationId":"73132558-56de-4c5f-8446-01ad60095861","bookingId":"2693d2ac-c0df-49c5-ab6d-9633d7574937","duplicate":false,"initialStatus":"confirmed","durationMs":6994,"maskedEmail":"bo***8@example.com","maskedPhone":"********2558"}
[2025-11-16T12:28:01.515Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"73132558-56de-4c5f-8446-01ad60095861","bookingId":"2693d2ac-c0df-49c5-ab6d-9633d7574937","reference":"ZNPTLKTDTM","bookingDate":"2026-04-06","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:28:00.802Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2017,"attemptId":"719b8375-cee6-4bd5-b270-6954b7d35f85","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6994,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7245,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["BA-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"15b5b7ca-f0e5-44f3-a6cf-7438c15ca672","tableId":"49d15284-c41d-449a-96f5-45a01dbb19f8","tableNumber":"BA-01","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:28:01.515Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e2b7c9db-beac-43ad-b12f-7e189b7929b0","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:28:01.515Z] [INFO] [submit] Submitting booking request {"correlationId":"e2b7c9db-beac-43ad-b12f-7e189b7929b0","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"19:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:28:08.331Z] [INFO] [submit] Booking created {"correlationId":"e2b7c9db-beac-43ad-b12f-7e189b7929b0","bookingId":"d5162407-c711-421a-95ac-08ac6edb896a","duplicate":false,"initialStatus":"confirmed","durationMs":6815,"maskedEmail":"bo***b@example.com","maskedPhone":"********2931"}
[2025-11-16T12:28:08.569Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e2b7c9db-beac-43ad-b12f-7e189b7929b0","bookingId":"d5162407-c711-421a-95ac-08ac6edb896a","reference":"M59FCHDGS8","bookingDate":"2026-04-06","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:28:07.881Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2244,"attemptId":"3a8873bb-837f-417c-8407-ec4049013260","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6815,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7054,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["BA-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ba588b90-b999-490e-a8e6-505ea1d78042","tableId":"6d20353b-fbb2-48c2-9335-b68bc235db7c","tableNumber":"BA-02","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:28:08.570Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"476e224b-f840-4f80-a7ba-62f360183e38","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:28:08.570Z] [INFO] [submit] Submitting booking request {"correlationId":"476e224b-f840-4f80-a7ba-62f360183e38","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"19:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:28:15.209Z] [INFO] [submit] Booking created {"correlationId":"476e224b-f840-4f80-a7ba-62f360183e38","bookingId":"1b655979-749b-4f30-a579-51f86eed9a4f","duplicate":false,"initialStatus":"confirmed","durationMs":6638,"maskedEmail":"bo***b@example.com","maskedPhone":"********2241"}
[2025-11-16T12:28:15.439Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"476e224b-f840-4f80-a7ba-62f360183e38","bookingId":"1b655979-749b-4f30-a579-51f86eed9a4f","reference":"7R7KVUD2KN","bookingDate":"2026-04-06","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:28:14.729Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2050,"attemptId":"c4202ce5-e418-4477-b682-53e7c5167b9c","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6638,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6869,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["MD-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8b698eb2-9bda-4fc8-9e49-e9888106436e","tableId":"75329c85-efdc-40cb-87fe-bb4f2242b802","tableNumber":"MD-01","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 3,
  successes: 3,
  failures: 0,
  maxRuns: 3,
  completedTarget: true,
  durationMs: { count: 3, min: 6869, max: 7245, avg: 7056, p95: 7054 },
  seatWaste: { count: 3, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 3, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01' ]
}
‚úÖ Stress run completed 3 booking(s) without failure.
