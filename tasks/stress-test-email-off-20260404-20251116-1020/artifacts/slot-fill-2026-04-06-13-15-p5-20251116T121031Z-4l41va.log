
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 13\:15 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  enable debug logging with { debug: true }
[2025-11-16T12:10:32.632Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"fc000aef-9a87-4cba-9aa0-86d652226fc3","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:32.632Z] [INFO] [submit] Submitting booking request {"correlationId":"fc000aef-9a87-4cba-9aa0-86d652226fc3","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:10:39.143Z] [INFO] [submit] Booking created {"correlationId":"fc000aef-9a87-4cba-9aa0-86d652226fc3","bookingId":"5f2270b3-66c5-494d-87dc-2eb47b46b5dd","duplicate":false,"initialStatus":"confirmed","durationMs":6510,"maskedEmail":"bo***f@example.com","maskedPhone":"********0045"}
[2025-11-16T12:10:39.491Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"fc000aef-9a87-4cba-9aa0-86d652226fc3","bookingId":"5f2270b3-66c5-494d-87dc-2eb47b46b5dd","reference":"LJKBZBL639","bookingDate":"2026-04-06","startTime":"13:15:00","endTime":"14:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:38.619Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1872,"attemptId":"38db441d-991b-4c12-b7c8-6fcd80f11694","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6510,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6859,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7d3f213e-78dc-4ee0-8f23-b84797fb4dee","tableId":"42a3ad2c-e3a3-453e-940a-f5e8405f601a","tableNumber":"OG-04","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:10:39.492Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5b4cca58-cb70-470f-840a-80086da6cc45","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:39.492Z] [INFO] [submit] Submitting booking request {"correlationId":"5b4cca58-cb70-470f-840a-80086da6cc45","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:10:46.144Z] [INFO] [submit] Booking created {"correlationId":"5b4cca58-cb70-470f-840a-80086da6cc45","bookingId":"dd54e194-0ef7-484b-8b19-b9c921bb2183","duplicate":false,"initialStatus":"confirmed","durationMs":6651,"maskedEmail":"bo***8@example.com","maskedPhone":"********2058"}
[2025-11-16T12:10:46.466Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5b4cca58-cb70-470f-840a-80086da6cc45","bookingId":"dd54e194-0ef7-484b-8b19-b9c921bb2183","reference":"LLY8JZY6SF","bookingDate":"2026-04-06","startTime":"13:15:00","endTime":"14:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:45.623Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1914,"attemptId":"6dcd8b10-96a5-4950-bf3c-ff5109a8512e","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6651,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6974,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-05"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9ca5d395-bd44-4442-850a-9d1da90c0118","tableId":"24d44799-86c7-4b2c-aeec-acbcd36f0e69","tableNumber":"OG-05","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:10:46.467Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"243ee7b0-e469-4f65-9162-d17a53fc3612","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:46.467Z] [INFO] [submit] Submitting booking request {"correlationId":"243ee7b0-e469-4f65-9162-d17a53fc3612","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:10:54.339Z] [INFO] [submit] Booking created {"correlationId":"243ee7b0-e469-4f65-9162-d17a53fc3612","bookingId":"f6a19d83-a292-417b-ba15-7158398b4fd9","duplicate":false,"initialStatus":"confirmed","durationMs":7872,"maskedEmail":"bo***0@example.com","maskedPhone":"********4710"}
[2025-11-16T12:10:54.555Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"243ee7b0-e469-4f65-9162-d17a53fc3612","bookingId":"f6a19d83-a292-417b-ba15-7158398b4fd9","reference":"NQBCR4W29B","bookingDate":"2026-04-06","startTime":"13:15:00","endTime":"14:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:53.839Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2549,"attemptId":"dcb1351c-1458-4dfb-b2a8-525960c0243e","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7872,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8088,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-03"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a6b9bc3e-b760-483c-b5b7-c0c753b6c066","tableId":"c5dab7a4-34fc-4ba0-965a-d3296d96726c","tableNumber":"PR-03","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:10:54.556Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"dcf4e191-d3d5-4054-a2b6-197acd071f8b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:54.556Z] [INFO] [submit] Submitting booking request {"correlationId":"dcf4e191-d3d5-4054-a2b6-197acd071f8b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:02.294Z] [INFO] [submit] Booking created {"correlationId":"dcf4e191-d3d5-4054-a2b6-197acd071f8b","bookingId":"1251e78d-340d-46be-9d5a-5e2b4e54710a","duplicate":false,"initialStatus":"confirmed","durationMs":7737,"maskedEmail":"bo***1@example.com","maskedPhone":"********4191"}
[2025-11-16T12:11:02.525Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"dcf4e191-d3d5-4054-a2b6-197acd071f8b","bookingId":"1251e78d-340d-46be-9d5a-5e2b4e54710a","reference":"3MCXFBQHJH","bookingDate":"2026-04-06","startTime":"13:15:00","endTime":"14:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:01.768Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2388,"attemptId":"1b6de6ac-5675-44d5-8e6c-af1a9b50e5d9","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7737,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7969,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5940a509-7e7d-456d-ac6c-8666dab25f5b","tableId":"bcc8a889-eb19-4197-a188-83269fa3f7b1","tableNumber":"PR-04","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6859, max: 8088, avg: 7472.5, p95: 7969 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-04', 'OG-05', 'PR-03', 'PR-04' ]
}
✅ Stress run completed 4 booking(s) without failure.
