
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 12\:45 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2025-11-16T12:09:36.399Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6783e01f-e5c3-4755-8be9-86c006110c49","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:36.399Z] [INFO] [submit] Submitting booking request {"correlationId":"6783e01f-e5c3-4755-8be9-86c006110c49","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:09:43.780Z] [INFO] [submit] Booking created {"correlationId":"6783e01f-e5c3-4755-8be9-86c006110c49","bookingId":"5e98647a-297e-4c03-a0ad-a4795c0d68ba","duplicate":false,"initialStatus":"confirmed","durationMs":7380,"maskedEmail":"bo***f@example.com","maskedPhone":"********4015"}
[2025-11-16T12:09:44.027Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6783e01f-e5c3-4755-8be9-86c006110c49","bookingId":"5e98647a-297e-4c03-a0ad-a4795c0d68ba","reference":"PJPFF4T3KZ","bookingDate":"2026-04-06","startTime":"12:45:00","endTime":"14:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:43.253Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2112,"attemptId":"1ee862d8-f417-4352-989f-51afc65a5ffa","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7380,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7628,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["OG-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"57d4e8aa-a149-47f4-a7ef-ea0be6a1c8f1","tableId":"32fd3505-2418-4a8f-9b4a-4e18eae92b50","tableNumber":"OG-02","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:09:44.027Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b059e246-2101-4309-8900-e153dd25b154","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:44.027Z] [INFO] [submit] Submitting booking request {"correlationId":"b059e246-2101-4309-8900-e153dd25b154","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:09:50.442Z] [INFO] [submit] Booking created {"correlationId":"b059e246-2101-4309-8900-e153dd25b154","bookingId":"b1b83899-fdf6-47e7-ba44-650724131fe1","duplicate":false,"initialStatus":"confirmed","durationMs":6414,"maskedEmail":"bo***6@example.com","maskedPhone":"********4246"}
[2025-11-16T12:09:50.712Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b059e246-2101-4309-8900-e153dd25b154","bookingId":"b1b83899-fdf6-47e7-ba44-650724131fe1","reference":"BRWN93VBSW","bookingDate":"2026-04-06","startTime":"12:45:00","endTime":"14:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:49.987Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1884,"attemptId":"7fd6d90e-3aeb-4646-946c-8f0484e30be8","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6414,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6684,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["OG-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2252d263-d3bb-42f2-bc7d-7738e7db2254","tableId":"438ffaac-0215-4817-8ff6-e1516d67ce53","tableNumber":"OG-03","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:09:50.713Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0f203a0c-c812-456a-a970-0fbab08f0deb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:50.713Z] [INFO] [submit] Submitting booking request {"correlationId":"0f203a0c-c812-456a-a970-0fbab08f0deb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:09:57.403Z] [INFO] [submit] Booking created {"correlationId":"0f203a0c-c812-456a-a970-0fbab08f0deb","bookingId":"e40b333b-2277-4b2c-83ee-69cf176b425a","duplicate":false,"initialStatus":"confirmed","durationMs":6689,"maskedEmail":"bo***c@example.com","maskedPhone":"********3002"}
[2025-11-16T12:09:57.621Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0f203a0c-c812-456a-a970-0fbab08f0deb","bookingId":"e40b333b-2277-4b2c-83ee-69cf176b425a","reference":"842KW4X928","bookingDate":"2026-04-06","startTime":"12:45:00","endTime":"14:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:56.958Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1919,"attemptId":"05e06944-9d9b-404c-8ca9-c7a4a5741bc8","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6689,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6908,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-01"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7c8ff19b-4823-45ff-a2da-4504e72e74ae","tableId":"cbcdedc9-1c2b-4d5d-a2d7-49833d4c4f0f","tableNumber":"PR-01","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:09:57.621Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6e350b34-c9f8-4cb1-842f-e856c323420b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:09:57.621Z] [INFO] [submit] Submitting booking request {"correlationId":"6e350b34-c9f8-4cb1-842f-e856c323420b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:10:03.914Z] [INFO] [submit] Booking created {"correlationId":"6e350b34-c9f8-4cb1-842f-e856c323420b","bookingId":"348a45bf-dfb4-4cdf-8937-32e581de52fa","duplicate":false,"initialStatus":"confirmed","durationMs":6293,"maskedEmail":"bo***4@example.com","maskedPhone":"********0134"}
[2025-11-16T12:10:04.142Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6e350b34-c9f8-4cb1-842f-e856c323420b","bookingId":"348a45bf-dfb4-4cdf-8937-32e581de52fa","reference":"5L7WX3GPVN","bookingDate":"2026-04-06","startTime":"12:45:00","endTime":"14:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:03.434Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1831,"attemptId":"bf6ea43a-834d-460a-a51e-c23250949e08","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6293,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6521,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"12141b1c-2e09-4bcb-82d6-da1bff57a8f9","tableId":"b2bd5f70-f175-4d36-a814-a1046aa2f2f6","tableNumber":"PR-02","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6521, max: 7628, avg: 6935.25, p95: 6908 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-02', 'OG-03', 'PR-01', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
