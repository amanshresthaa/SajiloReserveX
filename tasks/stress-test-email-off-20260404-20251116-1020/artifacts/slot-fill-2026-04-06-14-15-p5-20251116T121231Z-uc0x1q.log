
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 14\:15 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-16T12:12:32.591Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f1f2186d-0616-43f1-adb2-9c4fc5c4f1ba","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:32.591Z] [INFO] [submit] Submitting booking request {"correlationId":"f1f2186d-0616-43f1-adb2-9c4fc5c4f1ba","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:12:39.375Z] [INFO] [submit] Booking created {"correlationId":"f1f2186d-0616-43f1-adb2-9c4fc5c4f1ba","bookingId":"20b98537-6c61-4b53-98ed-4e1003a98114","duplicate":false,"initialStatus":"confirmed","durationMs":6784,"maskedEmail":"bo***d@example.com","maskedPhone":"********1863"}
[2025-11-16T12:12:39.606Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f1f2186d-0616-43f1-adb2-9c4fc5c4f1ba","bookingId":"20b98537-6c61-4b53-98ed-4e1003a98114","reference":"TEE7ZNNAE7","bookingDate":"2026-04-06","startTime":"14:15:00","endTime":"15:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:38.922Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2153,"attemptId":"34e616a9-10d0-4529-9655-09ffb0b76201","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6784,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7016,"tablesAssigned":1,"totalCapacity":8,"seatWaste":3,"tableNumbers":["PT-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"10ea2f85-9ba1-4a9b-88bc-09e020bd3510","tableId":"092429df-9dd0-42e7-8c32-5eb8f84bd418","tableNumber":"PT-07","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:12:39.606Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"08845a9c-a351-44ac-bf0e-e93e5d816134","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:39.606Z] [INFO] [submit] Submitting booking request {"correlationId":"08845a9c-a351-44ac-bf0e-e93e5d816134","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:12:46.622Z] [INFO] [submit] Booking created {"correlationId":"08845a9c-a351-44ac-bf0e-e93e5d816134","bookingId":"c92fbb7b-98e7-479b-a065-3c433abac9c0","duplicate":false,"initialStatus":"confirmed","durationMs":7015,"maskedEmail":"bo***c@example.com","maskedPhone":"********5092"}
[2025-11-16T12:12:46.846Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"08845a9c-a351-44ac-bf0e-e93e5d816134","bookingId":"c92fbb7b-98e7-479b-a065-3c433abac9c0","reference":"YHNUS9V8DK","bookingDate":"2026-04-06","startTime":"14:15:00","endTime":"15:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:46.148Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1919,"attemptId":"2165b839-db9b-4375-957a-6f08ecbcf3f7","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7015,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7240,"tablesAssigned":1,"totalCapacity":8,"seatWaste":3,"tableNumbers":["PT-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"532580cb-d4a4-460b-9eda-363c72d84fc9","tableId":"c0b9bf36-a98b-4837-b650-6a6ee50bb5ca","tableNumber":"PT-08","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:12:46.847Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"520ce2c1-fa0e-47c3-90d7-d6bab1b7e936","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:46.847Z] [INFO] [submit] Submitting booking request {"correlationId":"520ce2c1-fa0e-47c3-90d7-d6bab1b7e936","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:12:53.544Z] [INFO] [submit] Booking created {"correlationId":"520ce2c1-fa0e-47c3-90d7-d6bab1b7e936","bookingId":"38f723c9-fb34-4be8-b8ff-480c07a6e26d","duplicate":false,"initialStatus":"confirmed","durationMs":6697,"maskedEmail":"bo***1@example.com","maskedPhone":"********4221"}
[2025-11-16T12:12:53.763Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"520ce2c1-fa0e-47c3-90d7-d6bab1b7e936","bookingId":"38f723c9-fb34-4be8-b8ff-480c07a6e26d","reference":"LL9MMTVTVA","bookingDate":"2026-04-06","startTime":"14:15:00","endTime":"15:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:53.063Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1987,"attemptId":"e490b5b2-3985-47a2-91ce-14ad1cb6ca65","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6697,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6916,"tablesAssigned":2,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-04","MD-02"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d3307cdc-a81b-45d2-b0d1-816c6c884d45","tableId":"c5d016d2-7c61-4038-afc3-220a2fc91ea3","tableNumber":"MD-04","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null},{"id":"f7c41749-9d4e-4bc0-9d98-d771425b3879","tableId":"eb535103-6058-426f-9a4c-fa47b07c3783","tableNumber":"MD-02","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:12:53.763Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"487769fd-31bb-483e-8edd-2b31b1a1b70a","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:12:53.763Z] [INFO] [submit] Submitting booking request {"correlationId":"487769fd-31bb-483e-8edd-2b31b1a1b70a","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:13:00.417Z] [INFO] [submit] Booking created {"correlationId":"487769fd-31bb-483e-8edd-2b31b1a1b70a","bookingId":"469f3bbe-3b11-4db0-b39e-6f964da0f4fe","duplicate":false,"initialStatus":"confirmed","durationMs":6654,"maskedEmail":"bo***d@example.com","maskedPhone":"********6953"}
[2025-11-16T12:13:00.628Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"487769fd-31bb-483e-8edd-2b31b1a1b70a","bookingId":"469f3bbe-3b11-4db0-b39e-6f964da0f4fe","reference":"RMX79RHU3P","bookingDate":"2026-04-06","startTime":"14:15:00","endTime":"15:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:12:59.939Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2047,"attemptId":"83d57028-388c-4d15-afe6-e50a02acaa9e","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6654,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6865,"tablesAssigned":2,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-02","OG-01"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9f72e45e-ed28-43b5-b83c-75d3ad35fef3","tableId":"32fd3505-2418-4a8f-9b4a-4e18eae92b50","tableNumber":"OG-02","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null},{"id":"b2665b98-7b2a-430e-be48-1ed1e3b1af55","tableId":"ad1c68a5-a5dd-4625-b517-10a43511bbca","tableNumber":"OG-01","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6865, max: 7240, avg: 7009.25, p95: 7016 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.5, p95: 2 },
  uniqueTables: [ 'MD-02', 'MD-04', 'OG-01', 'OG-02', 'PT-07', 'PT-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
