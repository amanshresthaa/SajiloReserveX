
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 16\:00 --party-size 1 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-16T12:16:02.293Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5e45e348-ffeb-47dc-8357-df1c89b87552","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:02.293Z] [INFO] [submit] Submitting booking request {"correlationId":"5e45e348-ffeb-47dc-8357-df1c89b87552","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:16:10.405Z] [INFO] [submit] Booking created {"correlationId":"5e45e348-ffeb-47dc-8357-df1c89b87552","bookingId":"ae783bfc-54bb-4764-84d0-994fef1abcd8","duplicate":false,"initialStatus":"confirmed","durationMs":8110,"maskedEmail":"bo***8@example.com","maskedPhone":"********4348"}
[2025-11-16T12:16:10.638Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5e45e348-ffeb-47dc-8357-df1c89b87552","bookingId":"ae783bfc-54bb-4764-84d0-994fef1abcd8","reference":"TQT5Q3CCAQ","bookingDate":"2026-04-06","startTime":"16:00:00","endTime":"17:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:09.845Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2094,"attemptId":"eea7b603-1cfa-440b-834e-5b670963a44f","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":8110,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8344,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["OG-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3b2e63b6-224a-4b60-9818-289713979159","tableId":"ad1c68a5-a5dd-4625-b517-10a43511bbca","tableNumber":"OG-01","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:16:10.638Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e5fb487a-c158-4a1a-95bb-6e4aa70d5180","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:10.639Z] [INFO] [submit] Submitting booking request {"correlationId":"e5fb487a-c158-4a1a-95bb-6e4aa70d5180","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:16:17.846Z] [INFO] [submit] Booking created {"correlationId":"e5fb487a-c158-4a1a-95bb-6e4aa70d5180","bookingId":"a87a1fcd-878b-482b-8d43-b45e055a1ebf","duplicate":false,"initialStatus":"confirmed","durationMs":7206,"maskedEmail":"bo***a@example.com","maskedPhone":"********4870"}
[2025-11-16T12:16:18.058Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e5fb487a-c158-4a1a-95bb-6e4aa70d5180","bookingId":"a87a1fcd-878b-482b-8d43-b45e055a1ebf","reference":"5LKES9QUFH","bookingDate":"2026-04-06","startTime":"16:00:00","endTime":"17:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:17.383Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2335,"attemptId":"5fa018e7-248b-4c88-8448-675d29f24088","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7206,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7420,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["PT-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0d4fef28-d8f0-4462-a01b-4ab6f019b77e","tableId":"31c0e865-f5ef-453b-a3ef-fe994c8561fa","tableNumber":"PT-01","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:16:18.059Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"437752c4-a28d-4206-8d52-9661a2c56182","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:18.059Z] [INFO] [submit] Submitting booking request {"correlationId":"437752c4-a28d-4206-8d52-9661a2c56182","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:16:24.997Z] [INFO] [submit] Booking created {"correlationId":"437752c4-a28d-4206-8d52-9661a2c56182","bookingId":"b0fa8668-47b1-497d-a0a9-4af42ea77118","duplicate":false,"initialStatus":"confirmed","durationMs":6938,"maskedEmail":"bo***4@example.com","maskedPhone":"********5224"}
[2025-11-16T12:16:25.214Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"437752c4-a28d-4206-8d52-9661a2c56182","bookingId":"b0fa8668-47b1-497d-a0a9-4af42ea77118","reference":"FL9MUVCDXM","bookingDate":"2026-04-06","startTime":"16:00:00","endTime":"17:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:24.557Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2302,"attemptId":"220c3d39-d30f-4436-8e5d-50f6042d8266","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6938,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7155,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["BA-06"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5c21ff8c-c0b4-4242-8caf-d1e6838f0770","tableId":"f17cd4e8-32e3-4916-b40c-8c41addeee68","tableNumber":"BA-06","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:16:25.214Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"036b1885-d244-4cb2-93b6-b0f0fd08edd2","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:25.214Z] [INFO] [submit] Submitting booking request {"correlationId":"036b1885-d244-4cb2-93b6-b0f0fd08edd2","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:16:32.486Z] [INFO] [submit] Booking created {"correlationId":"036b1885-d244-4cb2-93b6-b0f0fd08edd2","bookingId":"21eb8011-01a6-41dc-b8f9-f7006954226e","duplicate":false,"initialStatus":"confirmed","durationMs":7271,"maskedEmail":"bo***5@example.com","maskedPhone":"********1885"}
[2025-11-16T12:16:32.702Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"036b1885-d244-4cb2-93b6-b0f0fd08edd2","bookingId":"21eb8011-01a6-41dc-b8f9-f7006954226e","reference":"5DQA45CQ4H","bookingDate":"2026-04-06","startTime":"16:00:00","endTime":"17:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:31.561Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1916,"attemptId":"1e6fcc93-8be2-4852-b896-8ab0f3d812a0","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7271,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7488,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["MD-03"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c0b82f10-cdb6-4090-be2d-dfbf2e224bdd","tableId":"38694eb6-cde9-4253-8b8a-cdcd4b74084e","tableNumber":"MD-03","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 7155, max: 8344, avg: 7601.75, p95: 7488 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-06', 'MD-03', 'OG-01', 'PT-01' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
