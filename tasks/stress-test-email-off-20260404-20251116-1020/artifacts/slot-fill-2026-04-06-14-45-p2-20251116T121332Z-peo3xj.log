
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 14\:45 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[2025-11-16T12:13:32.783Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8155867f-77c9-4a4b-9e50-cad068c9fbf9","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:32.783Z] [INFO] [submit] Submitting booking request {"correlationId":"8155867f-77c9-4a4b-9e50-cad068c9fbf9","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:13:40.038Z] [INFO] [submit] Booking created {"correlationId":"8155867f-77c9-4a4b-9e50-cad068c9fbf9","bookingId":"14014768-69f3-49c9-9f82-ba747ea6478e","duplicate":false,"initialStatus":"confirmed","durationMs":7253,"maskedEmail":"bo***f@example.com","maskedPhone":"********8675"}
[2025-11-16T12:13:40.269Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8155867f-77c9-4a4b-9e50-cad068c9fbf9","bookingId":"14014768-69f3-49c9-9f82-ba747ea6478e","reference":"5K3688JXU8","bookingDate":"2026-04-06","startTime":"14:45:00","endTime":"16:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:39.607Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2188,"attemptId":"156faefa-8d09-481f-a127-813323fe7658","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7253,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7486,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["MD-06"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"24af1192-d4d4-4b42-b89c-376d5e7c4b64","tableId":"e581bf2d-4baa-4263-b5db-ce6e415010cc","tableNumber":"MD-06","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:13:40.269Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"53568ffd-4216-4347-b675-1f0cd75ef3ab","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:40.270Z] [INFO] [submit] Submitting booking request {"correlationId":"53568ffd-4216-4347-b675-1f0cd75ef3ab","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:13:46.680Z] [INFO] [submit] Booking created {"correlationId":"53568ffd-4216-4347-b675-1f0cd75ef3ab","bookingId":"ebf9e10c-33d2-425a-ab12-9dbb9cdbaa4d","duplicate":false,"initialStatus":"confirmed","durationMs":6409,"maskedEmail":"bo***d@example.com","maskedPhone":"********8553"}
[2025-11-16T12:13:46.914Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"53568ffd-4216-4347-b675-1f0cd75ef3ab","bookingId":"ebf9e10c-33d2-425a-ab12-9dbb9cdbaa4d","reference":"C8K84BNR9D","bookingDate":"2026-04-06","startTime":"14:45:00","endTime":"16:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:46.241Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1985,"attemptId":"65f94bcc-b6e0-4e22-a059-8b20fa3e0fd9","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6409,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6645,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["OG-03"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3724b83d-93c0-4d0a-92e5-6cc1d11732e3","tableId":"438ffaac-0215-4817-8ff6-e1516d67ce53","tableNumber":"OG-03","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:13:46.915Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b1fb578c-1982-4c79-837a-92c25c6b199d","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:46.915Z] [INFO] [submit] Submitting booking request {"correlationId":"b1fb578c-1982-4c79-837a-92c25c6b199d","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:13:53.511Z] [INFO] [submit] Booking created {"correlationId":"b1fb578c-1982-4c79-837a-92c25c6b199d","bookingId":"acedc613-882d-4dc9-9cdc-dbf39b636713","duplicate":false,"initialStatus":"confirmed","durationMs":6596,"maskedEmail":"bo***c@example.com","maskedPhone":"********5782"}
[2025-11-16T12:13:53.721Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b1fb578c-1982-4c79-837a-92c25c6b199d","bookingId":"acedc613-882d-4dc9-9cdc-dbf39b636713","reference":"CQMRAEUQZY","bookingDate":"2026-04-06","startTime":"14:45:00","endTime":"16:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:13:53.075Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1965,"attemptId":"a955dcf3-9591-444a-a25b-f950be2c5bf6","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6596,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6806,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["PR-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6f8a94fd-389e-4819-8b2c-731f027fb8e8","tableId":"cbcdedc9-1c2b-4d5d-a2d7-49833d4c4f0f","tableNumber":"PR-01","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:13:53.722Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"50ef057a-2f6b-4c01-957d-096ff4acc2cf","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:13:53.722Z] [INFO] [submit] Submitting booking request {"correlationId":"50ef057a-2f6b-4c01-957d-096ff4acc2cf","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"14:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:14:01.570Z] [INFO] [submit] Booking created {"correlationId":"50ef057a-2f6b-4c01-957d-096ff4acc2cf","bookingId":"a161ef13-f75f-46f2-a4fa-6df47a530987","duplicate":false,"initialStatus":"confirmed","durationMs":7848,"maskedEmail":"bo***a@example.com","maskedPhone":"********0570"}
[2025-11-16T12:14:01.802Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"50ef057a-2f6b-4c01-957d-096ff4acc2cf","bookingId":"a161ef13-f75f-46f2-a4fa-6df47a530987","reference":"RY8U7G2SVE","bookingDate":"2026-04-06","startTime":"14:45:00","endTime":"16:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:00.784Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1952,"attemptId":"2d5c5b3c-3855-42a0-95e5-7fb60560235a","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7848,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8080,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["PR-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"acd21c36-e1f2-44a6-9f21-1d82ad69b443","tableId":"b2bd5f70-f175-4d36-a814-a1046aa2f2f6","tableNumber":"PR-02","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6645, max: 8080, avg: 7254.25, p95: 7486 },
  seatWaste: { count: 4, min: 2, max: 2, avg: 2, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-06', 'OG-03', 'PR-01', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
