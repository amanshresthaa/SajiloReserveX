
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 15\:45 --party-size 1 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2025-11-16T12:15:31.486Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e3569c8f-de97-44fb-8aef-fa1a208eb4a4","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:31.487Z] [INFO] [submit] Submitting booking request {"correlationId":"e3569c8f-de97-44fb-8aef-fa1a208eb4a4","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:15:38.043Z] [INFO] [submit] Booking created {"correlationId":"e3569c8f-de97-44fb-8aef-fa1a208eb4a4","bookingId":"b1860096-39f8-49ea-8526-8e6d112db5a3","duplicate":false,"initialStatus":"confirmed","durationMs":6554,"maskedEmail":"bo***f@example.com","maskedPhone":"********9285"}
[2025-11-16T12:15:38.268Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e3569c8f-de97-44fb-8aef-fa1a208eb4a4","bookingId":"b1860096-39f8-49ea-8526-8e6d112db5a3","reference":"9MJX727FZJ","bookingDate":"2026-04-06","startTime":"15:45:00","endTime":"17:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:37.556Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2102,"attemptId":"39f06831-10e7-432a-8026-7a9ad6fe1841","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6554,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6781,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["BA-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e9c2208e-3cf7-43c3-ae5a-2494ed620913","tableId":"49d15284-c41d-449a-96f5-45a01dbb19f8","tableNumber":"BA-01","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:15:38.268Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0641fcf7-b763-499f-bbc1-41a472d8b61a","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:38.268Z] [INFO] [submit] Submitting booking request {"correlationId":"0641fcf7-b763-499f-bbc1-41a472d8b61a","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:15:45.335Z] [INFO] [submit] Booking created {"correlationId":"0641fcf7-b763-499f-bbc1-41a472d8b61a","bookingId":"0ea15ea0-aaf9-4a97-b2cc-d6546899fd19","duplicate":false,"initialStatus":"confirmed","durationMs":7066,"maskedEmail":"bo***7@example.com","maskedPhone":"********5257"}
[2025-11-16T12:15:45.571Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0641fcf7-b763-499f-bbc1-41a472d8b61a","bookingId":"0ea15ea0-aaf9-4a97-b2cc-d6546899fd19","reference":"4S5DULWQVU","bookingDate":"2026-04-06","startTime":"15:45:00","endTime":"17:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:44.879Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2283,"attemptId":"280204bc-e033-4215-ab28-15cb169e237a","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7066,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7303,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["BA-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5f856aab-b192-4612-b9b5-433d8f756d1c","tableId":"6d20353b-fbb2-48c2-9335-b68bc235db7c","tableNumber":"BA-02","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:15:45.572Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ed81ee34-878d-443f-a902-d383b5fa7efb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:45.572Z] [INFO] [submit] Submitting booking request {"correlationId":"ed81ee34-878d-443f-a902-d383b5fa7efb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:15:52.464Z] [INFO] [submit] Booking created {"correlationId":"ed81ee34-878d-443f-a902-d383b5fa7efb","bookingId":"fb7f8af1-326d-4cb2-9f63-986400a86542","duplicate":false,"initialStatus":"confirmed","durationMs":6891,"maskedEmail":"bo***4@example.com","maskedPhone":"********4434"}
[2025-11-16T12:15:52.756Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ed81ee34-878d-443f-a902-d383b5fa7efb","bookingId":"fb7f8af1-326d-4cb2-9f63-986400a86542","reference":"L76V5KEAHZ","bookingDate":"2026-04-06","startTime":"15:45:00","endTime":"17:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:51.937Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1891,"attemptId":"d6fbc66c-b427-4e1c-a39d-c8f346e30e03","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6891,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7184,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["MD-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7df8b1fa-5647-42ee-9d2f-e76c8040a53c","tableId":"75329c85-efdc-40cb-87fe-bb4f2242b802","tableNumber":"MD-01","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:15:52.757Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7e45c97d-efa4-4456-8bd2-21f482a40ca8","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:52.757Z] [INFO] [submit] Submitting booking request {"correlationId":"7e45c97d-efa4-4456-8bd2-21f482a40ca8","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:16:01.029Z] [INFO] [submit] Booking created {"correlationId":"7e45c97d-efa4-4456-8bd2-21f482a40ca8","bookingId":"e962be2e-85c5-4ca0-9b77-19541c80959c","duplicate":false,"initialStatus":"confirmed","durationMs":8271,"maskedEmail":"bo***d@example.com","maskedPhone":"********2973"}
[2025-11-16T12:16:01.259Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7e45c97d-efa4-4456-8bd2-21f482a40ca8","bookingId":"e962be2e-85c5-4ca0-9b77-19541c80959c","reference":"WG2DTGKUTC","bookingDate":"2026-04-06","startTime":"15:45:00","endTime":"17:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:00.517Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2410,"attemptId":"b8a46dca-6ebb-499b-83e8-e62db6da686f","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":8271,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8502,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["MD-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5c1af836-ca02-4ece-886f-769a75da5f83","tableId":"eb535103-6058-426f-9a4c-fa47b07c3783","tableNumber":"MD-02","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6781, max: 8502, avg: 7442.5, p95: 7303 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
