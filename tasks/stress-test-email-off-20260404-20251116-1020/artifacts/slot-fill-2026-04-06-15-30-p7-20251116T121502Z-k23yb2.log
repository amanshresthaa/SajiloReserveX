
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 15\:30 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2025-11-16T12:15:03.550Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f07e9b2a-2098-4eb3-a406-1a85ac164595","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:03.550Z] [INFO] [submit] Submitting booking request {"correlationId":"f07e9b2a-2098-4eb3-a406-1a85ac164595","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:15:10.400Z] [INFO] [submit] Booking created {"correlationId":"f07e9b2a-2098-4eb3-a406-1a85ac164595","bookingId":"7fcadbb9-eb6b-4d4f-82ad-45ec6ef3a63a","duplicate":false,"initialStatus":"confirmed","durationMs":6848,"maskedEmail":"bo***a@example.com","maskedPhone":"********9120"}
[2025-11-16T12:15:10.635Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f07e9b2a-2098-4eb3-a406-1a85ac164595","bookingId":"7fcadbb9-eb6b-4d4f-82ad-45ec6ef3a63a","reference":"A3ZB9YDNUU","bookingDate":"2026-04-06","startTime":"15:30:00","endTime":"17:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:09.919Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1950,"attemptId":"63b75e3e-a0ad-4918-b93f-685069e2792a","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6848,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7084,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-09"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a3c8acf6-c4b0-42fc-837c-2ff5f4ce3c34","tableId":"df31eae2-3159-4194-a843-d9bb9b56121a","tableNumber":"MD-09","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:15:10.636Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"c36d1a2c-c13a-4b9b-84df-543783a130b8","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:10.636Z] [INFO] [submit] Submitting booking request {"correlationId":"c36d1a2c-c13a-4b9b-84df-543783a130b8","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:15:17.183Z] [INFO] [submit] Booking created {"correlationId":"c36d1a2c-c13a-4b9b-84df-543783a130b8","bookingId":"5980b516-d053-4cdd-8fcc-7d8741be4269","duplicate":false,"initialStatus":"confirmed","durationMs":6546,"maskedEmail":"bo***c@example.com","maskedPhone":"********1022"}
[2025-11-16T12:15:17.423Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"c36d1a2c-c13a-4b9b-84df-543783a130b8","bookingId":"5980b516-d053-4cdd-8fcc-7d8741be4269","reference":"DUG4EJ7LCE","bookingDate":"2026-04-06","startTime":"15:30:00","endTime":"17:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:16.744Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1900,"attemptId":"9d8e017b-7a2f-441b-87b0-f6dc76d1803c","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6546,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6787,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-10"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dff6ef49-6345-4d20-9373-13b34a8ce635","tableId":"d1f34cf1-07da-4171-84f7-71b4490a7276","tableNumber":"MD-10","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:15:17.425Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e8ec522a-24c6-455b-9435-63d2b84f3aeb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:17.425Z] [INFO] [submit] Submitting booking request {"correlationId":"e8ec522a-24c6-455b-9435-63d2b84f3aeb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:15:23.662Z] [INFO] [submit] Booking created {"correlationId":"e8ec522a-24c6-455b-9435-63d2b84f3aeb","bookingId":"36ad67e1-c6ef-4e05-9ac2-9ab72c4a7509","duplicate":false,"initialStatus":"confirmed","durationMs":6235,"maskedEmail":"bo***a@example.com","maskedPhone":"********5220"}
[2025-11-16T12:15:24.134Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e8ec522a-24c6-455b-9435-63d2b84f3aeb","bookingId":"36ad67e1-c6ef-4e05-9ac2-9ab72c4a7509","reference":"8CS7YLXWCM","bookingDate":"2026-04-06","startTime":"15:30:00","endTime":"17:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:23.186Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1825,"attemptId":"03c616bf-a245-4199-b04a-94ece48def48","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6235,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6709,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a0631e08-0644-4e0b-9eb6-8d15db7f73f5","tableId":"4545d5f6-817b-468c-8e32-264c9fdd9213","tableNumber":"OG-06","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:15:24.134Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"10c22479-b032-4a9c-8f2c-8ca824ea897b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:15:24.135Z] [INFO] [submit] Submitting booking request {"correlationId":"10c22479-b032-4a9c-8f2c-8ca824ea897b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:15:30.430Z] [INFO] [submit] Booking created {"correlationId":"10c22479-b032-4a9c-8f2c-8ca824ea897b","bookingId":"95d3b42f-f0d2-4d12-887f-585845b2b973","duplicate":false,"initialStatus":"confirmed","durationMs":6295,"maskedEmail":"bo***9@example.com","maskedPhone":"********2479"}
[2025-11-16T12:15:30.712Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"10c22479-b032-4a9c-8f2c-8ca824ea897b","bookingId":"95d3b42f-f0d2-4d12-887f-585845b2b973","reference":"AM7ARE7RHV","bookingDate":"2026-04-06","startTime":"15:30:00","endTime":"17:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:29.947Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1946,"attemptId":"9861ec9c-cf13-4941-920e-ecd5eca9e95e","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6295,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6578,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-11"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"52684800-3a6a-4540-8df7-a74cf68c5983","tableId":"fadc94ba-86ed-4075-a59d-5c84db03d150","tableNumber":"MD-11","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6578, max: 7084, avg: 6789.5, p95: 6787 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 1.5, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'MD-11', 'OG-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
