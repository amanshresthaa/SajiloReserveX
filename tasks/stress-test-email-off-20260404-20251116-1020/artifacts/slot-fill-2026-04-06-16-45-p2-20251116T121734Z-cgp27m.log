
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 16\:45 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-16T12:17:35.493Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"08807409-50ba-4f5b-a254-da2017b342f4","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:35.494Z] [INFO] [submit] Submitting booking request {"correlationId":"08807409-50ba-4f5b-a254-da2017b342f4","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:17:42.583Z] [INFO] [submit] Booking created {"correlationId":"08807409-50ba-4f5b-a254-da2017b342f4","bookingId":"01a63ab8-34fd-4ca4-9392-b0a418db8c69","duplicate":false,"initialStatus":"confirmed","durationMs":7088,"maskedEmail":"bo***9@example.com","maskedPhone":"********7409"}
[2025-11-16T12:17:42.806Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"08807409-50ba-4f5b-a254-da2017b342f4","bookingId":"01a63ab8-34fd-4ca4-9392-b0a418db8c69","reference":"VZZ8AKUY65","bookingDate":"2026-04-06","startTime":"16:45:00","endTime":"18:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:42.106Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2081,"attemptId":"6cc9e7d0-a0bb-46a5-a7a2-44ec389e3517","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7088,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7312,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["OG-03"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a3aebc9b-b2c5-4d72-847c-ae4e0a3e695f","tableId":"438ffaac-0215-4817-8ff6-e1516d67ce53","tableNumber":"OG-03","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:17:42.808Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5c76e124-b45c-457a-9a80-27c835703e30","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:42.808Z] [INFO] [submit] Submitting booking request {"correlationId":"5c76e124-b45c-457a-9a80-27c835703e30","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:17:49.557Z] [INFO] [submit] Booking created {"correlationId":"5c76e124-b45c-457a-9a80-27c835703e30","bookingId":"0a3b668a-925f-4f04-b02d-753815c978a1","duplicate":false,"initialStatus":"confirmed","durationMs":6748,"maskedEmail":"bo***4@example.com","maskedPhone":"********4124"}
[2025-11-16T12:17:49.808Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5c76e124-b45c-457a-9a80-27c835703e30","bookingId":"0a3b668a-925f-4f04-b02d-753815c978a1","reference":"Q3QESGGHAX","bookingDate":"2026-04-06","startTime":"16:45:00","endTime":"18:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:49.094Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2181,"attemptId":"8e3f70a5-0357-4f8b-bafb-a9dba108fa7f","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6748,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7001,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["PR-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"835c3681-34b4-4bee-a750-72f6ded54e3f","tableId":"cbcdedc9-1c2b-4d5d-a2d7-49833d4c4f0f","tableNumber":"PR-01","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:17:49.809Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"c2d791d5-a270-4ec2-bfa9-9005ba851dbb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:49.809Z] [INFO] [submit] Submitting booking request {"correlationId":"c2d791d5-a270-4ec2-bfa9-9005ba851dbb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:17:57.086Z] [INFO] [submit] Booking created {"correlationId":"c2d791d5-a270-4ec2-bfa9-9005ba851dbb","bookingId":"904777eb-1d99-49af-8e91-744e5d5bc430","duplicate":false,"initialStatus":"confirmed","durationMs":7276,"maskedEmail":"bo***5@example.com","maskedPhone":"********9135"}
[2025-11-16T12:17:57.295Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"c2d791d5-a270-4ec2-bfa9-9005ba851dbb","bookingId":"904777eb-1d99-49af-8e91-744e5d5bc430","reference":"8ZAZQL7W3J","bookingDate":"2026-04-06","startTime":"16:45:00","endTime":"18:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:56.358Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2403,"attemptId":"e4e5ab97-abaa-42d1-9622-13db13ca48fe","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7276,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7486,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["PR-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"199d8f57-eb36-4f99-8dd1-52b2e51394d2","tableId":"b2bd5f70-f175-4d36-a814-a1046aa2f2f6","tableNumber":"PR-02","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:17:57.296Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"75d28083-3186-4233-b84c-6f2bdb970613","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:17:57.296Z] [INFO] [submit] Submitting booking request {"correlationId":"75d28083-3186-4233-b84c-6f2bdb970613","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:18:04.452Z] [INFO] [submit] Booking created {"correlationId":"75d28083-3186-4233-b84c-6f2bdb970613","bookingId":"5d1c3b45-186b-4e7c-93b3-d2ca3c0cf67a","duplicate":false,"initialStatus":"confirmed","durationMs":7155,"maskedEmail":"bo***3@example.com","maskedPhone":"********8083"}
[2025-11-16T12:18:04.683Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"75d28083-3186-4233-b84c-6f2bdb970613","bookingId":"5d1c3b45-186b-4e7c-93b3-d2ca3c0cf67a","reference":"HJZN2UYPBN","bookingDate":"2026-04-06","startTime":"16:45:00","endTime":"18:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:18:03.992Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2160,"attemptId":"aaaf9757-9fb6-479c-afbf-aae9f8c68892","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7155,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7386,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["PT-03"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ab8bb1a0-ab8d-4121-a4f8-9026954a8a17","tableId":"878bda47-3172-4715-92a8-cf02574680cc","tableNumber":"PT-03","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 7001, max: 7486, avg: 7296.25, p95: 7386 },
  seatWaste: { count: 4, min: 2, max: 2, avg: 2, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-03', 'PR-01', 'PR-02', 'PT-03' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
