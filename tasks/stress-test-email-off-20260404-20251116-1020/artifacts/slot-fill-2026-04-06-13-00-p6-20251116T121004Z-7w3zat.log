
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 13\:00 --party-size 6 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  suppress all logs with { quiet: true }
[2025-11-16T12:10:04.986Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6a5720de-6003-4566-a8a2-b46280617c43","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:04.986Z] [INFO] [submit] Submitting booking request {"correlationId":"6a5720de-6003-4566-a8a2-b46280617c43","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:10:11.499Z] [INFO] [submit] Booking created {"correlationId":"6a5720de-6003-4566-a8a2-b46280617c43","bookingId":"0e874290-85b1-4427-9725-53f9c995e6d2","duplicate":false,"initialStatus":"confirmed","durationMs":6512,"maskedEmail":"bo***e@example.com","maskedPhone":"********2034"}
[2025-11-16T12:10:11.717Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6a5720de-6003-4566-a8a2-b46280617c43","bookingId":"0e874290-85b1-4427-9725-53f9c995e6d2","reference":"9Y8W6C2FLT","bookingDate":"2026-04-06","startTime":"13:00:00","endTime":"14:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:11.040Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1920,"attemptId":"561733e7-3aec-4e4e-a034-c2e2ade69936","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6512,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6731,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dbea0ae1-2b9b-4786-b4cc-cb45f34fa878","tableId":"15d6a144-c838-440f-9e76-fc415dd1be3f","tableNumber":"BA-07","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:10:11.717Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ad6ae8c9-7405-470e-98b7-714b14eabc9d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:11.717Z] [INFO] [submit] Submitting booking request {"correlationId":"ad6ae8c9-7405-470e-98b7-714b14eabc9d","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:10:18.283Z] [INFO] [submit] Booking created {"correlationId":"ad6ae8c9-7405-470e-98b7-714b14eabc9d","bookingId":"5e664433-ee48-45b2-9577-77fa6c11ae93","duplicate":false,"initialStatus":"confirmed","durationMs":6565,"maskedEmail":"bo***9@example.com","maskedPhone":"********4829"}
[2025-11-16T12:10:18.532Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ad6ae8c9-7405-470e-98b7-714b14eabc9d","bookingId":"5e664433-ee48-45b2-9577-77fa6c11ae93","reference":"HUVS557SX8","bookingDate":"2026-04-06","startTime":"13:00:00","endTime":"14:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:17.864Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1930,"attemptId":"610626a4-723a-4171-b81d-f155d1e7f62b","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6565,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6815,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e07dccfd-6ec3-499a-ac8a-e6d95163f2b2","tableId":"2dcab6f8-ccbc-4d31-bc47-fb82bcdf3122","tableNumber":"BA-08","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:10:18.533Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f4ab55cd-3f98-4c12-98d9-83e4698a865d","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:18.533Z] [INFO] [submit] Submitting booking request {"correlationId":"f4ab55cd-3f98-4c12-98d9-83e4698a865d","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:10:24.880Z] [INFO] [submit] Booking created {"correlationId":"f4ab55cd-3f98-4c12-98d9-83e4698a865d","bookingId":"b6dc5ec0-7535-4a48-9d4c-33820de6c95d","duplicate":false,"initialStatus":"confirmed","durationMs":6347,"maskedEmail":"bo***d@example.com","maskedPhone":"********5523"}
[2025-11-16T12:10:25.095Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f4ab55cd-3f98-4c12-98d9-83e4698a865d","bookingId":"b6dc5ec0-7535-4a48-9d4c-33820de6c95d","reference":"A6FL4G6PM7","bookingDate":"2026-04-06","startTime":"13:00:00","endTime":"14:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:24.384Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1938,"attemptId":"ecedf908-f2bf-47ec-8a06-63268dd674a6","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6347,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6562,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"572738ed-2efa-486a-a301-2abf9d2132cb","tableId":"36a18791-8339-42c5-a43f-996e2560b240","tableNumber":"MD-07","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:10:25.096Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cc237d05-5cc5-437a-a900-d61a4b3ef7a5","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:10:25.096Z] [INFO] [submit] Submitting booking request {"correlationId":"cc237d05-5cc5-437a-a900-d61a4b3ef7a5","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:10:31.637Z] [INFO] [submit] Booking created {"correlationId":"cc237d05-5cc5-437a-a900-d61a4b3ef7a5","bookingId":"d90a4e06-215e-491f-9e8b-a3ea4c67d738","duplicate":false,"initialStatus":"confirmed","durationMs":6540,"maskedEmail":"bo***5@example.com","maskedPhone":"********7305"}
[2025-11-16T12:10:31.860Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cc237d05-5cc5-437a-a900-d61a4b3ef7a5","bookingId":"d90a4e06-215e-491f-9e8b-a3ea4c67d738","reference":"X8DSA3EZRJ","bookingDate":"2026-04-06","startTime":"13:00:00","endTime":"14:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:10:31.222Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1897,"attemptId":"584d2da3-3e22-4dbb-9cac-f358b7c4f900","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6540,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6764,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"79e4fa0a-e2ae-4a2a-aa6e-62ed2b233b18","tableId":"94040fa4-ae8f-44eb-9298-cba491e3d204","tableNumber":"MD-08","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6562, max: 6815, avg: 6718, p95: 6764 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
✅ Stress run completed 4 booking(s) without failure.
