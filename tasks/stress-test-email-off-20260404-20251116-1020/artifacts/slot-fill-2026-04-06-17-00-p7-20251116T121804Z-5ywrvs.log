
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 17\:00 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-16T12:18:05.476Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8509c46b-678b-4afe-b742-39b0e2b3527c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:18:05.477Z] [INFO] [submit] Submitting booking request {"correlationId":"8509c46b-678b-4afe-b742-39b0e2b3527c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:18:11.956Z] [INFO] [submit] Booking created {"correlationId":"8509c46b-678b-4afe-b742-39b0e2b3527c","bookingId":"9c34a646-f717-4b85-a9ab-e3eda802da6b","duplicate":false,"initialStatus":"confirmed","durationMs":6477,"maskedEmail":"bo***b@example.com","maskedPhone":"********2461"}
[2025-11-16T12:18:12.186Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8509c46b-678b-4afe-b742-39b0e2b3527c","bookingId":"9c34a646-f717-4b85-a9ab-e3eda802da6b","reference":"M4S5N38RPE","bookingDate":"2026-04-06","startTime":"17:00:00","endTime":"19:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:18:11.536Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1987,"attemptId":"4a4a8e87-a208-4162-9ae9-0645c91ddc9f","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6477,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6710,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-09"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f105d8ce-6bfa-4c20-8865-2b91646c9847","tableId":"df31eae2-3159-4194-a843-d9bb9b56121a","tableNumber":"MD-09","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:18:12.187Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b5c7890c-b5c0-45bc-bf0c-fad5a2301f61","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:18:12.187Z] [INFO] [submit] Submitting booking request {"correlationId":"b5c7890c-b5c0-45bc-bf0c-fad5a2301f61","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:18:19.510Z] [INFO] [submit] Booking created {"correlationId":"b5c7890c-b5c0-45bc-bf0c-fad5a2301f61","bookingId":"f5d52322-0640-4d28-b63a-d93561b54469","duplicate":false,"initialStatus":"confirmed","durationMs":7322,"maskedEmail":"bo***c@example.com","maskedPhone":"********8902"}
[2025-11-16T12:18:19.711Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b5c7890c-b5c0-45bc-bf0c-fad5a2301f61","bookingId":"f5d52322-0640-4d28-b63a-d93561b54469","reference":"6DETSU2J9V","bookingDate":"2026-04-06","startTime":"17:00:00","endTime":"19:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:18:19.085Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2719,"attemptId":"efb62e7f-2061-47f4-bf2b-11b750547d5b","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7322,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7524,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-10"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e119d951-4ce6-48a5-95aa-8fd77181ea8e","tableId":"d1f34cf1-07da-4171-84f7-71b4490a7276","tableNumber":"MD-10","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:18:19.712Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ffbf7a32-65fc-41b9-97dd-2eac7a929fe5","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:18:19.712Z] [INFO] [submit] Submitting booking request {"correlationId":"ffbf7a32-65fc-41b9-97dd-2eac7a929fe5","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:18:26.747Z] [INFO] [submit] Booking created {"correlationId":"ffbf7a32-65fc-41b9-97dd-2eac7a929fe5","bookingId":"3a2e2f1c-d005-4af0-b92e-ae8148985c29","duplicate":false,"initialStatus":"confirmed","durationMs":7034,"maskedEmail":"bo***2@example.com","maskedPhone":"********7032"}
[2025-11-16T12:18:26.981Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ffbf7a32-65fc-41b9-97dd-2eac7a929fe5","bookingId":"3a2e2f1c-d005-4af0-b92e-ae8148985c29","reference":"F89K5QNVF4","bookingDate":"2026-04-06","startTime":"17:00:00","endTime":"19:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:18:26.121Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2023,"attemptId":"84b2a2ed-3b79-4291-97ff-040bad412dfd","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7034,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7269,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"48839317-5d43-4c41-86bc-cb90f0f391bc","tableId":"4545d5f6-817b-468c-8e32-264c9fdd9213","tableNumber":"OG-06","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:18:26.982Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1626a8ea-1e75-42d4-aead-7ec0d0efff23","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:18:26.982Z] [INFO] [submit] Submitting booking request {"correlationId":"1626a8ea-1e75-42d4-aead-7ec0d0efff23","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:18:41.684Z] [INFO] [submit] Booking created {"correlationId":"1626a8ea-1e75-42d4-aead-7ec0d0efff23","bookingId":"f03e36d9-8817-484b-aafc-be4ca2a5a4a9","duplicate":false,"initialStatus":"confirmed","durationMs":14700,"maskedEmail":"bo***a@example.com","maskedPhone":"********0840"}
[2025-11-16T12:18:41.916Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1626a8ea-1e75-42d4-aead-7ec0d0efff23","bookingId":"f03e36d9-8817-484b-aafc-be4ca2a5a4a9","reference":"VVNW45ZMS5","bookingDate":"2026-04-06","startTime":"17:00:00","endTime":"19:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:18:41.134Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12007,"attemptId":"f2284f4f-bc28-4114-9095-2498230f0572","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":14700,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":14934,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-07"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"abe79f48-9fd3-44e7-ae58-431291601dff","tableId":"092429df-9dd0-42e7-8c32-5eb8f84bd418","tableNumber":"PT-07","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6710, max: 14934, avg: 9109.25, p95: 7524 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
