
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 15\:15 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-16T12:14:31.891Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"99ae9eb3-6c3e-47af-bf81-5249f8140fdc","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:31.891Z] [INFO] [submit] Submitting booking request {"correlationId":"99ae9eb3-6c3e-47af-bf81-5249f8140fdc","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:14:39.200Z] [INFO] [submit] Booking created {"correlationId":"99ae9eb3-6c3e-47af-bf81-5249f8140fdc","bookingId":"48f251d7-89ac-4681-9ae8-51d5d26c303c","duplicate":false,"initialStatus":"confirmed","durationMs":7308,"maskedEmail":"bo***3@example.com","maskedPhone":"********9413"}
[2025-11-16T12:14:39.556Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"99ae9eb3-6c3e-47af-bf81-5249f8140fdc","bookingId":"48f251d7-89ac-4681-9ae8-51d5d26c303c","reference":"R8L6ETQW4S","bookingDate":"2026-04-06","startTime":"15:15:00","endTime":"16:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:38.655Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2151,"attemptId":"3681d7b4-73a1-47f3-8380-de2c51f4433b","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7308,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7664,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"951d526b-a7f9-4ec7-871a-a38344573d33","tableId":"15d6a144-c838-440f-9e76-fc415dd1be3f","tableNumber":"BA-07","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:14:39.556Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b95b4a00-8cde-452e-9c28-e5a98f711d9a","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:39.556Z] [INFO] [submit] Submitting booking request {"correlationId":"b95b4a00-8cde-452e-9c28-e5a98f711d9a","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:14:48.915Z] [INFO] [submit] Booking created {"correlationId":"b95b4a00-8cde-452e-9c28-e5a98f711d9a","bookingId":"0a201a42-b1f1-4640-880a-8c94639fedba","duplicate":false,"initialStatus":"confirmed","durationMs":9358,"maskedEmail":"bo***0@example.com","maskedPhone":"********4000"}
[2025-11-16T12:14:49.148Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b95b4a00-8cde-452e-9c28-e5a98f711d9a","bookingId":"0a201a42-b1f1-4640-880a-8c94639fedba","reference":"G855E2PSVA","bookingDate":"2026-04-06","startTime":"15:15:00","endTime":"16:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:48.414Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":3330,"attemptId":"e121c1cf-d703-4b94-a52d-b78875833896","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":9358,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":9591,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8947ccb4-125b-433e-ad95-4508a8642870","tableId":"2dcab6f8-ccbc-4d31-bc47-fb82bcdf3122","tableNumber":"BA-08","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:14:49.148Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b0d841ff-7219-42b6-acb8-5ad1ec6cbedd","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:49.148Z] [INFO] [submit] Submitting booking request {"correlationId":"b0d841ff-7219-42b6-acb8-5ad1ec6cbedd","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:14:56.177Z] [INFO] [submit] Booking created {"correlationId":"b0d841ff-7219-42b6-acb8-5ad1ec6cbedd","bookingId":"7c4ee8d3-c6ce-444d-8068-d7bdb97cf6f4","duplicate":false,"initialStatus":"confirmed","durationMs":7028,"maskedEmail":"bo***f@example.com","maskedPhone":"********4155"}
[2025-11-16T12:14:56.388Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b0d841ff-7219-42b6-acb8-5ad1ec6cbedd","bookingId":"7c4ee8d3-c6ce-444d-8068-d7bdb97cf6f4","reference":"4CA6LEAJK5","bookingDate":"2026-04-06","startTime":"15:15:00","endTime":"16:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:55.740Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2114,"attemptId":"1ecb6cbd-504b-4dbc-8edc-fbe21ec24d19","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7028,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7240,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"52738872-f04d-4ae1-8513-82a6c6a6e835","tableId":"36a18791-8339-42c5-a43f-996e2560b240","tableNumber":"MD-07","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:14:56.388Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3e6f22f4-5165-4e24-b20a-9fbb9d9f8d27","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:56.388Z] [INFO] [submit] Submitting booking request {"correlationId":"3e6f22f4-5165-4e24-b20a-9fbb9d9f8d27","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:15:02.607Z] [INFO] [submit] Booking created {"correlationId":"3e6f22f4-5165-4e24-b20a-9fbb9d9f8d27","bookingId":"115a2095-8560-40e9-86f8-934ade1751d8","duplicate":false,"initialStatus":"confirmed","durationMs":6219,"maskedEmail":"bo***4@example.com","maskedPhone":"********2254"}
[2025-11-16T12:15:02.823Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3e6f22f4-5165-4e24-b20a-9fbb9d9f8d27","bookingId":"115a2095-8560-40e9-86f8-934ade1751d8","reference":"7VNL78BVJA","bookingDate":"2026-04-06","startTime":"15:15:00","endTime":"16:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:15:02.153Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1846,"attemptId":"70a55ae4-be77-486e-b3b3-838095f1655e","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6219,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6435,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"002d8a3d-f3fe-438a-b903-23436606fb78","tableId":"94040fa4-ae8f-44eb-9298-cba491e3d204","tableNumber":"MD-08","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6435, max: 9591, avg: 7732.5, p95: 7664 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
