
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 13\:30 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2025-11-16T12:11:03.254Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"73b45a50-514f-49ee-bb3e-97937218ccaf","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:03.254Z] [INFO] [submit] Submitting booking request {"correlationId":"73b45a50-514f-49ee-bb3e-97937218ccaf","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:11:10.350Z] [INFO] [submit] Booking created {"correlationId":"73b45a50-514f-49ee-bb3e-97937218ccaf","bookingId":"f2a576a9-222f-43e7-a600-53d23c6bb219","duplicate":false,"initialStatus":"confirmed","durationMs":7095,"maskedEmail":"bo***0@example.com","maskedPhone":"********5050"}
[2025-11-16T12:11:10.550Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"73b45a50-514f-49ee-bb3e-97937218ccaf","bookingId":"f2a576a9-222f-43e7-a600-53d23c6bb219","reference":"VEJAWBXJLE","bookingDate":"2026-04-06","startTime":"13:30:00","endTime":"15:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:09.701Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2020,"attemptId":"131bfcec-3095-4b9e-8d4b-0d4d37e1030e","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7095,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7296,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"68a3996d-9357-4133-9ddd-dcf17073835f","tableId":"514fe674-dc73-4b6a-a981-7dbf102279a3","tableNumber":"BA-03","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:11:10.551Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1a571190-4176-4a4a-ad8f-aaa490ef87f7","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:10.551Z] [INFO] [submit] Submitting booking request {"correlationId":"1a571190-4176-4a4a-ad8f-aaa490ef87f7","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:17.466Z] [INFO] [submit] Booking created {"correlationId":"1a571190-4176-4a4a-ad8f-aaa490ef87f7","bookingId":"1ab31b28-7fdb-4523-85df-f1ef135074d7","duplicate":false,"initialStatus":"confirmed","durationMs":6914,"maskedEmail":"bo***0@example.com","maskedPhone":"********1190"}
[2025-11-16T12:11:17.712Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1a571190-4176-4a4a-ad8f-aaa490ef87f7","bookingId":"1ab31b28-7fdb-4523-85df-f1ef135074d7","reference":"WUMMNXPXPQ","bookingDate":"2026-04-06","startTime":"13:30:00","endTime":"15:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:17.006Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2090,"attemptId":"8897210e-8cb2-4c75-892c-bdd0566b6b31","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6914,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7160,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"984a7331-8def-414b-96cf-4dc8d726c10d","tableId":"14edb6e0-202e-40b9-a407-ac23f9f60c89","tableNumber":"BA-04","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:11:17.713Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"97d235f3-5f5b-4029-9ac0-edd27bb4f011","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:17.714Z] [INFO] [submit] Submitting booking request {"correlationId":"97d235f3-5f5b-4029-9ac0-edd27bb4f011","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:24.585Z] [INFO] [submit] Booking created {"correlationId":"97d235f3-5f5b-4029-9ac0-edd27bb4f011","bookingId":"6c2ad079-6908-4536-a380-acd0d84ac52a","duplicate":false,"initialStatus":"confirmed","durationMs":6870,"maskedEmail":"bo***3@example.com","maskedPhone":"********3553"}
[2025-11-16T12:11:24.845Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"97d235f3-5f5b-4029-9ac0-edd27bb4f011","bookingId":"6c2ad079-6908-4536-a380-acd0d84ac52a","reference":"CJC3VHQ43D","bookingDate":"2026-04-06","startTime":"13:30:00","endTime":"15:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:24.168Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2020,"attemptId":"f616728c-fc78-4b25-9da5-49dfd4da6c9b","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6870,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7132,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d7a76ce1-f497-4bb4-bc36-1ec09d2ea8dd","tableId":"bc0740e6-c0a9-49d8-92ca-416bbd0d7d32","tableNumber":"BA-05","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:11:24.847Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"09bd5a63-1d81-4312-b7d4-593a17fdf36f","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:24.847Z] [INFO] [submit] Submitting booking request {"correlationId":"09bd5a63-1d81-4312-b7d4-593a17fdf36f","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:31.208Z] [INFO] [submit] Booking created {"correlationId":"09bd5a63-1d81-4312-b7d4-593a17fdf36f","bookingId":"058d372a-53f5-4c86-b9be-f388f0fbb5ce","duplicate":false,"initialStatus":"confirmed","durationMs":6361,"maskedEmail":"bo***3@example.com","maskedPhone":"********5063"}
[2025-11-16T12:11:31.587Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"09bd5a63-1d81-4312-b7d4-593a17fdf36f","bookingId":"058d372a-53f5-4c86-b9be-f388f0fbb5ce","reference":"MFGHDBQZVH","bookingDate":"2026-04-06","startTime":"13:30:00","endTime":"15:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:30.747Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1877,"attemptId":"a05a1675-f559-4e0b-bbc7-c36235e33e8a","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6361,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6741,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"265639bf-11de-442b-8116-fef0b8cca9ea","tableId":"f17cd4e8-32e3-4916-b40c-8c41addeee68","tableNumber":"BA-06","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6741, max: 7296, avg: 7082.25, p95: 7160 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
