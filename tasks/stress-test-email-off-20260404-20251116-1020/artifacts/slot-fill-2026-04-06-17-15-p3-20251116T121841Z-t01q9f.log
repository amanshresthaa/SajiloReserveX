
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 17\:15 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2025-11-16T12:18:42.720Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a0e77fe4-5bd5-452f-a6e6-0ac1b9deab09","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:18:42.721Z] [INFO] [submit] Submitting booking request {"correlationId":"a0e77fe4-5bd5-452f-a6e6-0ac1b9deab09","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:18:57.029Z] [INFO] [submit] Booking created {"correlationId":"a0e77fe4-5bd5-452f-a6e6-0ac1b9deab09","bookingId":"55405cbd-ef3a-40ee-970e-758f3bb37a4e","duplicate":false,"initialStatus":"pending","durationMs":14307,"maskedEmail":"bo***4@example.com","maskedPhone":"********7544"}
[2025-11-16T12:18:57.395Z] [INFO] [inline_poll] Status update {"correlationId":"a0e77fe4-5bd5-452f-a6e6-0ac1b9deab09","bookingId":"55405cbd-ef3a-40ee-970e-758f3bb37a4e","attempt":1,"status":"pending","assignments":0,"elapsedMs":365}
[2025-11-16T12:19:01.638Z] [INFO] [inline_poll] Status update {"correlationId":"a0e77fe4-5bd5-452f-a6e6-0ac1b9deab09","bookingId":"55405cbd-ef3a-40ee-970e-758f3bb37a4e","attempt":3,"status":"confirmed","assignments":1,"elapsedMs":4608}
[2025-11-16T12:19:01.639Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"a0e77fe4-5bd5-452f-a6e6-0ac1b9deab09","bookingId":"55405cbd-ef3a-40ee-970e-758f3bb37a4e","reference":"8L7S5SPBJP","bookingDate":"2026-04-06","startTime":"17:15:00","endTime":"19:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:18:56.581Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"6636eff5-1623-4870-ab01-0e0e95fa2ea4","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":14307,"inlineAttempts":3,"inlineDurationMs":4609,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":18919,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"6491cd49-9980-477b-b14a-9cc5e17c2808","tableId":"f17cd4e8-32e3-4916-b40c-8c41addeee68","tableNumber":"BA-06","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:19:01.640Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5f49fa12-3b6b-4e3f-8336-0e1ce992c926","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:19:01.640Z] [INFO] [submit] Submitting booking request {"correlationId":"5f49fa12-3b6b-4e3f-8336-0e1ce992c926","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:19:09.511Z] [INFO] [submit] Booking created {"correlationId":"5f49fa12-3b6b-4e3f-8336-0e1ce992c926","bookingId":"3106757f-1e64-484e-b4f1-16cf7d85305c","duplicate":false,"initialStatus":"confirmed","durationMs":7870,"maskedEmail":"bo***2@example.com","maskedPhone":"********5012"}
[2025-11-16T12:19:09.772Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5f49fa12-3b6b-4e3f-8336-0e1ce992c926","bookingId":"3106757f-1e64-484e-b4f1-16cf7d85305c","reference":"P8GT6XSY39","bookingDate":"2026-04-06","startTime":"17:15:00","endTime":"19:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:19:09.031Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1941,"attemptId":"f34ace61-5c62-4303-8b5f-ae2b55e91390","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7870,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8131,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c2a323be-a081-4f84-b402-9dcc49b906ec","tableId":"38694eb6-cde9-4253-8b8a-cdcd4b74084e","tableNumber":"MD-03","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:19:09.773Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9e8e72a4-6434-46a4-9250-44286f742dae","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:19:09.773Z] [INFO] [submit] Submitting booking request {"correlationId":"9e8e72a4-6434-46a4-9250-44286f742dae","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:19:24.296Z] [INFO] [submit] Booking created {"correlationId":"9e8e72a4-6434-46a4-9250-44286f742dae","bookingId":"e23b3c42-6d29-4b99-9982-e8a1784a2239","duplicate":false,"initialStatus":"pending","durationMs":14522,"maskedEmail":"bo***4@example.com","maskedPhone":"********7204"}
[2025-11-16T12:19:24.509Z] [INFO] [inline_poll] Status update {"correlationId":"9e8e72a4-6434-46a4-9250-44286f742dae","bookingId":"e23b3c42-6d29-4b99-9982-e8a1784a2239","attempt":1,"status":"pending","assignments":0,"elapsedMs":213}
[2025-11-16T12:19:28.768Z] [INFO] [inline_poll] Status update {"correlationId":"9e8e72a4-6434-46a4-9250-44286f742dae","bookingId":"e23b3c42-6d29-4b99-9982-e8a1784a2239","attempt":3,"status":"confirmed","assignments":1,"elapsedMs":4472}
[2025-11-16T12:19:28.768Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"9e8e72a4-6434-46a4-9250-44286f742dae","bookingId":"e23b3c42-6d29-4b99-9982-e8a1784a2239","reference":"HHQ4YWPLGJ","bookingDate":"2026-04-06","startTime":"17:15:00","endTime":"19:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:19:23.689Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12015,"attemptId":"96c94b90-74df-4d77-88e4-491a02e94525","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":14522,"inlineAttempts":3,"inlineDurationMs":4472,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":18995,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PT-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"642c26ca-4ebb-437c-b2b5-521c817339f4","tableId":"17cec96c-ee94-44a7-a329-e9c5386443d8","tableNumber":"PT-04","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:19:28.768Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cfad1c38-5e80-4702-a011-2b6db8355d3c","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:19:28.768Z] [INFO] [submit] Submitting booking request {"correlationId":"cfad1c38-5e80-4702-a011-2b6db8355d3c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:19:35.714Z] [INFO] [submit] Booking created {"correlationId":"cfad1c38-5e80-4702-a011-2b6db8355d3c","bookingId":"f5efb7e7-bd3a-44c0-a0a1-19194fe05306","duplicate":false,"initialStatus":"confirmed","durationMs":6946,"maskedEmail":"bo***8@example.com","maskedPhone":"********1238"}
[2025-11-16T12:19:35.945Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cfad1c38-5e80-4702-a011-2b6db8355d3c","bookingId":"f5efb7e7-bd3a-44c0-a0a1-19194fe05306","reference":"RPZS3FF9EX","bookingDate":"2026-04-06","startTime":"17:15:00","endTime":"19:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:19:35.213Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2115,"attemptId":"3c9c4b0b-ab98-49bc-840b-040edde04743","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6946,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7177,"tablesAssigned":1,"totalCapacity":6,"seatWaste":3,"tableNumbers":["BA-07"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"701b38d7-97f6-4ace-abde-9c3222e9a93f","tableId":"15d6a144-c838-440f-9e76-fc415dd1be3f","tableNumber":"BA-07","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 7177, max: 18995, avg: 13305.5, p95: 18919 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 1.5, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-06', 'BA-07', 'MD-03', 'PT-04' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
