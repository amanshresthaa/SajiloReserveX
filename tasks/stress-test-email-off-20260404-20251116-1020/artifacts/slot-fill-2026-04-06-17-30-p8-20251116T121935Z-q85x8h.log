
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 17\:30 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2025-11-16T12:19:36.693Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"761a4dc3-5a5c-48fb-a651-b591284c575e","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:19:36.693Z] [INFO] [submit] Submitting booking request {"correlationId":"761a4dc3-5a5c-48fb-a651-b591284c575e","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:19:46.225Z] [INFO] [submit] Booking created {"correlationId":"761a4dc3-5a5c-48fb-a651-b591284c575e","bookingId":"cf5cd0c1-2442-450f-8272-870e2e90c344","duplicate":false,"initialStatus":"confirmed","durationMs":9531,"maskedEmail":"bo***3@example.com","maskedPhone":"********4323"}
[2025-11-16T12:19:46.541Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"761a4dc3-5a5c-48fb-a651-b591284c575e","bookingId":"cf5cd0c1-2442-450f-8272-870e2e90c344","reference":"E4AFRT3TQN","bookingDate":"2026-04-06","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:19:45.684Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2961,"attemptId":"32a30117-4ba6-4d5e-bac2-5871e5a373a2","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":9531,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":9848,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-08"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"77d8a06b-10e4-4005-a6f0-85c67e1be53f","tableId":"c0b9bf36-a98b-4837-b650-6a6ee50bb5ca","tableNumber":"PT-08","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-16T12:19:46.542Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"54233fbb-94a3-459c-9507-39412492dede","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:19:46.542Z] [INFO] [submit] Submitting booking request {"correlationId":"54233fbb-94a3-459c-9507-39412492dede","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:19:57.055Z] [INFO] [submit] Booking created {"correlationId":"54233fbb-94a3-459c-9507-39412492dede","bookingId":"9033a68a-b237-4f15-a40e-212719d8e296","duplicate":false,"initialStatus":"confirmed","durationMs":10511,"maskedEmail":"bo***b@example.com","maskedPhone":"********3511"}
[2025-11-16T12:19:57.347Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"54233fbb-94a3-459c-9507-39412492dede","bookingId":"9033a68a-b237-4f15-a40e-212719d8e296","reference":"LQKHPRWSK7","bookingDate":"2026-04-06","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:19:56.506Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":3572,"attemptId":"86842007-ca55-4a4a-a947-7e7c43feae37","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":10511,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":10805,"tablesAssigned":1,"totalCapacity":10,"seatWaste":2,"tableNumbers":["MD-11"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d45e5460-3656-4038-8f7d-59b961bc4a73","tableId":"fadc94ba-86ed-4075-a59d-5c84db03d150","tableNumber":"MD-11","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-16T12:19:57.348Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"24bf0ddb-efac-4240-ad2e-905a9a39b147","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:19:57.348Z] [INFO] [submit] Submitting booking request {"correlationId":"24bf0ddb-efac-4240-ad2e-905a9a39b147","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:20:04.066Z] [INFO] [submit] Booking created {"correlationId":"24bf0ddb-efac-4240-ad2e-905a9a39b147","bookingId":"96ea8929-09f4-49c7-b9a6-526743efead8","duplicate":false,"initialStatus":"confirmed","durationMs":6717,"maskedEmail":"bo***b@example.com","maskedPhone":"********0331"}
[2025-11-16T12:20:04.298Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"24bf0ddb-efac-4240-ad2e-905a9a39b147","bookingId":"96ea8929-09f4-49c7-b9a6-526743efead8","reference":"ATPKCAGHCK","bookingDate":"2026-04-06","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:03.576Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2074,"attemptId":"deefd617-a239-41d2-88f6-2cc2b7185eb2","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6717,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6950,"tablesAssigned":1,"totalCapacity":10,"seatWaste":2,"tableNumbers":["MD-12"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c4415012-1147-42bf-a48a-006facaf9825","tableId":"aa9804d0-fece-4631-b7c3-1e1a5418d05b","tableNumber":"MD-12","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-16T12:20:04.299Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7e5961a5-d2aa-4ddb-be2b-1422381fc1e9","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:04.299Z] [INFO] [submit] Submitting booking request {"correlationId":"7e5961a5-d2aa-4ddb-be2b-1422381fc1e9","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:20:11.274Z] [INFO] [submit] Booking created {"correlationId":"7e5961a5-d2aa-4ddb-be2b-1422381fc1e9","bookingId":"af370646-1519-4907-b9e6-70b6d8f2c6ad","duplicate":false,"initialStatus":"confirmed","durationMs":6975,"maskedEmail":"bo***5@example.com","maskedPhone":"********6105"}
[2025-11-16T12:20:11.495Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7e5961a5-d2aa-4ddb-be2b-1422381fc1e9","bookingId":"af370646-1519-4907-b9e6-70b6d8f2c6ad","reference":"FAPGNSCMF7","bookingDate":"2026-04-06","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:10.793Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1930,"attemptId":"e0837a60-9c2f-4d8b-a1e9-485d140084eb","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6975,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7196,"tablesAssigned":1,"totalCapacity":10,"seatWaste":2,"tableNumbers":["PR-05"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a71d16eb-a744-43ae-9b5e-423fc92e12c0","tableId":"70dd2cff-8340-4745-be99-886dfd278ccb","tableNumber":"PR-05","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6950, max: 10805, avg: 8699.75, p95: 9848 },
  seatWaste: { count: 4, min: 0, max: 2, avg: 1.5, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-11', 'MD-12', 'PR-05', 'PT-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
