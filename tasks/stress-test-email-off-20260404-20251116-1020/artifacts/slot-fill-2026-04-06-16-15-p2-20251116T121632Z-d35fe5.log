
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 16\:15 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-16T12:16:33.485Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"51255748-01b9-497b-9131-1ab6da2f66dd","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:33.486Z] [INFO] [submit] Submitting booking request {"correlationId":"51255748-01b9-497b-9131-1ab6da2f66dd","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:16:42.258Z] [INFO] [submit] Booking created {"correlationId":"51255748-01b9-497b-9131-1ab6da2f66dd","bookingId":"6c40917b-769f-4156-8054-416febdaed45","duplicate":false,"initialStatus":"confirmed","durationMs":8770,"maskedEmail":"bo***8@example.com","maskedPhone":"********5748"}
[2025-11-16T12:16:42.552Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"51255748-01b9-497b-9131-1ab6da2f66dd","bookingId":"6c40917b-769f-4156-8054-416febdaed45","reference":"957YTH3ZVV","bookingDate":"2026-04-06","startTime":"16:15:00","endTime":"17:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:41.731Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2425,"attemptId":"beb5f48f-f96e-41a7-bd55-b1fb3164d3fc","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":8770,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":9066,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["BA-03"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f4dc0f9e-4548-4f7d-a6b2-5561c2eb285f","tableId":"514fe674-dc73-4b6a-a981-7dbf102279a3","tableNumber":"BA-03","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:16:42.553Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"05622684-682b-4da9-a057-8355e88e719b","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:42.553Z] [INFO] [submit] Submitting booking request {"correlationId":"05622684-682b-4da9-a057-8355e88e719b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:16:49.467Z] [INFO] [submit] Booking created {"correlationId":"05622684-682b-4da9-a057-8355e88e719b","bookingId":"f7b78253-f915-420f-80b9-cd355306fda3","duplicate":false,"initialStatus":"confirmed","durationMs":6914,"maskedEmail":"bo***4@example.com","maskedPhone":"********2684"}
[2025-11-16T12:16:49.686Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"05622684-682b-4da9-a057-8355e88e719b","bookingId":"f7b78253-f915-420f-80b9-cd355306fda3","reference":"2TW2SN9RZG","bookingDate":"2026-04-06","startTime":"16:15:00","endTime":"17:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:49.040Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2410,"attemptId":"c1bbb512-8215-4bf2-862a-d9bf6876c953","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6914,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7133,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["BA-04"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a906ed0f-41b0-4624-b361-19cdc0cad77b","tableId":"14edb6e0-202e-40b9-a407-ac23f9f60c89","tableNumber":"BA-04","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:16:49.686Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"01f65ff2-a554-4cbf-95de-d320d47097d7","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:49.686Z] [INFO] [submit] Submitting booking request {"correlationId":"01f65ff2-a554-4cbf-95de-d320d47097d7","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:16:56.662Z] [INFO] [submit] Booking created {"correlationId":"01f65ff2-a554-4cbf-95de-d320d47097d7","bookingId":"6477bbec-f7d5-4193-92df-35e7f57089b3","duplicate":false,"initialStatus":"confirmed","durationMs":6975,"maskedEmail":"bo***2@example.com","maskedPhone":"********5552"}
[2025-11-16T12:16:56.905Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"01f65ff2-a554-4cbf-95de-d320d47097d7","bookingId":"6477bbec-f7d5-4193-92df-35e7f57089b3","reference":"W4SSZ2ZNCQ","bookingDate":"2026-04-06","startTime":"16:15:00","endTime":"17:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:16:56.214Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1928,"attemptId":"32ae7892-4e97-4ee9-9522-e9ee2e362d34","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6975,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7219,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["BA-05"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ad86e007-866f-4840-ad5b-7026883134f8","tableId":"bc0740e6-c0a9-49d8-92ca-416bbd0d7d32","tableNumber":"BA-05","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:16:56.906Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"77dcd919-753d-4210-a692-f4fb77fc330b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:16:56.906Z] [INFO] [submit] Submitting booking request {"correlationId":"77dcd919-753d-4210-a692-f4fb77fc330b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"16:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:17:03.524Z] [INFO] [submit] Booking created {"correlationId":"77dcd919-753d-4210-a692-f4fb77fc330b","bookingId":"be755ab9-4241-49ad-aee2-daa15bcde9e6","duplicate":false,"initialStatus":"confirmed","durationMs":6618,"maskedEmail":"bo***9@example.com","maskedPhone":"********3919"}
[2025-11-16T12:17:03.740Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"77dcd919-753d-4210-a692-f4fb77fc330b","bookingId":"be755ab9-4241-49ad-aee2-daa15bcde9e6","reference":"REPHXGA2SD","bookingDate":"2026-04-06","startTime":"16:15:00","endTime":"17:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:17:03.099Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1875,"attemptId":"de7d59dd-2aa6-4ec8-a1d2-02e9b22b9614","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6618,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6834,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["MD-04"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5e35cf82-151a-4a86-b0dc-6a085849ad17","tableId":"c5d016d2-7c61-4038-afc3-220a2fc91ea3","tableNumber":"MD-04","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6834, max: 9066, avg: 7563, p95: 7219 },
  seatWaste: { count: 4, min: 2, max: 2, avg: 2, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'MD-04' ]
}
✅ Stress run completed 4 booking(s) without failure.
