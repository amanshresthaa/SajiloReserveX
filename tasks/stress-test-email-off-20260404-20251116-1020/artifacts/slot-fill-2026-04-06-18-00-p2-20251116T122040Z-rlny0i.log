
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 18\:00 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[2025-11-16T12:20:41.266Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"240a2b6e-6fba-4022-9de3-8ce81d794766","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:41.267Z] [INFO] [submit] Submitting booking request {"correlationId":"240a2b6e-6fba-4022-9de3-8ce81d794766","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:20:48.093Z] [INFO] [submit] Booking created {"correlationId":"240a2b6e-6fba-4022-9de3-8ce81d794766","bookingId":"fe9fdae8-9581-4061-a03b-999b2f21b0c1","duplicate":false,"initialStatus":"confirmed","durationMs":6824,"maskedEmail":"bo***e@example.com","maskedPhone":"********2164"}
[2025-11-16T12:20:49.308Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"240a2b6e-6fba-4022-9de3-8ce81d794766","bookingId":"fe9fdae8-9581-4061-a03b-999b2f21b0c1","reference":"J8T9DVMPC8","bookingDate":"2026-04-06","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:47.638Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1983,"attemptId":"e6597e8f-ab38-4db6-b239-81cc584f34f8","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6824,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8041,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3cd7b1e0-fec4-4bfd-b7a1-00bed95e22d9","tableId":"49d15284-c41d-449a-96f5-45a01dbb19f8","tableNumber":"BA-01","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:20:49.309Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"804ccfe1-5e59-4ecb-a32c-22caf8fe1c59","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:49.309Z] [INFO] [submit] Submitting booking request {"correlationId":"804ccfe1-5e59-4ecb-a32c-22caf8fe1c59","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:20:55.693Z] [INFO] [submit] Booking created {"correlationId":"804ccfe1-5e59-4ecb-a32c-22caf8fe1c59","bookingId":"532c8f0c-150a-4119-889e-989ab67ec5c3","duplicate":false,"initialStatus":"confirmed","durationMs":6383,"maskedEmail":"bo***1@example.com","maskedPhone":"********2541"}
[2025-11-16T12:20:56.000Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"804ccfe1-5e59-4ecb-a32c-22caf8fe1c59","bookingId":"532c8f0c-150a-4119-889e-989ab67ec5c3","reference":"AS4UTC3VJK","bookingDate":"2026-04-06","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:20:55.232Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1889,"attemptId":"7582d4b6-6ba9-45ac-b123-6511af17a3a1","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6383,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6691,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"62e77993-f89a-4bee-ab57-c0e9baa404f9","tableId":"6d20353b-fbb2-48c2-9335-b68bc235db7c","tableNumber":"BA-02","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:20:56.001Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"130f65fc-f5e3-4303-acd5-8ac743530704","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:20:56.001Z] [INFO] [submit] Submitting booking request {"correlationId":"130f65fc-f5e3-4303-acd5-8ac743530704","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:21:05.200Z] [INFO] [submit] Booking created {"correlationId":"130f65fc-f5e3-4303-acd5-8ac743530704","bookingId":"c5bac0be-8474-4c01-b89c-433c029b0a2c","duplicate":false,"initialStatus":"confirmed","durationMs":9199,"maskedEmail":"bo***c@example.com","maskedPhone":"********6552"}
[2025-11-16T12:21:05.499Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"130f65fc-f5e3-4303-acd5-8ac743530704","bookingId":"c5bac0be-8474-4c01-b89c-433c029b0a2c","reference":"WB42BPHMCX","bookingDate":"2026-04-06","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:04.626Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2617,"attemptId":"0da66e12-89a9-48a3-be19-e7fe5f5aa4de","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":9199,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":9498,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"aad5bd25-b873-4739-a6cf-bd29977a8792","tableId":"75329c85-efdc-40cb-87fe-bb4f2242b802","tableNumber":"MD-01","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:21:05.499Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"883dfc5c-6333-4955-bb3c-e29d97d30aa3","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:05.499Z] [INFO] [submit] Submitting booking request {"correlationId":"883dfc5c-6333-4955-bb3c-e29d97d30aa3","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:21:13.302Z] [INFO] [submit] Booking created {"correlationId":"883dfc5c-6333-4955-bb3c-e29d97d30aa3","bookingId":"e2fa67f7-9c0f-4547-8bf3-5d9a490341fe","duplicate":false,"initialStatus":"confirmed","durationMs":7802,"maskedEmail":"bo***c@example.com","maskedPhone":"********5252"}
[2025-11-16T12:21:13.508Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"883dfc5c-6333-4955-bb3c-e29d97d30aa3","bookingId":"e2fa67f7-9c0f-4547-8bf3-5d9a490341fe","reference":"K4X53TAP42","bookingDate":"2026-04-06","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:12.850Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2632,"attemptId":"20b4094f-f0a5-4288-9ebb-efca0faa6bff","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":7802,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8009,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5cb30f13-e11d-4d1c-9a1a-89bd60a19de1","tableId":"eb535103-6058-426f-9a4c-fa47b07c3783","tableNumber":"MD-02","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6691, max: 9498, avg: 8059.75, p95: 8041 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
