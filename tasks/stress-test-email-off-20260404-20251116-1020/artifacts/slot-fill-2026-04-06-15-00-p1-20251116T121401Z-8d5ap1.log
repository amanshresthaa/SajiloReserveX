
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 15\:00 --party-size 1 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-16T12:14:02.530Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bfb09783-a4db-4c00-8df0-0857ad62f79f","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:02.530Z] [INFO] [submit] Submitting booking request {"correlationId":"bfb09783-a4db-4c00-8df0-0857ad62f79f","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:14:09.743Z] [INFO] [submit] Booking created {"correlationId":"bfb09783-a4db-4c00-8df0-0857ad62f79f","bookingId":"8e2d64d7-8f60-4d63-a81e-ad4f67a602c5","duplicate":false,"initialStatus":"confirmed","durationMs":7212,"maskedEmail":"bo***3@example.com","maskedPhone":"********9783"}
[2025-11-16T12:14:09.952Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bfb09783-a4db-4c00-8df0-0857ad62f79f","bookingId":"8e2d64d7-8f60-4d63-a81e-ad4f67a602c5","reference":"GCDHEKBXYS","bookingDate":"2026-04-06","startTime":"15:00:00","endTime":"16:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:09.280Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2276,"attemptId":"393465d7-6647-4674-bc8c-a5c8eeb68030","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7212,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7421,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["PT-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"fd4dde62-c387-443b-be7d-bdaecc5b604e","tableId":"25bd4b9f-53cf-44ab-8210-6598e8a8b8fb","tableNumber":"PT-02","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:14:09.952Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f070c1ec-5049-4e1c-82e9-b9d623cddcdc","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:09.952Z] [INFO] [submit] Submitting booking request {"correlationId":"f070c1ec-5049-4e1c-82e9-b9d623cddcdc","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:14:16.860Z] [INFO] [submit] Booking created {"correlationId":"f070c1ec-5049-4e1c-82e9-b9d623cddcdc","bookingId":"95290113-2c3c-462d-88e6-1535f3d1c992","duplicate":false,"initialStatus":"confirmed","durationMs":6906,"maskedEmail":"bo***c@example.com","maskedPhone":"********2142"}
[2025-11-16T12:14:17.111Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f070c1ec-5049-4e1c-82e9-b9d623cddcdc","bookingId":"95290113-2c3c-462d-88e6-1535f3d1c992","reference":"U6UPVQL3WY","bookingDate":"2026-04-06","startTime":"15:00:00","endTime":"16:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:16.419Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2091,"attemptId":"adc56473-f428-4ed1-9c59-e26be2d71ea7","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6906,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7159,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["BA-03"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"19073577-c6cf-46d8-ba66-3d06ad8010da","tableId":"514fe674-dc73-4b6a-a981-7dbf102279a3","tableNumber":"BA-03","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:14:17.113Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5fe5ba98-168b-4511-9f7c-b27feb66f75c","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:17.113Z] [INFO] [submit] Submitting booking request {"correlationId":"5fe5ba98-168b-4511-9f7c-b27feb66f75c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:14:23.810Z] [INFO] [submit] Booking created {"correlationId":"5fe5ba98-168b-4511-9f7c-b27feb66f75c","bookingId":"3a99a0e9-b4dd-4168-b935-7f3bacfe332c","duplicate":false,"initialStatus":"confirmed","durationMs":6697,"maskedEmail":"bo***8@example.com","maskedPhone":"********1098"}
[2025-11-16T12:14:24.014Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5fe5ba98-168b-4511-9f7c-b27feb66f75c","bookingId":"3a99a0e9-b4dd-4168-b935-7f3bacfe332c","reference":"ZMEZC38Y53","bookingDate":"2026-04-06","startTime":"15:00:00","endTime":"16:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:23.322Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1963,"attemptId":"ec5fc9ed-627f-475a-b855-c462d4b6c4f5","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6697,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6901,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["BA-04"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2e2c3a09-9ef8-419a-a36f-c2e91ff6b788","tableId":"14edb6e0-202e-40b9-a407-ac23f9f60c89","tableNumber":"BA-04","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:14:24.015Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7e7c0319-2bee-45e8-bfba-3ee8c72d276c","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:14:24.015Z] [INFO] [submit] Submitting booking request {"correlationId":"7e7c0319-2bee-45e8-bfba-3ee8c72d276c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"15:00","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:14:30.938Z] [INFO] [submit] Booking created {"correlationId":"7e7c0319-2bee-45e8-bfba-3ee8c72d276c","bookingId":"05fb732b-176d-44f9-8a3b-4bd0f11a5f5c","duplicate":false,"initialStatus":"confirmed","durationMs":6922,"maskedEmail":"bo***9@example.com","maskedPhone":"********0319"}
[2025-11-16T12:14:31.158Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7e7c0319-2bee-45e8-bfba-3ee8c72d276c","bookingId":"05fb732b-176d-44f9-8a3b-4bd0f11a5f5c","reference":"2KXVGTQC7D","bookingDate":"2026-04-06","startTime":"15:00:00","endTime":"16:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:14:30.480Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2040,"attemptId":"7f525bb8-d542-4f5d-8d76-f2f3ee94b4cf","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6922,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7143,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["BA-05"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9daef758-470d-4d60-8175-8fac57d1c34e","tableId":"bc0740e6-c0a9-49d8-92ca-416bbd0d7d32","tableNumber":"BA-05","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6901, max: 7421, avg: 7156, p95: 7159 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2.5, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'PT-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
