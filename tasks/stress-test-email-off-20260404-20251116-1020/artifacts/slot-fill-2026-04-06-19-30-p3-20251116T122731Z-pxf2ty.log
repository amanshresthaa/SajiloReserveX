
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 19\:30 --party-size 3 --stress --stress-max 3 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2025-11-16T12:27:32.363Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5eee4e4e-e172-43c2-8c6c-d6357f71e65d","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:27:32.363Z] [INFO] [submit] Submitting booking request {"correlationId":"5eee4e4e-e172-43c2-8c6c-d6357f71e65d","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"19:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:27:39.689Z] [INFO] [submit] Booking created {"correlationId":"5eee4e4e-e172-43c2-8c6c-d6357f71e65d","bookingId":"ae988fef-dad2-408b-9600-73908149a171","duplicate":false,"initialStatus":"confirmed","durationMs":7324,"maskedEmail":"bo***e@example.com","maskedPhone":"********4444"}
[2025-11-16T12:27:39.896Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5eee4e4e-e172-43c2-8c6c-d6357f71e65d","bookingId":"ae988fef-dad2-408b-9600-73908149a171","reference":"2NE5NKLPSY","bookingDate":"2026-04-06","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:27:39.166Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2626,"attemptId":"531b97c8-fb5c-4043-b2f4-c4886a87a915","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7324,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7533,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"80cc2512-aed6-43d1-be39-369b0126e08e","tableId":"38694eb6-cde9-4253-8b8a-cdcd4b74084e","tableNumber":"MD-03","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:27:39.897Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e6cf80b1-74a4-49cc-ada4-c7934cfb6759","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:27:39.897Z] [INFO] [submit] Submitting booking request {"correlationId":"e6cf80b1-74a4-49cc-ada4-c7934cfb6759","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"19:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:27:46.762Z] [INFO] [submit] Booking created {"correlationId":"e6cf80b1-74a4-49cc-ada4-c7934cfb6759","bookingId":"38ca6e9e-f5d8-4a7c-8a51-42da056a64ac","duplicate":false,"initialStatus":"confirmed","durationMs":6864,"maskedEmail":"bo***1@example.com","maskedPhone":"********8011"}
[2025-11-16T12:27:46.984Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e6cf80b1-74a4-49cc-ada4-c7934cfb6759","bookingId":"38ca6e9e-f5d8-4a7c-8a51-42da056a64ac","reference":"SFRGX4GKDU","bookingDate":"2026-04-06","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:27:46.301Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1977,"attemptId":"525329e2-acf1-46e2-a7c8-70ef3e0d942d","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6864,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7087,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PT-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5819f5c0-1676-4b90-b72a-bc54d46ca6d9","tableId":"878bda47-3172-4715-92a8-cf02574680cc","tableNumber":"PT-03","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:27:46.985Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2d84e296-3237-4d5b-be32-64fe71eb8ddc","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:27:46.986Z] [INFO] [submit] Submitting booking request {"correlationId":"2d84e296-3237-4d5b-be32-64fe71eb8ddc","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"19:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:27:53.308Z] [INFO] [submit] Booking created {"correlationId":"2d84e296-3237-4d5b-be32-64fe71eb8ddc","bookingId":"0db93ab9-d64f-4276-8eba-6768f6fdfeb4","duplicate":false,"initialStatus":"confirmed","durationMs":6321,"maskedEmail":"bo***6@example.com","maskedPhone":"********4296"}
[2025-11-16T12:27:53.523Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2d84e296-3237-4d5b-be32-64fe71eb8ddc","bookingId":"0db93ab9-d64f-4276-8eba-6768f6fdfeb4","reference":"DKB32Q9NF2","bookingDate":"2026-04-06","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:27:52.863Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1827,"attemptId":"2501df0b-2bb9-4ad4-b9b0-15acf5f0e353","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6321,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6537,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PT-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"37fe555a-fd47-47f4-a22d-e9d40c632065","tableId":"17cec96c-ee94-44a7-a329-e9c5386443d8","tableNumber":"PT-04","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 3,
  successes: 3,
  failures: 0,
  maxRuns: 3,
  completedTarget: true,
  durationMs: { count: 3, min: 6537, max: 7533, avg: 7052.333333333333, p95: 7087 },
  seatWaste: { count: 3, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 3, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-03', 'PT-03', 'PT-04' ]
}
‚úÖ Stress run completed 3 booking(s) without failure.
