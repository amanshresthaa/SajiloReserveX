
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 18\:45 --party-size 1 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[2025-11-16T12:22:09.019Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"49f2dcca-64fd-4fc3-8a1f-3b5d6734a1e8","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:22:09.019Z] [INFO] [submit] Submitting booking request {"correlationId":"49f2dcca-64fd-4fc3-8a1f-3b5d6734a1e8","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:22:16.197Z] [INFO] [submit] Booking created {"correlationId":"49f2dcca-64fd-4fc3-8a1f-3b5d6734a1e8","bookingId":"d18cd651-a73c-490c-b7be-4e3414762b03","duplicate":false,"initialStatus":"confirmed","durationMs":7177,"maskedEmail":"bo***a@example.com","maskedPhone":"********3220"}
[2025-11-16T12:22:16.510Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"49f2dcca-64fd-4fc3-8a1f-3b5d6734a1e8","bookingId":"d18cd651-a73c-490c-b7be-4e3414762b03","reference":"ZRZMX95VLJ","bookingDate":"2026-04-06","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:22:15.751Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1878,"attemptId":"c414607c-ee69-401d-8919-298bbd0899b0","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":7177,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7491,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["OG-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d1165bac-5ace-4037-83fc-3436feb41bca","tableId":"ad1c68a5-a5dd-4625-b517-10a43511bbca","tableNumber":"OG-01","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:22:16.511Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"744d3d4d-a315-4b57-85cc-e1f6d480b4ad","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:22:16.511Z] [INFO] [submit] Submitting booking request {"correlationId":"744d3d4d-a315-4b57-85cc-e1f6d480b4ad","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:22:23.949Z] [INFO] [submit] Booking created {"correlationId":"744d3d4d-a315-4b57-85cc-e1f6d480b4ad","bookingId":"ba10f56b-e25d-4c3d-9c0e-44495e24b403","duplicate":false,"initialStatus":"confirmed","durationMs":7437,"maskedEmail":"bo***d@example.com","maskedPhone":"********3343"}
[2025-11-16T12:22:24.370Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"744d3d4d-a315-4b57-85cc-e1f6d480b4ad","bookingId":"ba10f56b-e25d-4c3d-9c0e-44495e24b403","reference":"TZE7ZRXESZ","bookingDate":"2026-04-06","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:22:23.528Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2311,"attemptId":"beb880af-cc5c-4619-90a6-bd9fd658bbb1","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7437,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7858,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["PT-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0978650a-cbc7-4acd-9207-193e704b45ed","tableId":"31c0e865-f5ef-453b-a3ef-fe994c8561fa","tableNumber":"PT-01","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:22:24.370Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1fb3f47c-1626-413c-b0da-ee88c415e4cb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:22:24.371Z] [INFO] [submit] Submitting booking request {"correlationId":"1fb3f47c-1626-413c-b0da-ee88c415e4cb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:22:31.535Z] [INFO] [submit] Booking created {"correlationId":"1fb3f47c-1626-413c-b0da-ee88c415e4cb","bookingId":"b509b80c-a32e-470a-9e11-79f354b31bde","duplicate":false,"initialStatus":"confirmed","durationMs":7163,"maskedEmail":"bo***c@example.com","maskedPhone":"********5472"}
[2025-11-16T12:22:32.836Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1fb3f47c-1626-413c-b0da-ee88c415e4cb","bookingId":"b509b80c-a32e-470a-9e11-79f354b31bde","reference":"XS3486YVA5","bookingDate":"2026-04-06","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:22:31.042Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1958,"attemptId":"4e6d3dfe-ac11-491c-939f-bf37e0fd2733","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7163,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8466,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["PT-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"70e56f6a-8f04-4caa-8180-b876c01f3528","tableId":"25bd4b9f-53cf-44ab-8210-6598e8a8b8fb","tableNumber":"PT-02","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:22:32.837Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2276f4bf-8152-4fbf-9a5f-a807a6d6995b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:22:32.837Z] [INFO] [submit] Submitting booking request {"correlationId":"2276f4bf-8152-4fbf-9a5f-a807a6d6995b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:45","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:22:39.693Z] [INFO] [submit] Booking created {"correlationId":"2276f4bf-8152-4fbf-9a5f-a807a6d6995b","bookingId":"2f63e62f-6c2c-4fb1-b7e3-ee6e73a3a6a2","duplicate":false,"initialStatus":"confirmed","durationMs":6855,"maskedEmail":"bo***f@example.com","maskedPhone":"********5415"}
[2025-11-16T12:22:39.948Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2276f4bf-8152-4fbf-9a5f-a807a6d6995b","bookingId":"2f63e62f-6c2c-4fb1-b7e3-ee6e73a3a6a2","reference":"39U7AJAUBQ","bookingDate":"2026-04-06","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:22:39.244Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2437,"attemptId":"46000cb1-b2a7-4220-8d77-9cff4b6c88da","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6855,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7111,"tablesAssigned":1,"totalCapacity":4,"seatWaste":3,"tableNumbers":["BA-06"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"1c0bb31d-ba7f-45ad-895b-43df1b309cd5","tableId":"f17cd4e8-32e3-4916-b40c-8c41addeee68","tableNumber":"BA-06","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 7111, max: 8466, avg: 7731.5, p95: 7858 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 1.5, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-06', 'OG-01', 'PT-01', 'PT-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
