
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 12\:15 --party-size 1 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar
[2025-11-16T12:08:33.100Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2b66acaf-af6a-46a6-be7d-75bc96e97d68","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:33.101Z] [INFO] [submit] Submitting booking request {"correlationId":"2b66acaf-af6a-46a6-be7d-75bc96e97d68","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:15","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:08:39.583Z] [INFO] [submit] Booking created {"correlationId":"2b66acaf-af6a-46a6-be7d-75bc96e97d68","bookingId":"66084000-e255-4c19-9e8f-e13ed5cf0bb7","duplicate":false,"initialStatus":"confirmed","durationMs":6481,"maskedEmail":"bo***f@example.com","maskedPhone":"********0205"}
[2025-11-16T12:08:39.802Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2b66acaf-af6a-46a6-be7d-75bc96e97d68","bookingId":"66084000-e255-4c19-9e8f-e13ed5cf0bb7","reference":"AMJF96AZLU","bookingDate":"2026-04-06","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:39.161Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1901,"attemptId":"7a178317-63c3-4e73-8d50-72235adb3882","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6481,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6702,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["BA-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"440bdb7b-f43b-4bf3-ae1a-05d0e4a28146","tableId":"49d15284-c41d-449a-96f5-45a01dbb19f8","tableNumber":"BA-01","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:08:39.803Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4733926a-7bbf-4460-b456-318ea6a8ee5c","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:39.803Z] [INFO] [submit] Submitting booking request {"correlationId":"4733926a-7bbf-4460-b456-318ea6a8ee5c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:15","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:08:52.611Z] [INFO] [submit] Booking created {"correlationId":"4733926a-7bbf-4460-b456-318ea6a8ee5c","bookingId":"b80bb856-f7bf-4eff-ad96-6c5e6318e227","duplicate":false,"initialStatus":"confirmed","durationMs":12807,"maskedEmail":"bo***a@example.com","maskedPhone":"********9260"}
[2025-11-16T12:08:52.840Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4733926a-7bbf-4460-b456-318ea6a8ee5c","bookingId":"b80bb856-f7bf-4eff-ad96-6c5e6318e227","reference":"NG9XMXMXRW","bookingDate":"2026-04-06","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:52.131Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":8338,"attemptId":"e89bea10-55a7-48d2-a60d-f11030675456","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":12807,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":13037,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["BA-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b67bc13d-a64b-4fde-830e-076df36c048b","tableId":"6d20353b-fbb2-48c2-9335-b68bc235db7c","tableNumber":"BA-02","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:08:52.841Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4e980696-d30d-4ef6-83e4-994d3bb622cb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:52.841Z] [INFO] [submit] Submitting booking request {"correlationId":"4e980696-d30d-4ef6-83e4-994d3bb622cb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:15","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:08:59.295Z] [INFO] [submit] Booking created {"correlationId":"4e980696-d30d-4ef6-83e4-994d3bb622cb","bookingId":"185a304b-5b0e-454e-ad13-bdfbb0d469e0","duplicate":false,"initialStatus":"confirmed","durationMs":6454,"maskedEmail":"bo***6@example.com","maskedPhone":"********0696"}
[2025-11-16T12:08:59.514Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4e980696-d30d-4ef6-83e4-994d3bb622cb","bookingId":"185a304b-5b0e-454e-ad13-bdfbb0d469e0","reference":"USDJWQCT42","bookingDate":"2026-04-06","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:58.870Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2014,"attemptId":"cf86c067-1908-48d0-a4a9-960dba8834ad","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6454,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6673,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["MD-01"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b1e7a9b0-86dc-490a-80da-14f6f1355c0e","tableId":"75329c85-efdc-40cb-87fe-bb4f2242b802","tableNumber":"MD-01","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-16T12:08:59.514Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3715a503-7a7b-406a-8226-b75552000a9b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:59.514Z] [INFO] [submit] Submitting booking request {"correlationId":"3715a503-7a7b-406a-8226-b75552000a9b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:15","party":1,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:09:05.902Z] [INFO] [submit] Booking created {"correlationId":"3715a503-7a7b-406a-8226-b75552000a9b","bookingId":"d01ded86-8789-427d-ac83-00a8e80eb64f","duplicate":false,"initialStatus":"confirmed","durationMs":6387,"maskedEmail":"bo***3@example.com","maskedPhone":"********0503"}
[2025-11-16T12:09:06.135Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3715a503-7a7b-406a-8226-b75552000a9b","bookingId":"d01ded86-8789-427d-ac83-00a8e80eb64f","reference":"EHAS7FDLPY","bookingDate":"2026-04-06","startTime":"12:15:00","endTime":"13:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:09:05.436Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1918,"attemptId":"20db10cb-3da0-4ec4-904e-3957863fd20f","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6387,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6621,"tablesAssigned":1,"totalCapacity":2,"seatWaste":1,"tableNumbers":["MD-02"],"partySize":1,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"801eb81e-2ed8-4cf9-b549-70895cda07ea","tableId":"eb535103-6058-426f-9a4c-fa47b07c3783","tableNumber":"MD-02","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6621, max: 13037, avg: 8258.25, p95: 6702 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
