
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 12\:00 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2025-11-16T12:08:00.347Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bb6f9aa5-34e3-471d-95f3-20d2ba30aa07","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:00.347Z] [INFO] [submit] Submitting booking request {"correlationId":"bb6f9aa5-34e3-471d-95f3-20d2ba30aa07","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:08:09.129Z] [INFO] [submit] Booking created {"correlationId":"bb6f9aa5-34e3-471d-95f3-20d2ba30aa07","bookingId":"cf73fd50-53e5-4858-b0ea-ba815c1c7320","duplicate":false,"initialStatus":"confirmed","durationMs":8781,"maskedEmail":"bo***5@example.com","maskedPhone":"********9005"}
[2025-11-16T12:08:09.419Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bb6f9aa5-34e3-471d-95f3-20d2ba30aa07","bookingId":"cf73fd50-53e5-4858-b0ea-ba815c1c7320","reference":"479YVDG3VE","bookingDate":"2026-04-06","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:08.682Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2093,"attemptId":"266d217b-0647-44fd-a289-27961663582f","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":8781,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":9072,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"66842229-44f3-4513-9929-453b2393f7d0","tableId":"514fe674-dc73-4b6a-a981-7dbf102279a3","tableNumber":"BA-03","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:08:09.419Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ec5d7ef4-63aa-47d3-aea0-cfef8458bcd2","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:09.419Z] [INFO] [submit] Submitting booking request {"correlationId":"ec5d7ef4-63aa-47d3-aea0-cfef8458bcd2","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:08:17.280Z] [INFO] [submit] Booking created {"correlationId":"ec5d7ef4-63aa-47d3-aea0-cfef8458bcd2","bookingId":"1d6761df-8662-4c4f-a360-a17d1d0cee66","duplicate":false,"initialStatus":"confirmed","durationMs":7860,"maskedEmail":"bo***4@example.com","maskedPhone":"********7454"}
[2025-11-16T12:08:17.569Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ec5d7ef4-63aa-47d3-aea0-cfef8458bcd2","bookingId":"1d6761df-8662-4c4f-a360-a17d1d0cee66","reference":"USK9C68PZF","bookingDate":"2026-04-06","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:16.757Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2288,"attemptId":"bb9974d7-4e29-4187-89f3-cbdef70482fc","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":7860,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":8150,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"09b0e399-5d5a-4865-8675-dbcb2a4cd1c8","tableId":"14edb6e0-202e-40b9-a407-ac23f9f60c89","tableNumber":"BA-04","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:08:17.570Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f35db283-5630-47c2-9166-d5ed45cac49c","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:17.570Z] [INFO] [submit] Submitting booking request {"correlationId":"f35db283-5630-47c2-9166-d5ed45cac49c","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:08:25.142Z] [INFO] [submit] Booking created {"correlationId":"f35db283-5630-47c2-9166-d5ed45cac49c","bookingId":"5828c5e2-6a70-4687-8d81-2da7883fe842","duplicate":false,"initialStatus":"confirmed","durationMs":7571,"maskedEmail":"bo***3@example.com","maskedPhone":"********1283"}
[2025-11-16T12:08:25.361Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f35db283-5630-47c2-9166-d5ed45cac49c","bookingId":"5828c5e2-6a70-4687-8d81-2da7883fe842","reference":"XEFUUW8MQN","bookingDate":"2026-04-06","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:24.632Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2263,"attemptId":"432125b0-65e8-4a47-a454-cefdd398ea6a","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":7571,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7791,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4db36655-e74f-4f43-b15c-d19b8b7e6b8c","tableId":"bc0740e6-c0a9-49d8-92ca-416bbd0d7d32","tableNumber":"BA-05","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:08:25.361Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"69ba3a4c-c466-4e76-bc7f-66f06cd4ee72","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:08:25.361Z] [INFO] [submit] Submitting booking request {"correlationId":"69ba3a4c-c466-4e76-bc7f-66f06cd4ee72","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"12:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:08:32.059Z] [INFO] [submit] Booking created {"correlationId":"69ba3a4c-c466-4e76-bc7f-66f06cd4ee72","bookingId":"48a54705-8a9b-4721-8880-8a8e09c89b16","duplicate":false,"initialStatus":"confirmed","durationMs":6698,"maskedEmail":"bo***c@example.com","maskedPhone":"********3042"}
[2025-11-16T12:08:32.382Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"69ba3a4c-c466-4e76-bc7f-66f06cd4ee72","bookingId":"48a54705-8a9b-4721-8880-8a8e09c89b16","reference":"AQK3533J8M","bookingDate":"2026-04-06","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:08:31.638Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2020,"attemptId":"d593fb8f-af7b-421d-9c7a-1ff4970c30eb","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6698,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7021,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"07d02cc5-7a82-46a2-b5a0-134a8b6bf7cb","tableId":"f17cd4e8-32e3-4916-b40c-8c41addeee68","tableNumber":"BA-06","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 7021, max: 9072, avg: 8008.5, p95: 8150 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
