
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 18\:30 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-16T12:21:42.392Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1f980442-1ce6-4efa-8ad0-93c31355ba03","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:42.392Z] [INFO] [submit] Submitting booking request {"correlationId":"1f980442-1ce6-4efa-8ad0-93c31355ba03","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:21:48.744Z] [INFO] [submit] Booking created {"correlationId":"1f980442-1ce6-4efa-8ad0-93c31355ba03","bookingId":"1f36a181-1af0-4745-923a-f398380b5fb8","duplicate":false,"initialStatus":"confirmed","durationMs":6351,"maskedEmail":"bo***2@example.com","maskedPhone":"********0442"}
[2025-11-16T12:21:48.991Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1f980442-1ce6-4efa-8ad0-93c31355ba03","bookingId":"1f36a181-1af0-4745-923a-f398380b5fb8","reference":"L4WLT8J2DY","bookingDate":"2026-04-06","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:48.265Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1831,"attemptId":"051d7c37-54cf-4e69-8fbf-1b94200dc3a5","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6351,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6599,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"35171275-01aa-4a31-b3ad-fbef1516116a","tableId":"514fe674-dc73-4b6a-a981-7dbf102279a3","tableNumber":"BA-03","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:21:48.992Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a0e35712-ca07-4c44-a1e3-f1ff9f81ac1a","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:48.992Z] [INFO] [submit] Submitting booking request {"correlationId":"a0e35712-ca07-4c44-a1e3-f1ff9f81ac1a","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:21:55.228Z] [INFO] [submit] Booking created {"correlationId":"a0e35712-ca07-4c44-a1e3-f1ff9f81ac1a","bookingId":"c585d665-169a-4a73-98cd-dadd781a30c7","duplicate":false,"initialStatus":"confirmed","durationMs":6235,"maskedEmail":"bo***2@example.com","maskedPhone":"********5712"}
[2025-11-16T12:21:55.472Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a0e35712-ca07-4c44-a1e3-f1ff9f81ac1a","bookingId":"c585d665-169a-4a73-98cd-dadd781a30c7","reference":"WT7ZW2DV54","bookingDate":"2026-04-06","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:54.783Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1835,"attemptId":"ac50c290-e404-4c80-9961-4bd335dbf0fd","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6235,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6480,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5fbe7bd2-8d25-473b-b361-5b8c89932990","tableId":"14edb6e0-202e-40b9-a407-ac23f9f60c89","tableNumber":"BA-04","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:21:55.473Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1cab0b75-30e3-4afc-99ba-f42c0f2cc7af","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:55.473Z] [INFO] [submit] Submitting booking request {"correlationId":"1cab0b75-30e3-4afc-99ba-f42c0f2cc7af","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:22:01.773Z] [INFO] [submit] Booking created {"correlationId":"1cab0b75-30e3-4afc-99ba-f42c0f2cc7af","bookingId":"348c26ae-e276-43cd-94ce-57976dac8e98","duplicate":false,"initialStatus":"confirmed","durationMs":6299,"maskedEmail":"bo***5@example.com","maskedPhone":"********0175"}
[2025-11-16T12:22:02.020Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1cab0b75-30e3-4afc-99ba-f42c0f2cc7af","bookingId":"348c26ae-e276-43cd-94ce-57976dac8e98","reference":"AVH6WG2JT4","bookingDate":"2026-04-06","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:22:01.245Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1823,"attemptId":"f78fd7e1-598f-4478-99cf-049f180acffd","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6299,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6547,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"082acaeb-ddf3-4884-8afd-284fc39837b8","tableId":"bc0740e6-c0a9-49d8-92ca-416bbd0d7d32","tableNumber":"BA-05","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:22:02.020Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8aceab48-d165-4b81-92a0-32662fc623bb","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:22:02.020Z] [INFO] [submit] Submitting booking request {"correlationId":"8aceab48-d165-4b81-92a0-32662fc623bb","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:22:08.184Z] [INFO] [submit] Booking created {"correlationId":"8aceab48-d165-4b81-92a0-32662fc623bb","bookingId":"598c4dc2-8151-4232-b495-9149b3f7e321","duplicate":false,"initialStatus":"confirmed","durationMs":6163,"maskedEmail":"bo***8@example.com","maskedPhone":"********0148"}
[2025-11-16T12:22:08.390Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8aceab48-d165-4b81-92a0-32662fc623bb","bookingId":"598c4dc2-8151-4232-b495-9149b3f7e321","reference":"D8X4DCVDUD","bookingDate":"2026-04-06","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:22:07.735Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1929,"attemptId":"566bd3c5-d129-47bb-8fc7-0d86f00d56ad","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6163,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6370,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c3f46be0-3223-4d68-a50c-e0b011db6c05","tableId":"e581bf2d-4baa-4263-b5db-ce6e415010cc","tableNumber":"MD-06","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6370, max: 6599, avg: 6499, p95: 6547 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'MD-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
