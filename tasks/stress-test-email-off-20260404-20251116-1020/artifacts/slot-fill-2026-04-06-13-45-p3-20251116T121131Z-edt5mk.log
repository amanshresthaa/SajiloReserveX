
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 13\:45 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[2025-11-16T12:11:32.328Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"c36d71d0-4d50-4bcf-903b-8754cfdf2749","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:32.329Z] [INFO] [submit] Submitting booking request {"correlationId":"c36d71d0-4d50-4bcf-903b-8754cfdf2749","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:11:38.744Z] [INFO] [submit] Booking created {"correlationId":"c36d71d0-4d50-4bcf-903b-8754cfdf2749","bookingId":"ed0d1b80-a2f4-4900-8e9c-83c69ad0ea90","duplicate":false,"initialStatus":"confirmed","durationMs":6414,"maskedEmail":"bo***0@example.com","maskedPhone":"********7130"}
[2025-11-16T12:11:38.981Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"c36d71d0-4d50-4bcf-903b-8754cfdf2749","bookingId":"ed0d1b80-a2f4-4900-8e9c-83c69ad0ea90","reference":"E7U5D4DRHU","bookingDate":"2026-04-06","startTime":"13:45:00","endTime":"15:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:38.293Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1896,"attemptId":"b49e2943-e356-4c21-8f5d-54d930a7b2e0","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6414,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6652,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PT-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4672f18d-ae03-423f-8f47-3995cdadfd29","tableId":"878bda47-3172-4715-92a8-cf02574680cc","tableNumber":"PT-03","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:11:38.981Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e867871a-63ee-4a9d-a475-6a368b5e94df","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:38.981Z] [INFO] [submit] Submitting booking request {"correlationId":"e867871a-63ee-4a9d-a475-6a368b5e94df","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:45.683Z] [INFO] [submit] Booking created {"correlationId":"e867871a-63ee-4a9d-a475-6a368b5e94df","bookingId":"b7f39095-9227-4038-b67c-e233c987fce6","duplicate":false,"initialStatus":"confirmed","durationMs":6702,"maskedEmail":"bo***a@example.com","maskedPhone":"********8710"}
[2025-11-16T12:11:45.926Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e867871a-63ee-4a9d-a475-6a368b5e94df","bookingId":"b7f39095-9227-4038-b67c-e233c987fce6","reference":"TJW898GL52","bookingDate":"2026-04-06","startTime":"13:45:00","endTime":"15:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:45.245Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2053,"attemptId":"da01b3e7-9a5a-4131-9040-0fe8731bcd8e","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6702,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6945,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PT-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ee7a8e36-fc22-4bf9-a837-4c7ad788774c","tableId":"17cec96c-ee94-44a7-a329-e9c5386443d8","tableNumber":"PT-04","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:11:45.927Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"edcd0d71-b231-476c-a850-9107f3d90e45","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:45.928Z] [INFO] [submit] Submitting booking request {"correlationId":"edcd0d71-b231-476c-a850-9107f3d90e45","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:52.881Z] [INFO] [submit] Booking created {"correlationId":"edcd0d71-b231-476c-a850-9107f3d90e45","bookingId":"3620f4f5-f702-438a-b2e4-00ae84cc4643","duplicate":false,"initialStatus":"confirmed","durationMs":6952,"maskedEmail":"bo***1@example.com","maskedPhone":"********0371"}
[2025-11-16T12:11:53.129Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"edcd0d71-b231-476c-a850-9107f3d90e45","bookingId":"3620f4f5-f702-438a-b2e4-00ae84cc4643","reference":"XQ5GZBRZ8H","bookingDate":"2026-04-06","startTime":"13:45:00","endTime":"15:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:52.451Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2087,"attemptId":"ab94c68a-4334-4ff9-9d85-252894b7ecb0","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6952,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":7202,"tablesAssigned":1,"totalCapacity":6,"seatWaste":3,"tableNumbers":["PT-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"49ef7bd3-6b54-4eb2-b9bf-e4a37d0453ee","tableId":"1cc1d9b7-a560-48d0-b290-3c63bf6e7dba","tableNumber":"PT-05","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-16T12:11:53.129Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cd8b12d9-a0a6-4b10-aa66-efa2293fe1f6","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:11:53.129Z] [INFO] [submit] Submitting booking request {"correlationId":"cd8b12d9-a0a6-4b10-aa66-efa2293fe1f6","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"13:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:11:59.608Z] [INFO] [submit] Booking created {"correlationId":"cd8b12d9-a0a6-4b10-aa66-efa2293fe1f6","bookingId":"0343a232-78e7-4b25-99f8-4e4cd28f17f2","duplicate":false,"initialStatus":"confirmed","durationMs":6479,"maskedEmail":"bo***9@example.com","maskedPhone":"********1239"}
[2025-11-16T12:11:59.825Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cd8b12d9-a0a6-4b10-aa66-efa2293fe1f6","bookingId":"0343a232-78e7-4b25-99f8-4e4cd28f17f2","reference":"KPM3TBCEBG","bookingDate":"2026-04-06","startTime":"13:45:00","endTime":"15:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:11:59.145Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1853,"attemptId":"2c815853-8815-438c-8640-8fb374c239a2","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6479,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6696,"tablesAssigned":1,"totalCapacity":6,"seatWaste":3,"tableNumbers":["PT-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"60546904-e5fc-4282-9c63-0abe0ea6751b","tableId":"714473cf-11f3-4e85-a71e-b598677c9c91","tableNumber":"PT-06","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6652, max: 7202, avg: 6873.75, p95: 6945 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'PT-03', 'PT-04', 'PT-05', 'PT-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
