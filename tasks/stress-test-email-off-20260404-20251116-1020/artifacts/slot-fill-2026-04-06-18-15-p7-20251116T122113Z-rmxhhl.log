
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-04-06 --time 18\:15 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3000 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ðŸ“¡ observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ðŸ“¡ auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ðŸ“¡ version env with Radar: https://dotenvx.com/radar
[2025-11-16T12:21:14.257Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"02b0e27b-9be1-4202-a7ab-1bfb703c879b","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:14.257Z] [INFO] [submit] Submitting booking request {"correlationId":"02b0e27b-9be1-4202-a7ab-1bfb703c879b","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-16T12:21:20.616Z] [INFO] [submit] Booking created {"correlationId":"02b0e27b-9be1-4202-a7ab-1bfb703c879b","bookingId":"cc0b5899-9ce6-4601-96dc-b9e11e4cccd1","duplicate":false,"initialStatus":"confirmed","durationMs":6358,"maskedEmail":"bo***b@example.com","maskedPhone":"********4271"}
[2025-11-16T12:21:20.823Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"02b0e27b-9be1-4202-a7ab-1bfb703c879b","bookingId":"cc0b5899-9ce6-4601-96dc-b9e11e4cccd1","reference":"VVCU8QYJ4D","bookingDate":"2026-04-06","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:20.196Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2137,"attemptId":"09b51021-3a16-41e5-8d2d-9f8286bdcdfa","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":6358,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6566,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-05","MD-04"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f464b228-611e-4465-8fde-8bc915e935a9","tableId":"79590af2-90f6-40d8-8a32-e27579e5b949","tableNumber":"MD-05","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null},{"id":"eb8a98fa-fd58-48f1-be6c-dedfb0b7b308","tableId":"c5d016d2-7c61-4038-afc3-220a2fc91ea3","tableNumber":"MD-04","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:21:20.824Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2afafb81-25b4-4473-802a-7f27ed190433","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:20.824Z] [INFO] [submit] Submitting booking request {"correlationId":"2afafb81-25b4-4473-802a-7f27ed190433","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:21:27.491Z] [INFO] [submit] Booking created {"correlationId":"2afafb81-25b4-4473-802a-7f27ed190433","bookingId":"d44a17d1-46aa-4501-9e90-5683bdffbae4","duplicate":false,"initialStatus":"confirmed","durationMs":6666,"maskedEmail":"bo***1@example.com","maskedPhone":"********5181"}
[2025-11-16T12:21:27.746Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2afafb81-25b4-4473-802a-7f27ed190433","bookingId":"d44a17d1-46aa-4501-9e90-5683bdffbae4","reference":"KB5PWWYBVQ","bookingDate":"2026-04-06","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:27.084Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1911,"attemptId":"cbe2a339-4d29-4241-aaaa-65322b7d2eb4","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":6666,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6922,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-02","OG-03"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c7f63097-d50c-4e6b-a631-2e0cf50462ce","tableId":"32fd3505-2418-4a8f-9b4a-4e18eae92b50","tableNumber":"OG-02","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null},{"id":"98a01ff8-4e04-4706-9550-895e6b2d4086","tableId":"438ffaac-0215-4817-8ff6-e1516d67ce53","tableNumber":"OG-03","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:21:27.747Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8f21e830-f510-489a-b277-dc93003ff321","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:27.747Z] [INFO] [submit] Submitting booking request {"correlationId":"8f21e830-f510-489a-b277-dc93003ff321","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:21:34.411Z] [INFO] [submit] Booking created {"correlationId":"8f21e830-f510-489a-b277-dc93003ff321","bookingId":"6a522aef-7fb9-41bc-a969-6008b50ce410","duplicate":false,"initialStatus":"confirmed","durationMs":6663,"maskedEmail":"bo***0@example.com","maskedPhone":"********4830"}
[2025-11-16T12:21:34.641Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8f21e830-f510-489a-b277-dc93003ff321","bookingId":"6a522aef-7fb9-41bc-a969-6008b50ce410","reference":"RPV9YJKM6S","bookingDate":"2026-04-06","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:33.959Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2009,"attemptId":"3bd5d1e1-c786-42ae-81ff-2fcfd520be71","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":6663,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6894,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PR-02","PR-01"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e8788b61-0422-4afb-926d-7cbcbe4276be","tableId":"b2bd5f70-f175-4d36-a814-a1046aa2f2f6","tableNumber":"PR-02","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null},{"id":"54a3adb3-3e0d-4185-8407-b5cc4ada59f1","tableId":"cbcdedc9-1c2b-4d5d-a2d7-49833d4c4f0f","tableNumber":"PR-01","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-16T12:21:34.641Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"171f8ddb-19a8-4d39-bb9b-f2180b229d6a","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-16T12:21:34.641Z] [INFO] [submit] Submitting booking request {"correlationId":"171f8ddb-19a8-4d39-bb9b-f2180b229d6a","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-04-06","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-16T12:21:41.366Z] [INFO] [submit] Booking created {"correlationId":"171f8ddb-19a8-4d39-bb9b-f2180b229d6a","bookingId":"a2f053c8-7890-49f7-8853-cc161ac2ade5","duplicate":false,"initialStatus":"confirmed","durationMs":6725,"maskedEmail":"bo***b@example.com","maskedPhone":"********8331"}
[2025-11-16T12:21:41.589Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"171f8ddb-19a8-4d39-bb9b-f2180b229d6a","bookingId":"a2f053c8-7890-49f7-8853-cc161ac2ade5","reference":"4682PHNTJA","bookingDate":"2026-04-06","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-16T12:21:40.899Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":2013,"attemptId":"25555bd5-2f99-4ac0-b7e7-6cb5d7d5b300","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":6725,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":6948,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["PR-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"605b5019-1a88-40c8-9919-febbb01da77d","tableId":"803b084d-ae58-4c26-af01-bc2b79a79181","tableNumber":"PR-06","zoneId":"f830f7d4-ba3c-4290-aa0c-f6576fdbef9d","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 6566, max: 6948, avg: 6832.5, p95: 6922 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 1.5, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.75, p95: 2 },
  uniqueTables: [
    'MD-04', 'MD-05',
    'OG-02', 'OG-03',
    'PR-01', 'PR-02',
    'PR-06'
  ]
}
âœ… Stress run completed 4 booking(s) without failure.
