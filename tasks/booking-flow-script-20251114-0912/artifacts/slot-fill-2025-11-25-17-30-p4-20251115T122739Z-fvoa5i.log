
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-15T12:27:39.855Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5f1dbeb9-4c6e-41c7-aadf-cfa6e901b116","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:27:39.855Z] [INFO] [submit] Submitting booking request {"correlationId":"5f1dbeb9-4c6e-41c7-aadf-cfa6e901b116","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:28:01.324Z] [INFO] [submit] Booking created {"correlationId":"5f1dbeb9-4c6e-41c7-aadf-cfa6e901b116","bookingId":"b5ebdb8a-ccc9-463a-8e12-515d9b7e9863","duplicate":false,"initialStatus":"pending","durationMs":21469,"maskedEmail":"bo***9@example.com","maskedPhone":"********1419"}
[2025-11-15T12:28:02.020Z] [INFO] [inline_poll] Status update {"correlationId":"5f1dbeb9-4c6e-41c7-aadf-cfa6e901b116","bookingId":"b5ebdb8a-ccc9-463a-8e12-515d9b7e9863","attempt":1,"status":"pending","assignments":0,"elapsedMs":695}
[2025-11-15T12:28:11.362Z] [INFO] [inline_poll] Status update {"correlationId":"5f1dbeb9-4c6e-41c7-aadf-cfa6e901b116","bookingId":"b5ebdb8a-ccc9-463a-8e12-515d9b7e9863","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":10037}
[2025-11-15T12:28:11.363Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"5f1dbeb9-4c6e-41c7-aadf-cfa6e901b116","bookingId":"b5ebdb8a-ccc9-463a-8e12-515d9b7e9863","reference":"6NKTY42P8G","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:27:58.853Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"b7f86573-6532-46db-98f0-d3f76b23b621","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21469,"inlineAttempts":5,"inlineDurationMs":10038,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":31508,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"a1671cbb-04f9-4539-94f4-d3b9c9bdc7fc","tableId":"14edb6e0-202e-40b9-a407-ac23f9f60c89","tableNumber":"BA-04","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:11.364Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9b8ead06-62d7-4669-a3db-aa062b78cda0","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:11.365Z] [INFO] [submit] Submitting booking request {"correlationId":"9b8ead06-62d7-4669-a3db-aa062b78cda0","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:31.342Z] [INFO] [submit] Booking created {"correlationId":"9b8ead06-62d7-4669-a3db-aa062b78cda0","bookingId":"2cb6aebe-a0be-4920-998f-8d6bd3888334","duplicate":false,"initialStatus":"confirmed","durationMs":19975,"maskedEmail":"bo***6@example.com","maskedPhone":"********0306"}
[2025-11-15T12:28:31.974Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9b8ead06-62d7-4669-a3db-aa062b78cda0","bookingId":"2cb6aebe-a0be-4920-998f-8d6bd3888334","reference":"9DVWXWCZDR","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:29.665Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5787,"attemptId":"4f78b8a7-5ea3-4405-8ec0-3c920912896a","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19975,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20610,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"1ed4a202-788b-4a21-813b-4670a6924570","tableId":"f17cd4e8-32e3-4916-b40c-8c41addeee68","tableNumber":"BA-06","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:31.975Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d7fdd91f-2e1e-4698-9882-e5f1a91bbad0","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:31.975Z] [INFO] [submit] Submitting booking request {"correlationId":"d7fdd91f-2e1e-4698-9882-e5f1a91bbad0","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:51.023Z] [INFO] [submit] Booking created {"correlationId":"d7fdd91f-2e1e-4698-9882-e5f1a91bbad0","bookingId":"302aa313-48be-46cb-9086-d4eeeca15f24","duplicate":false,"initialStatus":"confirmed","durationMs":19047,"maskedEmail":"bo***f@example.com","maskedPhone":"********3915"}
[2025-11-15T12:28:51.652Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"d7fdd91f-2e1e-4698-9882-e5f1a91bbad0","bookingId":"302aa313-48be-46cb-9086-d4eeeca15f24","reference":"R8MUFGBQUM","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:49.937Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5732,"attemptId":"a1776a25-37c4-498e-82d9-8d5021dfeae6","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19047,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19677,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"91807cd9-ca38-4c72-8171-3c39054d8333","tableId":"c5d016d2-7c61-4038-afc3-220a2fc91ea3","tableNumber":"MD-04","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:51.653Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cd7afc01-bf11-429d-9ed4-00536b862bf6","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:51.653Z] [INFO] [submit] Submitting booking request {"correlationId":"cd7afc01-bf11-429d-9ed4-00536b862bf6","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:29:10.665Z] [INFO] [submit] Booking created {"correlationId":"cd7afc01-bf11-429d-9ed4-00536b862bf6","bookingId":"8b155e32-f356-474b-a353-b882903436b2","duplicate":false,"initialStatus":"confirmed","durationMs":19012,"maskedEmail":"bo***1@example.com","maskedPhone":"********5201"}
[2025-11-15T12:29:11.357Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cd7afc01-bf11-429d-9ed4-00536b862bf6","bookingId":"8b155e32-f356-474b-a353-b882903436b2","reference":"UYEVBGVJXC","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:29:09.712Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5433,"attemptId":"c4c28207-f58e-469c-9bf3-acb1700854ec","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19012,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19704,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8d95fc02-1ca4-4541-bca4-4407717d671f","tableId":"e581bf2d-4baa-4263-b5db-ce6e415010cc","tableNumber":"MD-06","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19677, max: 31508, avg: 22874.75, p95: 20610 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-04', 'BA-06', 'MD-04', 'MD-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
