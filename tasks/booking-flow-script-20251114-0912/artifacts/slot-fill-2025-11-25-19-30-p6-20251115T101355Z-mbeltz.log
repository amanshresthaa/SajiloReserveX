
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 19\:30 --party-size 6 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-15T10:13:56.462Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"58d5f168-e228-43a3-9066-442c83a517e0","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:13:56.462Z] [INFO] [submit] Submitting booking request {"correlationId":"58d5f168-e228-43a3-9066-442c83a517e0","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:14:16.661Z] [INFO] [submit] Booking created {"correlationId":"58d5f168-e228-43a3-9066-442c83a517e0","bookingId":"f9c9df08-11fa-4807-8d80-e89776bcfcc6","duplicate":false,"initialStatus":"confirmed","durationMs":20198,"maskedEmail":"bo***8@example.com","maskedPhone":"********5168"}
[2025-11-15T10:14:17.285Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"58d5f168-e228-43a3-9066-442c83a517e0","bookingId":"f9c9df08-11fa-4807-8d80-e89776bcfcc6","reference":"5J6ERVZTH4","bookingDate":"2025-11-25","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:14:14.234Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"3880b50d-0b47-4b51-9742-d9c49d6e46d5","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20198,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20823,"tablesAssigned":1,"totalCapacity":8,"seatWaste":2,"tableNumbers":["MD-09"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"17b05b0b-397d-43c9-b005-ee09448678cf","tableId":"261c9c48-b13a-4ec5-9078-13a54477275b","tableNumber":"MD-09","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:14:17.286Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4532a9e0-634e-4e32-8641-c3fdff9062e2","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:14:17.286Z] [INFO] [submit] Submitting booking request {"correlationId":"4532a9e0-634e-4e32-8641-c3fdff9062e2","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:14:35.980Z] [INFO] [submit] Booking created {"correlationId":"4532a9e0-634e-4e32-8641-c3fdff9062e2","bookingId":"ff59b420-0ef9-4b6e-adad-4cfd41ad92be","duplicate":false,"initialStatus":"confirmed","durationMs":18693,"maskedEmail":"bo***0@example.com","maskedPhone":"********0940"}
[2025-11-15T10:14:36.614Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4532a9e0-634e-4e32-8641-c3fdff9062e2","bookingId":"ff59b420-0ef9-4b6e-adad-4cfd41ad92be","reference":"T3DFQ7VGS5","bookingDate":"2025-11-25","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:14:35.072Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5476,"attemptId":"b450ba49-b1b1-4e8f-b729-849dac9eb382","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18693,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19328,"tablesAssigned":1,"totalCapacity":8,"seatWaste":2,"tableNumbers":["MD-10"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"92068e47-6ba6-4618-a0d0-54bf8c985c34","tableId":"685fc847-6aae-4198-8ac6-b987d13da2e7","tableNumber":"MD-10","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:14:36.616Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d89e10e9-3dab-4f2d-9c2c-b59cb1a0d88a","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:14:36.616Z] [INFO] [submit] Submitting booking request {"correlationId":"d89e10e9-3dab-4f2d-9c2c-b59cb1a0d88a","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:14:55.224Z] [INFO] [submit] Booking created {"correlationId":"d89e10e9-3dab-4f2d-9c2c-b59cb1a0d88a","bookingId":"78eb19a5-845b-4292-90b0-3eb163490a81","duplicate":false,"initialStatus":"confirmed","durationMs":18608,"maskedEmail":"bo***9@example.com","maskedPhone":"********1049"}
[2025-11-15T10:14:55.869Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"d89e10e9-3dab-4f2d-9c2c-b59cb1a0d88a","bookingId":"78eb19a5-845b-4292-90b0-3eb163490a81","reference":"7HZ63G9CAM","bookingDate":"2025-11-25","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:14:54.594Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5913,"attemptId":"fbdd82b0-99dd-4bf7-971d-a70a06505ce0","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18608,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19253,"tablesAssigned":1,"totalCapacity":8,"seatWaste":2,"tableNumbers":["OG-06"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6662c361-d761-4ec4-9571-4dfde7c6ffee","tableId":"c384bc25-aba6-4dc1-980b-eb70c1532a2d","tableNumber":"OG-06","zoneId":"a10aa8f6-2298-4141-8ccf-1cf6818f2337","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:14:55.870Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1100855b-48da-4e85-b502-6c74283b97c6","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:14:55.870Z] [INFO] [submit] Submitting booking request {"correlationId":"1100855b-48da-4e85-b502-6c74283b97c6","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:15:14.779Z] [INFO] [submit] Booking created {"correlationId":"1100855b-48da-4e85-b502-6c74283b97c6","bookingId":"5e551391-2750-4eb3-bfc7-a95cf785af65","duplicate":false,"initialStatus":"confirmed","durationMs":18908,"maskedEmail":"bo***b@example.com","maskedPhone":"********8551"}
[2025-11-15T10:15:15.516Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1100855b-48da-4e85-b502-6c74283b97c6","bookingId":"5e551391-2750-4eb3-bfc7-a95cf785af65","reference":"5838JUGJBF","bookingDate":"2025-11-25","startTime":"19:30:00","endTime":"21:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:15:13.954Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5410,"attemptId":"a731e372-9a6d-4289-b69d-9cbdcfef17ce","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18908,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19646,"tablesAssigned":1,"totalCapacity":8,"seatWaste":2,"tableNumbers":["PT-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f9ecd035-8282-4701-8bc5-735ed6b439f5","tableId":"b60e5cca-dc5a-4aec-8fca-91632d988a66","tableNumber":"PT-07","zoneId":"bc275831-348d-4c25-9f89-4587d08bf684","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19253, max: 20823, avg: 19762.5, p95: 19646 },
  seatWaste: { count: 4, min: 2, max: 2, avg: 2, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
✅ Stress run completed 4 booking(s) without failure.
