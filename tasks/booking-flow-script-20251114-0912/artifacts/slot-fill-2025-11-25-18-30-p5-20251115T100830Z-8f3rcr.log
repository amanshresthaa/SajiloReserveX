
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-15T10:08:31.164Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"95ad2717-7425-46b0-899e-bc947c799c2b","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:08:31.164Z] [INFO] [submit] Submitting booking request {"correlationId":"95ad2717-7425-46b0-899e-bc947c799c2b","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:08:50.135Z] [INFO] [submit] Booking created {"correlationId":"95ad2717-7425-46b0-899e-bc947c799c2b","bookingId":"0fd6f2df-a898-4558-85ba-6552559be0d9","duplicate":false,"initialStatus":"confirmed","durationMs":18970,"maskedEmail":"bo***7@example.com","maskedPhone":"********2717"}
[2025-11-15T10:08:50.766Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"95ad2717-7425-46b0-899e-bc947c799c2b","bookingId":"0fd6f2df-a898-4558-85ba-6552559be0d9","reference":"6B4WJ9757Y","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:08:49.560Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5731,"attemptId":"0193704d-1226-487b-9241-ba884bdd1a9e","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":18970,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19602,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f45f402a-3141-4371-a80e-a232b57cf1c9","tableId":"dafd2c49-18a5-40a6-9641-921b85f4da09","tableNumber":"BA-07","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:08:50.767Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1cae9b87-4299-4188-ad81-a3997910bd35","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:08:50.767Z] [INFO] [submit] Submitting booking request {"correlationId":"1cae9b87-4299-4188-ad81-a3997910bd35","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:09:11.052Z] [INFO] [submit] Booking created {"correlationId":"1cae9b87-4299-4188-ad81-a3997910bd35","bookingId":"402422e3-881e-477a-8cae-df93a3e39d21","duplicate":false,"initialStatus":"confirmed","durationMs":20284,"maskedEmail":"bo***7@example.com","maskedPhone":"********9187"}
[2025-11-15T10:09:11.684Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1cae9b87-4299-4188-ad81-a3997910bd35","bookingId":"402422e3-881e-477a-8cae-df93a3e39d21","reference":"6FNVYHJWFP","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:09:08.210Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12006,"attemptId":"8e8a9019-c046-41c4-b10c-a2500fd9f6cd","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20284,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20917,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bd1331ea-8bcc-4c76-a574-e22e0c307e01","tableId":"a4660069-4afd-40f0-b307-df6fd3b4649f","tableNumber":"BA-08","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:09:11.685Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"86f99368-fbcb-44a4-ba4c-c146cf36c544","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:09:11.685Z] [INFO] [submit] Submitting booking request {"correlationId":"86f99368-fbcb-44a4-ba4c-c146cf36c544","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:09:30.753Z] [INFO] [submit] Booking created {"correlationId":"86f99368-fbcb-44a4-ba4c-c146cf36c544","bookingId":"3fbca29d-1c71-4bdb-a84a-9fe74ab2351e","duplicate":false,"initialStatus":"confirmed","durationMs":19067,"maskedEmail":"bo***8@example.com","maskedPhone":"********9368"}
[2025-11-15T10:09:31.385Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"86f99368-fbcb-44a4-ba4c-c146cf36c544","bookingId":"3fbca29d-1c71-4bdb-a84a-9fe74ab2351e","reference":"35X8Q4JPBK","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:09:29.861Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5510,"attemptId":"49088f52-05e4-47c8-8d21-ec77f430078e","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19067,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19700,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8f6d9a3f-1ee5-4849-98d1-8ef214c06115","tableId":"91f47093-60b7-4ee9-beff-2b24a75a3982","tableNumber":"MD-07","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:09:31.386Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0692ff42-0eb4-4257-ba15-5c3f800b924a","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:09:31.386Z] [INFO] [submit] Submitting booking request {"correlationId":"0692ff42-0eb4-4257-ba15-5c3f800b924a","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:09:50.376Z] [INFO] [submit] Booking created {"correlationId":"0692ff42-0eb4-4257-ba15-5c3f800b924a","bookingId":"db641660-c47b-43dc-a2be-06434e4c218b","duplicate":false,"initialStatus":"confirmed","durationMs":18990,"maskedEmail":"bo***2@example.com","maskedPhone":"********5542"}
[2025-11-15T10:09:51.036Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0692ff42-0eb4-4257-ba15-5c3f800b924a","bookingId":"db641660-c47b-43dc-a2be-06434e4c218b","reference":"RUBMDYZDSX","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:09:49.718Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5477,"attemptId":"0e5b654d-a4e2-49d0-844e-a1e012ca0b32","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18990,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19650,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bc74c835-3d39-4df9-b309-72006de9108b","tableId":"af56c245-ec90-4fdf-82a3-ae7888c435a7","tableNumber":"MD-08","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19602, max: 20917, avg: 19967.25, p95: 19700 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
