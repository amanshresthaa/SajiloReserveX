
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-15T10:24:44.976Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e907a072-d1be-4c32-8f24-5f560deda115","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:24:44.977Z] [INFO] [submit] Submitting booking request {"correlationId":"e907a072-d1be-4c32-8f24-5f560deda115","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:25:04.277Z] [INFO] [submit] Booking created {"correlationId":"e907a072-d1be-4c32-8f24-5f560deda115","bookingId":"a971e430-f587-4581-9538-c628ec186679","duplicate":false,"initialStatus":"confirmed","durationMs":19299,"maskedEmail":"bo***2@example.com","maskedPhone":"********0072"}
[2025-11-15T10:25:04.999Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e907a072-d1be-4c32-8f24-5f560deda115","bookingId":"a971e430-f587-4581-9538-c628ec186679","reference":"TEUSA949XE","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:25:03.447Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5506,"attemptId":"c540394b-8ba1-4262-ba1e-241b13116fc6","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19299,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20022,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-08"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"439b67ed-0b25-4fa8-90f4-2e853f07ad45","tableId":"ae670f86-fac7-406c-877f-fde0cbfdb321","tableNumber":"PT-08","zoneId":"9fa8c6a5-9af6-43e4-bf0f-c2377833daeb","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:25:04.999Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e64b24df-a823-4445-ae94-be0aefdeed00","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:25:05.000Z] [INFO] [submit] Submitting booking request {"correlationId":"e64b24df-a823-4445-ae94-be0aefdeed00","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:25:24.311Z] [INFO] [submit] Booking created {"correlationId":"e64b24df-a823-4445-ae94-be0aefdeed00","bookingId":"ea41dee8-68d5-458d-9eb3-f10bae2f33be","duplicate":false,"initialStatus":"confirmed","durationMs":19311,"maskedEmail":"bo***f@example.com","maskedPhone":"********2435"}
[2025-11-15T10:25:25.053Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e64b24df-a823-4445-ae94-be0aefdeed00","bookingId":"ea41dee8-68d5-458d-9eb3-f10bae2f33be","reference":"63HYZKSPG6","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:25:21.985Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"40f3b40e-7a27-4dcf-b890-a354ee07d207","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19311,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20054,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-04","MD-03"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4011ab1f-ccc4-402b-b09f-9ff0285418ea","tableId":"47c613cb-fcca-4773-9954-e27c22b5b50c","tableNumber":"MD-04","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":4,"startAt":null,"endAt":null},{"id":"03d93c0d-d799-481f-9504-0486ccde59ba","tableId":"9da5a973-15d5-4424-a41f-bd69ec82147a","tableNumber":"MD-03","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:25:25.055Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3ec9981c-2291-48e3-84bd-60593684b5a5","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:25:25.055Z] [INFO] [submit] Submitting booking request {"correlationId":"3ec9981c-2291-48e3-84bd-60593684b5a5","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:25:45.635Z] [INFO] [submit] Booking created {"correlationId":"3ec9981c-2291-48e3-84bd-60593684b5a5","bookingId":"37053f0e-4d49-4012-ae54-30fc7ac98c77","duplicate":false,"initialStatus":"confirmed","durationMs":20579,"maskedEmail":"bo***c@example.com","maskedPhone":"********9812"}
[2025-11-15T10:25:46.268Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3ec9981c-2291-48e3-84bd-60593684b5a5","bookingId":"37053f0e-4d49-4012-ae54-30fc7ac98c77","reference":"Y2TNNS4E4W","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:25:43.206Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"374adac5-1cc3-4661-9bec-9692c7320259","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20579,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21213,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-06","MD-05"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"fa0d4980-c650-4361-ad67-4bfd700c0243","tableId":"704bbbdf-a7b7-479d-a0c2-cc0ba5c11d3c","tableNumber":"MD-06","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":4,"startAt":null,"endAt":null},{"id":"5c1048bc-c3a6-4e87-83cb-31e91ea32544","tableId":"a4b4d07a-8d16-4533-93fa-ba3344558413","tableNumber":"MD-05","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:25:46.268Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8aef9157-1622-4e23-a87a-fe6a094f5c0f","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:25:46.269Z] [INFO] [submit] Submitting booking request {"correlationId":"8aef9157-1622-4e23-a87a-fe6a094f5c0f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:26:04.995Z] [INFO] [submit] Booking created {"correlationId":"8aef9157-1622-4e23-a87a-fe6a094f5c0f","bookingId":"417a2556-ce95-43f1-9a64-13c7710c736f","duplicate":false,"initialStatus":"confirmed","durationMs":18726,"maskedEmail":"bo***7@example.com","maskedPhone":"********9157"}
[2025-11-15T10:26:05.627Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8aef9157-1622-4e23-a87a-fe6a094f5c0f","bookingId":"417a2556-ce95-43f1-9a64-13c7710c736f","reference":"8TJUJQKDNK","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:26:04.427Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5622,"attemptId":"509f656a-0fbe-4715-8540-9e2d12b09f96","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18726,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19359,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-04","PT-03"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6248f50a-95f3-4e09-8e52-6011e092091a","tableId":"0a5eec68-632c-450e-8d65-03b01469d1ce","tableNumber":"PT-04","zoneId":"9fa8c6a5-9af6-43e4-bf0f-c2377833daeb","capacity":4,"startAt":null,"endAt":null},{"id":"222af4a8-e7c1-4ddf-a7e5-8b8a85987934","tableId":"8a9a36b8-af9e-4113-b64c-11ccf2afb590","tableNumber":"PT-03","zoneId":"9fa8c6a5-9af6-43e4-bf0f-c2377833daeb","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19359, max: 21213, avg: 20162, p95: 20054 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.75, p95: 2 },
  uniqueTables: [
    'MD-03', 'MD-04',
    'MD-05', 'MD-06',
    'PT-03', 'PT-04',
    'PT-08'
  ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
