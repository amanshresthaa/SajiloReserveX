
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  enable debug logging with { debug: true }
[2025-11-15T10:20:36.140Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ebf3e77b-7d55-4d24-9db7-ccdfb9c275ce","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:20:36.140Z] [INFO] [submit] Submitting booking request {"correlationId":"ebf3e77b-7d55-4d24-9db7-ccdfb9c275ce","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:20:56.208Z] [INFO] [submit] Booking created {"correlationId":"ebf3e77b-7d55-4d24-9db7-ccdfb9c275ce","bookingId":"0ea78d60-98e9-424b-9439-5d9599643af2","duplicate":false,"initialStatus":"confirmed","durationMs":20067,"maskedEmail":"bo***b@example.com","maskedPhone":"********4771"}
[2025-11-15T10:20:56.888Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ebf3e77b-7d55-4d24-9db7-ccdfb9c275ce","bookingId":"0ea78d60-98e9-424b-9439-5d9599643af2","reference":"P9A5FR5CJK","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:20:55.361Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5487,"attemptId":"9a9c55c8-2ab6-4d0c-b018-31a90bc1fc13","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20067,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20748,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a9599d30-6645-40f6-b212-d084bc0ec0e6","tableId":"94d04550-13b4-42b8-ac67-2f4fc7757672","tableNumber":"BA-07","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:20:56.889Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d627daba-5546-46ab-8eca-6e122ab4c64d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:20:56.889Z] [INFO] [submit] Submitting booking request {"correlationId":"d627daba-5546-46ab-8eca-6e122ab4c64d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:21:15.581Z] [INFO] [submit] Booking created {"correlationId":"d627daba-5546-46ab-8eca-6e122ab4c64d","bookingId":"8fdde1a8-89b7-48a2-98e0-7302504d1c8a","duplicate":false,"initialStatus":"confirmed","durationMs":18691,"maskedEmail":"bo***a@example.com","maskedPhone":"********3010"}
[2025-11-15T10:21:16.212Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"d627daba-5546-46ab-8eca-6e122ab4c64d","bookingId":"8fdde1a8-89b7-48a2-98e0-7302504d1c8a","reference":"S6WSB6HGWZ","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:21:14.739Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5482,"attemptId":"f62f4815-bfc1-4553-8fde-ff87580871c5","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18691,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19323,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"951e90d9-2935-43be-b13e-9db305cf5483","tableId":"5fe8a925-54b6-47c7-b3e7-12ffbe1d6e9e","tableNumber":"BA-08","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:21:16.214Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f785a9c2-0d65-45ba-8f4d-411ad892f656","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:21:16.214Z] [INFO] [submit] Submitting booking request {"correlationId":"f785a9c2-0d65-45ba-8f4d-411ad892f656","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:21:36.787Z] [INFO] [submit] Booking created {"correlationId":"f785a9c2-0d65-45ba-8f4d-411ad892f656","bookingId":"6d14c5da-387d-456b-88dc-d6f8aa53f002","duplicate":false,"initialStatus":"confirmed","durationMs":20573,"maskedEmail":"bo***2@example.com","maskedPhone":"********0922"}
[2025-11-15T10:21:37.444Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f785a9c2-0d65-45ba-8f4d-411ad892f656","bookingId":"6d14c5da-387d-456b-88dc-d6f8aa53f002","reference":"SKT6PLWV8Q","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:21:35.341Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5486,"attemptId":"45bce356-3998-4756-b289-586bc813a208","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20573,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21230,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c15939fd-7dbd-4f39-88ad-83010740b9ca","tableId":"45e347f4-d784-4155-881f-32c4cbb58869","tableNumber":"MD-07","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:21:37.445Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"93054ebb-8c42-4bb0-bff0-e551d8798582","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:21:37.445Z] [INFO] [submit] Submitting booking request {"correlationId":"93054ebb-8c42-4bb0-bff0-e551d8798582","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:21:58.305Z] [INFO] [submit] Booking created {"correlationId":"93054ebb-8c42-4bb0-bff0-e551d8798582","bookingId":"6e69c005-c694-4f03-bc94-7e421d3dd94a","duplicate":false,"initialStatus":"confirmed","durationMs":20858,"maskedEmail":"bo***b@example.com","maskedPhone":"********4411"}
[2025-11-15T10:21:58.935Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"93054ebb-8c42-4bb0-bff0-e551d8798582","bookingId":"6e69c005-c694-4f03-bc94-7e421d3dd94a","reference":"JGZWQM5X8V","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:21:55.726Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"f51cc155-4564-45cd-8f74-740c601714fa","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20858,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21490,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a59dd26a-b0b3-464b-9e4e-9ab8084694c1","tableId":"3f3c9fcd-1ab2-4479-8fea-bc8ce959a2ac","tableNumber":"MD-08","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19323, max: 21490, avg: 20697.75, p95: 21230 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
✅ Stress run completed 4 booking(s) without failure.
