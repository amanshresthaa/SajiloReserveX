
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-15T10:42:03.641Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5591b3ec-ab3d-4f11-91dd-b21c36d8ca43","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:03.641Z] [INFO] [submit] Submitting booking request {"correlationId":"5591b3ec-ab3d-4f11-91dd-b21c36d8ca43","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:42:25.890Z] [INFO] [submit] Booking created {"correlationId":"5591b3ec-ab3d-4f11-91dd-b21c36d8ca43","bookingId":"68cdacb5-efdf-41f6-a88c-8593a88f90d3","duplicate":false,"initialStatus":"confirmed","durationMs":22248,"maskedEmail":"bo***c@example.com","maskedPhone":"********1342"}
[2025-11-15T10:42:26.506Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5591b3ec-ab3d-4f11-91dd-b21c36d8ca43","bookingId":"68cdacb5-efdf-41f6-a88c-8593a88f90d3","reference":"S88UR4FJ4Q","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:25.138Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":6309,"attemptId":"9f74071e-e595-4455-be52-9b04b30628e8","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22248,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22865,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b308870c-2683-49f3-b93c-dd54eccb0cc4","tableId":"12ed603b-c35e-44c8-9191-87b4a537d186","tableNumber":"BA-01","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:26.507Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"63a6ca5e-3f30-4bcc-bcaf-9e4a48e029cd","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:26.507Z] [INFO] [submit] Submitting booking request {"correlationId":"63a6ca5e-3f30-4bcc-bcaf-9e4a48e029cd","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:42:45.213Z] [INFO] [submit] Booking created {"correlationId":"63a6ca5e-3f30-4bcc-bcaf-9e4a48e029cd","bookingId":"7583506e-30d9-46fb-b3e5-13c589680726","duplicate":false,"initialStatus":"confirmed","durationMs":18705,"maskedEmail":"bo***e@example.com","maskedPhone":"********2054"}
[2025-11-15T10:42:45.844Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"63a6ca5e-3f30-4bcc-bcaf-9e4a48e029cd","bookingId":"7583506e-30d9-46fb-b3e5-13c589680726","reference":"AMBDEAQK77","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:43.602Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5596,"attemptId":"7a4e404c-a6ba-4a60-abcb-f81d6464ddcb","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18705,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19337,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"63bc835c-6bd7-4715-be8b-ff0fad7d5987","tableId":"7ce0f7b7-3d45-42ea-b940-5abf2f2a13ec","tableNumber":"BA-02","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:45.845Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"90554383-15a9-4644-8d60-dc17222b5bc5","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:45.845Z] [INFO] [submit] Submitting booking request {"correlationId":"90554383-15a9-4644-8d60-dc17222b5bc5","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:05.002Z] [INFO] [submit] Booking created {"correlationId":"90554383-15a9-4644-8d60-dc17222b5bc5","bookingId":"50d99ee3-cb71-49a3-a77e-a7ddf1364d29","duplicate":false,"initialStatus":"confirmed","durationMs":19156,"maskedEmail":"bo***3@example.com","maskedPhone":"********4383"}
[2025-11-15T10:43:05.673Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"90554383-15a9-4644-8d60-dc17222b5bc5","bookingId":"50d99ee3-cb71-49a3-a77e-a7ddf1364d29","reference":"HY7QUVEN5S","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:04.152Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5353,"attemptId":"7f7095e9-0a6f-4325-b631-f469913e39a9","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19156,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19828,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"93e2eb49-2e0e-4068-bea5-b5a3fc5549e9","tableId":"d758f742-89a2-4a44-9af2-82e28865484b","tableNumber":"MD-01","zoneId":"dce1381c-1e68-4040-9ed5-85411d27ddf9","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:43:05.674Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"be88dce9-1de9-4156-8713-e982dc4ff8e1","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:43:05.674Z] [INFO] [submit] Submitting booking request {"correlationId":"be88dce9-1de9-4156-8713-e982dc4ff8e1","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:25.394Z] [INFO] [submit] Booking created {"correlationId":"be88dce9-1de9-4156-8713-e982dc4ff8e1","bookingId":"7330e42e-3e3c-4ae4-ad59-cd5676174023","duplicate":false,"initialStatus":"confirmed","durationMs":19719,"maskedEmail":"bo***9@example.com","maskedPhone":"********3249"}
[2025-11-15T10:43:26.093Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"be88dce9-1de9-4156-8713-e982dc4ff8e1","bookingId":"7330e42e-3e3c-4ae4-ad59-cd5676174023","reference":"F9Y8J85MSY","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:25.037Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5600,"attemptId":"f14cf2a8-696a-444d-a6d5-a77286551cc0","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19719,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20419,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7e1da86b-fb21-42be-ac31-0f7e76082248","tableId":"abc1d7f0-c377-4a81-bfa3-a9d4fd5729f1","tableNumber":"MD-02","zoneId":"dce1381c-1e68-4040-9ed5-85411d27ddf9","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19337, max: 22865, avg: 20612.25, p95: 20419 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
✅ Stress run completed 4 booking(s) without failure.
