
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2025-11-15T12:27:39.855Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"54d77601-a70a-4c3e-b619-7d83f18446a3","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:27:39.855Z] [INFO] [submit] Submitting booking request {"correlationId":"54d77601-a70a-4c3e-b619-7d83f18446a3","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:28:01.344Z] [INFO] [submit] Booking created {"correlationId":"54d77601-a70a-4c3e-b619-7d83f18446a3","bookingId":"bb33b28f-6bb1-4db2-a7d4-a17c2e0c47da","duplicate":false,"initialStatus":"confirmed","durationMs":21488,"maskedEmail":"bo***1@example.com","maskedPhone":"********7601"}
[2025-11-15T12:28:02.022Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"54d77601-a70a-4c3e-b619-7d83f18446a3","bookingId":"bb33b28f-6bb1-4db2-a7d4-a17c2e0c47da","reference":"SSUUQQXTYS","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:00.911Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":6121,"attemptId":"6f42b9a9-0fb4-4bb5-830f-4ea8b5a85fce","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21488,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22167,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5c0d9268-99ee-4eef-b479-cbb803f836a4","tableId":"15d6a144-c838-440f-9e76-fc415dd1be3f","tableNumber":"BA-07","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:02.023Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ad7f904c-f7df-4321-8964-f9236198ed35","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:02.023Z] [INFO] [submit] Submitting booking request {"correlationId":"ad7f904c-f7df-4321-8964-f9236198ed35","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:22.033Z] [INFO] [submit] Booking created {"correlationId":"ad7f904c-f7df-4321-8964-f9236198ed35","bookingId":"b97efa4f-4421-4abd-b7c4-c4aed14b6aaa","duplicate":false,"initialStatus":"confirmed","durationMs":20008,"maskedEmail":"bo***c@example.com","maskedPhone":"********9042"}
[2025-11-15T12:28:22.667Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ad7f904c-f7df-4321-8964-f9236198ed35","bookingId":"b97efa4f-4421-4abd-b7c4-c4aed14b6aaa","reference":"5PV8QMB2KF","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:20.927Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5603,"attemptId":"d5af5d9d-7588-47b7-bf95-53198bee5817","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20008,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20644,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dcc7467c-3bae-46ac-8bc0-0d2c4629b0ff","tableId":"2dcab6f8-ccbc-4d31-bc47-fb82bcdf3122","tableNumber":"BA-08","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:22.669Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"72ea1909-3b24-4365-9d7f-ad9638322fd8","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:22.669Z] [INFO] [submit] Submitting booking request {"correlationId":"72ea1909-3b24-4365-9d7f-ad9638322fd8","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:41.780Z] [INFO] [submit] Booking created {"correlationId":"72ea1909-3b24-4365-9d7f-ad9638322fd8","bookingId":"96d48cce-cefe-45d2-82d5-624e8334f587","duplicate":false,"initialStatus":"confirmed","durationMs":19109,"maskedEmail":"bo***9@example.com","maskedPhone":"********1909"}
[2025-11-15T12:28:42.477Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"72ea1909-3b24-4365-9d7f-ad9638322fd8","bookingId":"96d48cce-cefe-45d2-82d5-624e8334f587","reference":"54ALY27MKA","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:40.257Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5420,"attemptId":"f3401916-2048-47f4-aeec-64b77aa2352f","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19109,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19808,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a741e45e-dffe-4e6c-84a7-af71507244fa","tableId":"36a18791-8339-42c5-a43f-996e2560b240","tableNumber":"MD-07","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:42.478Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9bcd527b-e014-4ac4-b0a1-ec95686f7b10","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:42.478Z] [INFO] [submit] Submitting booking request {"correlationId":"9bcd527b-e014-4ac4-b0a1-ec95686f7b10","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:29:01.358Z] [INFO] [submit] Booking created {"correlationId":"9bcd527b-e014-4ac4-b0a1-ec95686f7b10","bookingId":"e7e8b4f6-ed96-43b8-a35c-ff0446399a6d","duplicate":false,"initialStatus":"confirmed","durationMs":18879,"maskedEmail":"bo***b@example.com","maskedPhone":"********5271"}
[2025-11-15T12:29:02.005Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9bcd527b-e014-4ac4-b0a1-ec95686f7b10","bookingId":"e7e8b4f6-ed96-43b8-a35c-ff0446399a6d","reference":"U8BV2GXZ2W","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:29:00.510Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5414,"attemptId":"17851d4e-5da1-4c06-86ef-eab69abf2dc3","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18879,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19527,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e36f7e42-f74f-4010-b6da-cadb32d36f59","tableId":"94040fa4-ae8f-44eb-9298-cba491e3d204","tableNumber":"MD-08","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19527, max: 22167, avg: 20536.5, p95: 20644 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
