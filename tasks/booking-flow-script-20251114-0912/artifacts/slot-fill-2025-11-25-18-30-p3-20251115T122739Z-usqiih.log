
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2025-11-15T12:27:39.855Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"dc353c34-4b81-43af-a78d-0589fa31bc6c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:27:39.855Z] [INFO] [submit] Submitting booking request {"correlationId":"dc353c34-4b81-43af-a78d-0589fa31bc6c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:28:01.317Z] [INFO] [submit] Booking created {"correlationId":"dc353c34-4b81-43af-a78d-0589fa31bc6c","bookingId":"ea173937-310c-4420-bf13-ca337ba76c57","duplicate":false,"initialStatus":"confirmed","durationMs":21461,"maskedEmail":"bo***4@example.com","maskedPhone":"********3234"}
[2025-11-15T12:28:02.023Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"dc353c34-4b81-43af-a78d-0589fa31bc6c","bookingId":"ea173937-310c-4420-bf13-ca337ba76c57","reference":"RUEM9ZFPTR","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:00.980Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":6122,"attemptId":"7ef62037-aed1-4efc-8d5a-a18b150953a3","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21461,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22167,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4ae033df-0f18-41cf-a98b-92796c436ab3","tableId":"514fe674-dc73-4b6a-a981-7dbf102279a3","tableNumber":"BA-03","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:02.023Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"fb7e6d22-51be-4c1f-8f2b-d5425c24d6e8","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:02.024Z] [INFO] [submit] Submitting booking request {"correlationId":"fb7e6d22-51be-4c1f-8f2b-d5425c24d6e8","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:21.624Z] [INFO] [submit] Booking created {"correlationId":"fb7e6d22-51be-4c1f-8f2b-d5425c24d6e8","bookingId":"e920641d-260b-4199-b5b8-a0bf400da232","duplicate":false,"initialStatus":"confirmed","durationMs":19599,"maskedEmail":"bo***2@example.com","maskedPhone":"********6322"}
[2025-11-15T12:28:22.232Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"fb7e6d22-51be-4c1f-8f2b-d5425c24d6e8","bookingId":"e920641d-260b-4199-b5b8-a0bf400da232","reference":"USNFS9HDAC","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:20.668Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5618,"attemptId":"89d5e69a-bf94-46c3-9158-3b70d4dc3217","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19599,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20209,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2901b2e5-5d65-4331-81d4-bda6c626f059","tableId":"bc0740e6-c0a9-49d8-92ca-416bbd0d7d32","tableNumber":"BA-05","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:22.234Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a9b45f38-b553-4165-9a57-b5ac50a352b9","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:22.234Z] [INFO] [submit] Submitting booking request {"correlationId":"a9b45f38-b553-4165-9a57-b5ac50a352b9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:41.536Z] [INFO] [submit] Booking created {"correlationId":"a9b45f38-b553-4165-9a57-b5ac50a352b9","bookingId":"70a0cf63-bfea-4d8a-98b0-defc1feaeaa5","duplicate":false,"initialStatus":"confirmed","durationMs":19300,"maskedEmail":"bo***8@example.com","maskedPhone":"********5538"}
[2025-11-15T12:28:42.158Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a9b45f38-b553-4165-9a57-b5ac50a352b9","bookingId":"70a0cf63-bfea-4d8a-98b0-defc1feaeaa5","reference":"VF6B7B44XL","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:40.142Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":6055,"attemptId":"5ccb0c0a-ba9b-4740-91b8-880d98f02da4","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19300,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19924,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"31c5b6f7-c722-43a8-a57e-0fa9b230952d","tableId":"38694eb6-cde9-4253-8b8a-cdcd4b74084e","tableNumber":"MD-03","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:42.159Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0d541ded-d509-4714-a3fa-1ba12cf05d7f","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:42.159Z] [INFO] [submit] Submitting booking request {"correlationId":"0d541ded-d509-4714-a3fa-1ba12cf05d7f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:29:01.668Z] [INFO] [submit] Booking created {"correlationId":"0d541ded-d509-4714-a3fa-1ba12cf05d7f","bookingId":"f4e2c445-93cf-465c-ba46-537e638eaa1a","duplicate":false,"initialStatus":"confirmed","durationMs":19509,"maskedEmail":"bo***d@example.com","maskedPhone":"********1343"}
[2025-11-15T12:29:02.296Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0d541ded-d509-4714-a3fa-1ba12cf05d7f","bookingId":"f4e2c445-93cf-465c-ba46-537e638eaa1a","reference":"6G65HBTTKY","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:29:00.004Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5429,"attemptId":"e7dd7335-31df-459c-914b-83fe784133af","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19509,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20137,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"324b7ba1-1bc1-4901-ab67-ab60330741d0","tableId":"79590af2-90f6-40d8-8a32-e27579e5b949","tableNumber":"MD-05","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19924, max: 22167, avg: 20609.25, p95: 20209 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-05', 'MD-03', 'MD-05' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
