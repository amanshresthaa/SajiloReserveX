
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-15T10:30:00.853Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4e77d08f-1e94-4495-bb9e-60f51709ba8c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:30:00.853Z] [INFO] [submit] Submitting booking request {"correlationId":"4e77d08f-1e94-4495-bb9e-60f51709ba8c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:30:21.554Z] [INFO] [submit] Booking created {"correlationId":"4e77d08f-1e94-4495-bb9e-60f51709ba8c","bookingId":"621faac3-266d-41bd-aa82-e13e811136ce","duplicate":false,"initialStatus":"confirmed","durationMs":20699,"maskedEmail":"bo***f@example.com","maskedPhone":"********3085"}
[2025-11-15T10:30:22.311Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4e77d08f-1e94-4495-bb9e-60f51709ba8c","bookingId":"621faac3-266d-41bd-aa82-e13e811136ce","reference":"UPHQY59ZG2","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:30:20.567Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":6043,"attemptId":"e5242ca2-0f8b-4bfb-8255-479915a730da","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20699,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21458,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-09"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2b2d0122-390e-4014-87c1-24d8d5775a40","tableId":"404029ec-b768-433a-8574-c9416c926f21","tableNumber":"MD-09","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:30:22.312Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"550a4352-7f55-4985-94d1-b047f2279e46","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:30:22.313Z] [INFO] [submit] Submitting booking request {"correlationId":"550a4352-7f55-4985-94d1-b047f2279e46","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:30:42.090Z] [INFO] [submit] Booking created {"correlationId":"550a4352-7f55-4985-94d1-b047f2279e46","bookingId":"17e25873-8c40-40a1-af29-831e7fe179bd","duplicate":false,"initialStatus":"confirmed","durationMs":19776,"maskedEmail":"bo***2@example.com","maskedPhone":"********4352"}
[2025-11-15T10:30:43.128Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"550a4352-7f55-4985-94d1-b047f2279e46","bookingId":"17e25873-8c40-40a1-af29-831e7fe179bd","reference":"6MQLARB4W5","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:30:39.203Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"690f1bf4-9cd2-41b7-9694-fa805da1db25","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19776,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20816,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-10"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"341d609a-c2f2-4988-b9af-0ea36475f599","tableId":"a1aede9d-2f19-4832-a03d-d004e3aac822","tableNumber":"MD-10","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:30:43.130Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a0b28bed-4f1b-474e-abc3-4254eb73c8b4","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:30:43.130Z] [INFO] [submit] Submitting booking request {"correlationId":"a0b28bed-4f1b-474e-abc3-4254eb73c8b4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:31:03.052Z] [INFO] [submit] Booking created {"correlationId":"a0b28bed-4f1b-474e-abc3-4254eb73c8b4","bookingId":"1992b79b-5c54-486a-9f68-09bf6b867c6f","duplicate":false,"initialStatus":"confirmed","durationMs":19921,"maskedEmail":"bo***d@example.com","maskedPhone":"********8143"}
[2025-11-15T10:31:03.792Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a0b28bed-4f1b-474e-abc3-4254eb73c8b4","bookingId":"1992b79b-5c54-486a-9f68-09bf6b867c6f","reference":"9P3QXQB5C2","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:31:00.678Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"0e2c1c2a-6bba-4f3c-9b7d-7ae3775b4481","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19921,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20662,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"aef47d01-5a58-4d03-848e-51e5e83f4078","tableId":"1005da9a-3375-4ebb-b85d-69a38c4a391b","tableNumber":"OG-06","zoneId":"3e0273b5-51f8-4571-bcd2-ce3b034a4aaa","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:31:03.793Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"dc57fa68-3fc7-435c-982e-d2306231056f","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:31:03.793Z] [INFO] [submit] Submitting booking request {"correlationId":"dc57fa68-3fc7-435c-982e-d2306231056f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:31:23.290Z] [INFO] [submit] Booking created {"correlationId":"dc57fa68-3fc7-435c-982e-d2306231056f","bookingId":"bae68ea9-3278-439d-b291-506efe1d2f8e","duplicate":false,"initialStatus":"confirmed","durationMs":19497,"maskedEmail":"bo***8@example.com","maskedPhone":"********5068"}
[2025-11-15T10:31:24.026Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"dc57fa68-3fc7-435c-982e-d2306231056f","bookingId":"bae68ea9-3278-439d-b291-506efe1d2f8e","reference":"SARN3L9GDH","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:31:22.449Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5653,"attemptId":"d22a1532-943a-4219-a836-cfa9fa01e2dc","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19497,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20233,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-07"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"96153469-2350-4d32-9a7f-e2c63bb0e822","tableId":"75e3d6a4-9846-4d96-b24b-37a46527f2a3","tableNumber":"PT-07","zoneId":"a405d9d0-7cd1-447f-a550-b0f0b7d83525","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20233, max: 21458, avg: 20792.25, p95: 20816 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
