
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-15T12:16:02.512Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b9a34f07-ee9b-4c02-943a-325591aa2d68","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:16:02.512Z] [INFO] [submit] Submitting booking request {"correlationId":"b9a34f07-ee9b-4c02-943a-325591aa2d68","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:16:21.202Z] [INFO] [submit] Booking created {"correlationId":"b9a34f07-ee9b-4c02-943a-325591aa2d68","bookingId":"71cd0ecf-8b6a-45bc-856e-65640281571b","duplicate":false,"initialStatus":"confirmed","durationMs":18688,"maskedEmail":"bo***7@example.com","maskedPhone":"********4507"}
[2025-11-15T12:16:21.810Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b9a34f07-ee9b-4c02-943a-325591aa2d68","bookingId":"71cd0ecf-8b6a-45bc-856e-65640281571b","reference":"9B2SZEB5VL","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:16:20.344Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5442,"attemptId":"a16006b2-4892-4932-b8c7-63d8242b8382","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":18688,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19298,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c5903de1-d7b2-4c47-b52f-db0efec7eb64","tableId":"da4a85f9-758a-4d35-a3e1-38d8e995a9f2","tableNumber":"BA-03","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:16:21.811Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8079d5a6-7463-48d4-ad76-245380c47248","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:16:21.812Z] [INFO] [submit] Submitting booking request {"correlationId":"8079d5a6-7463-48d4-ad76-245380c47248","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:16:42.518Z] [INFO] [submit] Booking created {"correlationId":"8079d5a6-7463-48d4-ad76-245380c47248","bookingId":"31d5f3bf-b7d8-4822-848e-1a320999846c","duplicate":false,"initialStatus":"confirmed","durationMs":20705,"maskedEmail":"bo***6@example.com","maskedPhone":"********3506"}
[2025-11-15T12:16:43.248Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8079d5a6-7463-48d4-ad76-245380c47248","bookingId":"31d5f3bf-b7d8-4822-848e-1a320999846c","reference":"NJ9ZW74FHH","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:16:39.116Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"08acbe81-d4b7-4b15-b126-ff6283fbd65f","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20705,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21437,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"fc2a0e22-c8ec-4410-be93-7b2a3e96bec5","tableId":"3017c1b1-6080-425a-b2c2-eebbc8ddf981","tableNumber":"BA-04","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:16:43.250Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e4b342ee-27d3-453e-b13b-1a3a33ed816f","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:16:43.250Z] [INFO] [submit] Submitting booking request {"correlationId":"e4b342ee-27d3-453e-b13b-1a3a33ed816f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:17:02.284Z] [INFO] [submit] Booking created {"correlationId":"e4b342ee-27d3-453e-b13b-1a3a33ed816f","bookingId":"359527e3-8cd4-4835-9a1a-9e70e0c45280","duplicate":false,"initialStatus":"confirmed","durationMs":19034,"maskedEmail":"bo***e@example.com","maskedPhone":"********4244"}
[2025-11-15T12:17:02.929Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e4b342ee-27d3-453e-b13b-1a3a33ed816f","bookingId":"359527e3-8cd4-4835-9a1a-9e70e0c45280","reference":"2TVMPA9ZAN","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:17:01.378Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5505,"attemptId":"606463f7-5896-4d70-8aa2-0ff4a6497b94","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19034,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19679,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d4dd3937-dce6-4775-81eb-9d948749ff52","tableId":"f51aecef-0d4b-4d29-9e3f-307af65ffcda","tableNumber":"BA-05","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:17:02.930Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cf5c637b-cdc9-43b0-ba7b-ff00e1ae7f22","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:17:02.930Z] [INFO] [submit] Submitting booking request {"correlationId":"cf5c637b-cdc9-43b0-ba7b-ff00e1ae7f22","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:17:22.302Z] [INFO] [submit] Booking created {"correlationId":"cf5c637b-cdc9-43b0-ba7b-ff00e1ae7f22","bookingId":"8524baaf-e0fb-46a7-a9da-a56d0f13e83c","duplicate":false,"initialStatus":"confirmed","durationMs":19371,"maskedEmail":"bo***b@example.com","maskedPhone":"********6371"}
[2025-11-15T12:17:23.021Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cf5c637b-cdc9-43b0-ba7b-ff00e1ae7f22","bookingId":"8524baaf-e0fb-46a7-a9da-a56d0f13e83c","reference":"5FVVKLKY7T","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:17:21.359Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5746,"attemptId":"602e2a5e-4f7a-4347-8fe9-0da682329b06","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19371,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20091,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"44d31070-1f14-4f1e-bbd7-f8ea18ca7cc7","tableId":"6fdbb063-3fc6-4647-a9b5-278e1c4e9f3d","tableNumber":"BA-06","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19298, max: 21437, avg: 20126.25, p95: 20091 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
