
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-15T12:22:59.305Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"de1a7a2e-1e83-4b90-a35c-e568cc5ffd04","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:22:59.305Z] [INFO] [submit] Submitting booking request {"correlationId":"de1a7a2e-1e83-4b90-a35c-e568cc5ffd04","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:23:19.802Z] [INFO] [submit] Booking created {"correlationId":"de1a7a2e-1e83-4b90-a35c-e568cc5ffd04","bookingId":"af6d1094-11b9-442a-8688-d09ae9da45bf","duplicate":false,"initialStatus":"pending","durationMs":20487,"maskedEmail":"bo***e@example.com","maskedPhone":"********7024"}
[2025-11-15T12:23:20.425Z] [INFO] [inline_poll] Status update {"correlationId":"de1a7a2e-1e83-4b90-a35c-e568cc5ffd04","bookingId":"af6d1094-11b9-442a-8688-d09ae9da45bf","attempt":1,"status":"pending","assignments":0,"elapsedMs":622}
[2025-11-15T12:23:29.675Z] [INFO] [inline_poll] Status update {"correlationId":"de1a7a2e-1e83-4b90-a35c-e568cc5ffd04","bookingId":"af6d1094-11b9-442a-8688-d09ae9da45bf","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9872}
[2025-11-15T12:23:29.676Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"de1a7a2e-1e83-4b90-a35c-e568cc5ffd04","bookingId":"af6d1094-11b9-442a-8688-d09ae9da45bf","reference":"YL84TVPCM9","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:17.850Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"23bf9630-6dc7-4f42-b63e-614b4bd1f244","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20487,"inlineAttempts":5,"inlineDurationMs":9872,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":30370,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"020c6a02-1a0a-4bc0-a8e6-8e2ce6687fe4","tableId":"90bec463-2f28-4954-b754-2ba072e72b1b","tableNumber":"BA-08","zoneId":"df5b5d2b-4d2a-494e-8a38-e488ab929043","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:29.677Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"17a06459-40d2-4174-b277-ae2d89253abc","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:29.677Z] [INFO] [submit] Submitting booking request {"correlationId":"17a06459-40d2-4174-b277-ae2d89253abc","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:23:49.672Z] [INFO] [submit] Booking created {"correlationId":"17a06459-40d2-4174-b277-ae2d89253abc","bookingId":"57f15b8c-3872-490e-bb40-971276d42f19","duplicate":false,"initialStatus":"confirmed","durationMs":19994,"maskedEmail":"bo***9@example.com","maskedPhone":"********6459"}
[2025-11-15T12:23:50.307Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"17a06459-40d2-4174-b277-ae2d89253abc","bookingId":"57f15b8c-3872-490e-bb40-971276d42f19","reference":"GCWNZPVDLW","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:48.398Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5351,"attemptId":"f1b2214f-bf63-4707-9d10-588ea5dd9406","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19994,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20630,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b38cd941-4b72-42c8-bf32-3a31a37e0586","tableId":"817d3c67-3f42-48af-8d56-d4a2b6c11553","tableNumber":"MD-08","zoneId":"4749aafa-6ce9-492b-9f86-337b7cf8f8fe","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:50.309Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e2f97c80-93de-4e6c-98eb-438cc08db7f4","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:50.309Z] [INFO] [submit] Submitting booking request {"correlationId":"e2f97c80-93de-4e6c-98eb-438cc08db7f4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:09.855Z] [INFO] [submit] Booking created {"correlationId":"e2f97c80-93de-4e6c-98eb-438cc08db7f4","bookingId":"6e153111-bf43-452e-b3fc-10dbd3ce80d6","duplicate":false,"initialStatus":"confirmed","durationMs":19544,"maskedEmail":"bo***0@example.com","maskedPhone":"********7280"}
[2025-11-15T12:24:10.634Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e2f97c80-93de-4e6c-98eb-438cc08db7f4","bookingId":"6e153111-bf43-452e-b3fc-10dbd3ce80d6","reference":"3S2V347NMB","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:07.293Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"1ad214e1-8af6-4e2a-a9c5-d8aeaea7327d","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19544,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20325,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-05"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"1adf483b-2b8e-40cb-943d-99ea5935cc31","tableId":"ab6de180-e9b4-4731-b7af-bedacc5b88ea","tableNumber":"OG-05","zoneId":"1a2b5ba2-d745-40c7-98c7-1ca3bd20e530","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:24:10.634Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"69f59bc7-8656-466a-8660-a35bb3cec307","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:24:10.634Z] [INFO] [submit] Submitting booking request {"correlationId":"69f59bc7-8656-466a-8660-a35bb3cec307","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:30.405Z] [INFO] [submit] Booking created {"correlationId":"69f59bc7-8656-466a-8660-a35bb3cec307","bookingId":"84a742e1-565f-405e-8701-7a4576f1139e","duplicate":false,"initialStatus":"confirmed","durationMs":19771,"maskedEmail":"bo***7@example.com","maskedPhone":"********9127"}
[2025-11-15T12:24:31.028Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"69f59bc7-8656-466a-8660-a35bb3cec307","bookingId":"84a742e1-565f-405e-8701-7a4576f1139e","reference":"4W52RF7Z4L","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:29.410Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5535,"attemptId":"3cef83c5-6825-455c-a10e-842ec1124d20","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19771,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20394,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c1bc25b9-7d9b-40cf-baf4-b62bed1561bc","tableId":"96950f14-315e-4390-ad1a-4927f6afe617","tableNumber":"PR-04","zoneId":"f0b48046-a615-4595-93eb-ebe1f6e55f75","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20325, max: 30370, avg: 22929.75, p95: 20630 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-08', 'MD-08', 'OG-05', 'PR-04' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
