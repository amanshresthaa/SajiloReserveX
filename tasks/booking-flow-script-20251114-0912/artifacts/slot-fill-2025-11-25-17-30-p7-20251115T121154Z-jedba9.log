
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-15T12:11:55.394Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"583070e8-c03a-40d7-8f37-e51865116fbb","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:11:55.394Z] [INFO] [submit] Submitting booking request {"correlationId":"583070e8-c03a-40d7-8f37-e51865116fbb","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:12:17.509Z] [INFO] [submit] Booking created {"correlationId":"583070e8-c03a-40d7-8f37-e51865116fbb","bookingId":"7d54a3ce-22c6-4cfe-afd4-419ff9cb804e","duplicate":false,"initialStatus":"confirmed","durationMs":22115,"maskedEmail":"bo***8@example.com","maskedPhone":"********7048"}
[2025-11-15T12:12:18.207Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"583070e8-c03a-40d7-8f37-e51865116fbb","bookingId":"7d54a3ce-22c6-4cfe-afd4-419ff9cb804e","reference":"F9MYAP58ZP","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:12:14.736Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12010,"attemptId":"0d3b120d-c56b-409c-8781-213525a070e4","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22115,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22812,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-09"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"1d9f57b2-f1fb-48a0-954b-b0bf9dc5af1a","tableId":"ac641e9b-181a-4320-906e-f53b1b74d81c","tableNumber":"MD-09","zoneId":"406a6e8e-1e53-4b0b-8a07-abdd953d29fb","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:12:18.207Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8e783498-6b67-4655-9b28-f64e3a15d29a","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:12:18.208Z] [INFO] [submit] Submitting booking request {"correlationId":"8e783498-6b67-4655-9b28-f64e3a15d29a","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:12:38.763Z] [INFO] [submit] Booking created {"correlationId":"8e783498-6b67-4655-9b28-f64e3a15d29a","bookingId":"8e0936e6-fc90-4b72-8fd0-764319dc3473","duplicate":false,"initialStatus":"confirmed","durationMs":20554,"maskedEmail":"bo***8@example.com","maskedPhone":"********3498"}
[2025-11-15T12:12:39.463Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8e783498-6b67-4655-9b28-f64e3a15d29a","bookingId":"8e0936e6-fc90-4b72-8fd0-764319dc3473","reference":"8LDAUP9QLT","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:12:37.924Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5825,"attemptId":"85d1fedf-0488-4245-b33f-83dde95d9540","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20554,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21256,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-10"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"29ebc457-954b-4dc7-bb90-2afd549491ea","tableId":"1d22a6be-62e8-47ac-aadd-74f00cf23912","tableNumber":"MD-10","zoneId":"406a6e8e-1e53-4b0b-8a07-abdd953d29fb","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:12:39.464Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"955ac264-7e0d-4115-aec8-cc637bb47621","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:12:39.464Z] [INFO] [submit] Submitting booking request {"correlationId":"955ac264-7e0d-4115-aec8-cc637bb47621","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:12:59.683Z] [INFO] [submit] Booking created {"correlationId":"955ac264-7e0d-4115-aec8-cc637bb47621","bookingId":"2ce45359-2546-4827-98f4-c19e92c340b8","duplicate":false,"initialStatus":"confirmed","durationMs":20218,"maskedEmail":"bo***4@example.com","maskedPhone":"********2264"}
[2025-11-15T12:13:00.315Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"955ac264-7e0d-4115-aec8-cc637bb47621","bookingId":"2ce45359-2546-4827-98f4-c19e92c340b8","reference":"2QPGDWPUWD","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:12:57.084Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"32e20bc9-6780-4e01-874a-772bc8993ad0","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20218,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20851,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"578cf70b-23b3-4505-992a-a2f0beb41c31","tableId":"1fde9a56-d430-4d8f-9bd5-c92086873229","tableNumber":"OG-06","zoneId":"7bd99bc9-d325-417a-b117-fc8d208999bd","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:13:00.316Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4c3d56ea-b8ec-4e18-af00-99b595557acd","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:13:00.316Z] [INFO] [submit] Submitting booking request {"correlationId":"4c3d56ea-b8ec-4e18-af00-99b595557acd","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:13:19.344Z] [INFO] [submit] Booking created {"correlationId":"4c3d56ea-b8ec-4e18-af00-99b595557acd","bookingId":"ec42a5ab-4ad5-49b4-8001-446cf20540b9","duplicate":false,"initialStatus":"confirmed","durationMs":19027,"maskedEmail":"bo***a@example.com","maskedPhone":"********5640"}
[2025-11-15T12:13:19.974Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4c3d56ea-b8ec-4e18-af00-99b595557acd","bookingId":"ec42a5ab-4ad5-49b4-8001-446cf20540b9","reference":"M5K6FVMY8M","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:13:18.318Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5447,"attemptId":"1d1d37d4-9d95-4642-964f-5a0c3632b15a","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19027,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19658,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-07"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"da3702e3-0142-4368-bd35-530aaa8cff29","tableId":"10dc8982-66fc-459c-8b0c-fc02d4dcfc4f","tableNumber":"PT-07","zoneId":"450e0e17-f080-40ea-a832-d05c23e1cc44","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19658, max: 22812, avg: 21144.25, p95: 21256 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
✅ Stress run completed 4 booking(s) without failure.
