
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  enable debug logging with { debug: true }
[2025-11-15T12:27:39.855Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"16a17a3e-f82a-4e18-823c-99a44599d862","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:27:39.855Z] [INFO] [submit] Submitting booking request {"correlationId":"16a17a3e-f82a-4e18-823c-99a44599d862","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:28:01.396Z] [INFO] [submit] Booking created {"correlationId":"16a17a3e-f82a-4e18-823c-99a44599d862","bookingId":"31f55df9-58ef-40b7-9bd6-5933211b7efd","duplicate":false,"initialStatus":"confirmed","durationMs":21540,"maskedEmail":"bo***e@example.com","maskedPhone":"********7034"}
[2025-11-15T12:28:02.031Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"16a17a3e-f82a-4e18-823c-99a44599d862","bookingId":"31f55df9-58ef-40b7-9bd6-5933211b7efd","reference":"8WRJHK355Q","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:27:58.820Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12000,"attemptId":"c5acfa6d-2ccb-4208-94e8-59067f235638","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21540,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22175,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-09"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e4a37d1f-5a41-4e8f-a548-e3b4644ab4fa","tableId":"df31eae2-3159-4194-a843-d9bb9b56121a","tableNumber":"MD-09","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:02.031Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5e673fb3-f7a8-4964-82b7-3fe5257c7756","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:02.031Z] [INFO] [submit] Submitting booking request {"correlationId":"5e673fb3-f7a8-4964-82b7-3fe5257c7756","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:22.400Z] [INFO] [submit] Booking created {"correlationId":"5e673fb3-f7a8-4964-82b7-3fe5257c7756","bookingId":"8126d44a-3cb4-4fbe-9111-d71efe1d2264","duplicate":false,"initialStatus":"confirmed","durationMs":20368,"maskedEmail":"bo***3@example.com","maskedPhone":"********3513"}
[2025-11-15T12:28:23.027Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5e673fb3-f7a8-4964-82b7-3fe5257c7756","bookingId":"8126d44a-3cb4-4fbe-9111-d71efe1d2264","reference":"2GKZTHQ8PB","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:19.859Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"149b1942-3bb3-4296-8ee2-110985089813","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20368,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20996,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-10"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b447a71b-3152-4e8a-8490-fc6d0d44eb82","tableId":"d1f34cf1-07da-4171-84f7-71b4490a7276","tableNumber":"MD-10","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:23.029Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bc1e3235-a2d7-4076-b42b-392b5650cd74","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:23.029Z] [INFO] [submit] Submitting booking request {"correlationId":"bc1e3235-a2d7-4076-b42b-392b5650cd74","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:42.123Z] [INFO] [submit] Booking created {"correlationId":"bc1e3235-a2d7-4076-b42b-392b5650cd74","bookingId":"0a5ba96c-aade-4abc-896d-e0681593f0d1","duplicate":false,"initialStatus":"confirmed","durationMs":19093,"maskedEmail":"bo***5@example.com","maskedPhone":"********3235"}
[2025-11-15T12:28:42.879Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bc1e3235-a2d7-4076-b42b-392b5650cd74","bookingId":"0a5ba96c-aade-4abc-896d-e0681593f0d1","reference":"74AVSYZKAF","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:40.870Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5217,"attemptId":"51b90bca-3e69-4bac-ac96-2660dee14054","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19093,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19850,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["OG-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dbad2eee-3338-4c6a-a3b8-34ed6d2adfe4","tableId":"4545d5f6-817b-468c-8e32-264c9fdd9213","tableNumber":"OG-06","zoneId":"78d96564-d655-417c-b003-6290bde72dcd","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:42.880Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f1202770-4a51-4309-af08-42701e9aa7f9","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:42.880Z] [INFO] [submit] Submitting booking request {"correlationId":"f1202770-4a51-4309-af08-42701e9aa7f9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:29:01.553Z] [INFO] [submit] Booking created {"correlationId":"f1202770-4a51-4309-af08-42701e9aa7f9","bookingId":"0d8e19ea-1bd9-4dca-a817-06436a1b59ee","duplicate":false,"initialStatus":"confirmed","durationMs":18673,"maskedEmail":"bo***0@example.com","maskedPhone":"********2770"}
[2025-11-15T12:29:02.191Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f1202770-4a51-4309-af08-42701e9aa7f9","bookingId":"0d8e19ea-1bd9-4dca-a817-06436a1b59ee","reference":"2BHX36NE6F","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:29:00.738Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5423,"attemptId":"1a82ca64-4703-4098-b25a-3fa51d526c68","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18673,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19311,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-07"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6dd82c20-e934-40d2-a208-36b33ed6946d","tableId":"092429df-9dd0-42e7-8c32-5eb8f84bd418","tableNumber":"PT-07","zoneId":"fe22b647-d1f0-441e-8fc2-74203309cd6b","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19311, max: 22175, avg: 20583, p95: 20996 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
✅ Stress run completed 4 booking(s) without failure.
