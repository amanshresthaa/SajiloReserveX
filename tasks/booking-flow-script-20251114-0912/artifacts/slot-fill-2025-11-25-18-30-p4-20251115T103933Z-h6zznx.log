
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2025-11-15T10:39:34.543Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"99b3d659-79e4-49af-aeb0-ef132ceb1373","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:34.543Z] [INFO] [submit] Submitting booking request {"correlationId":"99b3d659-79e4-49af-aeb0-ef132ceb1373","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:39:54.167Z] [INFO] [submit] Booking created {"correlationId":"99b3d659-79e4-49af-aeb0-ef132ceb1373","bookingId":"5dd173ae-6b79-470b-8a96-2e3b81da2bf9","duplicate":false,"initialStatus":"confirmed","durationMs":19622,"maskedEmail":"bo***9@example.com","maskedPhone":"********3659"}
[2025-11-15T10:39:55.130Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"99b3d659-79e4-49af-aeb0-ef132ceb1373","bookingId":"5dd173ae-6b79-470b-8a96-2e3b81da2bf9","reference":"XBSEK2S7X7","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:53.494Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5563,"attemptId":"136c98da-06c6-4bff-a828-fcfc9e4e07ca","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19622,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20587,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["OG-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"cbdf2c1a-9e85-40d4-b256-24623b7200aa","tableId":"4245979f-23de-4dd5-9d8a-7c25c692af92","tableNumber":"OG-02","zoneId":"a0054ae3-ce64-4899-b8f2-acbf470266f4","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:55.131Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ee44e17a-f074-4bb2-bd3e-5556f2b26279","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:55.131Z] [INFO] [submit] Submitting booking request {"correlationId":"ee44e17a-f074-4bb2-bd3e-5556f2b26279","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:40:13.929Z] [INFO] [submit] Booking created {"correlationId":"ee44e17a-f074-4bb2-bd3e-5556f2b26279","bookingId":"880a29e4-d0c0-4d06-b71b-ce00645142c8","duplicate":false,"initialStatus":"confirmed","durationMs":18797,"maskedEmail":"bo***a@example.com","maskedPhone":"********4170"}
[2025-11-15T10:40:14.639Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ee44e17a-f074-4bb2-bd3e-5556f2b26279","bookingId":"880a29e4-d0c0-4d06-b71b-ce00645142c8","reference":"J74WLHNDM2","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:40:13.096Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5403,"attemptId":"8c79d996-4230-4d81-a893-eb22df6e58e9","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18797,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19508,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["OG-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6e44b61b-f09c-4497-9a99-e2c1cd73a07d","tableId":"1dc3b79f-72dd-4ccf-a956-ebf52f42716c","tableNumber":"OG-03","zoneId":"a0054ae3-ce64-4899-b8f2-acbf470266f4","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:40:14.641Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"78fcb697-1e70-4409-ac7d-b3aaec1e3a9e","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:40:14.642Z] [INFO] [submit] Submitting booking request {"correlationId":"78fcb697-1e70-4409-ac7d-b3aaec1e3a9e","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:40:35.128Z] [INFO] [submit] Booking created {"correlationId":"78fcb697-1e70-4409-ac7d-b3aaec1e3a9e","bookingId":"c7531dee-4a76-40d7-a05a-addcf4de17a3","duplicate":false,"initialStatus":"confirmed","durationMs":20485,"maskedEmail":"bo***7@example.com","maskedPhone":"********1697"}
[2025-11-15T10:40:35.957Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"78fcb697-1e70-4409-ac7d-b3aaec1e3a9e","bookingId":"c7531dee-4a76-40d7-a05a-addcf4de17a3","reference":"PDMS5WR4U4","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:40:32.119Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"59b0ed95-5ba0-4373-9564-9bd52d530013","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20485,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21316,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-01"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d3dc827a-a47a-4c49-b31b-28045fb789b2","tableId":"c4215e5d-ad39-4af6-a61a-954ae0c350ab","tableNumber":"PR-01","zoneId":"de50aeec-4ee8-48fc-b651-dc21e4273faa","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:40:35.958Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"27070abb-0d7e-40f4-8707-99021bc1f15c","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:40:35.958Z] [INFO] [submit] Submitting booking request {"correlationId":"27070abb-0d7e-40f4-8707-99021bc1f15c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:40:55.773Z] [INFO] [submit] Booking created {"correlationId":"27070abb-0d7e-40f4-8707-99021bc1f15c","bookingId":"46126c16-2e5f-4667-9149-71fd7a5bb5e9","duplicate":false,"initialStatus":"confirmed","durationMs":19815,"maskedEmail":"bo***b@example.com","maskedPhone":"********0011"}
[2025-11-15T10:40:56.426Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"27070abb-0d7e-40f4-8707-99021bc1f15c","bookingId":"46126c16-2e5f-4667-9149-71fd7a5bb5e9","reference":"EU47HBA7UA","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:40:53.181Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"13a41c79-f077-4a47-a5d7-dd3ad8a08f98","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19815,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20468,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0b24c6cf-59be-4887-9e7e-12e3e05ac161","tableId":"f4df7b28-e5f6-466a-8256-7019c71bc668","tableNumber":"PR-02","zoneId":"de50aeec-4ee8-48fc-b651-dc21e4273faa","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19508, max: 21316, avg: 20469.75, p95: 20587 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-02', 'OG-03', 'PR-01', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
