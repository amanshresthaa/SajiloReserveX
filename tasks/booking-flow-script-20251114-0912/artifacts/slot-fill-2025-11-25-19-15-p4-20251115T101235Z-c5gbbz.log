
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 19\:15 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar
[2025-11-15T10:12:35.971Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"93b39989-ec3f-4be7-bf07-fad48bb564ea","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:12:35.971Z] [INFO] [submit] Submitting booking request {"correlationId":"93b39989-ec3f-4be7-bf07-fad48bb564ea","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:12:56.014Z] [INFO] [submit] Booking created {"correlationId":"93b39989-ec3f-4be7-bf07-fad48bb564ea","bookingId":"518e259d-035c-45b0-bea7-d58b558b2df8","duplicate":false,"initialStatus":"confirmed","durationMs":20041,"maskedEmail":"bo***9@example.com","maskedPhone":"********9989"}
[2025-11-15T10:12:56.739Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"93b39989-ec3f-4be7-bf07-fad48bb564ea","bookingId":"518e259d-035c-45b0-bea7-d58b558b2df8","reference":"ZN8AUDWHNR","bookingDate":"2025-11-25","startTime":"19:15:00","endTime":"21:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:12:55.298Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5847,"attemptId":"c26656c9-8a64-45e5-8f27-2e4dce9c4147","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20041,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20768,"tablesAssigned":1,"totalCapacity":6,"seatWaste":2,"tableNumbers":["PR-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"11784d54-0ca9-4ab6-9e44-d4bf003e2ce4","tableId":"ca5b5bfc-e2fb-4b10-8413-d9a98d82b70e","tableNumber":"PR-03","zoneId":"80e6af37-31b6-4412-a4de-c26cd7b9bc5a","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:12:56.739Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"df96e3db-e792-4066-b564-ad929f778dcb","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:12:56.739Z] [INFO] [submit] Submitting booking request {"correlationId":"df96e3db-e792-4066-b564-ad929f778dcb","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:13:15.854Z] [INFO] [submit] Booking created {"correlationId":"df96e3db-e792-4066-b564-ad929f778dcb","bookingId":"fc60770f-0804-47dd-93d8-22d280348564","duplicate":false,"initialStatus":"confirmed","durationMs":19114,"maskedEmail":"bo***b@example.com","maskedPhone":"********4331"}
[2025-11-15T10:13:16.475Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"df96e3db-e792-4066-b564-ad929f778dcb","bookingId":"fc60770f-0804-47dd-93d8-22d280348564","reference":"X7UBKWZKLK","bookingDate":"2025-11-25","startTime":"19:15:00","endTime":"21:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:13:15.200Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5567,"attemptId":"df82ef89-4cc5-4951-a6fc-d4ebce243069","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19114,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19736,"tablesAssigned":1,"totalCapacity":6,"seatWaste":2,"tableNumbers":["PR-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"83a4b57f-bab1-4680-a993-eb31f07a5faf","tableId":"e8966229-4529-4125-9d9f-da67472f7eb6","tableNumber":"PR-04","zoneId":"80e6af37-31b6-4412-a4de-c26cd7b9bc5a","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:13:16.476Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f654ebc9-bea4-40db-a239-e7400bf9e6cd","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:13:16.476Z] [INFO] [submit] Submitting booking request {"correlationId":"f654ebc9-bea4-40db-a239-e7400bf9e6cd","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:13:35.582Z] [INFO] [submit] Booking created {"correlationId":"f654ebc9-bea4-40db-a239-e7400bf9e6cd","bookingId":"9cbeef27-e9c0-4fd2-b64b-5a44201ca77e","duplicate":false,"initialStatus":"confirmed","durationMs":19106,"maskedEmail":"bo***9@example.com","maskedPhone":"********4129"}
[2025-11-15T10:13:36.207Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f654ebc9-bea4-40db-a239-e7400bf9e6cd","bookingId":"9cbeef27-e9c0-4fd2-b64b-5a44201ca77e","reference":"MHR2J3WE6A","bookingDate":"2025-11-25","startTime":"19:15:00","endTime":"21:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:13:33.298Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"f8b09e38-f8f0-455d-a3ec-5338ea002a3c","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19106,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19731,"tablesAssigned":1,"totalCapacity":6,"seatWaste":2,"tableNumbers":["PT-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"cc2e76c4-afb7-4bef-a4c4-9c21bebec1de","tableId":"b5168b7c-7df9-4242-822c-ccc90becec10","tableNumber":"PT-05","zoneId":"bc275831-348d-4c25-9f89-4587d08bf684","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:13:36.207Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a6d12a1b-5bba-4ecb-b423-b9f994bba634","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:13:36.207Z] [INFO] [submit] Submitting booking request {"correlationId":"a6d12a1b-5bba-4ecb-b423-b9f994bba634","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:13:55.179Z] [INFO] [submit] Booking created {"correlationId":"a6d12a1b-5bba-4ecb-b423-b9f994bba634","bookingId":"3afc4828-b9b3-4cdb-bac4-7878c26e0364","duplicate":false,"initialStatus":"confirmed","durationMs":18972,"maskedEmail":"bo***b@example.com","maskedPhone":"********2011"}
[2025-11-15T10:13:55.831Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a6d12a1b-5bba-4ecb-b423-b9f994bba634","bookingId":"3afc4828-b9b3-4cdb-bac4-7878c26e0364","reference":"4TTA53ASL6","bookingDate":"2025-11-25","startTime":"19:15:00","endTime":"21:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:13:54.403Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5477,"attemptId":"4a29f53e-0b95-4bdf-b376-b24b507c7533","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18972,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19624,"tablesAssigned":1,"totalCapacity":6,"seatWaste":2,"tableNumbers":["PT-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"db5a05a9-6f9e-4216-8b4f-e621480b10dd","tableId":"b43312dd-09af-471f-bc97-ae49be4d2ee7","tableNumber":"PT-06","zoneId":"bc275831-348d-4c25-9f89-4587d08bf684","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19624, max: 20768, avg: 19964.75, p95: 19736 },
  seatWaste: { count: 4, min: 2, max: 2, avg: 2, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'PR-03', 'PR-04', 'PT-05', 'PT-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
