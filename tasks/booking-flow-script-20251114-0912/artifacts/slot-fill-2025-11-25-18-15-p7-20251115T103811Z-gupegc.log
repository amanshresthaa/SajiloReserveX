
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2025-11-15T10:38:12.095Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4a7aef37-74b0-4af0-bd8a-19e7d69f42b0","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:12.095Z] [INFO] [submit] Submitting booking request {"correlationId":"4a7aef37-74b0-4af0-bd8a-19e7d69f42b0","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:38:33.581Z] [INFO] [submit] Booking created {"correlationId":"4a7aef37-74b0-4af0-bd8a-19e7d69f42b0","bookingId":"4c7c45cf-0abb-4f49-adf9-6cd3aa4cd4f2","duplicate":false,"initialStatus":"pending","durationMs":21485,"maskedEmail":"bo***7@example.com","maskedPhone":"********4537"}
[2025-11-15T10:38:34.245Z] [INFO] [inline_poll] Status update {"correlationId":"4a7aef37-74b0-4af0-bd8a-19e7d69f42b0","bookingId":"4c7c45cf-0abb-4f49-adf9-6cd3aa4cd4f2","attempt":1,"status":"pending","assignments":0,"elapsedMs":663}
[2025-11-15T10:38:43.512Z] [INFO] [inline_poll] Status update {"correlationId":"4a7aef37-74b0-4af0-bd8a-19e7d69f42b0","bookingId":"4c7c45cf-0abb-4f49-adf9-6cd3aa4cd4f2","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9930}
[2025-11-15T10:38:43.513Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"4a7aef37-74b0-4af0-bd8a-19e7d69f42b0","bookingId":"4c7c45cf-0abb-4f49-adf9-6cd3aa4cd4f2","reference":"E89XZNX7WP","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:38:30.653Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"105d2617-66e4-4b53-aa10-a8b2665b5de3","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21485,"inlineAttempts":5,"inlineDurationMs":9930,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":31417,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-10"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"8ce90593-7b80-4806-aea5-8f4a6081f731","tableId":"f617e4a0-0cf7-45cb-999b-2630d1e564ca","tableNumber":"MD-10","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:38:43.514Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8ba0f1f8-9c25-4277-bcef-3818c0fab9b7","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:43.514Z] [INFO] [submit] Submitting booking request {"correlationId":"8ba0f1f8-9c25-4277-bcef-3818c0fab9b7","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:02.729Z] [INFO] [submit] Booking created {"correlationId":"8ba0f1f8-9c25-4277-bcef-3818c0fab9b7","bookingId":"ee664c73-581d-4618-b47f-e0b39649df67","duplicate":false,"initialStatus":"confirmed","durationMs":19215,"maskedEmail":"bo***8@example.com","maskedPhone":"********5158"}
[2025-11-15T10:39:03.366Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8ba0f1f8-9c25-4277-bcef-3818c0fab9b7","bookingId":"ee664c73-581d-4618-b47f-e0b39649df67","reference":"6WKU8LVRCU","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:01.112Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5152,"attemptId":"74419cc7-9fd6-4993-b066-73fdc9243a18","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19215,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19852,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-07"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"04aab6e5-b606-41f4-addd-84c301be7b77","tableId":"3dad5e93-1368-494a-92c6-7c8d80c60718","tableNumber":"PT-07","zoneId":"76587174-fe9d-4a91-ba00-1f3eef97930c","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:03.368Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ba2c4e75-5117-4aeb-8d53-168d9b33de78","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:03.368Z] [INFO] [submit] Submitting booking request {"correlationId":"ba2c4e75-5117-4aeb-8d53-168d9b33de78","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:22.471Z] [INFO] [submit] Booking created {"correlationId":"ba2c4e75-5117-4aeb-8d53-168d9b33de78","bookingId":"792a3815-abbe-4a6e-8860-dae18b63c7c6","duplicate":false,"initialStatus":"confirmed","durationMs":19102,"maskedEmail":"bo***5@example.com","maskedPhone":"********4475"}
[2025-11-15T10:39:23.107Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ba2c4e75-5117-4aeb-8d53-168d9b33de78","bookingId":"792a3815-abbe-4a6e-8860-dae18b63c7c6","reference":"MPEFN25NDG","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:20.156Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"4549164b-8f5a-4fa4-9c18-f943ece86fb3","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19102,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19739,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-11"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d7d0b932-2af1-4e9b-b030-c3fed60a53e9","tableId":"558754ba-86b0-4f2f-956c-5ee581a0b58b","tableNumber":"MD-11","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:23.108Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"38e8e765-a4aa-4581-9121-6eaa39613558","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:23.108Z] [INFO] [submit] Submitting booking request {"correlationId":"38e8e765-a4aa-4581-9121-6eaa39613558","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:42.595Z] [INFO] [submit] Booking created {"correlationId":"38e8e765-a4aa-4581-9121-6eaa39613558","bookingId":"e39b6cfc-89e7-4c2c-b207-3f7748db4af3","duplicate":false,"initialStatus":"confirmed","durationMs":19486,"maskedEmail":"bo***5@example.com","maskedPhone":"********4765"}
[2025-11-15T10:39:43.300Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"38e8e765-a4aa-4581-9121-6eaa39613558","bookingId":"e39b6cfc-89e7-4c2c-b207-3f7748db4af3","reference":"3CRFVUBR6T","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:40.245Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"bc2b7c66-8567-48b0-8582-c08c53f41747","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19486,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20192,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["PR-05"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b22d4e59-33ab-4f23-9efd-79dc4f8619b9","tableId":"88686edd-efe3-4928-8c1e-1597ec8dc8cd","tableNumber":"PR-05","zoneId":"de50aeec-4ee8-48fc-b651-dc21e4273faa","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19739, max: 31417, avg: 22800, p95: 20192 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-10', 'MD-11', 'PR-05', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
