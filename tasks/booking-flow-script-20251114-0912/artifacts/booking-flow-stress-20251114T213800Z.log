> pnpm booking:flow --restaurant-slug white-horse-pub-waterbeach --date 2026-07-05 --time 12:00 --stress --stress-max 40 --pretty --timeout-ms 180000 --base-url http://localhost:3000

> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2026-07-05 --time 12\:00 --stress --stress-max 40 --pretty --timeout-ms 180000 --base-url http\://localhost\:3000

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-14T21:38:00.993Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a98546f3-b752-4e11-b7ba-a4c7abfe8245","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:38:00.993Z] [INFO] [submit] Submitting booking request {"correlationId":"a98546f3-b752-4e11-b7ba-a4c7abfe8245","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-14T21:38:22.473Z] [INFO] [submit] Booking created {"correlationId":"a98546f3-b752-4e11-b7ba-a4c7abfe8245","bookingId":"1fbe53f7-37b8-4329-8233-a588a4b88d33","duplicate":false,"initialStatus":"confirmed","durationMs":21479,"maskedEmail":"bo***3@example.com","maskedPhone":"********4653"}
[2025-11-14T21:38:23.204Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a98546f3-b752-4e11-b7ba-a4c7abfe8245","bookingId":"1fbe53f7-37b8-4329-8233-a588a4b88d33","reference":"VA5BWN0S6T","bookingDate":"2026-07-05","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:38:19.767Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"3e029aec-39cc-4ada-89fe-7c2e6221926e","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21479,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22211,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["D7"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d66f9d74-0d44-4859-a645-f7f12c36acb7","tableId":"30dd773b-7f2d-415a-b33c-5135ab0e9abe","tableNumber":"D7","zoneId":"ed027aa1-c042-47dd-bcc0-4d1c1c9a7ef3","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-14T21:38:23.205Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a75619b2-33f3-4507-8de7-aeb67d24dbbc","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:38:23.205Z] [INFO] [submit] Submitting booking request {"correlationId":"a75619b2-33f3-4507-8de7-aeb67d24dbbc","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-14T21:38:42.796Z] [INFO] [submit] Booking created {"correlationId":"a75619b2-33f3-4507-8de7-aeb67d24dbbc","bookingId":"afda7dcb-f226-4fe6-80ca-d90a159f5917","duplicate":false,"initialStatus":"confirmed","durationMs":19590,"maskedEmail":"bo***2@example.com","maskedPhone":"********1912"}
[2025-11-14T21:38:43.442Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a75619b2-33f3-4507-8de7-aeb67d24dbbc","bookingId":"afda7dcb-f226-4fe6-80ca-d90a159f5917","reference":"EMTCEF0NEJ","bookingDate":"2026-07-05","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:38:42.004Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5591,"attemptId":"2e8c00aa-a447-4b4f-af03-07167652e4b5","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19590,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20237,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["D8"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"48d3397c-1a0c-4f20-9c67-49378b05b55f","tableId":"15f42ef5-29ac-4fb9-a36d-28d68c53b5e4","tableNumber":"D8","zoneId":"ed027aa1-c042-47dd-bcc0-4d1c1c9a7ef3","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-14T21:38:43.444Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b58d5505-cb53-4cd3-8712-dbb6f17b98c3","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:38:43.444Z] [INFO] [submit] Submitting booking request {"correlationId":"b58d5505-cb53-4cd3-8712-dbb6f17b98c3","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-14T21:39:03.400Z] [INFO] [submit] Booking created {"correlationId":"b58d5505-cb53-4cd3-8712-dbb6f17b98c3","bookingId":"7ebf6854-181e-405a-b7f6-becb7ef9ad69","duplicate":false,"initialStatus":"confirmed","durationMs":19955,"maskedEmail":"bo***5@example.com","maskedPhone":"********5505"}
[2025-11-14T21:39:04.096Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b58d5505-cb53-4cd3-8712-dbb6f17b98c3","bookingId":"7ebf6854-181e-405a-b7f6-becb7ef9ad69","reference":"7S8EGZ9NI6","bookingDate":"2026-07-05","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:39:00.766Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"4cbda443-1c1b-4064-96e6-77c361318eb8","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19955,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20652,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["G1"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"cbc89bc4-8697-4695-9017-b12495a0c272","tableId":"1f18114f-6799-4ce6-b910-9f5e293a7653","tableNumber":"G1","zoneId":"415ea270-3f38-4ebf-902d-28cff994e534","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-14T21:39:04.097Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"81f1068f-3c19-4928-a7f5-77394c7bb3fa","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:39:04.097Z] [INFO] [submit] Submitting booking request {"correlationId":"81f1068f-3c19-4928-a7f5-77394c7bb3fa","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-14T21:39:24.251Z] [INFO] [submit] Booking created {"correlationId":"81f1068f-3c19-4928-a7f5-77394c7bb3fa","bookingId":"286312df-7921-43d9-98c6-149ef55f34d0","duplicate":false,"initialStatus":"confirmed","durationMs":20154,"maskedEmail":"bo***f@example.com","maskedPhone":"********0685"}
[2025-11-14T21:39:24.909Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"81f1068f-3c19-4928-a7f5-77394c7bb3fa","bookingId":"286312df-7921-43d9-98c6-149ef55f34d0","reference":"0NFXNQWH0K","bookingDate":"2026-07-05","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:39:23.312Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5608,"attemptId":"e884d46a-e51b-4a77-811e-eb299445661c","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20154,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20812,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["G2"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7938e4db-09f1-4bfa-9cbe-5442dcd7e2e5","tableId":"ab9d0786-5349-4998-98e1-b2dc03d066be","tableNumber":"G2","zoneId":"415ea270-3f38-4ebf-902d-28cff994e534","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-14T21:39:24.910Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3049f6ff-84e8-4d2d-a37f-2a9bed5626f5","bookingId":null,"iteration":5,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:39:24.910Z] [INFO] [submit] Submitting booking request {"correlationId":"3049f6ff-84e8-4d2d-a37f-2a9bed5626f5","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-14T21:39:46.167Z] [INFO] [submit] Booking created {"correlationId":"3049f6ff-84e8-4d2d-a37f-2a9bed5626f5","bookingId":"a3d8885a-2dc3-4f41-a7c8-60ffb06ba26b","duplicate":false,"initialStatus":"confirmed","durationMs":21257,"maskedEmail":"bo***f@example.com","maskedPhone":"********5655"}
[2025-11-14T21:39:46.840Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3049f6ff-84e8-4d2d-a37f-2a9bed5626f5","bookingId":"a3d8885a-2dc3-4f41-a7c8-60ffb06ba26b","reference":"V69I1JXCQC","bookingDate":"2026-07-05","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:39:42.800Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"19de0a76-1631-4915-bf94-93cb5c9444b7","emailSent":false,"emailVariant":"standard"},"iteration":5,"submitDurationMs":21257,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21930,"tablesAssigned":1,"totalCapacity":4,"seatWaste":2,"tableNumbers":["G3"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9b9b5450-315f-45fd-a673-b54b371963ab","tableId":"3566cbad-bc7b-48c1-9068-1fb84bc47466","tableNumber":"G3","zoneId":"415ea270-3f38-4ebf-902d-28cff994e534","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-14T21:39:46.840Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2c33ec18-40bf-4142-b268-7300c489d6d1","bookingId":null,"iteration":6,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:39:46.841Z] [INFO] [submit] Submitting booking request {"correlationId":"2c33ec18-40bf-4142-b268-7300c489d6d1","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-14T21:40:06.817Z] [INFO] [submit] Booking created {"correlationId":"2c33ec18-40bf-4142-b268-7300c489d6d1","bookingId":"7264cdfc-b663-49dc-814b-d2bf9c877e6e","duplicate":false,"initialStatus":"confirmed","durationMs":19977,"maskedEmail":"bo***8@example.com","maskedPhone":"********4218"}
[2025-11-14T21:40:07.467Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2c33ec18-40bf-4142-b268-7300c489d6d1","bookingId":"7264cdfc-b663-49dc-814b-d2bf9c877e6e","reference":"9FJJDJKU7A","bookingDate":"2026-07-05","startTime":"12:00:00","endTime":"13:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:40:05.900Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5854,"attemptId":"fda9aab5-5d80-4b77-8db9-500b8ba06012","emailSent":true,"emailVariant":"standard"},"iteration":6,"submitDurationMs":19977,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20627,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["D4"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"669c9be8-5329-4ff4-979a-39fd38ae5a62","tableId":"330db220-1017-4868-8df5-283119bebe86","tableNumber":"D4","zoneId":"ed027aa1-c042-47dd-bcc0-4d1c1c9a7ef3","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-14T21:40:07.467Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":null,"iteration":7,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-14T21:40:07.467Z] [INFO] [submit] Submitting booking request {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":null,"url":"http://localhost:3000/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2026-07-05","time":"12:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-14T21:40:19.757Z] [INFO] [submit] Booking created {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","duplicate":false,"initialStatus":"pending","durationMs":12289,"maskedEmail":"bo***5@example.com","maskedPhone":"********0185"}
[2025-11-14T21:40:20.410Z] [INFO] [inline_poll] Status update {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","attempt":1,"status":"pending","assignments":0,"elapsedMs":653}
[2025-11-14T21:40:45.859Z] [WARN] [inline_poll] Inline window expired without confirmation {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","state":"timeout","attempts":11}
[2025-11-14T21:40:45.859Z] [INFO] [background_job] Triggering autoAssignAndConfirmIfPossible {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a"}
[auto-assign][job] scheduled {
  bookingId: '4174f9b9-e40b-4505-ba14-4451bb62134a',
  reason: 'creation',
  emailVariant: 'standard',
  bypass: true
}
[auto-assign][job] attempts.reduced.inline_no_capacity {
  bookingId: '4174f9b9-e40b-4505-ba14-4451bb62134a',
  inlineAttemptId: '30f547a5-22b4-4ad7-ad62-ef73b913eba6',
  inlineReason: 'No tables available for requested window'
}
[auto-assign][job] attempt.start {
  bookingId: '4174f9b9-e40b-4505-ba14-4451bb62134a',
  attempt: 0,
  maxAttempts: 1
}
[auto-assign][job] attempt.no_hold {
  bookingId: '4174f9b9-e40b-4505-ba14-4451bb62134a',
  attempt: 0,
  reason: 'No tables available for requested window',
  alternates: 0
}
[auto-assign][job] exhausted {
  bookingId: '4174f9b9-e40b-4505-ba14-4451bb62134a',
  attempts: 1,
  maxAttempts: 1
}
[2025-11-14T21:40:50.383Z] [INFO] [background_job] Background auto-assign invoked {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","durationMs":4524}
[2025-11-14T21:40:50.728Z] [INFO] [post_job_poll] Status update {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","attempt":1,"status":"pending","assignments":0,"elapsedMs":345}
[2025-11-14T21:43:13.756Z] [ERROR] [diagnostics] Assignment diagnostics {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","bookingStatus":"pending","assignments":[],"partySize":2,"totalCapacity":0,"seatWaste":0,"lastAutoAssignResult":{"source":"inline","lastAttemptAt":"2025-11-14T21:40:16.043Z","success":false,"reason":"No tables available for requested window","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":1991,"attemptId":"30f547a5-22b4-4ad7-ad62-ef73b913eba6","emailSent":false,"emailVariant":"standard"},"assignmentStateHistory":[]}
[2025-11-14T21:43:13.756Z] [ERROR] [final_summary] Booking failed to confirm {"correlationId":"27640185-ac50-474f-bb6b-8abc8b1d39b5","bookingId":"4174f9b9-e40b-4505-ba14-4451bb62134a","state":"timeout","durationMs":185901}
[stress] Summary {
  totalRuns: 7,
  successes: 6,
  failures: 1,
  maxRuns: 40,
  completedTarget: false,
  durationMs: {
    count: 6,
    min: 20237,
    max: 22211,
    avg: 21078.166666666668,
    p95: 21930
  },
  seatWaste: { count: 6, min: 0, max: 2, avg: 1.6666666666666667, p95: 2 },
  tablesPerBooking: { count: 6, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'D4', 'D7', 'D8', 'G1', 'G2', 'G3' ]
}
[stress] Failure details {
  iteration: 7,
  correlationId: '27640185-ac50-474f-bb6b-8abc8b1d39b5',
  status: 'failed_background_timeout',
  failureReason: 'timeout',
  bookingId: '4174f9b9-e40b-4505-ba14-4451bb62134a'
}
‚ùå Stress run halted after 6 successes; see summary above.
‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
