
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[2025-11-15T10:34:12.031Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8eb3e11e-6925-4cb4-9646-0de3ea645493","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:34:12.031Z] [INFO] [submit] Submitting booking request {"correlationId":"8eb3e11e-6925-4cb4-9646-0de3ea645493","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:34:33.190Z] [INFO] [submit] Booking created {"correlationId":"8eb3e11e-6925-4cb4-9646-0de3ea645493","bookingId":"9640f6ed-1fa9-4729-b733-1c9eade4e83e","duplicate":false,"initialStatus":"confirmed","durationMs":21158,"maskedEmail":"bo***e@example.com","maskedPhone":"********4114"}
[2025-11-15T10:34:33.917Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8eb3e11e-6925-4cb4-9646-0de3ea645493","bookingId":"9640f6ed-1fa9-4729-b733-1c9eade4e83e","reference":"WQFQMJ3CRA","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:34:30.424Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"d6c12895-6ba4-4fb8-b89c-a061ca9e9a75","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21158,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21885,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9130d9a7-2e3f-4e28-aa50-a780d3a9040a","tableId":"b609f914-3ba9-4c8a-8e2f-3eb6611b8c4e","tableNumber":"BA-01","zoneId":"597669cb-939e-41e9-9f50-c47a6c7af3fc","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:34:33.918Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"68f3ed12-ad19-4a82-9986-1bf27f324224","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:34:33.918Z] [INFO] [submit] Submitting booking request {"correlationId":"68f3ed12-ad19-4a82-9986-1bf27f324224","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:34:53.169Z] [INFO] [submit] Booking created {"correlationId":"68f3ed12-ad19-4a82-9986-1bf27f324224","bookingId":"90fdf10b-4452-4803-8aca-54ebe36d661f","duplicate":false,"initialStatus":"confirmed","durationMs":19250,"maskedEmail":"bo***2@example.com","maskedPhone":"********4312"}
[2025-11-15T10:34:54.126Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"68f3ed12-ad19-4a82-9986-1bf27f324224","bookingId":"90fdf10b-4452-4803-8aca-54ebe36d661f","reference":"UKB4378MHW","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:34:52.592Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5440,"attemptId":"7c21438e-0d5a-4d3c-8ba1-67024ea6139e","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19250,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20208,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2f5ea9c3-31cf-45f8-a348-7a45c897cb49","tableId":"6498e7f8-135e-4489-858f-05cdbd2a6a59","tableNumber":"BA-02","zoneId":"597669cb-939e-41e9-9f50-c47a6c7af3fc","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:34:54.127Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"08e72d42-7115-4f1b-8aea-da223ae1dbf1","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:34:54.127Z] [INFO] [submit] Submitting booking request {"correlationId":"08e72d42-7115-4f1b-8aea-da223ae1dbf1","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:35:13.765Z] [INFO] [submit] Booking created {"correlationId":"08e72d42-7115-4f1b-8aea-da223ae1dbf1","bookingId":"2e4ba06d-5418-4102-b9cc-30d750af58b2","duplicate":false,"initialStatus":"confirmed","durationMs":19637,"maskedEmail":"bo***2@example.com","maskedPhone":"********2342"}
[2025-11-15T10:35:14.372Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"08e72d42-7115-4f1b-8aea-da223ae1dbf1","bookingId":"2e4ba06d-5418-4102-b9cc-30d750af58b2","reference":"W798RRNBV5","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:35:11.069Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12006,"attemptId":"5438b7ea-80b8-4e32-8e2b-13c2d4c911a6","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19637,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20245,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f6704152-097d-4f35-8984-1b5ea7dbd93b","tableId":"588e930d-d317-4b0c-9b29-94463e984c2d","tableNumber":"MD-01","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:35:14.373Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"30885744-5e2c-43e5-954d-434a6730a579","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:35:14.373Z] [INFO] [submit] Submitting booking request {"correlationId":"30885744-5e2c-43e5-954d-434a6730a579","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:35:34.138Z] [INFO] [submit] Booking created {"correlationId":"30885744-5e2c-43e5-954d-434a6730a579","bookingId":"2a13ac9b-f214-4454-86b7-3b135fa0b243","duplicate":false,"initialStatus":"confirmed","durationMs":19765,"maskedEmail":"bo***4@example.com","maskedPhone":"********5744"}
[2025-11-15T10:35:34.788Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"30885744-5e2c-43e5-954d-434a6730a579","bookingId":"2a13ac9b-f214-4454-86b7-3b135fa0b243","reference":"Y4REP3CPKJ","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:35:33.275Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5872,"attemptId":"03c89cf5-bcea-4108-afc4-7f21c730e939","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19765,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20415,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ec972ced-3b05-4035-a5ed-3bfbd7e63f8b","tableId":"68454026-63f3-4cd3-94bf-db6fec0fc10f","tableNumber":"MD-02","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20208, max: 21885, avg: 20688.25, p95: 20415 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
