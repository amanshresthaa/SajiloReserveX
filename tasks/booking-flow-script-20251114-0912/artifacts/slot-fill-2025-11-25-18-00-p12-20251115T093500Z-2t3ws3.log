
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 12 --stress --stress-max 10 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-15T09:35:01.497Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:35:01.498Z] [INFO] [submit] Submitting booking request {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":12,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T09:35:21.058Z] [INFO] [submit] Booking created {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","duplicate":false,"initialStatus":"pending","durationMs":19559,"maskedEmail":"bo***f@example.com","maskedPhone":"********8465"}
[2025-11-15T09:35:21.669Z] [INFO] [inline_poll] Status update {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","attempt":1,"status":"pending","assignments":0,"elapsedMs":611}
[2025-11-15T09:35:47.473Z] [WARN] [inline_poll] Inline window expired without confirmation {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","state":"timeout","attempts":11}
[2025-11-15T09:35:47.473Z] [INFO] [background_job] Triggering autoAssignAndConfirmIfPossible {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc"}
[auto-assign][job] scheduled {
  bookingId: 'a8576cdd-e8b4-4411-a120-b6f4e50e46cc',
  reason: 'creation',
  emailVariant: 'standard',
  bypass: true
}
[auto-assign][job] attempt.start {
  bookingId: 'a8576cdd-e8b4-4411-a120-b6f4e50e46cc',
  attempt: 0,
  maxAttempts: 1
}
[auto-assign][job] attempt.error {
  bookingId: 'a8576cdd-e8b4-4411-a120-b6f4e50e46cc',
  attempt: 0,
  error: 'Table 04bc201e-56f2-4246-9ad7-73ced4f20385 is not adjacent to the selected set'
}
[auto-assign][job] exhausted {
  bookingId: 'a8576cdd-e8b4-4411-a120-b6f4e50e46cc',
  attempts: 1,
  maxAttempts: 1
}
[2025-11-15T09:36:01.975Z] [INFO] [background_job] Background auto-assign invoked {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","durationMs":14502}
[2025-11-15T09:36:02.397Z] [INFO] [post_job_poll] Status update {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","attempt":1,"status":"pending","assignments":0,"elapsedMs":422}
[2025-11-15T09:38:17.158Z] [ERROR] [diagnostics] Assignment diagnostics {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","bookingStatus":"pending","assignments":[],"partySize":12,"totalCapacity":0,"seatWaste":0,"lastAutoAssignResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:35:19.583Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"f9af8558-3b54-4710-a8ff-830acd00d68c","emailSent":false,"emailVariant":"standard"},"assignmentStateHistory":[]}
[2025-11-15T09:38:17.158Z] [ERROR] [final_summary] Booking failed to confirm {"correlationId":"4ae4846f-eeb1-42b2-ad3c-639d6405b2f2","bookingId":"a8576cdd-e8b4-4411-a120-b6f4e50e46cc","state":"timeout","durationMs":195301}
[stress] Summary {
  totalRuns: 1,
  successes: 0,
  failures: 1,
  maxRuns: 10,
  completedTarget: false,
  durationMs: { count: 0, min: 0, max: 0, avg: 0, p95: 0 },
  seatWaste: { count: 0, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 0, min: 0, max: 0, avg: 0, p95: 0 },
  uniqueTables: []
}
[stress] Failure details {
  iteration: 1,
  correlationId: '4ae4846f-eeb1-42b2-ad3c-639d6405b2f2',
  status: 'failed_background_timeout',
  failureReason: 'timeout',
  bookingId: 'a8576cdd-e8b4-4411-a120-b6f4e50e46cc'
}
‚ùå Stress run halted after 0 successes; see summary above.
‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
