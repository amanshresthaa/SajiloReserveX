
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-15T10:38:12.095Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"af2ab233-326e-4961-b535-cab855edd374","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:12.095Z] [INFO] [submit] Submitting booking request {"correlationId":"af2ab233-326e-4961-b535-cab855edd374","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:38:34.074Z] [INFO] [submit] Booking created {"correlationId":"af2ab233-326e-4961-b535-cab855edd374","bookingId":"55db241c-cbda-4198-861c-d097cff097ff","duplicate":false,"initialStatus":"confirmed","durationMs":21978,"maskedEmail":"bo***3@example.com","maskedPhone":"********1233"}
[2025-11-15T10:38:34.714Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"af2ab233-326e-4961-b535-cab855edd374","bookingId":"55db241c-cbda-4198-861c-d097cff097ff","reference":"BFQ7RXSM4Y","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:38:31.961Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12009,"attemptId":"d2dd9667-2a1a-4965-965e-3373cc65ff49","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21978,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22619,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-09"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"06b60eec-ead8-4c38-9e58-6c40c9c0fc39","tableId":"d536b980-474c-4f0c-a00a-76376805915a","tableNumber":"MD-09","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:38:34.716Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"84b081e1-67b8-475e-9645-54b1fa5dd425","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:34.716Z] [INFO] [submit] Submitting booking request {"correlationId":"84b081e1-67b8-475e-9645-54b1fa5dd425","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:38:53.093Z] [INFO] [submit] Booking created {"correlationId":"84b081e1-67b8-475e-9645-54b1fa5dd425","bookingId":"a79d4418-e2e0-41f1-9444-3cc7c9f52e7f","duplicate":false,"initialStatus":"confirmed","durationMs":18377,"maskedEmail":"bo***1@example.com","maskedPhone":"********8141"}
[2025-11-15T10:38:53.716Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"84b081e1-67b8-475e-9645-54b1fa5dd425","bookingId":"a79d4418-e2e0-41f1-9444-3cc7c9f52e7f","reference":"NJ8JWHS7XC","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:38:51.380Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"c451108f-9aa0-4d5e-9185-eefd896a9aa6","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18377,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19000,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d7f7a294-5eee-4ceb-8cde-c0ca9793c3c4","tableId":"9cba3503-f92c-491b-8b76-d0ac0e6f77d6","tableNumber":"OG-06","zoneId":"a0054ae3-ce64-4899-b8f2-acbf470266f4","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:38:53.717Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2369bb81-04ab-447a-b7a1-0bb212b04e8d","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:53.717Z] [INFO] [submit] Submitting booking request {"correlationId":"2369bb81-04ab-447a-b7a1-0bb212b04e8d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:12.607Z] [INFO] [submit] Booking created {"correlationId":"2369bb81-04ab-447a-b7a1-0bb212b04e8d","bookingId":"eaabc5ad-2963-4d6a-8ce4-9c28047dd100","duplicate":false,"initialStatus":"confirmed","durationMs":18889,"maskedEmail":"bo***1@example.com","maskedPhone":"********1181"}
[2025-11-15T10:39:13.271Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2369bb81-04ab-447a-b7a1-0bb212b04e8d","bookingId":"eaabc5ad-2963-4d6a-8ce4-9c28047dd100","reference":"G8LBRUJ7R4","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:11.035Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5631,"attemptId":"6cec5f7c-93ce-4d07-81cb-57ef7d56b04a","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18889,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19554,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-08"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8ac21606-fe93-4766-bd0a-8f597da8995b","tableId":"0b9598bb-87d5-4e45-b0cf-588aefbd0e62","tableNumber":"PT-08","zoneId":"76587174-fe9d-4a91-ba00-1f3eef97930c","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:13.272Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"df7ace65-f439-42f6-9100-3d4c1edbbbdf","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:13.272Z] [INFO] [submit] Submitting booking request {"correlationId":"df7ace65-f439-42f6-9100-3d4c1edbbbdf","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:33.051Z] [INFO] [submit] Booking created {"correlationId":"df7ace65-f439-42f6-9100-3d4c1edbbbdf","bookingId":"c3753131-a61a-4aca-b158-31fe823c2e57","duplicate":false,"initialStatus":"confirmed","durationMs":19778,"maskedEmail":"bo***5@example.com","maskedPhone":"********2465"}
[2025-11-15T10:39:33.860Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"df7ace65-f439-42f6-9100-3d4c1edbbbdf","bookingId":"c3753131-a61a-4aca-b158-31fe823c2e57","reference":"8CJHT6CQFS","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:32.093Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5225,"attemptId":"0610db60-03ff-4fe0-b354-7d87dee40ded","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19778,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20588,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-12"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7a17028a-47df-4ccd-93f4-ac10e5775c36","tableId":"9a37cae1-ac7f-4bfc-8fd2-e46a24bb880b","tableNumber":"MD-12","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19000, max: 22619, avg: 20440.25, p95: 20588 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 1.5, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-12', 'OG-06', 'PT-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
