
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 6 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[2025-11-15T10:42:03.642Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a2bf656a-b811-4187-a019-237fc14805f3","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:03.642Z] [INFO] [submit] Submitting booking request {"correlationId":"a2bf656a-b811-4187-a019-237fc14805f3","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:42:26.153Z] [INFO] [submit] Booking created {"correlationId":"a2bf656a-b811-4187-a019-237fc14805f3","bookingId":"3604af4a-1e79-44cf-b7f7-9519f37e890d","duplicate":false,"initialStatus":"confirmed","durationMs":22510,"maskedEmail":"bo***a@example.com","maskedPhone":"********6560"}
[2025-11-15T10:42:26.802Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a2bf656a-b811-4187-a019-237fc14805f3","bookingId":"3604af4a-1e79-44cf-b7f7-9519f37e890d","reference":"RVANSV66PE","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:23.792Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12020,"attemptId":"8aa2d510-b608-43df-99e0-9b809426cc37","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22510,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":23161,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9f4fc1c1-9a3e-49fe-89cf-0760b263d863","tableId":"8c65fcc7-c92b-4f40-a350-1fc75701b2d0","tableNumber":"BA-07","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:26.803Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0ba727c1-aeb4-456f-977b-4be2e30cd226","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:26.803Z] [INFO] [submit] Submitting booking request {"correlationId":"0ba727c1-aeb4-456f-977b-4be2e30cd226","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:42:45.590Z] [INFO] [submit] Booking created {"correlationId":"0ba727c1-aeb4-456f-977b-4be2e30cd226","bookingId":"df855011-1255-488f-ba1d-863efcf8256d","duplicate":false,"initialStatus":"confirmed","durationMs":18786,"maskedEmail":"bo***1@example.com","maskedPhone":"********2721"}
[2025-11-15T10:42:46.492Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0ba727c1-aeb4-456f-977b-4be2e30cd226","bookingId":"df855011-1255-488f-ba1d-863efcf8256d","reference":"HN83QLHDM7","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:43.705Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12001,"attemptId":"e08c57fe-0011-41a5-a8ee-ac662287b481","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18786,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19689,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4a506100-70c4-4d3f-99ac-9844e81dd5a1","tableId":"de11afe3-f36b-4292-a613-23182490c73b","tableNumber":"MD-07","zoneId":"dce1381c-1e68-4040-9ed5-85411d27ddf9","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:46.492Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1b99dda4-10ff-4df8-8bb0-9b7a3cfa7fb9","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:46.492Z] [INFO] [submit] Submitting booking request {"correlationId":"1b99dda4-10ff-4df8-8bb0-9b7a3cfa7fb9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:05.034Z] [INFO] [submit] Booking created {"correlationId":"1b99dda4-10ff-4df8-8bb0-9b7a3cfa7fb9","bookingId":"f3c47d53-1829-4def-a6fe-525be3b30aee","duplicate":false,"initialStatus":"confirmed","durationMs":18541,"maskedEmail":"bo***4@example.com","maskedPhone":"********3304"}
[2025-11-15T10:43:05.702Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1b99dda4-10ff-4df8-8bb0-9b7a3cfa7fb9","bookingId":"f3c47d53-1829-4def-a6fe-525be3b30aee","reference":"A5ZAVC3TPR","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:03.772Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":4948,"attemptId":"de2ba735-804f-4a2b-8d62-a89f3b763bcb","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18541,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19210,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-04"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"1551a7a3-8a82-4477-a7fd-e8d5bbab15ed","tableId":"7c2ccf01-86bb-427f-b99f-51a4eaf4394f","tableNumber":"OG-04","zoneId":"c56cf6aa-f668-4a9f-881a-70e041656051","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:43:05.702Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4c81a0a2-0c30-4574-9dea-88136854eafc","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:43:05.702Z] [INFO] [submit] Submitting booking request {"correlationId":"4c81a0a2-0c30-4574-9dea-88136854eafc","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:25.339Z] [INFO] [submit] Booking created {"correlationId":"4c81a0a2-0c30-4574-9dea-88136854eafc","bookingId":"9a179409-98f7-48d6-a8aa-904753e884fe","duplicate":false,"initialStatus":"confirmed","durationMs":19636,"maskedEmail":"bo***2@example.com","maskedPhone":"********0002"}
[2025-11-15T10:43:26.091Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4c81a0a2-0c30-4574-9dea-88136854eafc","bookingId":"9a179409-98f7-48d6-a8aa-904753e884fe","reference":"B77K9CZ6H5","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:24.315Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5360,"attemptId":"69aa7838-e4f7-4a7f-bdf4-c1b7f0e3b346","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19636,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20389,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["PR-03"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8e97a3a2-4c39-4efd-8a0a-0e62d8fa5df9","tableId":"5ba20268-7032-4618-9636-99114c0b7f45","tableNumber":"PR-03","zoneId":"15ba8e3c-544b-4536-a0a4-2978dd4606e6","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19210, max: 23161, avg: 20612.25, p95: 20389 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'MD-07', 'OG-04', 'PR-03' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
