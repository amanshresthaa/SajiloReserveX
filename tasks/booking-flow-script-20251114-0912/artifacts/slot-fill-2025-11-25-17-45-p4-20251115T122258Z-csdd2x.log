
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2025-11-15T12:22:59.304Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2f2a4e7c-45cc-4a5b-bd56-10a643e9efe6","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:22:59.305Z] [INFO] [submit] Submitting booking request {"correlationId":"2f2a4e7c-45cc-4a5b-bd56-10a643e9efe6","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:23:19.876Z] [INFO] [submit] Booking created {"correlationId":"2f2a4e7c-45cc-4a5b-bd56-10a643e9efe6","bookingId":"c20c549d-a124-4709-95bf-bd0fcd6d8861","duplicate":false,"initialStatus":"pending","durationMs":20569,"maskedEmail":"bo***c@example.com","maskedPhone":"********4472"}
[2025-11-15T12:23:20.507Z] [INFO] [inline_poll] Status update {"correlationId":"2f2a4e7c-45cc-4a5b-bd56-10a643e9efe6","bookingId":"c20c549d-a124-4709-95bf-bd0fcd6d8861","attempt":1,"status":"pending","assignments":0,"elapsedMs":631}
[2025-11-15T12:23:29.789Z] [INFO] [inline_poll] Status update {"correlationId":"2f2a4e7c-45cc-4a5b-bd56-10a643e9efe6","bookingId":"c20c549d-a124-4709-95bf-bd0fcd6d8861","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9913}
[2025-11-15T12:23:29.790Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"2f2a4e7c-45cc-4a5b-bd56-10a643e9efe6","bookingId":"c20c549d-a124-4709-95bf-bd0fcd6d8861","reference":"UVLESGA32C","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:17.525Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"7e144357-1867-49b4-8605-441e7950e5a2","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20569,"inlineAttempts":5,"inlineDurationMs":9913,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":30485,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"c74ddb82-8398-4c40-a001-e2e64740a268","tableId":"05a16ba0-4404-4144-a0f7-c3d918344f8d","tableNumber":"BA-04","zoneId":"df5b5d2b-4d2a-494e-8a38-e488ab929043","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:29.791Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6ed6cdc4-bb38-4316-aa2b-d719eb4d4442","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:29.791Z] [INFO] [submit] Submitting booking request {"correlationId":"6ed6cdc4-bb38-4316-aa2b-d719eb4d4442","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:23:50.223Z] [INFO] [submit] Booking created {"correlationId":"6ed6cdc4-bb38-4316-aa2b-d719eb4d4442","bookingId":"333dec4c-b0cc-4933-abeb-6d26223a42ad","duplicate":false,"initialStatus":"confirmed","durationMs":20432,"maskedEmail":"bo***4@example.com","maskedPhone":"********2324"}
[2025-11-15T12:23:50.837Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6ed6cdc4-bb38-4316-aa2b-d719eb4d4442","bookingId":"333dec4c-b0cc-4933-abeb-6d26223a42ad","reference":"R87G7UXPJ9","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:47.956Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"e0bbf2bc-7d13-4287-a89b-6eeb59c7400b","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20432,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21046,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"03a382ff-27c9-41d9-9b59-ac4f973770a2","tableId":"72d4824d-87ee-4c55-8a24-ed845b53308b","tableNumber":"MD-03","zoneId":"4749aafa-6ce9-492b-9f86-337b7cf8f8fe","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:50.839Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ba1dd606-3d53-4b89-b36c-f3d1fa04c679","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:50.839Z] [INFO] [submit] Submitting booking request {"correlationId":"ba1dd606-3d53-4b89-b36c-f3d1fa04c679","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:09.852Z] [INFO] [submit] Booking created {"correlationId":"ba1dd606-3d53-4b89-b36c-f3d1fa04c679","bookingId":"8b9df35c-d1f9-429d-91e2-b2e91701a325","duplicate":false,"initialStatus":"confirmed","durationMs":19012,"maskedEmail":"bo***6@example.com","maskedPhone":"********3606"}
[2025-11-15T12:24:10.596Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ba1dd606-3d53-4b89-b36c-f3d1fa04c679","bookingId":"8b9df35c-d1f9-429d-91e2-b2e91701a325","reference":"PXSKDKFB2T","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:08.488Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5551,"attemptId":"34fedec1-94dc-4ca3-b0aa-160273bce4a8","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19012,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19757,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bf2a50ec-32bf-44c4-98d9-886a6478deaf","tableId":"2ea61b82-f4e4-4424-8ba3-552929b0e59e","tableNumber":"MD-06","zoneId":"4749aafa-6ce9-492b-9f86-337b7cf8f8fe","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:24:10.597Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e0c09ccf-3e24-4a06-b61c-cc67fcee68dd","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:24:10.597Z] [INFO] [submit] Submitting booking request {"correlationId":"e0c09ccf-3e24-4a06-b61c-cc67fcee68dd","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:30.043Z] [INFO] [submit] Booking created {"correlationId":"e0c09ccf-3e24-4a06-b61c-cc67fcee68dd","bookingId":"7810efb4-80aa-4c2c-9ce3-805c509959da","duplicate":false,"initialStatus":"confirmed","durationMs":19446,"maskedEmail":"bo***f@example.com","maskedPhone":"********9225"}
[2025-11-15T12:24:30.669Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e0c09ccf-3e24-4a06-b61c-cc67fcee68dd","bookingId":"7810efb4-80aa-4c2c-9ce3-805c509959da","reference":"9FF3UTYZ7M","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:28.238Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"471158c8-f79c-48b7-961a-1ace77569ed9","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19446,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20072,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-01"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b92f0463-1ccd-42a9-95e5-50fdffe178f3","tableId":"87bd6be8-ffe9-4eb5-aad4-46228ece641c","tableNumber":"PR-01","zoneId":"f0b48046-a615-4595-93eb-ebe1f6e55f75","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19757, max: 30485, avg: 22840, p95: 21046 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-04', 'MD-03', 'MD-06', 'PR-01' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
