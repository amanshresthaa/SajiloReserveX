
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2025-11-15T12:22:59.304Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e1eb01e9-6dc1-4e6e-9611-137b08d9c4ba","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:22:59.305Z] [INFO] [submit] Submitting booking request {"correlationId":"e1eb01e9-6dc1-4e6e-9611-137b08d9c4ba","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:23:19.982Z] [INFO] [submit] Booking created {"correlationId":"e1eb01e9-6dc1-4e6e-9611-137b08d9c4ba","bookingId":"7e1d8d30-afd5-4bf8-af64-7b93e52649b5","duplicate":false,"initialStatus":"confirmed","durationMs":20676,"maskedEmail":"bo***9@example.com","maskedPhone":"********0149"}
[2025-11-15T12:23:20.593Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e1eb01e9-6dc1-4e6e-9611-137b08d9c4ba","bookingId":"7e1d8d30-afd5-4bf8-af64-7b93e52649b5","reference":"SUD4JBTQW5","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:19.370Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5855,"attemptId":"b4a3c5f7-5d64-4607-b009-93fc67a3b87f","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20676,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21289,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8617ef0e-f846-4de7-80a6-26a71e01b3e4","tableId":"e8bc19d9-b247-459e-ad1a-8f431353bbd3","tableNumber":"BA-03","zoneId":"df5b5d2b-4d2a-494e-8a38-e488ab929043","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:20.594Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e2e15984-958b-470b-b0a7-490c39f37f51","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:20.594Z] [INFO] [submit] Submitting booking request {"correlationId":"e2e15984-958b-470b-b0a7-490c39f37f51","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:23:40.002Z] [INFO] [submit] Booking created {"correlationId":"e2e15984-958b-470b-b0a7-490c39f37f51","bookingId":"8ac1cfe4-aebc-4467-9c3b-84f4891882ed","duplicate":false,"initialStatus":"confirmed","durationMs":19408,"maskedEmail":"bo***4@example.com","maskedPhone":"********5984"}
[2025-11-15T12:23:40.647Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e2e15984-958b-470b-b0a7-490c39f37f51","bookingId":"8ac1cfe4-aebc-4467-9c3b-84f4891882ed","reference":"TPVNHG45AN","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:38.698Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5811,"attemptId":"168f7325-83b7-4b96-8e84-4139ae054193","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19408,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20053,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9a3ccae7-9005-462f-bc2c-011ed5f3400d","tableId":"76b75e0f-b32d-441d-8389-41c739a70b9f","tableNumber":"BA-06","zoneId":"df5b5d2b-4d2a-494e-8a38-e488ab929043","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:40.649Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"47fafe6b-4691-4e18-b803-6c1a973a6936","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:40.649Z] [INFO] [submit] Submitting booking request {"correlationId":"47fafe6b-4691-4e18-b803-6c1a973a6936","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:00.288Z] [INFO] [submit] Booking created {"correlationId":"47fafe6b-4691-4e18-b803-6c1a973a6936","bookingId":"6b072e7e-96ae-477e-9bd9-78bf34793b65","duplicate":false,"initialStatus":"confirmed","durationMs":19638,"maskedEmail":"bo***b@example.com","maskedPhone":"********5461"}
[2025-11-15T12:24:00.974Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"47fafe6b-4691-4e18-b803-6c1a973a6936","bookingId":"6b072e7e-96ae-477e-9bd9-78bf34793b65","reference":"GU2BG7NW4W","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:58.610Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5381,"attemptId":"e1a5ce98-cbdb-4f7f-9b47-f000d77a3894","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19638,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20325,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"857a1adf-4c98-49d2-9e5e-26b248454395","tableId":"d220c3c6-301f-4955-a724-1cd775582b9f","tableNumber":"MD-05","zoneId":"4749aafa-6ce9-492b-9f86-337b7cf8f8fe","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:24:00.976Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"084cd5d9-07ba-4d57-b5fa-723e033fb975","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:24:00.976Z] [INFO] [submit] Submitting booking request {"correlationId":"084cd5d9-07ba-4d57-b5fa-723e033fb975","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:21.083Z] [INFO] [submit] Booking created {"correlationId":"084cd5d9-07ba-4d57-b5fa-723e033fb975","bookingId":"fd83005c-fb5b-46af-b1f6-edfd3a00a15e","duplicate":false,"initialStatus":"confirmed","durationMs":20106,"maskedEmail":"bo***9@example.com","maskedPhone":"********3539"}
[2025-11-15T12:24:21.850Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"084cd5d9-07ba-4d57-b5fa-723e033fb975","bookingId":"fd83005c-fb5b-46af-b1f6-edfd3a00a15e","reference":"3HPA5JM3DP","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:19.806Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5584,"attemptId":"5fab813c-c34c-496a-931b-880795bbf8b1","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20106,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20874,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["OG-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b2585f07-d0b3-4e21-ab72-58943000e9fc","tableId":"1949ea53-edd6-4271-9363-e944b0c7086e","tableNumber":"OG-03","zoneId":"1a2b5ba2-d745-40c7-98c7-1ca3bd20e530","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20053, max: 21289, avg: 20635.25, p95: 20874 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-06', 'MD-05', 'OG-03' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
