
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-15T10:31:24.590Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e29d29e5-959a-4373-a677-677bc57161b9","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:31:24.590Z] [INFO] [submit] Submitting booking request {"correlationId":"e29d29e5-959a-4373-a677-677bc57161b9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:31:45.102Z] [INFO] [submit] Booking created {"correlationId":"e29d29e5-959a-4373-a677-677bc57161b9","bookingId":"d2487616-9a13-4853-844a-d8d291fc90a1","duplicate":false,"initialStatus":"confirmed","durationMs":20511,"maskedEmail":"bo***5@example.com","maskedPhone":"********2945"}
[2025-11-15T10:31:45.756Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e29d29e5-959a-4373-a677-677bc57161b9","bookingId":"d2487616-9a13-4853-844a-d8d291fc90a1","reference":"49Q9S2HMQM","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:31:42.231Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"47d58a55-7dbd-403e-b56a-5e86352930d5","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20511,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21167,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-08"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"01db1e4d-1e46-423c-af81-c4bb130c0b42","tableId":"d91592bf-94f2-4f13-80b2-37137756a62c","tableNumber":"PT-08","zoneId":"a405d9d0-7cd1-447f-a550-b0f0b7d83525","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:31:45.757Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ce8a4714-86b0-4f23-a86d-4170d53020f3","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:31:45.757Z] [INFO] [submit] Submitting booking request {"correlationId":"ce8a4714-86b0-4f23-a86d-4170d53020f3","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:32:06.908Z] [INFO] [submit] Booking created {"correlationId":"ce8a4714-86b0-4f23-a86d-4170d53020f3","bookingId":"dfd4a256-febe-4312-9d55-1c45aff7133a","duplicate":false,"initialStatus":"confirmed","durationMs":21150,"maskedEmail":"bo***4@example.com","maskedPhone":"********4714"}
[2025-11-15T10:32:07.546Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ce8a4714-86b0-4f23-a86d-4170d53020f3","bookingId":"dfd4a256-febe-4312-9d55-1c45aff7133a","reference":"R99P6Z2332","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:32:03.442Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"d386bbf7-c819-41c7-b404-c9706565c4d9","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":21150,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21789,"tablesAssigned":1,"totalCapacity":10,"seatWaste":2,"tableNumbers":["MD-11"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e46abec5-c123-4908-b9ae-867578c94dd1","tableId":"9b595c3b-f1c3-4069-b18e-8f9e22e3730d","tableNumber":"MD-11","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T10:32:07.547Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b643554b-b577-4cb2-9858-d1b496b72fd2","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:32:07.547Z] [INFO] [submit] Submitting booking request {"correlationId":"b643554b-b577-4cb2-9858-d1b496b72fd2","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:32:26.867Z] [INFO] [submit] Booking created {"correlationId":"b643554b-b577-4cb2-9858-d1b496b72fd2","bookingId":"aca0708e-c478-4fb0-8fb6-30007100525f","duplicate":false,"initialStatus":"confirmed","durationMs":19320,"maskedEmail":"bo***b@example.com","maskedPhone":"********5541"}
[2025-11-15T10:32:27.505Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b643554b-b577-4cb2-9858-d1b496b72fd2","bookingId":"aca0708e-c478-4fb0-8fb6-30007100525f","reference":"AWXNTMZXTL","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:32:26.053Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5717,"attemptId":"84475e5e-29d3-4d29-b5a2-0f7f61033a1f","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19320,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19958,"tablesAssigned":2,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-03","MD-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a3abadb4-a0b1-4f10-8568-2a620e203c48","tableId":"2f14c427-c7fc-47ec-a733-21b3408af503","tableNumber":"MD-03","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":4,"startAt":null,"endAt":null},{"id":"68b2a408-05a0-4fb6-90cf-a590f88ef12e","tableId":"3edec822-a4c8-4b71-ab39-06223c28d739","tableNumber":"MD-06","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:32:27.506Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3d3b6e7f-9686-4d72-9e86-fa3ea4d1664e","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:32:27.506Z] [INFO] [submit] Submitting booking request {"correlationId":"3d3b6e7f-9686-4d72-9e86-fa3ea4d1664e","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:32:46.956Z] [INFO] [submit] Booking created {"correlationId":"3d3b6e7f-9686-4d72-9e86-fa3ea4d1664e","bookingId":"509b160d-d761-467a-9a62-6742cc4773e5","duplicate":false,"initialStatus":"confirmed","durationMs":19450,"maskedEmail":"bo***f@example.com","maskedPhone":"********6475"}
[2025-11-15T10:32:47.603Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3d3b6e7f-9686-4d72-9e86-fa3ea4d1664e","bookingId":"509b160d-d761-467a-9a62-6742cc4773e5","reference":"UM88GDMFUT","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:32:44.359Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"71dd59a3-efa1-44c6-8032-15c68e514d3b","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19450,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20097,"tablesAssigned":2,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-03","PT-04"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"69926e62-cea4-42bb-8824-fd1e2cba60ec","tableId":"33607f27-0151-46fd-995b-7862ca7952e9","tableNumber":"PT-03","zoneId":"a405d9d0-7cd1-447f-a550-b0f0b7d83525","capacity":4,"startAt":null,"endAt":null},{"id":"e9c641ed-bea1-427d-a9fe-5a2a7a1a2dcf","tableId":"e8cfa282-8cb3-4038-bbcb-b1d5390872d8","tableNumber":"PT-04","zoneId":"a405d9d0-7cd1-447f-a550-b0f0b7d83525","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19958, max: 21789, avg: 20752.75, p95: 21167 },
  seatWaste: { count: 4, min: 0, max: 2, avg: 0.5, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.5, p95: 2 },
  uniqueTables: [ 'MD-03', 'MD-06', 'MD-11', 'PT-03', 'PT-04', 'PT-08' ]
}
✅ Stress run completed 4 booking(s) without failure.
