
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-15T10:23:22.162Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"33fbd773-7c6c-4a86-aa4a-d6ce70ba854c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:23:22.162Z] [INFO] [submit] Submitting booking request {"correlationId":"33fbd773-7c6c-4a86-aa4a-d6ce70ba854c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:23:41.689Z] [INFO] [submit] Booking created {"correlationId":"33fbd773-7c6c-4a86-aa4a-d6ce70ba854c","bookingId":"88515641-f7e8-4fe0-9463-7d75ac3a6995","duplicate":false,"initialStatus":"confirmed","durationMs":19526,"maskedEmail":"bo***3@example.com","maskedPhone":"********3773"}
[2025-11-15T10:23:42.340Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"33fbd773-7c6c-4a86-aa4a-d6ce70ba854c","bookingId":"88515641-f7e8-4fe0-9463-7d75ac3a6995","reference":"YYEBNWDD6J","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:23:40.838Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5605,"attemptId":"f990755b-3d81-44c3-b340-c023ef1fefb7","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19526,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20178,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2de1cf3c-8317-45e4-9e33-cd2a58d0831e","tableId":"086e62e5-f1d4-4cba-81da-460500449e9d","tableNumber":"BA-03","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:23:42.341Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bd937a77-1b63-43f7-8304-30de7dfa6a48","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:23:42.341Z] [INFO] [submit] Submitting booking request {"correlationId":"bd937a77-1b63-43f7-8304-30de7dfa6a48","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:24:01.817Z] [INFO] [submit] Booking created {"correlationId":"bd937a77-1b63-43f7-8304-30de7dfa6a48","bookingId":"bfe36323-ed67-4bf7-ae36-45834db41144","duplicate":false,"initialStatus":"confirmed","durationMs":19474,"maskedEmail":"bo***7@example.com","maskedPhone":"********7077"}
[2025-11-15T10:24:02.466Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bd937a77-1b63-43f7-8304-30de7dfa6a48","bookingId":"bfe36323-ed67-4bf7-ae36-45834db41144","reference":"5FNTKBQMM4","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:24:01.159Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5540,"attemptId":"081a28fa-b5fa-47b0-a1fd-d1cfd85458fe","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19474,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20125,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4b34935e-59bd-484e-ae48-7287aa508bc0","tableId":"3e241ed8-f4a7-49ef-9c5e-3ccc09984f91","tableNumber":"BA-04","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:24:02.467Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"36e7f7d4-dbd1-4662-915e-6a2d7ae65536","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:24:02.467Z] [INFO] [submit] Submitting booking request {"correlationId":"36e7f7d4-dbd1-4662-915e-6a2d7ae65536","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:24:22.368Z] [INFO] [submit] Booking created {"correlationId":"36e7f7d4-dbd1-4662-915e-6a2d7ae65536","bookingId":"ea350afb-dcce-413b-8b8f-b5fd27b74db2","duplicate":false,"initialStatus":"confirmed","durationMs":19900,"maskedEmail":"bo***4@example.com","maskedPhone":"********5734"}
[2025-11-15T10:24:23.692Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"36e7f7d4-dbd1-4662-915e-6a2d7ae65536","bookingId":"ea350afb-dcce-413b-8b8f-b5fd27b74db2","reference":"2WJ38CZ29Q","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:24:19.656Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"437539c0-8eb0-42dc-a69b-784919d0a714","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19900,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21225,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"89c773d7-a51e-4fda-ad3e-94bfb5a10f81","tableId":"9b38a0a1-3248-45e9-8852-3bc7bc42a0a1","tableNumber":"BA-05","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:24:23.693Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4ee7d032-e2af-4354-814d-11bb936d0af8","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:24:23.693Z] [INFO] [submit] Submitting booking request {"correlationId":"4ee7d032-e2af-4354-814d-11bb936d0af8","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:24:43.730Z] [INFO] [submit] Booking created {"correlationId":"4ee7d032-e2af-4354-814d-11bb936d0af8","bookingId":"dae30e28-507c-4b38-8380-fef68cc1b3dc","duplicate":false,"initialStatus":"confirmed","durationMs":20037,"maskedEmail":"bo***2@example.com","maskedPhone":"********3032"}
[2025-11-15T10:24:44.367Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4ee7d032-e2af-4354-814d-11bb936d0af8","bookingId":"dae30e28-507c-4b38-8380-fef68cc1b3dc","reference":"JF276KNPE2","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:24:43.014Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5716,"attemptId":"c8312bfc-82ee-430b-b2ba-730e2496d3eb","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20037,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20674,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f83e4a9b-a33e-4c4c-90e3-79804f03beb9","tableId":"29dcfde0-c8aa-4ee6-b806-2fb849b674a0","tableNumber":"BA-06","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20125, max: 21225, avg: 20550.5, p95: 20674 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
