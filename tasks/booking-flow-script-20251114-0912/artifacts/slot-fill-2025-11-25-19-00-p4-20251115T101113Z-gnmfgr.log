
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 19\:00 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[2025-11-15T10:11:14.339Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4dd46e81-8038-4bd1-9eb5-e34d99d23385","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:11:14.340Z] [INFO] [submit] Submitting booking request {"correlationId":"4dd46e81-8038-4bd1-9eb5-e34d99d23385","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:11:34.190Z] [INFO] [submit] Booking created {"correlationId":"4dd46e81-8038-4bd1-9eb5-e34d99d23385","bookingId":"180e301c-8976-42bb-b782-5866c8642094","duplicate":false,"initialStatus":"confirmed","durationMs":19848,"maskedEmail":"bo***1@example.com","maskedPhone":"********6481"}
[2025-11-15T10:11:35.018Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4dd46e81-8038-4bd1-9eb5-e34d99d23385","bookingId":"180e301c-8976-42bb-b782-5866c8642094","reference":"WJAW3U3R8K","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:11:31.690Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"21ca6714-23a9-4883-b0cd-d5b534457239","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19848,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20679,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-01"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"51d0f148-63c7-4d3e-a333-e0de1b202733","tableId":"2d954f9b-5baf-4282-a3a4-d5a521d44f1e","tableNumber":"PR-01","zoneId":"80e6af37-31b6-4412-a4de-c26cd7b9bc5a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:11:35.019Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4df5cf6a-2348-4794-99a2-7b1910a139b6","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:11:35.019Z] [INFO] [submit] Submitting booking request {"correlationId":"4df5cf6a-2348-4794-99a2-7b1910a139b6","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:11:55.772Z] [INFO] [submit] Booking created {"correlationId":"4df5cf6a-2348-4794-99a2-7b1910a139b6","bookingId":"e174b4f3-c221-4aeb-836c-649346b73918","duplicate":false,"initialStatus":"confirmed","durationMs":20753,"maskedEmail":"bo***a@example.com","maskedPhone":"********2560"}
[2025-11-15T10:11:56.401Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4df5cf6a-2348-4794-99a2-7b1910a139b6","bookingId":"e174b4f3-c221-4aeb-836c-649346b73918","reference":"Y35GTM9C3T","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:11:53.115Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"41b1eaea-f2bc-4e20-865f-d6e6f1e5ecbd","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20753,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21382,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"18aef1bd-f1c4-4cda-a964-de66610a377b","tableId":"81e3b274-461b-4c6e-a84b-4a9ff19a3b7a","tableNumber":"PR-02","zoneId":"80e6af37-31b6-4412-a4de-c26cd7b9bc5a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:11:56.402Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"31d7d86a-bec0-4749-98e9-b05ba365714e","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:11:56.402Z] [INFO] [submit] Submitting booking request {"correlationId":"31d7d86a-bec0-4749-98e9-b05ba365714e","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:12:15.146Z] [INFO] [submit] Booking created {"correlationId":"31d7d86a-bec0-4749-98e9-b05ba365714e","bookingId":"5b48be8c-5c44-49a6-b00e-2312d6d945ad","duplicate":false,"initialStatus":"confirmed","durationMs":18743,"maskedEmail":"bo***a@example.com","maskedPhone":"********3860"}
[2025-11-15T10:12:15.759Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"31d7d86a-bec0-4749-98e9-b05ba365714e","bookingId":"5b48be8c-5c44-49a6-b00e-2312d6d945ad","reference":"MGAVMG5G6G","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:12:14.352Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5553,"attemptId":"10a4d97a-073c-4fe8-895b-fbda6843a6c3","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18743,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19357,"tablesAssigned":1,"totalCapacity":6,"seatWaste":2,"tableNumbers":["OG-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e2293aa5-1887-4293-869d-b36ba816963e","tableId":"157bf6bc-00e9-4a1e-8c2f-e9717588d02a","tableNumber":"OG-04","zoneId":"a10aa8f6-2298-4141-8ccf-1cf6818f2337","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:12:15.760Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"96d78da3-185c-46b6-b09a-5704ba283f9d","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:12:15.760Z] [INFO] [submit] Submitting booking request {"correlationId":"96d78da3-185c-46b6-b09a-5704ba283f9d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:12:34.678Z] [INFO] [submit] Booking created {"correlationId":"96d78da3-185c-46b6-b09a-5704ba283f9d","bookingId":"f544c98b-886b-42af-9a70-4222bac549b3","duplicate":false,"initialStatus":"confirmed","durationMs":18917,"maskedEmail":"bo***3@example.com","maskedPhone":"********8303"}
[2025-11-15T10:12:35.331Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"96d78da3-185c-46b6-b09a-5704ba283f9d","bookingId":"f544c98b-886b-42af-9a70-4222bac549b3","reference":"7WQNGQCSE6","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:12:34.002Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5476,"attemptId":"f538fc09-da09-43d1-ad59-65eb43c471bd","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18917,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19571,"tablesAssigned":1,"totalCapacity":6,"seatWaste":2,"tableNumbers":["OG-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"867f074a-2a12-4620-bea6-ba1e828d4658","tableId":"2442736e-923d-4191-a352-a3f3ed1d1c59","tableNumber":"OG-05","zoneId":"a10aa8f6-2298-4141-8ccf-1cf6818f2337","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19357, max: 21382, avg: 20247.25, p95: 20679 },
  seatWaste: { count: 4, min: 0, max: 2, avg: 1, p95: 2 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-04', 'OG-05', 'PR-01', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
