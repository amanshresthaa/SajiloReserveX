
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-15T10:38:12.095Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3f7e4772-7576-419a-86b0-eddcad391738","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:12.095Z] [INFO] [submit] Submitting booking request {"correlationId":"3f7e4772-7576-419a-86b0-eddcad391738","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:38:34.242Z] [INFO] [submit] Booking created {"correlationId":"3f7e4772-7576-419a-86b0-eddcad391738","bookingId":"653e8372-d09b-4572-8338-4abf4c835a9b","duplicate":false,"initialStatus":"confirmed","durationMs":22146,"maskedEmail":"bo***2@example.com","maskedPhone":"********4772"}
[2025-11-15T10:38:34.868Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3f7e4772-7576-419a-86b0-eddcad391738","bookingId":"653e8372-d09b-4572-8338-4abf4c835a9b","reference":"5JWVEMNDSJ","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:38:31.622Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"6c677831-5fd5-4d62-838f-e7d41a342249","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22146,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22773,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e232fe20-2714-49a8-89af-595fe0d1347b","tableId":"77fd0e5b-c0e5-42af-85a8-eed73371d318","tableNumber":"BA-03","zoneId":"4dcdc847-1f57-4cc8-8b5d-4ee86f17dc20","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:38:34.869Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"927e1489-8d17-4375-94b0-e8468ce03068","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:34.869Z] [INFO] [submit] Submitting booking request {"correlationId":"927e1489-8d17-4375-94b0-e8468ce03068","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:38:53.547Z] [INFO] [submit] Booking created {"correlationId":"927e1489-8d17-4375-94b0-e8468ce03068","bookingId":"db795556-f17d-4117-b94c-9e7faecdb7c4","duplicate":false,"initialStatus":"confirmed","durationMs":18677,"maskedEmail":"bo***9@example.com","maskedPhone":"********1489"}
[2025-11-15T10:38:54.151Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"927e1489-8d17-4375-94b0-e8468ce03068","bookingId":"db795556-f17d-4117-b94c-9e7faecdb7c4","reference":"87V86S25BR","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:38:51.942Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5240,"attemptId":"01759120-61f8-4722-85d9-b9c98980a9b7","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18677,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19282,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"cf28a68b-832b-42b9-bdb3-91b4586ab028","tableId":"e9e67acd-e6d4-4c41-8429-2c95c43b5f50","tableNumber":"BA-05","zoneId":"4dcdc847-1f57-4cc8-8b5d-4ee86f17dc20","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:38:54.153Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"299a9472-0ea5-4e0f-b64f-770c716417b4","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:54.153Z] [INFO] [submit] Submitting booking request {"correlationId":"299a9472-0ea5-4e0f-b64f-770c716417b4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:12.644Z] [INFO] [submit] Booking created {"correlationId":"299a9472-0ea5-4e0f-b64f-770c716417b4","bookingId":"8e340dd9-b2b6-4294-a4d4-095ba7851a0f","duplicate":false,"initialStatus":"confirmed","durationMs":18491,"maskedEmail":"bo***2@example.com","maskedPhone":"********9472"}
[2025-11-15T10:39:13.262Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"299a9472-0ea5-4e0f-b64f-770c716417b4","bookingId":"8e340dd9-b2b6-4294-a4d4-095ba7851a0f","reference":"9UGTZNPGV3","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:10.930Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5026,"attemptId":"cc60e7ed-4fe2-48d1-bbc1-3d00b3c698d0","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18491,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19108,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d700d2da-7dd6-4fb4-9d52-2d746bebaed3","tableId":"df200ef4-a7a5-4050-b200-58801b2f7e4b","tableNumber":"MD-03","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:13.262Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"078c9615-35b1-4508-9d8b-1d43ffd3ab52","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:13.262Z] [INFO] [submit] Submitting booking request {"correlationId":"078c9615-35b1-4508-9d8b-1d43ffd3ab52","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:33.535Z] [INFO] [submit] Booking created {"correlationId":"078c9615-35b1-4508-9d8b-1d43ffd3ab52","bookingId":"82f29a49-3665-4669-9055-1d2ce1697e1b","duplicate":false,"initialStatus":"confirmed","durationMs":20272,"maskedEmail":"bo***5@example.com","maskedPhone":"********9615"}
[2025-11-15T10:39:34.430Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"078c9615-35b1-4508-9d8b-1d43ffd3ab52","bookingId":"82f29a49-3665-4669-9055-1d2ce1697e1b","reference":"2L9Y2VP6LN","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:31.294Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12006,"attemptId":"8e7d3e15-2327-434e-a589-b4a3e5694791","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20272,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21168,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e0d36127-d1aa-4431-a003-faee77049fa1","tableId":"caa0d4ee-8e1a-432c-9a27-d01fc8296221","tableNumber":"MD-05","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19108, max: 22773, avg: 20582.75, p95: 21168 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-05', 'MD-03', 'MD-05' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
