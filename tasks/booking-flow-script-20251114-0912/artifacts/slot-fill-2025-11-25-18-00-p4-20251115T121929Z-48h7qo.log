
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  suppress all logs with { quiet: true }
[2025-11-15T12:19:30.520Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"04528348-6839-4351-87c3-ee4ed05ceb74","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:30.520Z] [INFO] [submit] Submitting booking request {"correlationId":"04528348-6839-4351-87c3-ee4ed05ceb74","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:19:50.987Z] [INFO] [submit] Booking created {"correlationId":"04528348-6839-4351-87c3-ee4ed05ceb74","bookingId":"3eccf6d7-5ffb-4176-86b0-8018ac6a83b8","duplicate":false,"initialStatus":"confirmed","durationMs":20465,"maskedEmail":"bo***8@example.com","maskedPhone":"********8348"}
[2025-11-15T12:19:51.697Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"04528348-6839-4351-87c3-ee4ed05ceb74","bookingId":"3eccf6d7-5ffb-4176-86b0-8018ac6a83b8","reference":"EJZ3T8DX4E","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:19:50.173Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5954,"attemptId":"a49f099f-df1a-4233-a3cc-5ae0bdaad022","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20465,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21177,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"639f6246-6b38-4668-8299-cf1f0b602555","tableId":"55795b3d-9aec-475e-a8b9-380de8774325","tableNumber":"BA-03","zoneId":"14915a10-e151-4a4d-a2af-9557f57e9c9b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:19:51.697Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9ebedb20-e121-43ee-846f-ad6b5e59f3ca","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:51.697Z] [INFO] [submit] Submitting booking request {"correlationId":"9ebedb20-e121-43ee-846f-ad6b5e59f3ca","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:10.636Z] [INFO] [submit] Booking created {"correlationId":"9ebedb20-e121-43ee-846f-ad6b5e59f3ca","bookingId":"ffd4ddec-d874-437e-a11e-f2a980a90e8a","duplicate":false,"initialStatus":"confirmed","durationMs":18938,"maskedEmail":"bo***0@example.com","maskedPhone":"********3120"}
[2025-11-15T12:20:11.359Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9ebedb20-e121-43ee-846f-ad6b5e59f3ca","bookingId":"ffd4ddec-d874-437e-a11e-f2a980a90e8a","reference":"G4FDYLJR8Y","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:09.469Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5777,"attemptId":"845183aa-e884-46d4-8fdf-0b5ae78e50ec","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18938,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19662,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3d0c958e-f858-4db9-943e-8a7444c83b4d","tableId":"11a2e334-fe76-46c8-8a21-e4394fe94812","tableNumber":"BA-04","zoneId":"14915a10-e151-4a4d-a2af-9557f57e9c9b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:11.360Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"03d5a75a-5133-48f2-be97-64e39a7cdb08","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:11.360Z] [INFO] [submit] Submitting booking request {"correlationId":"03d5a75a-5133-48f2-be97-64e39a7cdb08","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:31.236Z] [INFO] [submit] Booking created {"correlationId":"03d5a75a-5133-48f2-be97-64e39a7cdb08","bookingId":"b29432bf-65f2-4ca9-af64-d8de19093e08","duplicate":false,"initialStatus":"confirmed","durationMs":19875,"maskedEmail":"bo***a@example.com","maskedPhone":"********0750"}
[2025-11-15T12:20:31.872Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"03d5a75a-5133-48f2-be97-64e39a7cdb08","bookingId":"b29432bf-65f2-4ca9-af64-d8de19093e08","reference":"XESNQC24WR","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:28.431Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"567ce710-0b93-42ab-a8dc-fed0bfe926cb","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19875,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20511,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8aff48e7-dd24-4919-964d-dea9f84043e0","tableId":"b28fd031-e789-41e1-8dfc-5c29c514d40e","tableNumber":"BA-05","zoneId":"14915a10-e151-4a4d-a2af-9557f57e9c9b","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:31.873Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"dc87bb04-1533-4c49-849f-cd6026d0f59c","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:31.873Z] [INFO] [submit] Submitting booking request {"correlationId":"dc87bb04-1533-4c49-849f-cd6026d0f59c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:51.442Z] [INFO] [submit] Booking created {"correlationId":"dc87bb04-1533-4c49-849f-cd6026d0f59c","bookingId":"bd40c5b9-ae9f-4c63-8140-8cd969110852","duplicate":false,"initialStatus":"confirmed","durationMs":19569,"maskedEmail":"bo***4@example.com","maskedPhone":"********1104"}
[2025-11-15T12:20:52.044Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"dc87bb04-1533-4c49-849f-cd6026d0f59c","bookingId":"bd40c5b9-ae9f-4c63-8140-8cd969110852","reference":"4Z2JTWYSBE","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:49.839Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5499,"attemptId":"2fd7e9cb-5137-47c4-ac93-ce4cbf2c5fcd","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19569,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20171,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3bd4e0df-cc75-44b3-ba35-0868c088cf31","tableId":"61646669-c785-4d58-9c73-bddf03abe775","tableNumber":"BA-06","zoneId":"14915a10-e151-4a4d-a2af-9557f57e9c9b","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19662, max: 21177, avg: 20380.25, p95: 20511 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
✅ Stress run completed 4 booking(s) without failure.
