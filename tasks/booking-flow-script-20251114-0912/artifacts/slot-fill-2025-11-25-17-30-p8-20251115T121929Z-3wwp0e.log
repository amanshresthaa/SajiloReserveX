
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-15T12:19:30.520Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6b8fe973-0a17-4841-8dfb-ee6437d62f27","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:30.520Z] [INFO] [submit] Submitting booking request {"correlationId":"6b8fe973-0a17-4841-8dfb-ee6437d62f27","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:19:51.330Z] [INFO] [submit] Booking created {"correlationId":"6b8fe973-0a17-4841-8dfb-ee6437d62f27","bookingId":"c7384b3e-3856-4847-b90c-ade86ec01911","duplicate":false,"initialStatus":"pending","durationMs":20809,"maskedEmail":"bo***3@example.com","maskedPhone":"********4973"}
[2025-11-15T12:19:52.008Z] [INFO] [inline_poll] Status update {"correlationId":"6b8fe973-0a17-4841-8dfb-ee6437d62f27","bookingId":"c7384b3e-3856-4847-b90c-ade86ec01911","attempt":1,"status":"pending","assignments":0,"elapsedMs":677}
[2025-11-15T12:20:01.321Z] [INFO] [inline_poll] Status update {"correlationId":"6b8fe973-0a17-4841-8dfb-ee6437d62f27","bookingId":"c7384b3e-3856-4847-b90c-ade86ec01911","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9990}
[2025-11-15T12:20:01.322Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"6b8fe973-0a17-4841-8dfb-ee6437d62f27","bookingId":"c7384b3e-3856-4847-b90c-ade86ec01911","reference":"EEUSLVWXG9","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:19:49.422Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12001,"attemptId":"e1f1e47b-55e1-4c1d-8034-077f480c569f","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20809,"inlineAttempts":5,"inlineDurationMs":9990,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":30801,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-10"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"b1572169-777f-43c4-a7e8-7dad117f2109","tableId":"e2cf02cc-d1ad-4e8a-82eb-b1afaeaab1c9","tableNumber":"MD-10","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:01.323Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e68f761c-2088-4d51-975b-cce18373d82e","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:01.323Z] [INFO] [submit] Submitting booking request {"correlationId":"e68f761c-2088-4d51-975b-cce18373d82e","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:21.233Z] [INFO] [submit] Booking created {"correlationId":"e68f761c-2088-4d51-975b-cce18373d82e","bookingId":"a5a809ec-e521-41fe-8d90-0e27f7eba9ca","duplicate":false,"initialStatus":"confirmed","durationMs":19908,"maskedEmail":"bo***c@example.com","maskedPhone":"********7612"}
[2025-11-15T12:20:21.910Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e68f761c-2088-4d51-975b-cce18373d82e","bookingId":"a5a809ec-e521-41fe-8d90-0e27f7eba9ca","reference":"46GGG7TR63","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:19.073Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5572,"attemptId":"a5cf2943-2111-4f84-a4ad-2200e6244e06","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19908,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20587,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-07"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0a2a40d3-1539-4430-8dbb-21fd65dc4d8a","tableId":"9c978987-4749-4d2c-b98b-ec853aeafbd7","tableNumber":"PT-07","zoneId":"ac2bb419-063a-4997-87a6-f0cbf29d7150","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:21.911Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2fff374f-94ed-4915-b456-f7a223a7fe2c","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:21.911Z] [INFO] [submit] Submitting booking request {"correlationId":"2fff374f-94ed-4915-b456-f7a223a7fe2c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:41.805Z] [INFO] [submit] Booking created {"correlationId":"2fff374f-94ed-4915-b456-f7a223a7fe2c","bookingId":"bb0615eb-2935-4e5a-8c6d-d798a056645f","duplicate":false,"initialStatus":"confirmed","durationMs":19894,"maskedEmail":"bo***f@example.com","maskedPhone":"********3745"}
[2025-11-15T12:20:42.431Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2fff374f-94ed-4915-b456-f7a223a7fe2c","bookingId":"bb0615eb-2935-4e5a-8c6d-d798a056645f","reference":"RYKBG5F9CX","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:40.928Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5601,"attemptId":"7f207451-3699-4796-8931-cfcb61cccc16","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19894,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20520,"tablesAssigned":2,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-03","MD-04"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c05c80f5-74e6-4e19-8446-959dcf505722","tableId":"4aba580b-9649-4b54-a267-431077c6cff9","tableNumber":"MD-03","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":4,"startAt":null,"endAt":null},{"id":"c54af71d-6270-484f-beba-13f6624c7271","tableId":"59a623b8-43fa-4b17-a4d5-347218580b3d","tableNumber":"MD-04","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:42.432Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"81070da0-0b6a-4248-b25e-f63d6ef76635","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:42.432Z] [INFO] [submit] Submitting booking request {"correlationId":"81070da0-0b6a-4248-b25e-f63d6ef76635","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:21:01.496Z] [INFO] [submit] Booking created {"correlationId":"81070da0-0b6a-4248-b25e-f63d6ef76635","bookingId":"fd544c6d-9d23-4101-a750-045431349271","duplicate":false,"initialStatus":"confirmed","durationMs":19063,"maskedEmail":"bo***0@example.com","maskedPhone":"********0300"}
[2025-11-15T12:21:02.135Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"81070da0-0b6a-4248-b25e-f63d6ef76635","bookingId":"fd544c6d-9d23-4101-a750-045431349271","reference":"4LL3JWK3F6","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:59.792Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5496,"attemptId":"03579109-c3cc-43f4-a818-1cd39374d6d2","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19063,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19703,"tablesAssigned":2,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-04","PT-03"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b1c468b8-8a6d-4463-add5-58c84948bbce","tableId":"76e0fce4-dfce-4a32-921d-12aed10ce250","tableNumber":"PT-04","zoneId":"ac2bb419-063a-4997-87a6-f0cbf29d7150","capacity":4,"startAt":null,"endAt":null},{"id":"25bbc1c0-8f61-4562-86ba-fbb8d24a741a","tableId":"a3762343-4afd-4990-aa32-bb04e37bfebb","tableNumber":"PT-03","zoneId":"ac2bb419-063a-4997-87a6-f0cbf29d7150","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19703, max: 30801, avg: 22902.75, p95: 20587 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.5, p95: 2 },
  uniqueTables: [ 'MD-03', 'MD-04', 'MD-10', 'PT-03', 'PT-04', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
