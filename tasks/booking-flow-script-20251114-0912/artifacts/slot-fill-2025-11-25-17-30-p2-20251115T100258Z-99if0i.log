
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2025-11-15T10:02:59.127Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"27a3f0bb-c2b0-4316-aa6a-7957276a2e3c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:02:59.127Z] [INFO] [submit] Submitting booking request {"correlationId":"27a3f0bb-c2b0-4316-aa6a-7957276a2e3c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:03:19.845Z] [INFO] [submit] Booking created {"correlationId":"27a3f0bb-c2b0-4316-aa6a-7957276a2e3c","bookingId":"2db67d64-0baf-4858-8c53-de28ac088df1","duplicate":false,"initialStatus":"confirmed","durationMs":20717,"maskedEmail":"bo***b@example.com","maskedPhone":"********5011"}
[2025-11-15T10:03:20.463Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"27a3f0bb-c2b0-4316-aa6a-7957276a2e3c","bookingId":"2db67d64-0baf-4858-8c53-de28ac088df1","reference":"MZGNCKWBYQ","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:03:18.962Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5795,"attemptId":"0bcc3fd0-d061-4e01-8afd-91fd3791e6b3","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20717,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21336,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dabe446a-4273-443e-b3f6-cfc97750e083","tableId":"9c9e603e-9ea9-456a-a572-0d62e34d4900","tableNumber":"BA-01","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:03:20.463Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f2049815-889f-4aaf-b8c6-5ac8f2884d5f","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:03:20.463Z] [INFO] [submit] Submitting booking request {"correlationId":"f2049815-889f-4aaf-b8c6-5ac8f2884d5f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:03:39.845Z] [INFO] [submit] Booking created {"correlationId":"f2049815-889f-4aaf-b8c6-5ac8f2884d5f","bookingId":"afb0b040-213e-4f1e-8e44-f3a9f6b6bcce","duplicate":false,"initialStatus":"confirmed","durationMs":19381,"maskedEmail":"bo***5@example.com","maskedPhone":"********9815"}
[2025-11-15T10:03:40.479Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f2049815-889f-4aaf-b8c6-5ac8f2884d5f","bookingId":"afb0b040-213e-4f1e-8e44-f3a9f6b6bcce","reference":"D78ABS4RUP","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:03:38.627Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5556,"attemptId":"eb46a6bd-a1c6-4c15-8816-c1955b7dade6","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19381,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20016,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8f269e9c-b2f0-42c9-adc8-96dfd0c7fd1d","tableId":"24ae584c-e4ef-495d-98e0-0ee4ca366f73","tableNumber":"BA-02","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:03:40.480Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bbfa3650-c814-4824-b004-06b6f4ec3c96","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:03:40.480Z] [INFO] [submit] Submitting booking request {"correlationId":"bbfa3650-c814-4824-b004-06b6f4ec3c96","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:04:00.816Z] [INFO] [submit] Booking created {"correlationId":"bbfa3650-c814-4824-b004-06b6f4ec3c96","bookingId":"7c784ba2-1ccf-48fc-a250-4cffcfcde7ad","duplicate":false,"initialStatus":"confirmed","durationMs":20336,"maskedEmail":"bo***0@example.com","maskedPhone":"********3650"}
[2025-11-15T10:04:01.438Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bbfa3650-c814-4824-b004-06b6f4ec3c96","bookingId":"7c784ba2-1ccf-48fc-a250-4cffcfcde7ad","reference":"PLXTBNDHSD","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:03:57.965Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"c2a67436-ecea-47f3-831e-22ff697db3ec","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20336,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20957,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"33cfe962-8ebb-4771-8238-f3d340d6ba52","tableId":"1eb45136-5dca-4408-a8d2-89c9c21511d2","tableNumber":"MD-01","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:04:01.438Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f8c9c05b-b15f-483a-8f22-d6f3059ef707","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:04:01.438Z] [INFO] [submit] Submitting booking request {"correlationId":"f8c9c05b-b15f-483a-8f22-d6f3059ef707","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:04:20.673Z] [INFO] [submit] Booking created {"correlationId":"f8c9c05b-b15f-483a-8f22-d6f3059ef707","bookingId":"9b39b819-bbbd-4100-aaca-1e388346926e","duplicate":false,"initialStatus":"confirmed","durationMs":19234,"maskedEmail":"bo***b@example.com","maskedPhone":"********2051"}
[2025-11-15T10:04:21.330Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f8c9c05b-b15f-483a-8f22-d6f3059ef707","bookingId":"9b39b819-bbbd-4100-aaca-1e388346926e","reference":"UXTWQLVR9D","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:04:19.818Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5432,"attemptId":"511302c0-eef4-4424-89a9-d9d11a78fffa","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19234,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19892,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8d406907-e106-4795-8265-d33705c62de4","tableId":"e8674e36-181f-411c-9f9e-31ced7dfd6b8","tableNumber":"MD-02","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19892, max: 21336, avg: 20550.25, p95: 20957 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
