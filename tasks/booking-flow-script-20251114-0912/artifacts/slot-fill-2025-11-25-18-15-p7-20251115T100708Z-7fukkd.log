
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[2025-11-15T10:07:08.691Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e0716b59-0583-4c05-b05e-05948782f1d2","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:07:08.691Z] [INFO] [submit] Submitting booking request {"correlationId":"e0716b59-0583-4c05-b05e-05948782f1d2","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:07:27.780Z] [INFO] [submit] Booking created {"correlationId":"e0716b59-0583-4c05-b05e-05948782f1d2","bookingId":"39ea90e7-bd7b-44c4-b468-98e2427429c8","duplicate":false,"initialStatus":"confirmed","durationMs":19087,"maskedEmail":"bo***9@example.com","maskedPhone":"********6159"}
[2025-11-15T10:07:28.456Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e0716b59-0583-4c05-b05e-05948782f1d2","bookingId":"39ea90e7-bd7b-44c4-b468-98e2427429c8","reference":"DLELW2LTGW","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:07:25.528Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"14117090-3604-4629-b7b6-2c169f628287","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19087,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19764,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-08"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bed4581b-6882-4c22-bd93-b609c6c5086d","tableId":"51ef38e2-584c-4c98-b36d-695befcc0b06","tableNumber":"PT-08","zoneId":"bc275831-348d-4c25-9f89-4587d08bf684","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:07:28.456Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"52a52e60-efc8-4fb6-8440-4f44fd61e665","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:07:28.456Z] [INFO] [submit] Submitting booking request {"correlationId":"52a52e60-efc8-4fb6-8440-4f44fd61e665","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:07:49.350Z] [INFO] [submit] Booking created {"correlationId":"52a52e60-efc8-4fb6-8440-4f44fd61e665","bookingId":"9d150d93-32df-45ae-b4ce-26602b35bbc5","duplicate":false,"initialStatus":"confirmed","durationMs":20894,"maskedEmail":"bo***0@example.com","maskedPhone":"********2460"}
[2025-11-15T10:07:50.072Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"52a52e60-efc8-4fb6-8440-4f44fd61e665","bookingId":"9d150d93-32df-45ae-b4ce-26602b35bbc5","reference":"LH82JK8LQT","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:07:46.056Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"543071b7-3657-4e1a-90f3-292f59f75ad0","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20894,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21616,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-11"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5e909222-3b8c-44f3-aac5-50b82186dbc1","tableId":"eb772606-6096-46cf-984a-7c471a064ba8","tableNumber":"MD-11","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T10:07:50.074Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"36284199-d1fe-410e-8570-f544d6f93146","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:07:50.074Z] [INFO] [submit] Submitting booking request {"correlationId":"36284199-d1fe-410e-8570-f544d6f93146","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:08:10.057Z] [INFO] [submit] Booking created {"correlationId":"36284199-d1fe-410e-8570-f544d6f93146","bookingId":"09ac33eb-b191-4cb4-b653-7cf99e3f81b2","duplicate":false,"initialStatus":"confirmed","durationMs":19983,"maskedEmail":"bo***9@example.com","maskedPhone":"********4199"}
[2025-11-15T10:08:10.678Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"36284199-d1fe-410e-8570-f544d6f93146","bookingId":"09ac33eb-b191-4cb4-b653-7cf99e3f81b2","reference":"USU8MP4N7F","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:08:09.214Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5744,"attemptId":"b1df0722-c4b5-49e7-9a89-06f474463bf2","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19983,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20604,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-12"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"42b7e564-c58b-44a6-8ef4-32c1d0c72925","tableId":"8cdbd2b2-edf9-46ce-acc7-db8677681cdd","tableNumber":"MD-12","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T10:08:10.679Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bf025f85-8851-4455-b63d-3b32243186da","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:08:10.679Z] [INFO] [submit] Submitting booking request {"correlationId":"bf025f85-8851-4455-b63d-3b32243186da","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:08:29.890Z] [INFO] [submit] Booking created {"correlationId":"bf025f85-8851-4455-b63d-3b32243186da","bookingId":"4bf27fd4-1e4e-48ef-b7d0-d868474e6ecc","duplicate":false,"initialStatus":"confirmed","durationMs":19210,"maskedEmail":"bo***5@example.com","maskedPhone":"********5585"}
[2025-11-15T10:08:30.530Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bf025f85-8851-4455-b63d-3b32243186da","bookingId":"4bf27fd4-1e4e-48ef-b7d0-d868474e6ecc","reference":"J3ULJUCC5J","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:08:28.855Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5897,"attemptId":"d42d2f59-3778-4244-89d3-571d6be77225","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19210,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19851,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["PR-05"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c4b629ff-10c5-4aa8-b0e5-e3f016264feb","tableId":"4c5bdd24-d19a-4cd7-a0a6-2ea399474328","tableNumber":"PR-05","zoneId":"80e6af37-31b6-4412-a4de-c26cd7b9bc5a","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19764, max: 21616, avg: 20458.75, p95: 20604 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2.5, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-11', 'MD-12', 'PR-05', 'PT-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
