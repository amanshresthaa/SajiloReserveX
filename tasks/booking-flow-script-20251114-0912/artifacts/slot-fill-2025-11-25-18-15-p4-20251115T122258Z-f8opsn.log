
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2025-11-15T12:22:59.304Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2f43bad2-9cf4-44f7-ab6d-a80ec1a341f6","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:22:59.305Z] [INFO] [submit] Submitting booking request {"correlationId":"2f43bad2-9cf4-44f7-ab6d-a80ec1a341f6","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:23:20.002Z] [INFO] [submit] Booking created {"correlationId":"2f43bad2-9cf4-44f7-ab6d-a80ec1a341f6","bookingId":"1c75c578-2bae-489f-b479-bccf699d5af2","duplicate":false,"initialStatus":"pending","durationMs":20696,"maskedEmail":"bo***2@example.com","maskedPhone":"********1032"}
[2025-11-15T12:23:20.697Z] [INFO] [inline_poll] Status update {"correlationId":"2f43bad2-9cf4-44f7-ab6d-a80ec1a341f6","bookingId":"1c75c578-2bae-489f-b479-bccf699d5af2","attempt":1,"status":"pending","assignments":0,"elapsedMs":695}
[2025-11-15T12:23:34.841Z] [INFO] [inline_poll] Status update {"correlationId":"2f43bad2-9cf4-44f7-ab6d-a80ec1a341f6","bookingId":"1c75c578-2bae-489f-b479-bccf699d5af2","attempt":7,"status":"confirmed","assignments":1,"elapsedMs":14839}
[2025-11-15T12:23:34.842Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"2f43bad2-9cf4-44f7-ab6d-a80ec1a341f6","bookingId":"1c75c578-2bae-489f-b479-bccf699d5af2","reference":"GZWNBLCXLK","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:17.716Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"1d133e8d-6832-4220-85cb-62f5d39b53ac","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20696,"inlineAttempts":7,"inlineDurationMs":14840,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":35538,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"cc4b08eb-732d-4348-a7f1-229917749ef2","tableId":"a1e9526f-cf23-4d2c-8e3a-6d24a731690e","tableNumber":"BA-05","zoneId":"df5b5d2b-4d2a-494e-8a38-e488ab929043","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:34.843Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e0a67be4-5e76-4c9f-a805-6c3ddf7c4309","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:34.844Z] [INFO] [submit] Submitting booking request {"correlationId":"e0a67be4-5e76-4c9f-a805-6c3ddf7c4309","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:23:53.368Z] [INFO] [submit] Booking created {"correlationId":"e0a67be4-5e76-4c9f-a805-6c3ddf7c4309","bookingId":"569375b1-d685-4380-aa45-6922068dab27","duplicate":false,"initialStatus":"confirmed","durationMs":18522,"maskedEmail":"bo***4@example.com","maskedPhone":"********7144"}
[2025-11-15T12:23:54.041Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e0a67be4-5e76-4c9f-a805-6c3ddf7c4309","bookingId":"569375b1-d685-4380-aa45-6922068dab27","reference":"VBMZEWZVZQ","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:52.134Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"3d98eaf5-4d71-43ec-a088-28fe45f8edc4","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18522,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19198,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["MD-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"29a06d4f-f5a3-4571-a147-a0eadbda761c","tableId":"752c0b65-dfa1-4695-a308-9c2470c1ff5a","tableNumber":"MD-04","zoneId":"4749aafa-6ce9-492b-9f86-337b7cf8f8fe","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:54.045Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e994ccd3-768d-4ed1-925f-db11aff984dc","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:54.045Z] [INFO] [submit] Submitting booking request {"correlationId":"e994ccd3-768d-4ed1-925f-db11aff984dc","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:13.387Z] [INFO] [submit] Booking created {"correlationId":"e994ccd3-768d-4ed1-925f-db11aff984dc","bookingId":"01f709f9-cf73-4b66-8827-7487b9d4a0e9","duplicate":false,"initialStatus":"confirmed","durationMs":19339,"maskedEmail":"bo***3@example.com","maskedPhone":"********2233"}
[2025-11-15T12:24:14.025Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e994ccd3-768d-4ed1-925f-db11aff984dc","bookingId":"01f709f9-cf73-4b66-8827-7487b9d4a0e9","reference":"3WXMAWKWLP","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:11.984Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5120,"attemptId":"22ef9409-c44b-4b7e-93a6-da1658dd0be6","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19339,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19979,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["OG-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c6880ba2-01f8-49e1-aa1b-4cc131bf6e2f","tableId":"dd211bb5-034f-4def-8815-ee966f4efc02","tableNumber":"OG-02","zoneId":"1a2b5ba2-d745-40c7-98c7-1ca3bd20e530","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:24:14.025Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"eda4e2a1-44a1-4b9b-bdcc-de5b94189f69","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:24:14.025Z] [INFO] [submit] Submitting booking request {"correlationId":"eda4e2a1-44a1-4b9b-bdcc-de5b94189f69","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:32.876Z] [INFO] [submit] Booking created {"correlationId":"eda4e2a1-44a1-4b9b-bdcc-de5b94189f69","bookingId":"fe9d0496-c0ee-41ab-abd4-c17e752ee16e","duplicate":false,"initialStatus":"confirmed","durationMs":18851,"maskedEmail":"bo***1@example.com","maskedPhone":"********4201"}
[2025-11-15T12:24:33.537Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"eda4e2a1-44a1-4b9b-bdcc-de5b94189f69","bookingId":"fe9d0496-c0ee-41ab-abd4-c17e752ee16e","reference":"RA7NGM4EJF","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:31.615Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5525,"attemptId":"14a4f756-abfd-4582-a839-2a3856d29927","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18851,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19512,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["PR-02"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d70f429f-c8b7-4fa5-a0fd-7dbc1875a7d0","tableId":"a52ca0c3-3853-4676-96d7-c16fc4a80b74","tableNumber":"PR-02","zoneId":"f0b48046-a615-4595-93eb-ebe1f6e55f75","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19198, max: 35538, avg: 23556.75, p95: 19979 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-05', 'MD-04', 'OG-02', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
