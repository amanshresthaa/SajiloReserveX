
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[2025-11-15T10:42:03.641Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0432af38-0525-472c-afce-e77343f6f300","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:03.641Z] [INFO] [submit] Submitting booking request {"correlationId":"0432af38-0525-472c-afce-e77343f6f300","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:42:26.331Z] [INFO] [submit] Booking created {"correlationId":"0432af38-0525-472c-afce-e77343f6f300","bookingId":"0f1e1194-6a12-45b0-8f5e-58a734b5c15b","duplicate":false,"initialStatus":"confirmed","durationMs":22690,"maskedEmail":"bo***8@example.com","maskedPhone":"********0538"}
[2025-11-15T10:42:27.240Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0432af38-0525-472c-afce-e77343f6f300","bookingId":"0f1e1194-6a12-45b0-8f5e-58a734b5c15b","reference":"FMLETD6LCL","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:24.751Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5984,"attemptId":"519980d7-c3cd-4951-89f2-405164a887ea","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22690,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":23599,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"33a74a09-e356-4a2c-aab2-8585196c2ab9","tableId":"680c3ecd-7de3-4fac-8d5b-7fa6e36ace25","tableNumber":"BA-03","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:27.241Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"04338b1e-ccdb-4913-8ace-431358daa556","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:27.241Z] [INFO] [submit] Submitting booking request {"correlationId":"04338b1e-ccdb-4913-8ace-431358daa556","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:42:46.160Z] [INFO] [submit] Booking created {"correlationId":"04338b1e-ccdb-4913-8ace-431358daa556","bookingId":"2bb3e5fb-ae59-4c8b-9713-eecc18aa39fa","duplicate":false,"initialStatus":"confirmed","durationMs":18918,"maskedEmail":"bo***e@example.com","maskedPhone":"********8114"}
[2025-11-15T10:42:46.781Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"04338b1e-ccdb-4913-8ace-431358daa556","bookingId":"2bb3e5fb-ae59-4c8b-9713-eecc18aa39fa","reference":"9CH54HF7DE","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:44.437Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5293,"attemptId":"0262be00-e0ad-42ad-bb17-d0a1b1f2e1cc","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18918,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19540,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a8adca4c-ab3d-45bf-b35c-f02435f397b4","tableId":"2decc64e-05fd-4cc7-815f-cf4b09b90b70","tableNumber":"BA-04","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:46.782Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cfd2f093-eea7-45a4-ac24-2b5f8ff5309a","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:46.782Z] [INFO] [submit] Submitting booking request {"correlationId":"cfd2f093-eea7-45a4-ac24-2b5f8ff5309a","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:05.751Z] [INFO] [submit] Booking created {"correlationId":"cfd2f093-eea7-45a4-ac24-2b5f8ff5309a","bookingId":"2cbc90bf-7d09-45ec-8c2b-c7d9eb46f2e3","duplicate":false,"initialStatus":"confirmed","durationMs":18969,"maskedEmail":"bo***3@example.com","maskedPhone":"********5093"}
[2025-11-15T10:43:06.359Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cfd2f093-eea7-45a4-ac24-2b5f8ff5309a","bookingId":"2cbc90bf-7d09-45ec-8c2b-c7d9eb46f2e3","reference":"DPB4TR4YBY","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:04.229Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5022,"attemptId":"ff028b37-0028-4dd4-9d72-2b87722e87e6","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18969,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19577,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a382be8f-c6d2-4c2c-b19e-c5607289a772","tableId":"a703a32f-cb97-4002-87d8-768c686dcb04","tableNumber":"BA-05","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:43:06.360Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ef83cd34-92ed-4b78-8c56-b441919600ea","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:43:06.360Z] [INFO] [submit] Submitting booking request {"correlationId":"ef83cd34-92ed-4b78-8c56-b441919600ea","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:26.265Z] [INFO] [submit] Booking created {"correlationId":"ef83cd34-92ed-4b78-8c56-b441919600ea","bookingId":"6ddf029a-2afd-4b89-8b86-f245757ddc70","duplicate":false,"initialStatus":"confirmed","durationMs":19904,"maskedEmail":"bo***4@example.com","maskedPhone":"********2334"}
[2025-11-15T10:43:26.958Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ef83cd34-92ed-4b78-8c56-b441919600ea","bookingId":"6ddf029a-2afd-4b89-8b86-f245757ddc70","reference":"YL3SXG8WDL","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:25.008Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5151,"attemptId":"a1df42aa-ac30-49c8-aa1d-a0726516dac5","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19904,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20598,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a92e1bdc-c9a2-4cf3-b66c-0c45f553ef04","tableId":"9de54c32-848a-4869-a603-c4a054f3d5ae","tableNumber":"BA-06","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19540, max: 23599, avg: 20828.5, p95: 20598 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
