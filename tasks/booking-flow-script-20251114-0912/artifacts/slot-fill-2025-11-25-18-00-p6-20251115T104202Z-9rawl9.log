
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 6 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar
[2025-11-15T10:42:03.641Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b28bee4d-ec7b-41b3-83a4-26b631cad577","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:03.641Z] [INFO] [submit] Submitting booking request {"correlationId":"b28bee4d-ec7b-41b3-83a4-26b631cad577","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:42:26.174Z] [INFO] [submit] Booking created {"correlationId":"b28bee4d-ec7b-41b3-83a4-26b631cad577","bookingId":"e344814f-4911-4fa0-bd96-2f69ecd77dce","duplicate":false,"initialStatus":"pending","durationMs":22532,"maskedEmail":"bo***d@example.com","maskedPhone":"********4443"}
[2025-11-15T10:42:26.798Z] [INFO] [inline_poll] Status update {"correlationId":"b28bee4d-ec7b-41b3-83a4-26b631cad577","bookingId":"e344814f-4911-4fa0-bd96-2f69ecd77dce","attempt":1,"status":"pending","assignments":0,"elapsedMs":623}
[2025-11-15T10:42:36.097Z] [INFO] [inline_poll] Status update {"correlationId":"b28bee4d-ec7b-41b3-83a4-26b631cad577","bookingId":"e344814f-4911-4fa0-bd96-2f69ecd77dce","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9922}
[2025-11-15T10:42:36.098Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"b28bee4d-ec7b-41b3-83a4-26b631cad577","bookingId":"e344814f-4911-4fa0-bd96-2f69ecd77dce","reference":"96PWS2SY7X","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:23.741Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"9c2942f9-87a7-43a0-bdad-658cca6ce5e5","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22532,"inlineAttempts":5,"inlineDurationMs":9922,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":32456,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"3da5fa7d-0b9d-4198-b11c-4cea546eb142","tableId":"a9081c21-5fe8-4e9f-9557-9a0b235b5298","tableNumber":"BA-08","zoneId":"b03e7b0e-b537-4b70-aeaf-70a9ec758b0f","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:36.099Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b9d762e4-ba19-4c1a-899f-6581bb8fd4e7","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:36.099Z] [INFO] [submit] Submitting booking request {"correlationId":"b9d762e4-ba19-4c1a-899f-6581bb8fd4e7","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:42:54.615Z] [INFO] [submit] Booking created {"correlationId":"b9d762e4-ba19-4c1a-899f-6581bb8fd4e7","bookingId":"5dd422d6-eafb-4d82-b7a6-bcc4e722bd22","duplicate":false,"initialStatus":"confirmed","durationMs":18515,"maskedEmail":"bo***4@example.com","maskedPhone":"********6244"}
[2025-11-15T10:42:55.252Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b9d762e4-ba19-4c1a-899f-6581bb8fd4e7","bookingId":"5dd422d6-eafb-4d82-b7a6-bcc4e722bd22","reference":"NNTQUG5EGM","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:52.966Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5294,"attemptId":"f7c27a6e-a505-4faa-8cdf-d452c00d131c","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18515,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19153,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ed37e864-c0bb-43b6-abed-aca643edcdf1","tableId":"41270f63-7e76-4f2f-add7-c87d9023bf31","tableNumber":"MD-08","zoneId":"dce1381c-1e68-4040-9ed5-85411d27ddf9","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:55.254Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f52dcf18-ccc6-465b-92af-f8cba94c23b2","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:55.254Z] [INFO] [submit] Submitting booking request {"correlationId":"f52dcf18-ccc6-465b-92af-f8cba94c23b2","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:14.933Z] [INFO] [submit] Booking created {"correlationId":"f52dcf18-ccc6-465b-92af-f8cba94c23b2","bookingId":"bcd85b8e-86a7-490e-80b9-d5dde8203603","duplicate":false,"initialStatus":"confirmed","durationMs":19679,"maskedEmail":"bo***8@example.com","maskedPhone":"********2518"}
[2025-11-15T10:43:15.562Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f52dcf18-ccc6-465b-92af-f8cba94c23b2","bookingId":"bcd85b8e-86a7-490e-80b9-d5dde8203603","reference":"B4E6834B5L","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:13.042Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5429,"attemptId":"99bcda15-de3f-4685-80be-313d095c84eb","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19679,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20308,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-05"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f98fc3c6-ea6a-43b2-9201-368ac8e740b4","tableId":"c6503c3d-56e0-42ad-9b15-c90da24f1c52","tableNumber":"OG-05","zoneId":"c56cf6aa-f668-4a9f-881a-70e041656051","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:43:15.562Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"594ae767-17be-4c35-bb50-f5df34224068","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:43:15.562Z] [INFO] [submit] Submitting booking request {"correlationId":"594ae767-17be-4c35-bb50-f5df34224068","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:35.756Z] [INFO] [submit] Booking created {"correlationId":"594ae767-17be-4c35-bb50-f5df34224068","bookingId":"26fdbb37-4543-4480-9aaa-9464274d6fa6","duplicate":false,"initialStatus":"confirmed","durationMs":20193,"maskedEmail":"bo***7@example.com","maskedPhone":"********4767"}
[2025-11-15T10:43:36.576Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"594ae767-17be-4c35-bb50-f5df34224068","bookingId":"26fdbb37-4543-4480-9aaa-9464274d6fa6","reference":"6MU5FWUYRG","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:32.882Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"7a3ddde0-6041-4201-b6f2-15194b0977a2","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20193,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21014,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["PR-04"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4ccac486-2c20-4b01-b35a-624b95356ae9","tableId":"35265e5e-c22c-46f8-be02-d19874fcf7bf","tableNumber":"PR-04","zoneId":"15ba8e3c-544b-4536-a0a4-2978dd4606e6","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19153, max: 32456, avg: 23232.75, p95: 21014 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-08', 'MD-08', 'OG-05', 'PR-04' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
