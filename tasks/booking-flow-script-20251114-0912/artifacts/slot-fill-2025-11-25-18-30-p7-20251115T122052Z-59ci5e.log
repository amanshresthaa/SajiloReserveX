
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-15T12:20:52.672Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"985ca455-bc1d-414c-b5f7-1aa9bfab6937","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:52.672Z] [INFO] [submit] Submitting booking request {"correlationId":"985ca455-bc1d-414c-b5f7-1aa9bfab6937","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:21:11.404Z] [INFO] [submit] Booking created {"correlationId":"985ca455-bc1d-414c-b5f7-1aa9bfab6937","bookingId":"fc9b08a7-2088-415d-8ed3-92e60e307604","duplicate":false,"initialStatus":"confirmed","durationMs":18731,"maskedEmail":"bo***5@example.com","maskedPhone":"********0455"}
[2025-11-15T12:21:12.054Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"985ca455-bc1d-414c-b5f7-1aa9bfab6937","bookingId":"fc9b08a7-2088-415d-8ed3-92e60e307604","reference":"CBMQ4MHX2Z","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:21:10.485Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5447,"attemptId":"898a3b51-e9f3-407d-82df-a6ac7e4d469c","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":18731,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19382,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-02","OG-03"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"40170c50-795e-4db3-9bce-8852ef363675","tableId":"7b4972a3-21b5-4a8e-9113-da46fec51e73","tableNumber":"OG-02","zoneId":"eb340f0f-df1e-46fd-a236-f6c128205dbf","capacity":4,"startAt":null,"endAt":null},{"id":"a44bf130-f8aa-472d-8559-e4932c88d7e9","tableId":"a9cc452e-a792-4b5a-9f0b-c6c8157bd6f4","tableNumber":"OG-03","zoneId":"eb340f0f-df1e-46fd-a236-f6c128205dbf","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T12:21:12.055Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"94aeb7bf-111b-4655-a349-81743f88accf","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:21:12.055Z] [INFO] [submit] Submitting booking request {"correlationId":"94aeb7bf-111b-4655-a349-81743f88accf","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:21:31.222Z] [INFO] [submit] Booking created {"correlationId":"94aeb7bf-111b-4655-a349-81743f88accf","bookingId":"2edddff4-510c-4f02-9575-ddfc91b67b8f","duplicate":false,"initialStatus":"confirmed","durationMs":19165,"maskedEmail":"bo***f@example.com","maskedPhone":"********1715"}
[2025-11-15T12:21:31.942Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"94aeb7bf-111b-4655-a349-81743f88accf","bookingId":"2edddff4-510c-4f02-9575-ddfc91b67b8f","reference":"BQCDWFD776","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:21:30.031Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5444,"attemptId":"40bbbd6a-92e7-4d91-931f-e06662aeb726","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19165,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19886,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-11"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"53cd74c8-80cc-49ba-ab4d-fb44fd013a5f","tableId":"2afd4a15-e96f-433c-a184-742110c92ce0","tableNumber":"MD-11","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T12:21:31.943Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7c190c73-dc13-4faa-b250-a6ca1b2a4c72","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:21:31.943Z] [INFO] [submit] Submitting booking request {"correlationId":"7c190c73-dc13-4faa-b250-a6ca1b2a4c72","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:21:52.642Z] [INFO] [submit] Booking created {"correlationId":"7c190c73-dc13-4faa-b250-a6ca1b2a4c72","bookingId":"5665431b-4923-45e3-a663-638b57891cb0","duplicate":false,"initialStatus":"confirmed","durationMs":20697,"maskedEmail":"bo***3@example.com","maskedPhone":"********0273"}
[2025-11-15T12:21:53.271Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7c190c73-dc13-4faa-b250-a6ca1b2a4c72","bookingId":"5665431b-4923-45e3-a663-638b57891cb0","reference":"UR339N8VF5","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:21:50.115Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"ca6f3f65-0ed0-4622-ac59-d028e71de792","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20697,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21328,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-12"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e11db896-f4c6-49fe-9820-a41df7bcdcbb","tableId":"15a52a19-3636-49f4-ac8c-773d2ba69171","tableNumber":"MD-12","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T12:21:53.271Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5ee9c64b-5b3f-4e4f-91c9-fa1f275f4707","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:21:53.271Z] [INFO] [submit] Submitting booking request {"correlationId":"5ee9c64b-5b3f-4e4f-91c9-fa1f275f4707","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:22:13.179Z] [INFO] [submit] Booking created {"correlationId":"5ee9c64b-5b3f-4e4f-91c9-fa1f275f4707","bookingId":"70f159e8-bed4-4878-80b4-3d236766ce57","duplicate":false,"initialStatus":"pending","durationMs":19908,"maskedEmail":"bo***b@example.com","maskedPhone":"********2641"}
[2025-11-15T12:22:13.807Z] [INFO] [inline_poll] Status update {"correlationId":"5ee9c64b-5b3f-4e4f-91c9-fa1f275f4707","bookingId":"70f159e8-bed4-4878-80b4-3d236766ce57","attempt":1,"status":"pending","assignments":0,"elapsedMs":627}
[2025-11-15T12:22:23.129Z] [INFO] [inline_poll] Status update {"correlationId":"5ee9c64b-5b3f-4e4f-91c9-fa1f275f4707","bookingId":"70f159e8-bed4-4878-80b4-3d236766ce57","attempt":5,"status":"confirmed","assignments":2,"elapsedMs":9949}
[2025-11-15T12:22:23.130Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"5ee9c64b-5b3f-4e4f-91c9-fa1f275f4707","bookingId":"70f159e8-bed4-4878-80b4-3d236766ce57","reference":"CU4A3YZPW2","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:22:10.808Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"55120cf4-5201-43c0-b656-973002382974","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19908,"inlineAttempts":5,"inlineDurationMs":9949,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":29858,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PR-02","PR-01"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"39446949-b8dd-4780-937b-ac5e82896a47","tableId":"591ae989-0754-41eb-a93c-481b772aa422","tableNumber":"PR-02","zoneId":"cbbf85cd-fdfe-4f67-87a4-b3155007c474","capacity":4,"startAt":null,"endAt":null},{"id":"d9ff3c35-6f19-4a47-9c6c-6bae88b83a87","tableId":"71eaed57-5049-4d31-9aba-224618cf281c","tableNumber":"PR-01","zoneId":"cbbf85cd-fdfe-4f67-87a4-b3155007c474","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19382, max: 29858, avg: 22613.5, p95: 21328 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.5, p95: 2 },
  uniqueTables: [ 'MD-11', 'MD-12', 'OG-02', 'OG-03', 'PR-01', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
