
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[2025-11-15T10:04:21.990Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4e8b0274-4acc-45a8-9a96-b7f6f96378c9","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:04:21.990Z] [INFO] [submit] Submitting booking request {"correlationId":"4e8b0274-4acc-45a8-9a96-b7f6f96378c9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:04:40.887Z] [INFO] [submit] Booking created {"correlationId":"4e8b0274-4acc-45a8-9a96-b7f6f96378c9","bookingId":"6b48865e-c7ce-44b1-8f66-2fdb48ad3a83","duplicate":false,"initialStatus":"confirmed","durationMs":18896,"maskedEmail":"bo***4@example.com","maskedPhone":"********0274"}
[2025-11-15T10:04:41.518Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4e8b0274-4acc-45a8-9a96-b7f6f96378c9","bookingId":"6b48865e-c7ce-44b1-8f66-2fdb48ad3a83","reference":"4DQ8G6983V","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:04:39.594Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5395,"attemptId":"cc0f7c2c-595a-426c-bd4d-9519894eb72a","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":18896,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19528,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-09"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"3b441d17-d3ed-4efb-8fbe-a7e53d967973","tableId":"261c9c48-b13a-4ec5-9078-13a54477275b","tableNumber":"MD-09","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:04:41.519Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a3a70d52-c334-4d4d-9ab1-1b6ebbdb6693","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:04:41.519Z] [INFO] [submit] Submitting booking request {"correlationId":"a3a70d52-c334-4d4d-9ab1-1b6ebbdb6693","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:05:00.399Z] [INFO] [submit] Booking created {"correlationId":"a3a70d52-c334-4d4d-9ab1-1b6ebbdb6693","bookingId":"de6536d0-3190-4560-96a5-1b719e1c2656","duplicate":false,"initialStatus":"confirmed","durationMs":18879,"maskedEmail":"bo***2@example.com","maskedPhone":"********0352"}
[2025-11-15T10:05:01.052Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a3a70d52-c334-4d4d-9ab1-1b6ebbdb6693","bookingId":"de6536d0-3190-4560-96a5-1b719e1c2656","reference":"SL83PWPHS3","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:04:59.464Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5383,"attemptId":"91857810-9246-433e-9ddb-741ca1f219f6","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18879,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19533,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-10"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"73e69c61-b0ad-4a6e-9e96-7dd83dcf66c5","tableId":"685fc847-6aae-4198-8ac6-b987d13da2e7","tableNumber":"MD-10","zoneId":"74b23058-f095-4eb1-9746-3b23a6b17ee4","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:05:01.053Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e0b9cb2c-a43d-4433-b029-5a9943d9dace","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:05:01.054Z] [INFO] [submit] Submitting booking request {"correlationId":"e0b9cb2c-a43d-4433-b029-5a9943d9dace","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:05:21.274Z] [INFO] [submit] Booking created {"correlationId":"e0b9cb2c-a43d-4433-b029-5a9943d9dace","bookingId":"0944f237-8941-4433-b72f-9abc66ce72bc","duplicate":false,"initialStatus":"confirmed","durationMs":20220,"maskedEmail":"bo***c@example.com","maskedPhone":"********2122"}
[2025-11-15T10:05:21.864Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e0b9cb2c-a43d-4433-b029-5a9943d9dace","bookingId":"0944f237-8941-4433-b72f-9abc66ce72bc","reference":"EJV84Z36AB","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:05:18.654Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"a64ea8ba-7caf-4b3b-8d25-419bce478d96","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20220,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20811,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["OG-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"abb1a7e4-3585-46ee-a653-99cc1469aad0","tableId":"c384bc25-aba6-4dc1-980b-eb70c1532a2d","tableNumber":"OG-06","zoneId":"a10aa8f6-2298-4141-8ccf-1cf6818f2337","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:05:21.864Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8950f5dc-5d12-433f-80f5-c72e64435fe8","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:05:21.864Z] [INFO] [submit] Submitting booking request {"correlationId":"8950f5dc-5d12-433f-80f5-c72e64435fe8","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:05:41.115Z] [INFO] [submit] Booking created {"correlationId":"8950f5dc-5d12-433f-80f5-c72e64435fe8","bookingId":"49d43006-968d-4a5f-bfe9-6e5690693b35","duplicate":false,"initialStatus":"confirmed","durationMs":19251,"maskedEmail":"bo***c@example.com","maskedPhone":"********5532"}
[2025-11-15T10:05:41.775Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8950f5dc-5d12-433f-80f5-c72e64435fe8","bookingId":"49d43006-968d-4a5f-bfe9-6e5690693b35","reference":"56ZDQ7TB9F","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:05:40.340Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5389,"attemptId":"804f7610-33dc-45e1-ad7e-20c326ec4ac2","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19251,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19911,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-07"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a7f2aa78-39b4-43b1-8d49-a2b89231c584","tableId":"b60e5cca-dc5a-4aec-8fca-91632d988a66","tableNumber":"PT-07","zoneId":"bc275831-348d-4c25-9f89-4587d08bf684","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19528, max: 20811, avg: 19945.75, p95: 19911 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
