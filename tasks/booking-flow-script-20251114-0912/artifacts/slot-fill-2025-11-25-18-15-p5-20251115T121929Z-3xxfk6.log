
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[2025-11-15T12:19:30.527Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"55276968-fe16-440f-922a-d9827aab590c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:30.527Z] [INFO] [submit] Submitting booking request {"correlationId":"55276968-fe16-440f-922a-d9827aab590c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:19:51.306Z] [INFO] [submit] Booking created {"correlationId":"55276968-fe16-440f-922a-d9827aab590c","bookingId":"e878e887-070e-48bf-a29f-60e88dad74cc","duplicate":false,"initialStatus":"confirmed","durationMs":20777,"maskedEmail":"bo***8@example.com","maskedPhone":"********6968"}
[2025-11-15T12:19:51.990Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"55276968-fe16-440f-922a-d9827aab590c","bookingId":"e878e887-070e-48bf-a29f-60e88dad74cc","reference":"XMQJUZVDGN","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:19:50.144Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5652,"attemptId":"dcf4e3e9-200d-4255-a2b5-50fc46a71949","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20777,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21462,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"39dda217-aaff-425f-bf89-e04b61dbb8fc","tableId":"f9eda902-6239-4e36-8233-c102a458027d","tableNumber":"BA-07","zoneId":"14915a10-e151-4a4d-a2af-9557f57e9c9b","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:19:51.990Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e097a3a6-f0ed-4c92-9290-cfad363c8f46","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:51.990Z] [INFO] [submit] Submitting booking request {"correlationId":"e097a3a6-f0ed-4c92-9290-cfad363c8f46","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:10.693Z] [INFO] [submit] Booking created {"correlationId":"e097a3a6-f0ed-4c92-9290-cfad363c8f46","bookingId":"c5c3ef49-4245-4d4b-bbc7-361891c08d8f","duplicate":false,"initialStatus":"confirmed","durationMs":18702,"maskedEmail":"bo***6@example.com","maskedPhone":"********0306"}
[2025-11-15T12:20:11.357Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e097a3a6-f0ed-4c92-9290-cfad363c8f46","bookingId":"c5c3ef49-4245-4d4b-bbc7-361891c08d8f","reference":"WA3VWLXXA9","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:09.540Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5639,"attemptId":"bf928028-2e1d-4313-a326-a327cb25f6e6","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18702,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19367,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d23680e7-770b-4c16-804e-8aef9b38ff01","tableId":"56c51845-ece9-4804-af63-ed68084180de","tableNumber":"BA-08","zoneId":"14915a10-e151-4a4d-a2af-9557f57e9c9b","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:11.359Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"fddc2cf9-99a6-4156-a467-d1ce451293cb","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:11.359Z] [INFO] [submit] Submitting booking request {"correlationId":"fddc2cf9-99a6-4156-a467-d1ce451293cb","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:31.565Z] [INFO] [submit] Booking created {"correlationId":"fddc2cf9-99a6-4156-a467-d1ce451293cb","bookingId":"89965eb4-47bd-4658-95ba-c2945a9890c3","duplicate":false,"initialStatus":"confirmed","durationMs":20204,"maskedEmail":"bo***9@example.com","maskedPhone":"********2259"}
[2025-11-15T12:20:32.286Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"fddc2cf9-99a6-4156-a467-d1ce451293cb","bookingId":"89965eb4-47bd-4658-95ba-c2945a9890c3","reference":"X7VC5GUNCB","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:29.697Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"6e2d37cd-7d53-4afb-ba53-950ea146b699","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20204,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20927,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"1358f209-e7ce-4362-bfc5-95b4f8217e13","tableId":"483402e2-877c-4b85-b96b-c1db23cd3f23","tableNumber":"MD-07","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:32.287Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"8830115d-b98c-47ad-bd2c-4113fda8caa4","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:32.287Z] [INFO] [submit] Submitting booking request {"correlationId":"8830115d-b98c-47ad-bd2c-4113fda8caa4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:51.821Z] [INFO] [submit] Booking created {"correlationId":"8830115d-b98c-47ad-bd2c-4113fda8caa4","bookingId":"e4c419a6-f6e6-4e0f-9ce0-15b73e0d992f","duplicate":false,"initialStatus":"confirmed","durationMs":19533,"maskedEmail":"bo***d@example.com","maskedPhone":"********1153"}
[2025-11-15T12:20:52.432Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"8830115d-b98c-47ad-bd2c-4113fda8caa4","bookingId":"e4c419a6-f6e6-4e0f-9ce0-15b73e0d992f","reference":"ABVLXGZVZK","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:50.783Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5631,"attemptId":"9dca4adf-6ba3-4ff6-a729-1e946a0eecec","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19533,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20145,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"6abddd1e-6c56-4377-b06c-8d5fe8a13251","tableId":"54aed07b-5079-4785-9386-ff133c5584e4","tableNumber":"MD-08","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19367, max: 21462, avg: 20475.25, p95: 20927 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
