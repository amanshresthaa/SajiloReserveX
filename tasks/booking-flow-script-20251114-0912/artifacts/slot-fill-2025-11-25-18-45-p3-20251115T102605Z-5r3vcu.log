
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:45 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[2025-11-15T10:26:06.258Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"427fd5ba-3efe-475c-8b66-828863e822a3","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:26:06.258Z] [INFO] [submit] Submitting booking request {"correlationId":"427fd5ba-3efe-475c-8b66-828863e822a3","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:26:24.912Z] [INFO] [submit] Booking created {"correlationId":"427fd5ba-3efe-475c-8b66-828863e822a3","bookingId":"08f2267c-b3dc-4ecd-aaa6-fac3dd2bd8f8","duplicate":false,"initialStatus":"confirmed","durationMs":18653,"maskedEmail":"bo***a@example.com","maskedPhone":"********3510"}
[2025-11-15T10:26:25.557Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"427fd5ba-3efe-475c-8b66-828863e822a3","bookingId":"08f2267c-b3dc-4ecd-aaa6-fac3dd2bd8f8","reference":"P8PASZLCMC","bookingDate":"2025-11-25","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:26:24.151Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5575,"attemptId":"d85b4c57-1589-408c-be3c-087736705867","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":18653,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19298,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["OG-02"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7bb97176-3e03-4db9-95a3-99a037a41763","tableId":"a3f7b10f-98a0-48e5-894a-1f0573e3893b","tableNumber":"OG-02","zoneId":"7ba0e930-2095-4eb7-9bec-4002acb9a42f","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:26:25.557Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b4828476-c7eb-4e76-b5f8-87e26a4ebd9c","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:26:25.557Z] [INFO] [submit] Submitting booking request {"correlationId":"b4828476-c7eb-4e76-b5f8-87e26a4ebd9c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:26:45.840Z] [INFO] [submit] Booking created {"correlationId":"b4828476-c7eb-4e76-b5f8-87e26a4ebd9c","bookingId":"9fcc6b12-11de-4d44-85c2-a1ec3ac1d449","duplicate":false,"initialStatus":"confirmed","durationMs":20282,"maskedEmail":"bo***6@example.com","maskedPhone":"********8476"}
[2025-11-15T10:26:46.582Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b4828476-c7eb-4e76-b5f8-87e26a4ebd9c","bookingId":"9fcc6b12-11de-4d44-85c2-a1ec3ac1d449","reference":"FXYBM5ZUW6","bookingDate":"2025-11-25","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:26:45.103Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5907,"attemptId":"d21a0fd6-2800-467e-8785-8fefcc073c31","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20282,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21025,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["OG-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e2d3fbd6-0e02-41e7-abca-54a2180dd2ec","tableId":"b122cade-1216-41e8-840f-40244c508855","tableNumber":"OG-03","zoneId":"7ba0e930-2095-4eb7-9bec-4002acb9a42f","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:26:46.583Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1c9f6910-3223-4a24-b1e1-9a384c1a7964","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:26:46.584Z] [INFO] [submit] Submitting booking request {"correlationId":"1c9f6910-3223-4a24-b1e1-9a384c1a7964","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:27:06.691Z] [INFO] [submit] Booking created {"correlationId":"1c9f6910-3223-4a24-b1e1-9a384c1a7964","bookingId":"ffb6c465-b926-4cf5-b63b-5e042e36931f","duplicate":false,"initialStatus":"confirmed","durationMs":20107,"maskedEmail":"bo***0@example.com","maskedPhone":"********6910"}
[2025-11-15T10:27:07.336Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1c9f6910-3223-4a24-b1e1-9a384c1a7964","bookingId":"ffb6c465-b926-4cf5-b63b-5e042e36931f","reference":"69AQQHFT2K","bookingDate":"2025-11-25","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:27:04.011Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"a25309b5-11f4-458e-bc6a-fb75a3fa8a7e","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20107,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20753,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PR-01"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"74686da6-d601-4058-be68-29a75d8223b5","tableId":"d29fd6e8-bd4a-427b-b4ab-223d2ba1550c","tableNumber":"PR-01","zoneId":"157b8bf1-25b4-43fe-9388-5e42e8d2c36a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:27:07.337Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3d3c5f32-e631-45f2-9c42-20fbf0018d36","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:27:07.337Z] [INFO] [submit] Submitting booking request {"correlationId":"3d3c5f32-e631-45f2-9c42-20fbf0018d36","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:27:26.414Z] [INFO] [submit] Booking created {"correlationId":"3d3c5f32-e631-45f2-9c42-20fbf0018d36","bookingId":"25f3ca8c-5369-48ca-807f-fc15a947fd97","duplicate":false,"initialStatus":"confirmed","durationMs":19076,"maskedEmail":"bo***2@example.com","maskedPhone":"********5532"}
[2025-11-15T10:27:27.022Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3d3c5f32-e631-45f2-9c42-20fbf0018d36","bookingId":"25f3ca8c-5369-48ca-807f-fc15a947fd97","reference":"GGVW4UHY63","bookingDate":"2025-11-25","startTime":"18:45:00","endTime":"20:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:27:25.625Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5361,"attemptId":"66d59631-b978-428a-8cde-99da8b503f6b","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19076,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19685,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["PR-02"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5f355f52-0204-4bf7-ab24-4bf89890e0a8","tableId":"ba430136-903e-4079-8a0c-d5a3e886024a","tableNumber":"PR-02","zoneId":"157b8bf1-25b4-43fe-9388-5e42e8d2c36a","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19298, max: 21025, avg: 20190.25, p95: 20753 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-02', 'OG-03', 'PR-01', 'PR-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
