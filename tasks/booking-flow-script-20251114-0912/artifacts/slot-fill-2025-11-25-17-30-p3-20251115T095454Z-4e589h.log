
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 3 --stress --stress-max 6 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2025-11-15T09:54:55.567Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e4d7ea88-b253-499f-bfb6-424f4c9775ac","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:54:55.567Z] [INFO] [submit] Submitting booking request {"correlationId":"e4d7ea88-b253-499f-bfb6-424f4c9775ac","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T09:55:16.964Z] [INFO] [submit] Booking created {"correlationId":"e4d7ea88-b253-499f-bfb6-424f4c9775ac","bookingId":"4656929c-0d53-42d6-a1e3-d6872c4f74a6","duplicate":false,"initialStatus":"confirmed","durationMs":21397,"maskedEmail":"bo***8@example.com","maskedPhone":"********4088"}
[2025-11-15T09:55:17.583Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e4d7ea88-b253-499f-bfb6-424f4c9775ac","bookingId":"4656929c-0d53-42d6-a1e3-d6872c4f74a6","reference":"ZWTZTGVFBP","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:55:14.459Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"1249d455-e81f-4f88-868e-6aa578aa611e","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21397,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22016,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"f2af624e-68bb-45d9-867a-68799bed592d","tableId":"e261f8b9-f80e-4e6c-940b-49f774c0eadb","tableNumber":"BA-03","zoneId":"28bc8656-13fa-4a48-be86-9c7812f5a197","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T09:55:17.584Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4016dbb7-839b-4da0-8702-745f785c555f","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:55:17.584Z] [INFO] [submit] Submitting booking request {"correlationId":"4016dbb7-839b-4da0-8702-745f785c555f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:55:36.241Z] [INFO] [submit] Booking created {"correlationId":"4016dbb7-839b-4da0-8702-745f785c555f","bookingId":"db53fd5d-dc3b-4d3a-9147-3a3afc72cac4","duplicate":false,"initialStatus":"confirmed","durationMs":18656,"maskedEmail":"bo***7@example.com","maskedPhone":"********3117"}
[2025-11-15T09:55:37.163Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4016dbb7-839b-4da0-8702-745f785c555f","bookingId":"db53fd5d-dc3b-4d3a-9147-3a3afc72cac4","reference":"HCYU92SYCG","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:55:35.135Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5395,"attemptId":"458491ba-55ae-43e5-93d9-13e457ed9c7a","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18656,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19579,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"315c3665-a1c6-4660-991d-f9e08fe1d452","tableId":"bf5624e6-0661-481a-bcca-1bd5d0e2c420","tableNumber":"BA-04","zoneId":"28bc8656-13fa-4a48-be86-9c7812f5a197","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T09:55:37.163Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2e1eeed3-16b4-46d6-a493-bc3477dfd649","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:55:37.163Z] [INFO] [submit] Submitting booking request {"correlationId":"2e1eeed3-16b4-46d6-a493-bc3477dfd649","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:55:56.546Z] [INFO] [submit] Booking created {"correlationId":"2e1eeed3-16b4-46d6-a493-bc3477dfd649","bookingId":"b0aaa72b-e53d-48db-859c-cf93e35b2536","duplicate":false,"initialStatus":"confirmed","durationMs":19383,"maskedEmail":"bo***3@example.com","maskedPhone":"********4433"}
[2025-11-15T09:55:57.253Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2e1eeed3-16b4-46d6-a493-bc3477dfd649","bookingId":"b0aaa72b-e53d-48db-859c-cf93e35b2536","reference":"659GHJKDYN","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:55:55.784Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5393,"attemptId":"de1d0083-ece0-4a97-a6da-7cd8a0f19412","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19383,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20090,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"91c5cd3e-235a-44f5-915c-2bcd58a839bf","tableId":"b8258dde-6cf7-4f06-860f-6760453160eb","tableNumber":"BA-05","zoneId":"28bc8656-13fa-4a48-be86-9c7812f5a197","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T09:55:57.253Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"92640e73-83ed-46bc-9364-75e77bc011b5","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:55:57.253Z] [INFO] [submit] Submitting booking request {"correlationId":"92640e73-83ed-46bc-9364-75e77bc011b5","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:56:17.586Z] [INFO] [submit] Booking created {"correlationId":"92640e73-83ed-46bc-9364-75e77bc011b5","bookingId":"5ab80358-4bd6-4ee9-8e77-1dd83cc2998d","duplicate":false,"initialStatus":"confirmed","durationMs":20333,"maskedEmail":"bo***3@example.com","maskedPhone":"********0473"}
[2025-11-15T09:56:18.311Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"92640e73-83ed-46bc-9364-75e77bc011b5","bookingId":"5ab80358-4bd6-4ee9-8e77-1dd83cc2998d","reference":"78ZJMPJJTX","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:56:16.678Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5655,"attemptId":"a10221e7-af84-4223-aa05-bfea3cd2fa4a","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20333,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21058,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"06f7b536-4b7a-44ab-b922-8a31108c0661","tableId":"d9e56d7c-734b-4c4a-b50a-fcfcdc3afd2c","tableNumber":"BA-06","zoneId":"28bc8656-13fa-4a48-be86-9c7812f5a197","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T09:56:18.311Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"c6270809-4cfe-4d48-8c21-ba562bd7ef74","bookingId":null,"iteration":5,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:56:18.311Z] [INFO] [submit] Submitting booking request {"correlationId":"c6270809-4cfe-4d48-8c21-ba562bd7ef74","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:56:37.347Z] [INFO] [submit] Booking created {"correlationId":"c6270809-4cfe-4d48-8c21-ba562bd7ef74","bookingId":"082157dd-a414-44ea-a1b9-a1af63a17a93","duplicate":false,"initialStatus":"confirmed","durationMs":19035,"maskedEmail":"bo***9@example.com","maskedPhone":"********0809"}
[2025-11-15T09:56:37.991Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"c6270809-4cfe-4d48-8c21-ba562bd7ef74","bookingId":"082157dd-a414-44ea-a1b9-a1af63a17a93","reference":"T8B7C3MPQ8","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:56:36.643Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5559,"attemptId":"659147c9-9eb7-4b74-aa70-34b811325420","emailSent":true,"emailVariant":"standard"},"iteration":5,"submitDurationMs":19035,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19680,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"762476c5-c74b-426c-bfa6-a39fa6d279af","tableId":"6e4dc290-d4a7-4fb2-93d6-cb0269a1892f","tableNumber":"MD-03","zoneId":"f72b1367-3da5-48b2-9469-97885d1fae9e","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T09:56:37.991Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bfde6cf7-31db-48be-aaf7-c5e1a7ed6b3b","bookingId":null,"iteration":6,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:56:37.991Z] [INFO] [submit] Submitting booking request {"correlationId":"bfde6cf7-31db-48be-aaf7-c5e1a7ed6b3b","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:56:58.810Z] [INFO] [submit] Booking created {"correlationId":"bfde6cf7-31db-48be-aaf7-c5e1a7ed6b3b","bookingId":"f77644b2-6821-4c9a-954d-917d654fae1a","duplicate":false,"initialStatus":"confirmed","durationMs":20819,"maskedEmail":"bo***7@example.com","maskedPhone":"********6257"}
[2025-11-15T09:56:59.735Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bfde6cf7-31db-48be-aaf7-c5e1a7ed6b3b","bookingId":"f77644b2-6821-4c9a-954d-917d654fae1a","reference":"3QTQTQAKVC","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:56:56.075Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"1ec82e72-b81e-49ad-b208-89cd23e4600e","emailSent":false,"emailVariant":"standard"},"iteration":6,"submitDurationMs":20819,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21744,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"409aa8ff-e2a2-45f2-9888-6820d9628b20","tableId":"71ae7858-caae-4e71-9c41-14bf99a86cc7","tableNumber":"MD-04","zoneId":"f72b1367-3da5-48b2-9469-97885d1fae9e","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 6,
  successes: 6,
  failures: 0,
  maxRuns: 6,
  completedTarget: true,
  durationMs: { count: 6, min: 19579, max: 22016, avg: 20694.5, p95: 21744 },
  seatWaste: { count: 6, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 6, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06', 'MD-03', 'MD-04' ]
}
‚úÖ Stress run completed 6 booking(s) without failure.
