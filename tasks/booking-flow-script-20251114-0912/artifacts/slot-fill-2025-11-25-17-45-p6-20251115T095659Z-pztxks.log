
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 6 --stress --stress-max 6 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[2025-11-15T09:57:00.417Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3806c50e-1faf-4924-912b-62fee7ae403a","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:57:00.417Z] [INFO] [submit] Submitting booking request {"correlationId":"3806c50e-1faf-4924-912b-62fee7ae403a","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T09:57:19.884Z] [INFO] [submit] Booking created {"correlationId":"3806c50e-1faf-4924-912b-62fee7ae403a","bookingId":"b137326c-2e0a-49e7-af77-73ce678dbb86","duplicate":false,"initialStatus":"confirmed","durationMs":19466,"maskedEmail":"bo***e@example.com","maskedPhone":"********2504"}
[2025-11-15T09:57:20.495Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3806c50e-1faf-4924-912b-62fee7ae403a","bookingId":"b137326c-2e0a-49e7-af77-73ce678dbb86","reference":"7L3YBAXNBU","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:57:18.960Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5624,"attemptId":"00499402-bde4-4053-b4a2-9a07788930e6","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19466,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20078,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8632d21b-c966-4482-973f-d092b6ea8eb7","tableId":"1d177295-7eaf-4e10-bd39-b2b116e87386","tableNumber":"BA-07","zoneId":"28bc8656-13fa-4a48-be86-9c7812f5a197","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T09:57:20.496Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"27e917c7-cb1a-4a13-9c93-42dece93c8d4","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:57:20.496Z] [INFO] [submit] Submitting booking request {"correlationId":"27e917c7-cb1a-4a13-9c93-42dece93c8d4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:57:40.403Z] [INFO] [submit] Booking created {"correlationId":"27e917c7-cb1a-4a13-9c93-42dece93c8d4","bookingId":"9c3c1e00-9b5a-4ffd-bdda-ec2b4dced9de","duplicate":false,"initialStatus":"confirmed","durationMs":19907,"maskedEmail":"bo***7@example.com","maskedPhone":"********1727"}
[2025-11-15T09:57:41.037Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"27e917c7-cb1a-4a13-9c93-42dece93c8d4","bookingId":"9c3c1e00-9b5a-4ffd-bdda-ec2b4dced9de","reference":"ELKCSCE9M6","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:57:37.407Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"ec56e7cc-82c5-4675-ba25-2725fc2c8075","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19907,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20541,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["BA-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ea7abc2a-8c73-46d4-b873-d7be7b43509b","tableId":"5a0ff445-d3e9-452a-9554-11cd8c898d97","tableNumber":"BA-08","zoneId":"28bc8656-13fa-4a48-be86-9c7812f5a197","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T09:57:41.038Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"05fb3ebc-fd92-4a66-8060-8e2def7131aa","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:57:41.038Z] [INFO] [submit] Submitting booking request {"correlationId":"05fb3ebc-fd92-4a66-8060-8e2def7131aa","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:58:00.843Z] [INFO] [submit] Booking created {"correlationId":"05fb3ebc-fd92-4a66-8060-8e2def7131aa","bookingId":"0f41eaf3-242b-4df5-8466-28e5f8c30ce8","duplicate":false,"initialStatus":"confirmed","durationMs":19805,"maskedEmail":"bo***c@example.com","maskedPhone":"********3412"}
[2025-11-15T09:58:01.493Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"05fb3ebc-fd92-4a66-8060-8e2def7131aa","bookingId":"0f41eaf3-242b-4df5-8466-28e5f8c30ce8","reference":"DPWPP72FAL","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:57:58.223Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"da764069-f3b1-4b68-9150-1405ee259ddd","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19805,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20455,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-07"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"97d6e240-fe44-4ecf-a9f0-2b532d1fd481","tableId":"958a4ba7-2258-427c-9a7b-671af48f82fa","tableNumber":"MD-07","zoneId":"f72b1367-3da5-48b2-9469-97885d1fae9e","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T09:58:01.493Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"12410830-f414-4336-af3a-d9dcb1ce70f4","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:58:01.493Z] [INFO] [submit] Submitting booking request {"correlationId":"12410830-f414-4336-af3a-d9dcb1ce70f4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:58:21.642Z] [INFO] [submit] Booking created {"correlationId":"12410830-f414-4336-af3a-d9dcb1ce70f4","bookingId":"0f0bcc22-9a32-4960-9c71-323f42b09d7b","duplicate":false,"initialStatus":"confirmed","durationMs":20148,"maskedEmail":"bo***0@example.com","maskedPhone":"********0830"}
[2025-11-15T09:58:22.273Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"12410830-f414-4336-af3a-d9dcb1ce70f4","bookingId":"0f0bcc22-9a32-4960-9c71-323f42b09d7b","reference":"97Y9YNUHBH","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:58:20.630Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5496,"attemptId":"d7165940-0279-42ec-99cc-f4445f1ff90b","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20148,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20780,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["MD-08"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a247896a-1d93-430e-a399-6213343d7b63","tableId":"8aa7f51a-a000-4792-919d-a956a696fec9","tableNumber":"MD-08","zoneId":"f72b1367-3da5-48b2-9469-97885d1fae9e","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T09:58:22.273Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"56f749d5-63ee-4335-9ebf-d0b000d92dc4","bookingId":null,"iteration":5,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:58:22.273Z] [INFO] [submit] Submitting booking request {"correlationId":"56f749d5-63ee-4335-9ebf-d0b000d92dc4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:58:41.812Z] [INFO] [submit] Booking created {"correlationId":"56f749d5-63ee-4335-9ebf-d0b000d92dc4","bookingId":"6babb0ec-44f6-4857-8d35-58570fe5d449","duplicate":false,"initialStatus":"confirmed","durationMs":19539,"maskedEmail":"bo***5@example.com","maskedPhone":"********4935"}
[2025-11-15T09:58:42.574Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"56f749d5-63ee-4335-9ebf-d0b000d92dc4","bookingId":"6babb0ec-44f6-4857-8d35-58570fe5d449","reference":"EGRATQKA57","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:58:40.690Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5933,"attemptId":"b1809273-ff9c-47ec-971c-c6308d67fa1a","emailSent":true,"emailVariant":"standard"},"iteration":5,"submitDurationMs":19539,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20301,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-04"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"95ea043f-2059-4e54-ace1-a957415604a5","tableId":"79161610-eb56-4cbc-8956-1b4ade9ac5d3","tableNumber":"OG-04","zoneId":"98af5e98-f6d2-409d-a3b1-5f6dd04fb0ce","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T09:58:42.575Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5a3455b2-db02-418a-b251-e3b22512d705","bookingId":null,"iteration":6,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T09:58:42.575Z] [INFO] [submit] Submitting booking request {"correlationId":"5a3455b2-db02-418a-b251-e3b22512d705","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T09:59:02.428Z] [INFO] [submit] Booking created {"correlationId":"5a3455b2-db02-418a-b251-e3b22512d705","bookingId":"c77cc24e-4cca-49df-a5c6-3fe9b1086eb5","duplicate":false,"initialStatus":"confirmed","durationMs":19853,"maskedEmail":"bo***2@example.com","maskedPhone":"********5512"}
[2025-11-15T09:59:03.086Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5a3455b2-db02-418a-b251-e3b22512d705","bookingId":"c77cc24e-4cca-49df-a5c6-3fe9b1086eb5","reference":"BLB2W966XX","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T09:59:00.039Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"483ba15d-0d3d-4295-a3ca-b8841e8daf83","emailSent":false,"emailVariant":"standard"},"iteration":6,"submitDurationMs":19853,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20511,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-05"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"59fd5190-169d-4898-b715-db356945903e","tableId":"a766033a-c448-442b-9986-1fc398db3ee6","tableNumber":"OG-05","zoneId":"98af5e98-f6d2-409d-a3b1-5f6dd04fb0ce","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 6,
  successes: 6,
  failures: 0,
  maxRuns: 6,
  completedTarget: true,
  durationMs: {
    count: 6,
    min: 20078,
    max: 20780,
    avg: 20444.333333333332,
    p95: 20541
  },
  seatWaste: { count: 6, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 6, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08', 'OG-04', 'OG-05' ]
}
‚úÖ Stress run completed 6 booking(s) without failure.
