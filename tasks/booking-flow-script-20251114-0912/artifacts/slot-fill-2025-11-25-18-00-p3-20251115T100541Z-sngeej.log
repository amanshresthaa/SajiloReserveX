
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-15T10:05:42.415Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"af537f3a-6bd8-4ae3-b725-51236203f189","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:05:42.415Z] [INFO] [submit] Submitting booking request {"correlationId":"af537f3a-6bd8-4ae3-b725-51236203f189","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:06:02.402Z] [INFO] [submit] Booking created {"correlationId":"af537f3a-6bd8-4ae3-b725-51236203f189","bookingId":"a0c8665b-8a43-4ee8-a034-77ea4ee1d1ac","duplicate":false,"initialStatus":"confirmed","durationMs":19985,"maskedEmail":"bo***a@example.com","maskedPhone":"********7530"}
[2025-11-15T10:06:03.150Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"af537f3a-6bd8-4ae3-b725-51236203f189","bookingId":"a0c8665b-8a43-4ee8-a034-77ea4ee1d1ac","reference":"3VG85ASKBE","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:06:01.559Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5520,"attemptId":"cd8de36b-eb16-45af-b475-e707cc235ada","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19985,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20734,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"23ceb88e-dee5-4796-abdc-3ea47fef3201","tableId":"7d8a1c3a-550e-4a4f-a660-e03d76a16efe","tableNumber":"BA-03","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:06:03.150Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d3e42c57-9cf8-4420-8ccc-bc62f2ea84fa","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:06:03.151Z] [INFO] [submit] Submitting booking request {"correlationId":"d3e42c57-9cf8-4420-8ccc-bc62f2ea84fa","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:06:24.460Z] [INFO] [submit] Booking created {"correlationId":"d3e42c57-9cf8-4420-8ccc-bc62f2ea84fa","bookingId":"8a0fcb88-a2f2-493b-b250-4ede464fbd89","duplicate":false,"initialStatus":"confirmed","durationMs":21308,"maskedEmail":"bo***7@example.com","maskedPhone":"********2257"}
[2025-11-15T10:06:25.278Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"d3e42c57-9cf8-4420-8ccc-bc62f2ea84fa","bookingId":"8a0fcb88-a2f2-493b-b250-4ede464fbd89","reference":"6BWDX7B6PC","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:06:23.383Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5642,"attemptId":"5ac19c59-4ee3-4de2-8ba6-70442edcf112","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":21308,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22127,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"de99dd6c-1c2e-4e82-84b9-e3c3ebd5b9e9","tableId":"42aa5acd-51a4-4f1c-a943-abd860663372","tableNumber":"BA-04","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:06:25.279Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"82c8cef0-1f35-4d49-8e5e-adb495fbe01e","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:06:25.279Z] [INFO] [submit] Submitting booking request {"correlationId":"82c8cef0-1f35-4d49-8e5e-adb495fbe01e","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:06:46.649Z] [INFO] [submit] Booking created {"correlationId":"82c8cef0-1f35-4d49-8e5e-adb495fbe01e","bookingId":"a86ba29a-a183-4655-82a3-9d2f1060a1c0","duplicate":false,"initialStatus":"confirmed","durationMs":21369,"maskedEmail":"bo***0@example.com","maskedPhone":"********2450"}
[2025-11-15T10:06:47.326Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"82c8cef0-1f35-4d49-8e5e-adb495fbe01e","bookingId":"a86ba29a-a183-4655-82a3-9d2f1060a1c0","reference":"JYDKARCZQ5","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:06:43.793Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"34ed2eb6-036e-4a09-9dbc-7022e897276b","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":21369,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22047,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4d6f0f54-8adb-4bad-b2e5-a9cbd0e45f98","tableId":"6308eaa4-1b67-4697-a7b1-ddd71e35dcb1","tableNumber":"BA-05","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:06:47.327Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"fb03a5c7-ea4a-4ccd-843f-cec99c11c37f","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:06:47.327Z] [INFO] [submit] Submitting booking request {"correlationId":"fb03a5c7-ea4a-4ccd-843f-cec99c11c37f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:07:07.430Z] [INFO] [submit] Booking created {"correlationId":"fb03a5c7-ea4a-4ccd-843f-cec99c11c37f","bookingId":"89be4786-ce4b-4cee-9867-647c35988e96","duplicate":false,"initialStatus":"confirmed","durationMs":20102,"maskedEmail":"bo***7@example.com","maskedPhone":"********0527"}
[2025-11-15T10:07:08.051Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"fb03a5c7-ea4a-4ccd-843f-cec99c11c37f","bookingId":"89be4786-ce4b-4cee-9867-647c35988e96","reference":"B6QSYH4QLS","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:07:06.344Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5795,"attemptId":"a740c213-b486-4a16-a78e-c75a25acac6b","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20102,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20724,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d30300b0-24a7-4615-8b52-2ab65100d7a8","tableId":"3dcc6ba2-a603-4fbb-bc1b-19cfa8e29200","tableNumber":"BA-06","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20724, max: 22127, avg: 21408, p95: 22047 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
