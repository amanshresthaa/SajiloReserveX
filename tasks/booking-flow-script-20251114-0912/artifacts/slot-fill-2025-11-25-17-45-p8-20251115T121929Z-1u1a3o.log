
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2025-11-15T12:19:30.520Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"904fd4c8-a537-4cdc-b291-262229551a74","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:30.520Z] [INFO] [submit] Submitting booking request {"correlationId":"904fd4c8-a537-4cdc-b291-262229551a74","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:19:51.682Z] [INFO] [submit] Booking created {"correlationId":"904fd4c8-a537-4cdc-b291-262229551a74","bookingId":"e78f8bbf-3a8f-42b4-aeb4-e7c281dbed8d","duplicate":false,"initialStatus":"confirmed","durationMs":21161,"maskedEmail":"bo***8@example.com","maskedPhone":"********3428"}
[2025-11-15T12:19:52.313Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"904fd4c8-a537-4cdc-b291-262229551a74","bookingId":"e78f8bbf-3a8f-42b4-aeb4-e7c281dbed8d","reference":"E5H2X6SVUS","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:19:49.442Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"b9fba9e1-a0c5-4c77-8757-bbeeed4af851","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21161,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21792,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-09"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"431338b3-5102-4198-a632-4127c07d3ad4","tableId":"7ede1619-b3d0-4d7c-a722-01db7cd3bcbe","tableNumber":"MD-09","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:19:52.314Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2c33a7d4-997c-49ee-b8ad-7963612201e1","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:19:52.314Z] [INFO] [submit] Submitting booking request {"correlationId":"2c33a7d4-997c-49ee-b8ad-7963612201e1","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:11.352Z] [INFO] [submit] Booking created {"correlationId":"2c33a7d4-997c-49ee-b8ad-7963612201e1","bookingId":"9e38187f-a006-4c8a-b7d1-56ec8ead032c","duplicate":false,"initialStatus":"confirmed","durationMs":19037,"maskedEmail":"bo***4@example.com","maskedPhone":"********0734"}
[2025-11-15T12:20:12.003Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2c33a7d4-997c-49ee-b8ad-7963612201e1","bookingId":"9e38187f-a006-4c8a-b7d1-56ec8ead032c","reference":"GCNV4VKCR9","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:09.811Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5511,"attemptId":"7b295410-ec60-4348-a16d-bfc5b1f2fd88","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19037,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19689,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["OG-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"411cffd6-2d42-4683-9290-141971943a29","tableId":"9d3478f1-dc09-4b8e-bea9-303e1d52f980","tableNumber":"OG-06","zoneId":"eb340f0f-df1e-46fd-a236-f6c128205dbf","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:12.005Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"05858f57-a0a8-4bc4-9a04-4ee9d89d45c7","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:12.005Z] [INFO] [submit] Submitting booking request {"correlationId":"05858f57-a0a8-4bc4-9a04-4ee9d89d45c7","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:31.889Z] [INFO] [submit] Booking created {"correlationId":"05858f57-a0a8-4bc4-9a04-4ee9d89d45c7","bookingId":"13054429-ee3d-4fda-8e4e-0fd3f584feaa","duplicate":false,"initialStatus":"confirmed","durationMs":19883,"maskedEmail":"bo***7@example.com","maskedPhone":"********8557"}
[2025-11-15T12:20:32.622Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"05858f57-a0a8-4bc4-9a04-4ee9d89d45c7","bookingId":"13054429-ee3d-4fda-8e4e-0fd3f584feaa","reference":"SDFCWKA9KR","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:31.578Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5912,"attemptId":"f90aeb4e-de48-41da-8cb5-f47fa3bca522","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19883,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20617,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-08"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"33a873ac-f8cf-4269-be7b-c089601dda07","tableId":"5c480ff3-3fcc-4db1-abc1-ae87f53259a5","tableNumber":"PT-08","zoneId":"ac2bb419-063a-4997-87a6-f0cbf29d7150","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T12:20:32.623Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"57bb4556-69f4-45ee-8b62-672e146e9f99","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:20:32.623Z] [INFO] [submit] Submitting booking request {"correlationId":"57bb4556-69f4-45ee-8b62-672e146e9f99","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:20:51.502Z] [INFO] [submit] Booking created {"correlationId":"57bb4556-69f4-45ee-8b62-672e146e9f99","bookingId":"d5acb67b-e4da-4d64-a928-5be4bc38ba6c","duplicate":false,"initialStatus":"confirmed","durationMs":18878,"maskedEmail":"bo***6@example.com","maskedPhone":"********4556"}
[2025-11-15T12:20:52.122Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"57bb4556-69f4-45ee-8b62-672e146e9f99","bookingId":"d5acb67b-e4da-4d64-a928-5be4bc38ba6c","reference":"LV8762LASY","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:20:50.173Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5202,"attemptId":"aa121424-06b4-4aa0-b3fb-9a8d208bffe4","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18878,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19499,"tablesAssigned":2,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-05","MD-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7ee7e146-e25e-4b82-a5c9-fcbc4d0ff79b","tableId":"49b9edd0-f47e-481e-a888-f663f8ba2ce5","tableNumber":"MD-05","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":4,"startAt":null,"endAt":null},{"id":"49f28699-dbed-4ef4-9188-d504dae53871","tableId":"ee257a77-f86a-4400-9f69-f2ef78896fb4","tableNumber":"MD-06","zoneId":"9666080e-8d18-416c-815e-5d5e29f7ad54","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19499, max: 21792, avg: 20399.25, p95: 20617 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.25, p95: 1 },
  uniqueTables: [ 'MD-05', 'MD-06', 'MD-09', 'OG-06', 'PT-08' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
