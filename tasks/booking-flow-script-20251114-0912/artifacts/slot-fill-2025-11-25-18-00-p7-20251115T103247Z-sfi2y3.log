
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[2025-11-15T10:32:48.141Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"440de317-ff68-4f10-9486-2257ba42d9b5","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:32:48.141Z] [INFO] [submit] Submitting booking request {"correlationId":"440de317-ff68-4f10-9486-2257ba42d9b5","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:33:07.967Z] [INFO] [submit] Booking created {"correlationId":"440de317-ff68-4f10-9486-2257ba42d9b5","bookingId":"f4059600-e62f-451d-895a-c928b9188350","duplicate":false,"initialStatus":"confirmed","durationMs":19824,"maskedEmail":"bo***7@example.com","maskedPhone":"********4317"}
[2025-11-15T10:33:08.690Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"440de317-ff68-4f10-9486-2257ba42d9b5","bookingId":"f4059600-e62f-451d-895a-c928b9188350","reference":"YUWBFEAJ5J","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:33:04.956Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"c3f05e68-e66d-4276-a8fb-9e713e497ce2","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19824,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20549,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["MD-12"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"99ced076-3704-442a-9019-04b21d24e2b5","tableId":"6651403a-c674-46c3-a0ec-7e7269416736","tableNumber":"MD-12","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T10:33:08.691Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1e56169b-3020-4889-8e5a-b4ef98aae063","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:33:08.691Z] [INFO] [submit] Submitting booking request {"correlationId":"1e56169b-3020-4889-8e5a-b4ef98aae063","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:33:29.482Z] [INFO] [submit] Booking created {"correlationId":"1e56169b-3020-4889-8e5a-b4ef98aae063","bookingId":"8521031b-37d6-4688-a644-20e9d3b00fd4","duplicate":false,"initialStatus":"confirmed","durationMs":20789,"maskedEmail":"bo***b@example.com","maskedPhone":"********1691"}
[2025-11-15T10:33:30.172Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1e56169b-3020-4889-8e5a-b4ef98aae063","bookingId":"8521031b-37d6-4688-a644-20e9d3b00fd4","reference":"PNPADYDYG6","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:33:26.705Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"4bc05e11-9db8-488b-a7f9-011b3bdb336e","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20789,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21481,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["PR-05"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a5c444a0-8ffb-4d97-a0b6-69d7bee84408","tableId":"e50733be-9486-484b-a71b-3f51e0cf05b1","tableNumber":"PR-05","zoneId":"720b2da6-be5b-4d3b-831d-b970fc29d502","capacity":10,"startAt":null,"endAt":null}]}
[2025-11-15T10:33:30.174Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4c561d2a-29f3-4d7e-89a6-35a693a9f92c","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:33:30.174Z] [INFO] [submit] Submitting booking request {"correlationId":"4c561d2a-29f3-4d7e-89a6-35a693a9f92c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:33:50.301Z] [INFO] [submit] Booking created {"correlationId":"4c561d2a-29f3-4d7e-89a6-35a693a9f92c","bookingId":"a2f9e1c9-9ece-4cf7-8d32-ffb98b84cdba","duplicate":false,"initialStatus":"confirmed","durationMs":20126,"maskedEmail":"bo***a@example.com","maskedPhone":"********1320"}
[2025-11-15T10:33:50.954Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4c561d2a-29f3-4d7e-89a6-35a693a9f92c","bookingId":"a2f9e1c9-9ece-4cf7-8d32-ffb98b84cdba","reference":"QLSADX3D4P","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:33:46.998Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"a1607e3f-6af4-40f0-9fc9-7318aa09ff2d","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20126,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20780,"tablesAssigned":2,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-05","MD-04"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2677caa0-ddfe-4ce1-9ad8-9935960f84d8","tableId":"16a8f6db-c6b3-418d-953a-91f8faad5d9c","tableNumber":"MD-05","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":4,"startAt":null,"endAt":null},{"id":"99894f1f-8cdb-4d93-9f53-ae802f44be5e","tableId":"8f18db09-28e2-49bd-82a6-c3d5118dc709","tableNumber":"MD-04","zoneId":"d4fa3190-cc40-4d4c-9140-5bac194da959","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:33:50.955Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"798cee89-2c5b-49f9-99ca-3825933f9f67","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:33:50.955Z] [INFO] [submit] Submitting booking request {"correlationId":"798cee89-2c5b-49f9-99ca-3825933f9f67","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:34:10.821Z] [INFO] [submit] Booking created {"correlationId":"798cee89-2c5b-49f9-99ca-3825933f9f67","bookingId":"c753eae5-e479-4cfc-8374-84a7bb60fed1","duplicate":false,"initialStatus":"confirmed","durationMs":19866,"maskedEmail":"bo***9@example.com","maskedPhone":"********4489"}
[2025-11-15T10:34:11.478Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"798cee89-2c5b-49f9-99ca-3825933f9f67","bookingId":"c753eae5-e479-4cfc-8374-84a7bb60fed1","reference":"4KWJJ8KYR9","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:34:09.805Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5676,"attemptId":"9780e917-bc7b-4619-9deb-5484a9f1808a","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19866,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20523,"tablesAssigned":1,"totalCapacity":10,"seatWaste":3,"tableNumbers":["PR-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0223d1f2-f717-4527-b80f-e73415336bda","tableId":"96039fb5-14ab-40aa-b2c5-a932f7404b0e","tableNumber":"PR-06","zoneId":"720b2da6-be5b-4d3b-831d-b970fc29d502","capacity":10,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20523, max: 21481, avg: 20833.25, p95: 20780 },
  seatWaste: { count: 4, min: 1, max: 3, avg: 2.5, p95: 3 },
  tablesPerBooking: { count: 4, min: 1, max: 2, avg: 1.25, p95: 1 },
  uniqueTables: [ 'MD-04', 'MD-05', 'MD-12', 'PR-05', 'PR-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
