
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ⚙️  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  override existing env vars with { override: true }
[2025-11-15T12:14:40.935Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"c58968d3-be71-4ec9-af99-4fef7b390f6c","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:14:40.935Z] [INFO] [submit] Submitting booking request {"correlationId":"c58968d3-be71-4ec9-af99-4fef7b390f6c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:15:00.003Z] [INFO] [submit] Booking created {"correlationId":"c58968d3-be71-4ec9-af99-4fef7b390f6c","bookingId":"c9db7a1f-8a9c-4488-bbd6-8e5c215b53f3","duplicate":false,"initialStatus":"confirmed","durationMs":19067,"maskedEmail":"bo***3@example.com","maskedPhone":"********6833"}
[2025-11-15T12:15:00.641Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"c58968d3-be71-4ec9-af99-4fef7b390f6c","bookingId":"c9db7a1f-8a9c-4488-bbd6-8e5c215b53f3","reference":"FJ9AM882ZC","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:14:59.353Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5759,"attemptId":"d0cb40ce-00f6-44df-abb2-3338d3080a71","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19067,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19706,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e953cd57-a004-415e-af31-066b455f9534","tableId":"bfcfee40-b4f0-4629-80f2-c37bde7c9845","tableNumber":"BA-07","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:15:00.642Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"3273d082-3b4e-4f90-b218-5314540dc2c7","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:15:00.642Z] [INFO] [submit] Submitting booking request {"correlationId":"3273d082-3b4e-4f90-b218-5314540dc2c7","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:15:19.824Z] [INFO] [submit] Booking created {"correlationId":"3273d082-3b4e-4f90-b218-5314540dc2c7","bookingId":"3449bc50-7242-4fab-8a44-c5739c4a02f4","duplicate":false,"initialStatus":"confirmed","durationMs":19181,"maskedEmail":"bo***2@example.com","maskedPhone":"********3082"}
[2025-11-15T12:15:20.607Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"3273d082-3b4e-4f90-b218-5314540dc2c7","bookingId":"3449bc50-7242-4fab-8a44-c5739c4a02f4","reference":"8GRV2LWTGF","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:15:18.979Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5679,"attemptId":"07ac630d-dc7e-460e-ad38-4887d4a56876","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19181,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19965,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5b54e6a4-6cc6-45c8-bc0d-508ca0f0c21d","tableId":"d63141b1-90b7-406a-9fac-27821c9913cb","tableNumber":"BA-08","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:15:20.608Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2609badb-0c2c-43e7-8354-e4ea57eb60d1","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:15:20.608Z] [INFO] [submit] Submitting booking request {"correlationId":"2609badb-0c2c-43e7-8354-e4ea57eb60d1","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:15:41.559Z] [INFO] [submit] Booking created {"correlationId":"2609badb-0c2c-43e7-8354-e4ea57eb60d1","bookingId":"b2463a1c-d894-4a4e-ac29-03a2e7fdcf5d","duplicate":false,"initialStatus":"confirmed","durationMs":20950,"maskedEmail":"bo***b@example.com","maskedPhone":"********1031"}
[2025-11-15T12:15:42.177Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2609badb-0c2c-43e7-8354-e4ea57eb60d1","bookingId":"b2463a1c-d894-4a4e-ac29-03a2e7fdcf5d","reference":"89DGPEYTXH","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:15:38.365Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"04e0df40-eb45-46e6-ba15-c4e996d17ee6","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20950,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21569,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e9a8b878-b735-4f22-bcb7-d6f6603e1af7","tableId":"43d95240-9162-4261-bf5b-4a4d22507ec8","tableNumber":"MD-07","zoneId":"406a6e8e-1e53-4b0b-8a07-abdd953d29fb","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:15:42.178Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9168e63f-78c5-4163-8b10-b08680f3fcfc","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:15:42.178Z] [INFO] [submit] Submitting booking request {"correlationId":"9168e63f-78c5-4163-8b10-b08680f3fcfc","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:16:00.876Z] [INFO] [submit] Booking created {"correlationId":"9168e63f-78c5-4163-8b10-b08680f3fcfc","bookingId":"e61bac8b-160a-4c5c-a36e-8d303cc8a1bb","duplicate":false,"initialStatus":"confirmed","durationMs":18698,"maskedEmail":"bo***f@example.com","maskedPhone":"********4635"}
[2025-11-15T12:16:01.896Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9168e63f-78c5-4163-8b10-b08680f3fcfc","bookingId":"e61bac8b-160a-4c5c-a36e-8d303cc8a1bb","reference":"YLYD3NU6KM","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:15:59.970Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5356,"attemptId":"2ef1b7a0-6b57-402d-a125-9bef83454de7","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18698,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19718,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-08"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"349013f1-601e-48a4-84c7-c196561f2c1b","tableId":"81246135-6215-4bbf-904b-5dd0ecc1696b","tableNumber":"MD-08","zoneId":"406a6e8e-1e53-4b0b-8a07-abdd953d29fb","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19706, max: 21569, avg: 20239.5, p95: 19965 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'BA-08', 'MD-07', 'MD-08' ]
}
✅ Stress run completed 4 booking(s) without failure.
