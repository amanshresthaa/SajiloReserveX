
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 19\:45 --party-size 4 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[2025-11-15T10:15:16.143Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"ada905b0-110b-4c2f-9817-70204a56055b","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:15:16.143Z] [INFO] [submit] Submitting booking request {"correlationId":"ada905b0-110b-4c2f-9817-70204a56055b","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:15:36.305Z] [INFO] [submit] Booking created {"correlationId":"ada905b0-110b-4c2f-9817-70204a56055b","bookingId":"071d1224-48f7-46a7-81b7-5e2be6e4ee93","duplicate":false,"initialStatus":"confirmed","durationMs":20160,"maskedEmail":"bo***0@example.com","maskedPhone":"********0510"}
[2025-11-15T10:15:36.932Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"ada905b0-110b-4c2f-9817-70204a56055b","bookingId":"071d1224-48f7-46a7-81b7-5e2be6e4ee93","reference":"R6DL2BFV9L","bookingDate":"2025-11-25","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:15:35.669Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5771,"attemptId":"05364b17-797c-4e0f-a636-ef43455e68e7","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20160,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20789,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-03"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bd57e4c7-610e-4e41-986d-8e12c22adb23","tableId":"7d8a1c3a-550e-4a4f-a660-e03d76a16efe","tableNumber":"BA-03","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:15:36.933Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"438b944d-c8fe-49f8-ae81-59b8631aafeb","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:15:36.934Z] [INFO] [submit] Submitting booking request {"correlationId":"438b944d-c8fe-49f8-ae81-59b8631aafeb","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:15:55.597Z] [INFO] [submit] Booking created {"correlationId":"438b944d-c8fe-49f8-ae81-59b8631aafeb","bookingId":"7b0177ec-5e5f-4d19-a67c-e3d17ccd87b7","duplicate":false,"initialStatus":"confirmed","durationMs":18662,"maskedEmail":"bo***d@example.com","maskedPhone":"********9443"}
[2025-11-15T10:15:56.249Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"438b944d-c8fe-49f8-ae81-59b8631aafeb","bookingId":"7b0177ec-5e5f-4d19-a67c-e3d17ccd87b7","reference":"XHJ579LHZ6","bookingDate":"2025-11-25","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:15:54.804Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5411,"attemptId":"632d22a0-79ae-4759-8f8c-e6e045f8e135","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18662,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19316,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-04"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"4aeb3b62-27f0-473e-a9ea-1a15077221b9","tableId":"42aa5acd-51a4-4f1c-a943-abd860663372","tableNumber":"BA-04","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:15:56.251Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"81979e26-5351-4aca-b394-33666327888c","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:15:56.251Z] [INFO] [submit] Submitting booking request {"correlationId":"81979e26-5351-4aca-b394-33666327888c","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:16:15.906Z] [INFO] [submit] Booking created {"correlationId":"81979e26-5351-4aca-b394-33666327888c","bookingId":"34a67b32-5d2b-49ff-8430-904b5d320f7b","duplicate":false,"initialStatus":"confirmed","durationMs":19654,"maskedEmail":"bo***6@example.com","maskedPhone":"********9426"}
[2025-11-15T10:16:16.522Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"81979e26-5351-4aca-b394-33666327888c","bookingId":"34a67b32-5d2b-49ff-8430-904b5d320f7b","reference":"HFXAT5YPAQ","bookingDate":"2025-11-25","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:16:14.909Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5389,"attemptId":"f1b68e0d-6b65-445a-9617-a9f5f9a526d0","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19654,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20271,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-05"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"821752f4-16fd-44c6-a326-8855d6311ff1","tableId":"6308eaa4-1b67-4697-a7b1-ddd71e35dcb1","tableNumber":"BA-05","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:16:16.523Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a2f256e4-27ed-4327-abd6-0bcc541e3b8d","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:16:16.523Z] [INFO] [submit] Submitting booking request {"correlationId":"a2f256e4-27ed-4327-abd6-0bcc541e3b8d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:45","party":4,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:16:36.694Z] [INFO] [submit] Booking created {"correlationId":"a2f256e4-27ed-4327-abd6-0bcc541e3b8d","bookingId":"814222b3-0f43-472d-8dba-38dc200ca8e4","duplicate":false,"initialStatus":"confirmed","durationMs":20171,"maskedEmail":"bo***4@example.com","maskedPhone":"********5644"}
[2025-11-15T10:16:37.418Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a2f256e4-27ed-4327-abd6-0bcc541e3b8d","bookingId":"814222b3-0f43-472d-8dba-38dc200ca8e4","reference":"5Y2S5QKZX4","bookingDate":"2025-11-25","startTime":"19:45:00","endTime":"21:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:16:36.078Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5645,"attemptId":"e1138564-c1b0-428c-8300-570851b7dda7","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20171,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20895,"tablesAssigned":1,"totalCapacity":4,"seatWaste":0,"tableNumbers":["BA-06"],"partySize":4,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"5170749a-f9b5-4ff5-9b12-be2cc2344108","tableId":"3dcc6ba2-a603-4fbb-bc1b-19cfa8e29200","tableNumber":"BA-06","zoneId":"1089f11a-d60d-40ad-8a66-6614fe93d90a","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19316, max: 20895, avg: 20317.75, p95: 20789 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
