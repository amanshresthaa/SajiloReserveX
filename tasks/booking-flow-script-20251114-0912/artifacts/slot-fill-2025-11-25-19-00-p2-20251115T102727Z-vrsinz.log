
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 19\:00 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ðŸ“¡ observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ðŸ“¡ version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: ðŸ“¡ auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-15T10:27:27.585Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"da24006d-844b-4425-b969-7595511a412f","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:27:27.586Z] [INFO] [submit] Submitting booking request {"correlationId":"da24006d-844b-4425-b969-7595511a412f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:27:46.672Z] [INFO] [submit] Booking created {"correlationId":"da24006d-844b-4425-b969-7595511a412f","bookingId":"de5f93ef-b94b-48be-a987-f9c599b2fe03","duplicate":false,"initialStatus":"confirmed","durationMs":19085,"maskedEmail":"bo***d@example.com","maskedPhone":"********0063"}
[2025-11-15T10:27:47.394Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"da24006d-844b-4425-b969-7595511a412f","bookingId":"de5f93ef-b94b-48be-a987-f9c599b2fe03","reference":"PDXSJLS627","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:27:45.831Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5526,"attemptId":"cd15af13-7ba8-4142-8d14-19530a1c375f","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19085,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19809,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"66930daf-e8e8-42aa-9445-87141568c06c","tableId":"8082f2af-b40c-45ba-a0bb-0d0b89e2ac41","tableNumber":"BA-01","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:27:47.395Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"14902cf2-f52d-486a-a59a-07abdaa87176","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:27:47.395Z] [INFO] [submit] Submitting booking request {"correlationId":"14902cf2-f52d-486a-a59a-07abdaa87176","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:28:07.544Z] [INFO] [submit] Booking created {"correlationId":"14902cf2-f52d-486a-a59a-07abdaa87176","bookingId":"0d967789-f082-46aa-91ef-9c5b7dc1151b","duplicate":false,"initialStatus":"pending","durationMs":20148,"maskedEmail":"bo***2@example.com","maskedPhone":"********2252"}
[2025-11-15T10:28:08.293Z] [INFO] [inline_poll] Status update {"correlationId":"14902cf2-f52d-486a-a59a-07abdaa87176","bookingId":"0d967789-f082-46aa-91ef-9c5b7dc1151b","attempt":1,"status":"pending","assignments":0,"elapsedMs":748}
[2025-11-15T10:28:17.719Z] [INFO] [inline_poll] Status update {"correlationId":"14902cf2-f52d-486a-a59a-07abdaa87176","bookingId":"0d967789-f082-46aa-91ef-9c5b7dc1151b","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":10174}
[2025-11-15T10:28:17.719Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"14902cf2-f52d-486a-a59a-07abdaa87176","bookingId":"0d967789-f082-46aa-91ef-9c5b7dc1151b","reference":"FFS9B7NWQM","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:28:04.384Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"2d56134d-9cfa-40ee-90cd-6158cb9f61ee","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20148,"inlineAttempts":5,"inlineDurationMs":10174,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":30324,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"5841bf4f-396c-462a-b80f-c7c6d1849f5c","tableId":"6ea89c3b-f061-457d-94d0-2391e79a15f0","tableNumber":"BA-02","zoneId":"bf1cfa5a-2d6f-4370-a077-e6d713363099","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:28:17.720Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9af1beee-269f-439c-ab92-c29dd46a52ce","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:28:17.720Z] [INFO] [submit] Submitting booking request {"correlationId":"9af1beee-269f-439c-ab92-c29dd46a52ce","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:28:37.518Z] [INFO] [submit] Booking created {"correlationId":"9af1beee-269f-439c-ab92-c29dd46a52ce","bookingId":"e8813a26-999e-4fd2-b505-8849928abfcb","duplicate":false,"initialStatus":"confirmed","durationMs":19797,"maskedEmail":"bo***e@example.com","maskedPhone":"********1444"}
[2025-11-15T10:28:38.151Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9af1beee-269f-439c-ab92-c29dd46a52ce","bookingId":"e8813a26-999e-4fd2-b505-8849928abfcb","reference":"9CL5BGPNPH","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:28:36.521Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5494,"attemptId":"a41786ab-7ee0-4c10-bb6b-7713f9cfb3af","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19797,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20431,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"d717c43e-94c7-40e5-a577-1d8f7bc419f8","tableId":"2c33747d-26a8-4a6a-a37f-13e0c10ef79a","tableNumber":"MD-01","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T10:28:38.152Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4c6e8ff7-82b7-48f9-b634-fce087c428d8","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:28:38.152Z] [INFO] [submit] Submitting booking request {"correlationId":"4c6e8ff7-82b7-48f9-b634-fce087c428d8","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"19:00","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:28:57.882Z] [INFO] [submit] Booking created {"correlationId":"4c6e8ff7-82b7-48f9-b634-fce087c428d8","bookingId":"19f9d636-f951-4f48-b6b7-e03c16fe5dba","duplicate":false,"initialStatus":"confirmed","durationMs":19729,"maskedEmail":"bo***7@example.com","maskedPhone":"********8557"}
[2025-11-15T10:28:58.488Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4c6e8ff7-82b7-48f9-b634-fce087c428d8","bookingId":"19f9d636-f951-4f48-b6b7-e03c16fe5dba","reference":"9QQFJSPZQR","bookingDate":"2025-11-25","startTime":"19:00:00","endTime":"21:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:28:56.830Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5699,"attemptId":"648c9793-2ecf-45b0-93cd-cb367a138add","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19729,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20336,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ae21ef6e-353b-4cbd-baed-b537710254c9","tableId":"041d22f5-1b24-4825-a675-d93d4755984e","tableNumber":"MD-02","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19809, max: 30324, avg: 22725, p95: 20431 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
âœ… Stress run completed 4 booking(s) without failure.
