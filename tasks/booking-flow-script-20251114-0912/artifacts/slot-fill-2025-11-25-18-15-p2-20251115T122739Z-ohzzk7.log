
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[2025-11-15T12:27:39.855Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9e9c28e6-bf0e-4f31-b35d-5f6eecff8508","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:27:39.855Z] [INFO] [submit] Submitting booking request {"correlationId":"9e9c28e6-bf0e-4f31-b35d-5f6eecff8508","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:28:01.285Z] [INFO] [submit] Booking created {"correlationId":"9e9c28e6-bf0e-4f31-b35d-5f6eecff8508","bookingId":"a83bbaad-67fe-468f-b470-4e0e31a64383","duplicate":false,"initialStatus":"confirmed","durationMs":21429,"maskedEmail":"bo***6@example.com","maskedPhone":"********2846"}
[2025-11-15T12:28:02.022Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9e9c28e6-bf0e-4f31-b35d-5f6eecff8508","bookingId":"a83bbaad-67fe-468f-b470-4e0e31a64383","reference":"LTLTMENDNN","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:27:58.815Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"3ba1051c-59cc-43ae-8906-dff4817746e5","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21429,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22167,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e0ff9fd1-d8c0-4631-b783-f153cb643db8","tableId":"49d15284-c41d-449a-96f5-45a01dbb19f8","tableNumber":"BA-01","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:02.023Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"26ba4c4c-b168-4d3f-8620-7672b081989b","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:02.023Z] [INFO] [submit] Submitting booking request {"correlationId":"26ba4c4c-b168-4d3f-8620-7672b081989b","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:21.752Z] [INFO] [submit] Booking created {"correlationId":"26ba4c4c-b168-4d3f-8620-7672b081989b","bookingId":"2537a085-830e-43cd-9bd3-159bf23ad8d0","duplicate":false,"initialStatus":"confirmed","durationMs":19727,"maskedEmail":"bo***c@example.com","maskedPhone":"********4242"}
[2025-11-15T12:28:22.391Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"26ba4c4c-b168-4d3f-8620-7672b081989b","bookingId":"2537a085-830e-43cd-9bd3-159bf23ad8d0","reference":"7WVLD77WNG","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:19.860Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"ec36c337-6df3-4b12-9898-4d2d297c41f3","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19727,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20368,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"c221fc94-6b92-4bb3-9999-c248c95a7fbe","tableId":"6d20353b-fbb2-48c2-9335-b68bc235db7c","tableNumber":"BA-02","zoneId":"05e92343-5dfa-446f-b946-eb59dd07b553","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:22.392Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"aec8d28e-1595-4c51-a9e3-a8ec5f648380","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:22.392Z] [INFO] [submit] Submitting booking request {"correlationId":"aec8d28e-1595-4c51-a9e3-a8ec5f648380","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:28:41.767Z] [INFO] [submit] Booking created {"correlationId":"aec8d28e-1595-4c51-a9e3-a8ec5f648380","bookingId":"8050aa08-3f4d-4415-a9d7-297c8c3a9f1b","duplicate":false,"initialStatus":"confirmed","durationMs":19374,"maskedEmail":"bo***e@example.com","maskedPhone":"********3284"}
[2025-11-15T12:28:42.433Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"aec8d28e-1595-4c51-a9e3-a8ec5f648380","bookingId":"8050aa08-3f4d-4415-a9d7-297c8c3a9f1b","reference":"7XAB4K8JLV","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:28:39.669Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"89994d6f-3a3b-4df8-8e1b-8b1a0b467e1f","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19374,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20041,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"19305dab-edd6-4836-89da-9dc7901c437c","tableId":"75329c85-efdc-40cb-87fe-bb4f2242b802","tableNumber":"MD-01","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T12:28:42.434Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0c958738-50b7-4fd4-8d41-38b51c93eab7","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:28:42.434Z] [INFO] [submit] Submitting booking request {"correlationId":"0c958738-50b7-4fd4-8d41-38b51c93eab7","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:29:01.629Z] [INFO] [submit] Booking created {"correlationId":"0c958738-50b7-4fd4-8d41-38b51c93eab7","bookingId":"9f7d33d2-2a9f-4ef9-9a15-50455fb91b97","duplicate":false,"initialStatus":"confirmed","durationMs":19195,"maskedEmail":"bo***8@example.com","maskedPhone":"********8738"}
[2025-11-15T12:29:02.267Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0c958738-50b7-4fd4-8d41-38b51c93eab7","bookingId":"9f7d33d2-2a9f-4ef9-9a15-50455fb91b97","reference":"5FZ32KENTL","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:29:00.294Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5172,"attemptId":"11f54a6d-e288-4ddb-99fd-0fa0476fc7d6","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19195,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19833,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0af2db2b-28ef-48d4-9d96-c632da52c2cc","tableId":"eb535103-6058-426f-9a4c-fa47b07c3783","tableNumber":"MD-02","zoneId":"02941be8-0aec-4421-9cd2-9dac380d4b91","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19833, max: 22167, avg: 20602.25, p95: 20368 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
