
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:30 --party-size 8 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[2025-11-15T10:19:03.746Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d1a6279c-cca0-4324-aeb3-7ff3c3b3c3e9","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:19:03.747Z] [INFO] [submit] Submitting booking request {"correlationId":"d1a6279c-cca0-4324-aeb3-7ff3c3b3c3e9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:19:25.344Z] [INFO] [submit] Booking created {"correlationId":"d1a6279c-cca0-4324-aeb3-7ff3c3b3c3e9","bookingId":"4156be83-f5c7-4746-b756-76357cad3fe2","duplicate":false,"initialStatus":"pending","durationMs":21595,"maskedEmail":"bo***c@example.com","maskedPhone":"********2792"}
[2025-11-15T10:19:26.011Z] [INFO] [inline_poll] Status update {"correlationId":"d1a6279c-cca0-4324-aeb3-7ff3c3b3c3e9","bookingId":"4156be83-f5c7-4746-b756-76357cad3fe2","attempt":1,"status":"pending","assignments":0,"elapsedMs":666}
[2025-11-15T10:19:35.331Z] [INFO] [inline_poll] Status update {"correlationId":"d1a6279c-cca0-4324-aeb3-7ff3c3b3c3e9","bookingId":"4156be83-f5c7-4746-b756-76357cad3fe2","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9986}
[2025-11-15T10:19:35.332Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"d1a6279c-cca0-4324-aeb3-7ff3c3b3c3e9","bookingId":"4156be83-f5c7-4746-b756-76357cad3fe2","reference":"XPRS2TKYN6","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:19:22.110Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"7e339bf3-df24-404b-8246-6e29736d32b3","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21595,"inlineAttempts":5,"inlineDurationMs":9986,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":31585,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-09"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"9c3c2151-cc5a-4be6-afbf-eedd4f59d164","tableId":"e48c6e16-566a-4af5-9a09-7e915de3c21b","tableNumber":"MD-09","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:19:35.333Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"9ad850c7-bb85-4cfe-ab6f-54117259c12d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:19:35.333Z] [INFO] [submit] Submitting booking request {"correlationId":"9ad850c7-bb85-4cfe-ab6f-54117259c12d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:19:54.401Z] [INFO] [submit] Booking created {"correlationId":"9ad850c7-bb85-4cfe-ab6f-54117259c12d","bookingId":"d01eb397-89fd-4457-b35b-d105abe8327f","duplicate":false,"initialStatus":"confirmed","durationMs":19067,"maskedEmail":"bo***7@example.com","maskedPhone":"********5027"}
[2025-11-15T10:19:55.008Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"9ad850c7-bb85-4cfe-ab6f-54117259c12d","bookingId":"d01eb397-89fd-4457-b35b-d105abe8327f","reference":"2USKVUYFGK","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:19:53.731Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5438,"attemptId":"40c9faff-c902-4d50-8f06-d99136e570e0","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19067,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19675,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["MD-10"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"7cfcea1f-6fe4-4446-8755-07bea42832cd","tableId":"af0ffc82-f002-4b6f-ba8b-31b884531dfe","tableNumber":"MD-10","zoneId":"4561fa1e-1258-49e2-a424-c421fcdebdfb","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:19:55.009Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bde46ba8-7db2-4d60-8084-f3f1dbd10f13","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:19:55.009Z] [INFO] [submit] Submitting booking request {"correlationId":"bde46ba8-7db2-4d60-8084-f3f1dbd10f13","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:20:13.991Z] [INFO] [submit] Booking created {"correlationId":"bde46ba8-7db2-4d60-8084-f3f1dbd10f13","bookingId":"2a0349a3-8a10-4e24-9704-0d57eeaf067c","duplicate":false,"initialStatus":"confirmed","durationMs":18982,"maskedEmail":"bo***8@example.com","maskedPhone":"********6108"}
[2025-11-15T10:20:14.615Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bde46ba8-7db2-4d60-8084-f3f1dbd10f13","bookingId":"2a0349a3-8a10-4e24-9704-0d57eeaf067c","reference":"FZHXNQFLNH","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:20:13.421Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5596,"attemptId":"9ba4f8aa-240e-4230-b619-7046f84174e1","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18982,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19606,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["OG-06"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"07344949-09eb-4647-937d-76dd8c47c97d","tableId":"9b915780-eec4-47f7-bcd3-bfac28a78d3f","tableNumber":"OG-06","zoneId":"7ba0e930-2095-4eb7-9bec-4002acb9a42f","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:20:14.615Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"cf23885b-093d-475a-8915-e21a0e86916b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:20:14.616Z] [INFO] [submit] Submitting booking request {"correlationId":"cf23885b-093d-475a-8915-e21a0e86916b","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:30","party":8,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:20:34.829Z] [INFO] [submit] Booking created {"correlationId":"cf23885b-093d-475a-8915-e21a0e86916b","bookingId":"30f27ec5-8513-410e-b759-5b07a2fab327","duplicate":false,"initialStatus":"confirmed","durationMs":20212,"maskedEmail":"bo***b@example.com","maskedPhone":"********8851"}
[2025-11-15T10:20:35.590Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"cf23885b-093d-475a-8915-e21a0e86916b","bookingId":"30f27ec5-8513-410e-b759-5b07a2fab327","reference":"3MHA5RKECT","bookingDate":"2025-11-25","startTime":"17:30:00","endTime":"19:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:20:32.081Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"e2452ea6-a684-449c-8718-cde6603b229d","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20212,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20975,"tablesAssigned":1,"totalCapacity":8,"seatWaste":0,"tableNumbers":["PT-07"],"partySize":8,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"74ca4074-b82e-46a7-9c57-3949d35f9b40","tableId":"6131e3a9-84bd-4be6-b802-82a977f28dfe","tableNumber":"PT-07","zoneId":"9fa8c6a5-9af6-43e4-bf0f-c2377833daeb","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19606, max: 31585, avg: 22960.25, p95: 20975 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
