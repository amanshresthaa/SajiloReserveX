
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 2 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-15T12:13:20.592Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"4db24f3d-8378-45cf-a61d-f6292e1576bb","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:13:20.592Z] [INFO] [submit] Submitting booking request {"correlationId":"4db24f3d-8378-45cf-a61d-f6292e1576bb","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:13:39.290Z] [INFO] [submit] Booking created {"correlationId":"4db24f3d-8378-45cf-a61d-f6292e1576bb","bookingId":"d2f88328-1491-4a87-935d-bb580b7f0ce3","duplicate":false,"initialStatus":"confirmed","durationMs":18696,"maskedEmail":"bo***d@example.com","maskedPhone":"********4533"}
[2025-11-15T12:13:39.944Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"4db24f3d-8378-45cf-a61d-f6292e1576bb","bookingId":"d2f88328-1491-4a87-935d-bb580b7f0ce3","reference":"DGU9NUDSYR","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:13:38.511Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5513,"attemptId":"d15b0f20-308f-464f-953a-6183715140a5","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":18696,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19352,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bd3993e1-a7ae-4f04-bd7a-0bf631882fd0","tableId":"56dc1a3b-e468-4c15-a00a-f6d98b56a58c","tableNumber":"BA-01","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T12:13:39.945Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"96b4166b-56d3-4c7a-a088-b74899f68939","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:13:39.945Z] [INFO] [submit] Submitting booking request {"correlationId":"96b4166b-56d3-4c7a-a088-b74899f68939","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:13:59.778Z] [INFO] [submit] Booking created {"correlationId":"96b4166b-56d3-4c7a-a088-b74899f68939","bookingId":"d960d0b8-17bc-4134-bf69-72deb92fa270","duplicate":false,"initialStatus":"confirmed","durationMs":19830,"maskedEmail":"bo***b@example.com","maskedPhone":"********1661"}
[2025-11-15T12:14:00.695Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"96b4166b-56d3-4c7a-a088-b74899f68939","bookingId":"d960d0b8-17bc-4134-bf69-72deb92fa270","reference":"324PFSPBED","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:13:58.744Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5739,"attemptId":"ae2c4086-414f-4334-8fd1-ab1df41ea05a","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19830,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20750,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["BA-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2ad74621-67e1-41be-9f1e-ee3fd1042ce2","tableId":"ef0c26ed-43b5-48d6-825d-a4ac40e08c44","tableNumber":"BA-02","zoneId":"92017a89-35a6-483c-bdde-73ba1cc97dae","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T12:14:00.697Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"01b10c6a-36a6-492e-bbd5-4406abe69add","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:14:00.697Z] [INFO] [submit] Submitting booking request {"correlationId":"01b10c6a-36a6-492e-bbd5-4406abe69add","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:14:20.311Z] [INFO] [submit] Booking created {"correlationId":"01b10c6a-36a6-492e-bbd5-4406abe69add","bookingId":"df31842b-2472-4417-8a4a-ba882489521b","duplicate":false,"initialStatus":"confirmed","durationMs":19613,"maskedEmail":"bo***a@example.com","maskedPhone":"********0260"}
[2025-11-15T12:14:20.949Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"01b10c6a-36a6-492e-bbd5-4406abe69add","bookingId":"df31842b-2472-4417-8a4a-ba882489521b","reference":"W49LZ5NFSA","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:14:19.535Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5756,"attemptId":"ff8956b8-8f4f-48ce-aff6-3f7ca8d872e1","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19613,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20251,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-01"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ebfe06f0-8be9-44d1-9196-467585032501","tableId":"dfb5718a-c200-4222-a61c-5065cc765d33","tableNumber":"MD-01","zoneId":"406a6e8e-1e53-4b0b-8a07-abdd953d29fb","capacity":2,"startAt":null,"endAt":null}]}
[2025-11-15T12:14:20.949Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"d6ce1114-d859-4a3d-80f4-5ac59880e38b","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:14:20.949Z] [INFO] [submit] Submitting booking request {"correlationId":"d6ce1114-d859-4a3d-80f4-5ac59880e38b","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":2,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:14:39.666Z] [INFO] [submit] Booking created {"correlationId":"d6ce1114-d859-4a3d-80f4-5ac59880e38b","bookingId":"7bbc4e3f-6405-451c-8e63-10ca549230f9","duplicate":false,"initialStatus":"confirmed","durationMs":18716,"maskedEmail":"bo***4@example.com","maskedPhone":"********1114"}
[2025-11-15T12:14:40.316Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"d6ce1114-d859-4a3d-80f4-5ac59880e38b","bookingId":"7bbc4e3f-6405-451c-8e63-10ca549230f9","reference":"RJDP5GGD3X","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:14:38.819Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5657,"attemptId":"42571899-2ef1-4597-81c5-38aa2d18ddf6","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18716,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19366,"tablesAssigned":1,"totalCapacity":2,"seatWaste":0,"tableNumbers":["MD-02"],"partySize":2,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e38b1019-ff9d-46e3-bc7b-cef5a58322fa","tableId":"46354e5f-05e4-4bb3-a239-489d84024086","tableNumber":"MD-02","zoneId":"406a6e8e-1e53-4b0b-8a07-abdd953d29fb","capacity":2,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19352, max: 20750, avg: 19929.75, p95: 20251 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-01', 'BA-02', 'MD-01', 'MD-02' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
