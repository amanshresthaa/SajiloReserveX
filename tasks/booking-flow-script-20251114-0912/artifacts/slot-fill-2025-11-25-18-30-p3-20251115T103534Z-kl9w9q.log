
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[2025-11-15T10:35:35.333Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"052f9d32-9a5b-4122-b9d8-eb452dbcc12f","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:35:35.333Z] [INFO] [submit] Submitting booking request {"correlationId":"052f9d32-9a5b-4122-b9d8-eb452dbcc12f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:35:55.883Z] [INFO] [submit] Booking created {"correlationId":"052f9d32-9a5b-4122-b9d8-eb452dbcc12f","bookingId":"e380c94d-4eb7-4577-ad2c-8bee6b811d81","duplicate":false,"initialStatus":"confirmed","durationMs":20549,"maskedEmail":"bo***2@example.com","maskedPhone":"********9332"}
[2025-11-15T10:35:56.544Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"052f9d32-9a5b-4122-b9d8-eb452dbcc12f","bookingId":"e380c94d-4eb7-4577-ad2c-8bee6b811d81","reference":"B87GQ3RZZT","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:35:52.870Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12001,"attemptId":"2880c515-47c4-40c3-abf4-6f6248a65379","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20549,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21211,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-03"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"eb85bb2f-c15b-4eb7-b644-dcf94daae70e","tableId":"031b7cec-6496-42ee-aefe-aac4cf185d47","tableNumber":"BA-03","zoneId":"597669cb-939e-41e9-9f50-c47a6c7af3fc","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:35:56.545Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"10b7bbb4-8a30-448f-80cc-a4c27874878d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:35:56.546Z] [INFO] [submit] Submitting booking request {"correlationId":"10b7bbb4-8a30-448f-80cc-a4c27874878d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:36:15.121Z] [INFO] [submit] Booking created {"correlationId":"10b7bbb4-8a30-448f-80cc-a4c27874878d","bookingId":"b89640b7-c393-4ca6-99e8-29af057eb3db","duplicate":false,"initialStatus":"confirmed","durationMs":18574,"maskedEmail":"bo***4@example.com","maskedPhone":"********1114"}
[2025-11-15T10:36:15.751Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"10b7bbb4-8a30-448f-80cc-a4c27874878d","bookingId":"b89640b7-c393-4ca6-99e8-29af057eb3db","reference":"LYBCHE9PDJ","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:36:13.971Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5367,"attemptId":"ea17e503-05ca-45b0-bca8-1ed4877add4f","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18574,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19206,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"fb180df7-a28a-4f47-b08e-c98f57072b71","tableId":"133fcbb5-5249-474e-bf6a-c10285866de3","tableNumber":"BA-04","zoneId":"597669cb-939e-41e9-9f50-c47a6c7af3fc","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:36:15.752Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"5d7d0852-3700-4d40-9137-c48b8dc7686f","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:36:15.752Z] [INFO] [submit] Submitting booking request {"correlationId":"5d7d0852-3700-4d40-9137-c48b8dc7686f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:36:34.738Z] [INFO] [submit] Booking created {"correlationId":"5d7d0852-3700-4d40-9137-c48b8dc7686f","bookingId":"5851b9f2-c246-45cb-bc19-ffc4ce98e49d","duplicate":false,"initialStatus":"confirmed","durationMs":18986,"maskedEmail":"bo***2@example.com","maskedPhone":"********0852"}
[2025-11-15T10:36:35.361Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"5d7d0852-3700-4d40-9137-c48b8dc7686f","bookingId":"5851b9f2-c246-45cb-bc19-ffc4ce98e49d","reference":"7PQ7YEH896","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:36:34.120Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5412,"attemptId":"811c20f1-8198-4499-9f19-99a6092745b6","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18986,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19609,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-05"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"a61502dd-77ae-4eba-a52c-c59c9a5027cd","tableId":"1125b671-6a07-42ad-98e7-fcc828e0a17a","tableNumber":"BA-05","zoneId":"597669cb-939e-41e9-9f50-c47a6c7af3fc","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:36:35.362Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f23f6a5e-d75e-4f64-a657-f5f6c618a796","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:36:35.362Z] [INFO] [submit] Submitting booking request {"correlationId":"f23f6a5e-d75e-4f64-a657-f5f6c618a796","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:36:54.037Z] [INFO] [submit] Booking created {"correlationId":"f23f6a5e-d75e-4f64-a657-f5f6c618a796","bookingId":"d6ffbce6-147a-4167-8c5e-d0b3c515fddf","duplicate":false,"initialStatus":"confirmed","durationMs":18674,"maskedEmail":"bo***e@example.com","maskedPhone":"********6054"}
[2025-11-15T10:36:54.840Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"f23f6a5e-d75e-4f64-a657-f5f6c618a796","bookingId":"d6ffbce6-147a-4167-8c5e-d0b3c515fddf","reference":"QQZKKZZKKC","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:36:52.994Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5457,"attemptId":"b582f5d6-cf9e-47ce-8862-4e322f574493","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":18674,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19478,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"90081d51-5a67-4e08-8662-7e4f78321815","tableId":"db26922d-5fbb-4007-a4f2-a6a6c438aa49","tableNumber":"BA-06","zoneId":"597669cb-939e-41e9-9f50-c47a6c7af3fc","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19206, max: 21211, avg: 19876, p95: 19609 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-03', 'BA-04', 'BA-05', 'BA-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
