
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:00 --party-size 6 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar
[2025-11-15T10:21:59.480Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"c545f1d3-adb7-4e12-beac-20174eeafa8e","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:21:59.480Z] [INFO] [submit] Submitting booking request {"correlationId":"c545f1d3-adb7-4e12-beac-20174eeafa8e","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:22:18.956Z] [INFO] [submit] Booking created {"correlationId":"c545f1d3-adb7-4e12-beac-20174eeafa8e","bookingId":"d657b899-0583-45e1-b7ad-f7de21e70da2","duplicate":false,"initialStatus":"confirmed","durationMs":19474,"maskedEmail":"bo***3@example.com","maskedPhone":"********5133"}
[2025-11-15T10:22:19.597Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"c545f1d3-adb7-4e12-beac-20174eeafa8e","bookingId":"d657b899-0583-45e1-b7ad-f7de21e70da2","reference":"ZSFK22G6VQ","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:22:16.556Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"14f1113a-67a5-40f2-9ae1-edf786b3b7c9","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":19474,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20117,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-04"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"92a9d22d-57b1-4a11-859a-9babba77f038","tableId":"7c31fedf-9f54-40d7-9181-4c7ff36dc9d7","tableNumber":"OG-04","zoneId":"7ba0e930-2095-4eb7-9bec-4002acb9a42f","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:22:19.597Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"44120493-29e2-4d5a-82e6-644eeaea37bd","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:22:19.598Z] [INFO] [submit] Submitting booking request {"correlationId":"44120493-29e2-4d5a-82e6-644eeaea37bd","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:22:38.806Z] [INFO] [submit] Booking created {"correlationId":"44120493-29e2-4d5a-82e6-644eeaea37bd","bookingId":"7fba6df7-b45a-472a-94c5-c1a636004b76","duplicate":false,"initialStatus":"confirmed","durationMs":19207,"maskedEmail":"bo***3@example.com","maskedPhone":"********0493"}
[2025-11-15T10:22:39.439Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"44120493-29e2-4d5a-82e6-644eeaea37bd","bookingId":"7fba6df7-b45a-472a-94c5-c1a636004b76","reference":"2QEDTVF7WA","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:22:38.125Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5806,"attemptId":"2585f7f7-c575-447d-b54d-18a0196b69ac","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19207,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19842,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["OG-05"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"df6c0f35-ace3-491a-9d0b-c30954ef69b7","tableId":"35cb4482-9afb-40a7-95e3-5bce09faecef","tableNumber":"OG-05","zoneId":"7ba0e930-2095-4eb7-9bec-4002acb9a42f","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:22:39.440Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"af0f00ce-cfb3-49ba-b9d7-26894f24e434","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:22:39.441Z] [INFO] [submit] Submitting booking request {"correlationId":"af0f00ce-cfb3-49ba-b9d7-26894f24e434","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:22:59.826Z] [INFO] [submit] Booking created {"correlationId":"af0f00ce-cfb3-49ba-b9d7-26894f24e434","bookingId":"95e5664d-6917-4894-be22-0cced88e1783","duplicate":false,"initialStatus":"confirmed","durationMs":20385,"maskedEmail":"bo***e@example.com","maskedPhone":"********0024"}
[2025-11-15T10:23:00.833Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"af0f00ce-cfb3-49ba-b9d7-26894f24e434","bookingId":"95e5664d-6917-4894-be22-0cced88e1783","reference":"NJWKZM8JC8","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:22:58.774Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5316,"attemptId":"8d55b1da-ddb1-4030-9921-5319a26f9db5","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":20385,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21393,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["PR-03"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"96745352-e7e5-426e-aaa2-0be86be08330","tableId":"08523427-fa6b-4660-9ce8-8705c2b56554","tableNumber":"PR-03","zoneId":"157b8bf1-25b4-43fe-9388-5e42e8d2c36a","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T10:23:00.834Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1a660663-cf08-4241-9181-feaa64579046","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:23:00.835Z] [INFO] [submit] Submitting booking request {"correlationId":"1a660663-cf08-4241-9181-feaa64579046","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:00","party":6,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:23:20.982Z] [INFO] [submit] Booking created {"correlationId":"1a660663-cf08-4241-9181-feaa64579046","bookingId":"430aaeac-647b-4f3b-9502-cf8eeb0a4171","duplicate":false,"initialStatus":"confirmed","durationMs":20147,"maskedEmail":"bo***3@example.com","maskedPhone":"********0663"}
[2025-11-15T10:23:21.620Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1a660663-cf08-4241-9181-feaa64579046","bookingId":"430aaeac-647b-4f3b-9502-cf8eeb0a4171","reference":"Y9U4PPUC82","bookingDate":"2025-11-25","startTime":"18:00:00","endTime":"20:00:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:23:20.217Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5778,"attemptId":"b1fa8b03-85ef-41b8-992f-c499d818a0c4","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20147,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20786,"tablesAssigned":1,"totalCapacity":6,"seatWaste":0,"tableNumbers":["PR-04"],"partySize":6,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"e498fb6d-9bad-41d7-aae1-a3f61fd484ae","tableId":"41134b67-1aac-42ff-8bb3-90070b43c27c","tableNumber":"PR-04","zoneId":"157b8bf1-25b4-43fe-9388-5e42e8d2c36a","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19842, max: 21393, avg: 20534.5, p95: 20786 },
  seatWaste: { count: 4, min: 0, max: 0, avg: 0, p95: 0 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-04', 'OG-05', 'PR-03', 'PR-04' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
