
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üì° observe env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[2025-11-15T12:17:23.560Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"772a25dd-9ef5-44ad-bc66-6609768bd6f4","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:17:23.560Z] [INFO] [submit] Submitting booking request {"correlationId":"772a25dd-9ef5-44ad-bc66-6609768bd6f4","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:17:44.274Z] [INFO] [submit] Booking created {"correlationId":"772a25dd-9ef5-44ad-bc66-6609768bd6f4","bookingId":"c306361e-bfe5-45ea-8c94-c0e98c2fe35d","duplicate":false,"initialStatus":"confirmed","durationMs":20713,"maskedEmail":"bo***d@example.com","maskedPhone":"********2533"}
[2025-11-15T12:17:44.917Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"772a25dd-9ef5-44ad-bc66-6609768bd6f4","bookingId":"c306361e-bfe5-45ea-8c94-c0e98c2fe35d","reference":"NN898SPM2D","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:17:41.443Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12002,"attemptId":"fe15758e-b68d-494c-aaf6-73158f5a6dd4","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20713,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21357,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dc28e835-4c01-4714-936b-2c7dd1d5e62d","tableId":"01d3cce4-6eba-42ec-83ee-d37f32a9bc3c","tableNumber":"OG-04","zoneId":"7bd99bc9-d325-417a-b117-fc8d208999bd","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:17:44.917Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"0f76b3da-6b02-4015-b1df-362f64be8a97","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:17:44.917Z] [INFO] [submit] Submitting booking request {"correlationId":"0f76b3da-6b02-4015-b1df-362f64be8a97","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:18:05.834Z] [INFO] [submit] Booking created {"correlationId":"0f76b3da-6b02-4015-b1df-362f64be8a97","bookingId":"5b478e20-6b95-45b5-a155-c36d813bd7f1","duplicate":false,"initialStatus":"confirmed","durationMs":20917,"maskedEmail":"bo***a@example.com","maskedPhone":"********1330"}
[2025-11-15T12:18:06.468Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"0f76b3da-6b02-4015-b1df-362f64be8a97","bookingId":"5b478e20-6b95-45b5-a155-c36d813bd7f1","reference":"2VUU78LUFM","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:18:03.051Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12005,"attemptId":"e5315092-bd2d-4cd0-a2ac-c8a28b76294b","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":20917,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21550,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-05"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"8ad8af0f-7711-4c0e-b525-58d0dd218f0c","tableId":"7d6a43ea-ae78-4b40-9b69-b7121c4ec40a","tableNumber":"OG-05","zoneId":"7bd99bc9-d325-417a-b117-fc8d208999bd","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:18:06.469Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7ed92199-520f-4456-bb8b-bdad10473259","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:18:06.469Z] [INFO] [submit] Submitting booking request {"correlationId":"7ed92199-520f-4456-bb8b-bdad10473259","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:18:25.809Z] [INFO] [submit] Booking created {"correlationId":"7ed92199-520f-4456-bb8b-bdad10473259","bookingId":"96a301de-2644-43cc-9e08-e0f3fe66c839","duplicate":false,"initialStatus":"confirmed","durationMs":19339,"maskedEmail":"bo***9@example.com","maskedPhone":"********2199"}
[2025-11-15T12:18:26.535Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7ed92199-520f-4456-bb8b-bdad10473259","bookingId":"96a301de-2644-43cc-9e08-e0f3fe66c839","reference":"APB8AXUXD6","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:18:25.147Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5592,"attemptId":"122b0b5d-e7ab-469f-b735-0780666a6c21","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19339,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20066,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-03"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"16db60ea-5ba0-4a62-86c2-741888e8aba5","tableId":"391e4645-b6e2-4fe5-9987-6bb8d53bbede","tableNumber":"PR-03","zoneId":"968d482b-6e26-48cb-9261-3286f72af99b","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:18:26.536Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1c529917-fd07-44df-b5b4-960f4439fb90","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:18:26.536Z] [INFO] [submit] Submitting booking request {"correlationId":"1c529917-fd07-44df-b5b4-960f4439fb90","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:18:46.747Z] [INFO] [submit] Booking created {"correlationId":"1c529917-fd07-44df-b5b4-960f4439fb90","bookingId":"6658dfa1-79d6-4e1f-8a49-a8c57439fd5b","duplicate":false,"initialStatus":"confirmed","durationMs":20211,"maskedEmail":"bo***7@example.com","maskedPhone":"********9917"}
[2025-11-15T12:18:47.385Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1c529917-fd07-44df-b5b4-960f4439fb90","bookingId":"6658dfa1-79d6-4e1f-8a49-a8c57439fd5b","reference":"2F5YVBSVKD","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:18:45.341Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5432,"attemptId":"e2438bb6-e438-4ccd-a8cc-db1eb46406f8","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20211,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20849,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b25b3a49-4084-4c4a-8198-0a09220cdbff","tableId":"1c76cd8a-045b-44f7-89a6-288e44791717","tableNumber":"PR-04","zoneId":"968d482b-6e26-48cb-9261-3286f72af99b","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 20066, max: 21550, avg: 20955.5, p95: 21357 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'OG-04', 'OG-05', 'PR-03', 'PR-04' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
