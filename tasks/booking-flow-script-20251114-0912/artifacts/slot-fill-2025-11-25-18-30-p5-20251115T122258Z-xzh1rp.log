
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:30 --party-size 5 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[2025-11-15T12:22:59.304Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"e78cbb97-b999-4d66-abcd-75a1ffac26da","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:22:59.305Z] [INFO] [submit] Submitting booking request {"correlationId":"e78cbb97-b999-4d66-abcd-75a1ffac26da","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T12:23:20.217Z] [INFO] [submit] Booking created {"correlationId":"e78cbb97-b999-4d66-abcd-75a1ffac26da","bookingId":"28a786ff-ad20-4e20-b561-bbebf58df5ce","duplicate":false,"initialStatus":"confirmed","durationMs":20911,"maskedEmail":"bo***7@example.com","maskedPhone":"********1197"}
[2025-11-15T12:23:20.853Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"e78cbb97-b999-4d66-abcd-75a1ffac26da","bookingId":"28a786ff-ad20-4e20-b561-bbebf58df5ce","reference":"RKSYQXPAGQ","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:19.118Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":6002,"attemptId":"d9e579a8-98d0-4e16-a785-b91cedea97bf","emailSent":true,"emailVariant":"standard"},"iteration":1,"submitDurationMs":20911,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21548,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["BA-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"9c279234-4b95-4126-baef-e67054cce11e","tableId":"b91455fd-290f-42b9-b600-7840b0896293","tableNumber":"BA-07","zoneId":"df5b5d2b-4d2a-494e-8a38-e488ab929043","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:20.854Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"7d110e4e-5d00-471d-9859-a3f1e5532d8d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:20.854Z] [INFO] [submit] Submitting booking request {"correlationId":"7d110e4e-5d00-471d-9859-a3f1e5532d8d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:23:40.471Z] [INFO] [submit] Booking created {"correlationId":"7d110e4e-5d00-471d-9859-a3f1e5532d8d","bookingId":"821603cf-16aa-4b0c-9815-655969d9197b","duplicate":false,"initialStatus":"confirmed","durationMs":19616,"maskedEmail":"bo***e@example.com","maskedPhone":"********0444"}
[2025-11-15T12:23:41.148Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"7d110e4e-5d00-471d-9859-a3f1e5532d8d","bookingId":"821603cf-16aa-4b0c-9815-655969d9197b","reference":"28Y42KL5BU","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:38.178Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"6f1b225a-c1d8-491a-871a-16a6623f8332","emailSent":false,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19616,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20294,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["MD-07"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"83801890-acce-4e2c-889f-3cd84c318263","tableId":"86ca89aa-2c86-4163-826d-889cdee30ffa","tableNumber":"MD-07","zoneId":"4749aafa-6ce9-492b-9f86-337b7cf8f8fe","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:23:41.149Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"2093c197-3aee-40b3-a996-a9c0f0f6aed1","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:23:41.149Z] [INFO] [submit] Submitting booking request {"correlationId":"2093c197-3aee-40b3-a996-a9c0f0f6aed1","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:23:59.971Z] [INFO] [submit] Booking created {"correlationId":"2093c197-3aee-40b3-a996-a9c0f0f6aed1","bookingId":"59506291-e7bd-4949-a823-bbcfa7437533","duplicate":false,"initialStatus":"confirmed","durationMs":18821,"maskedEmail":"bo***7@example.com","maskedPhone":"********2197"}
[2025-11-15T12:24:00.645Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"2093c197-3aee-40b3-a996-a9c0f0f6aed1","bookingId":"59506291-e7bd-4949-a823-bbcfa7437533","reference":"YQQ8BDDXHM","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:23:58.617Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5372,"attemptId":"bcad72b1-6810-47ce-9cc2-1d880782b128","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18821,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19496,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["OG-04"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"0a064e69-cdb6-4ef2-9950-2060529aa4fb","tableId":"36587dbe-a62e-46e9-bdbc-97b5a56bafaf","tableNumber":"OG-04","zoneId":"1a2b5ba2-d745-40c7-98c7-1ca3bd20e530","capacity":6,"startAt":null,"endAt":null}]}
[2025-11-15T12:24:00.645Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a9090901-cff3-4f40-a256-d041e454ddd9","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T12:24:00.646Z] [INFO] [submit] Submitting booking request {"correlationId":"a9090901-cff3-4f40-a256-d041e454ddd9","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:30","party":5,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T12:24:20.472Z] [INFO] [submit] Booking created {"correlationId":"a9090901-cff3-4f40-a256-d041e454ddd9","bookingId":"44cf6c02-c2bc-4fbc-9a4c-782759ef5912","duplicate":false,"initialStatus":"confirmed","durationMs":19824,"maskedEmail":"bo***1@example.com","maskedPhone":"********0901"}
[2025-11-15T12:24:21.165Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a9090901-cff3-4f40-a256-d041e454ddd9","bookingId":"44cf6c02-c2bc-4fbc-9a4c-782759ef5912","reference":"FH4BG5GXZB","bookingDate":"2025-11-25","startTime":"18:30:00","endTime":"20:30:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T12:24:17.891Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"986d774b-6321-461c-bb08-65741b6b4403","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":19824,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20520,"tablesAssigned":1,"totalCapacity":6,"seatWaste":1,"tableNumbers":["PR-03"],"partySize":5,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"02533d78-f497-47ad-bf8f-7173df69acc9","tableId":"2646deba-c9e3-4786-b2c8-3c4e042d6183","tableNumber":"PR-03","zoneId":"f0b48046-a615-4595-93eb-ebe1f6e55f75","capacity":6,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19496, max: 21548, avg: 20464.5, p95: 20520 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-07', 'MD-07', 'OG-04', 'PR-03' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
