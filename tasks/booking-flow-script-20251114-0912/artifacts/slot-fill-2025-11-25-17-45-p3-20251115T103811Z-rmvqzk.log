
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 17\:45 --party-size 3 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.2] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
[2025-11-15T10:38:12.095Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"f4d08cf0-90c0-4b98-9f38-07547686d62d","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:12.095Z] [INFO] [submit] Submitting booking request {"correlationId":"f4d08cf0-90c0-4b98-9f38-07547686d62d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:38:34.208Z] [INFO] [submit] Booking created {"correlationId":"f4d08cf0-90c0-4b98-9f38-07547686d62d","bookingId":"594ff6e5-b242-4c31-a239-8a62a5c564e8","duplicate":false,"initialStatus":"pending","durationMs":22111,"maskedEmail":"bo***0@example.com","maskedPhone":"********8250"}
[2025-11-15T10:38:34.805Z] [INFO] [inline_poll] Status update {"correlationId":"f4d08cf0-90c0-4b98-9f38-07547686d62d","bookingId":"594ff6e5-b242-4c31-a239-8a62a5c564e8","attempt":1,"status":"pending","assignments":0,"elapsedMs":597}
[2025-11-15T10:38:44.064Z] [INFO] [inline_poll] Status update {"correlationId":"f4d08cf0-90c0-4b98-9f38-07547686d62d","bookingId":"594ff6e5-b242-4c31-a239-8a62a5c564e8","attempt":5,"status":"confirmed","assignments":1,"elapsedMs":9856}
[2025-11-15T10:38:44.065Z] [INFO] [final_summary] Booking confirmed via inline flow {"correlationId":"f4d08cf0-90c0-4b98-9f38-07547686d62d","bookingId":"594ff6e5-b242-4c31-a239-8a62a5c564e8","reference":"T56U55LC9B","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:38:31.737Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12004,"attemptId":"b1336773-e348-4cfb-9d8c-0ead9992518c","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":22111,"inlineAttempts":5,"inlineDurationMs":9857,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":31970,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_poll","assignments":[{"id":"4f8d0c01-c659-4013-a8c3-bc224b6ae6e6","tableId":"9294561d-9467-4189-8c5a-29b40dd3a524","tableNumber":"BA-04","zoneId":"4dcdc847-1f57-4cc8-8b5d-4ee86f17dc20","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:38:44.066Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"31e020e6-e5d5-4e82-a58c-4ce58dc81bbf","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:38:44.066Z] [INFO] [submit] Submitting booking request {"correlationId":"31e020e6-e5d5-4e82-a58c-4ce58dc81bbf","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:03.212Z] [INFO] [submit] Booking created {"correlationId":"31e020e6-e5d5-4e82-a58c-4ce58dc81bbf","bookingId":"0a85dca8-ce01-4269-afdf-1b64ad0924b9","duplicate":false,"initialStatus":"confirmed","durationMs":19145,"maskedEmail":"bo***6@example.com","maskedPhone":"********2046"}
[2025-11-15T10:39:03.853Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"31e020e6-e5d5-4e82-a58c-4ce58dc81bbf","bookingId":"0a85dca8-ce01-4269-afdf-1b64ad0924b9","reference":"ZEHAGTW246","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:01.385Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5294,"attemptId":"01053cb3-0a61-4ce9-899a-ab411ddaf78f","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":19145,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19787,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["BA-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"ffdb6d81-cf21-4e1a-ba3b-d9d06c1b95b6","tableId":"9ecc802b-54a1-45e8-acf1-93d9be5da4f4","tableNumber":"BA-06","zoneId":"4dcdc847-1f57-4cc8-8b5d-4ee86f17dc20","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:03.854Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"6124dabc-b539-4ad7-a292-63ff5326c9ad","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:03.855Z] [INFO] [submit] Submitting booking request {"correlationId":"6124dabc-b539-4ad7-a292-63ff5326c9ad","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:22.685Z] [INFO] [submit] Booking created {"correlationId":"6124dabc-b539-4ad7-a292-63ff5326c9ad","bookingId":"32fcd5b7-faba-436b-b045-d768092f9fe9","duplicate":false,"initialStatus":"confirmed","durationMs":18829,"maskedEmail":"bo***c@example.com","maskedPhone":"********3012"}
[2025-11-15T10:39:23.316Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"6124dabc-b539-4ad7-a292-63ff5326c9ad","bookingId":"32fcd5b7-faba-436b-b045-d768092f9fe9","reference":"AN96N8A8BK","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:20.643Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"97b58077-0b60-4e55-91de-59ffd3c1355e","emailSent":false,"emailVariant":"standard"},"iteration":3,"submitDurationMs":18829,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19462,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-04"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"79952810-fea8-4c09-97d4-4a439f0b0d6f","tableId":"61eb28ec-dd80-4207-ae91-efd3ca1c803a","tableNumber":"MD-04","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":4,"startAt":null,"endAt":null}]}
[2025-11-15T10:39:23.316Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"b4d1b883-0e5b-41c7-8e22-eaa5bf07e189","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:39:23.317Z] [INFO] [submit] Submitting booking request {"correlationId":"b4d1b883-0e5b-41c7-8e22-eaa5bf07e189","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"17:45","party":3,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:39:43.628Z] [INFO] [submit] Booking created {"correlationId":"b4d1b883-0e5b-41c7-8e22-eaa5bf07e189","bookingId":"2002a707-1db6-4d06-be41-4d3813293535","duplicate":false,"initialStatus":"confirmed","durationMs":20311,"maskedEmail":"bo***3@example.com","maskedPhone":"********1883"}
[2025-11-15T10:39:44.324Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"b4d1b883-0e5b-41c7-8e22-eaa5bf07e189","bookingId":"2002a707-1db6-4d06-be41-4d3813293535","reference":"PPL7ZG8K8N","bookingDate":"2025-11-25","startTime":"17:45:00","endTime":"19:45:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:39:41.579Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12003,"attemptId":"2951fbee-e621-423d-b8af-130a6e9172c7","emailSent":false,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20311,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":21008,"tablesAssigned":1,"totalCapacity":4,"seatWaste":1,"tableNumbers":["MD-06"],"partySize":3,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"dd6c4b4e-08d0-4666-a5bb-fba03ab1c325","tableId":"16990695-d3a9-4178-88ec-330b2f8a805a","tableNumber":"MD-06","zoneId":"33da1acf-fc1c-40da-9dfb-497617c8b592","capacity":4,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19462, max: 31970, avg: 23056.75, p95: 21008 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'BA-04', 'BA-06', 'MD-04', 'MD-06' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
