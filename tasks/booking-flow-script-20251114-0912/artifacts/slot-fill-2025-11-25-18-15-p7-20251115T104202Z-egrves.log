
> ship-fast-code@0.1.0 booking:flow /Users/amankumarshrestha/Downloads/SajiloReserveX
> tsx -r tsconfig-paths/register scripts/run-booking-flow.ts --restaurant-slug white-horse-pub-waterbeach --date 2025-11-25 --time 18\:15 --party-size 7 --stress --stress-max 4 --timeout-ms 180000 --base-url http\://localhost\:3020 --pretty

[dotenv@17.2.2] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.2] injecting env (0) from .env.development -- tip: üì° version env with Radar: https://dotenvx.com/radar
[dotenv@17.2.2] injecting env (0) from .env -- tip: üì° version env with Radar: https://dotenvx.com/radar
[2025-11-15T10:42:03.641Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"26fed5f6-5b12-4eec-b20a-b050fb0a12cf","bookingId":null,"iteration":1,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:03.641Z] [INFO] [submit] Submitting booking request {"correlationId":"26fed5f6-5b12-4eec-b20a-b050fb0a12cf","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[supabase] strict hold enforcement active
[2025-11-15T10:42:25.619Z] [INFO] [submit] Booking created {"correlationId":"26fed5f6-5b12-4eec-b20a-b050fb0a12cf","bookingId":"a658443c-feed-4aea-b438-0ba1d3fc45c2","duplicate":false,"initialStatus":"confirmed","durationMs":21977,"maskedEmail":"bo***6@example.com","maskedPhone":"********3556"}
[2025-11-15T10:42:26.320Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"26fed5f6-5b12-4eec-b20a-b050fb0a12cf","bookingId":"a658443c-feed-4aea-b438-0ba1d3fc45c2","reference":"5NRAXLBUFL","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:23.780Z","success":false,"reason":"INLINE_TIMEOUT","strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":12012,"attemptId":"0bbb19eb-75b6-48cc-8d69-62ee47e06834","emailSent":false,"emailVariant":"standard"},"iteration":1,"submitDurationMs":21977,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":22679,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-09"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"bfcc5c8a-7574-40a1-98e1-7f1e5faa5d12","tableId":"deb8feab-43e1-43b3-a115-f8ac2f30c73a","tableNumber":"MD-09","zoneId":"dce1381c-1e68-4040-9ed5-85411d27ddf9","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:26.321Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"bef24fed-5680-4391-a24a-b3986fb0182d","bookingId":null,"iteration":2,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:26.321Z] [INFO] [submit] Submitting booking request {"correlationId":"bef24fed-5680-4391-a24a-b3986fb0182d","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:42:45.063Z] [INFO] [submit] Booking created {"correlationId":"bef24fed-5680-4391-a24a-b3986fb0182d","bookingId":"28238453-359e-475c-ad53-3ed7f63612a0","duplicate":false,"initialStatus":"confirmed","durationMs":18741,"maskedEmail":"bo***d@example.com","maskedPhone":"********4543"}
[2025-11-15T10:42:45.680Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"bef24fed-5680-4391-a24a-b3986fb0182d","bookingId":"28238453-359e-475c-ad53-3ed7f63612a0","reference":"CTU428KS7W","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:42:43.623Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":4966,"attemptId":"f0dfa711-3d13-49c2-a8a5-d08628ef5c9e","emailSent":true,"emailVariant":"standard"},"iteration":2,"submitDurationMs":18741,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19359,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["MD-10"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"2b020e9f-2057-449b-87a6-3944c4224044","tableId":"1619ffd9-c298-4942-8144-64b3b59aebdb","tableNumber":"MD-10","zoneId":"dce1381c-1e68-4040-9ed5-85411d27ddf9","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:42:45.681Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"1ad1a80d-fef2-4d9d-b11a-3119ef804f4f","bookingId":null,"iteration":3,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:42:45.681Z] [INFO] [submit] Submitting booking request {"correlationId":"1ad1a80d-fef2-4d9d-b11a-3119ef804f4f","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:04.739Z] [INFO] [submit] Booking created {"correlationId":"1ad1a80d-fef2-4d9d-b11a-3119ef804f4f","bookingId":"27eb2c55-15ae-4b4f-93ff-3da2edc23ba8","duplicate":false,"initialStatus":"confirmed","durationMs":19057,"maskedEmail":"bo***d@example.com","maskedPhone":"********0803"}
[2025-11-15T10:43:05.352Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"1ad1a80d-fef2-4d9d-b11a-3119ef804f4f","bookingId":"27eb2c55-15ae-4b4f-93ff-3da2edc23ba8","reference":"AWXZJKYN52","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:03.640Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5415,"attemptId":"576107be-2ad0-4b7c-b8f2-661dd412e4ce","emailSent":true,"emailVariant":"standard"},"iteration":3,"submitDurationMs":19057,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":19671,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["OG-06"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"b8932759-be18-4b16-b485-d390f9c415e8","tableId":"2f966e39-15fa-41ad-97d3-ea4c8828230e","tableNumber":"OG-06","zoneId":"c56cf6aa-f668-4a9f-881a-70e041656051","capacity":8,"startAt":null,"endAt":null}]}
[2025-11-15T10:43:05.353Z] [INFO] [bootstrap] Starting booking flow {"correlationId":"a2b9503f-f9c2-4989-8b9d-f94a0dce9425","bookingId":null,"iteration":4,"totalRuns":"stress","timeoutMs":180000,"inlineWindowMs":25000,"pollIntervalMs":2000}
[2025-11-15T10:43:05.353Z] [INFO] [submit] Submitting booking request {"correlationId":"a2b9503f-f9c2-4989-8b9d-f94a0dce9425","bookingId":null,"url":"http://localhost:3020/api/bookings","restaurantSlug":"white-horse-pub-waterbeach","restaurantId":null,"date":"2025-11-25","time":"18:15","party":7,"bookingType":"dinner","seating":"any","marketingOptIn":false}
[2025-11-15T10:43:25.366Z] [INFO] [submit] Booking created {"correlationId":"a2b9503f-f9c2-4989-8b9d-f94a0dce9425","bookingId":"5ad25eaf-039c-4570-94ca-094f7f4071d8","duplicate":false,"initialStatus":"confirmed","durationMs":20013,"maskedEmail":"bo***f@example.com","maskedPhone":"********5035"}
[2025-11-15T10:43:26.093Z] [INFO] [final_summary] Booking confirmed inline (API response) {"correlationId":"a2b9503f-f9c2-4989-8b9d-f94a0dce9425","bookingId":"5ad25eaf-039c-4570-94ca-094f7f4071d8","reference":"EXHEGQGRV9","bookingDate":"2025-11-25","startTime":"18:15:00","endTime":"20:15:00","autoAssignLastResult":{"source":"inline","lastAttemptAt":"2025-11-15T10:43:24.012Z","success":true,"reason":null,"strategy":{"maxTables":null,"requireAdjacency":null},"trigger":"inline_creation","alternates":0,"durationMs":5060,"attemptId":"bfad44f5-5f73-4da2-a817-f5daa78266af","emailSent":true,"emailVariant":"standard"},"iteration":4,"submitDurationMs":20013,"inlineAttempts":0,"inlineDurationMs":0,"postJobAttempts":0,"postJobDurationMs":0,"backgroundInvoked":false,"backgroundDurationMs":null,"totalDurationMs":20740,"tablesAssigned":1,"totalCapacity":8,"seatWaste":1,"tableNumbers":["PT-07"],"partySize":7,"duplicateRequest":false,"status":"confirmed_inline_api","assignments":[{"id":"74cceaad-0e2d-4af1-b365-3b4e3a3eddc7","tableId":"9350b621-aec3-40f3-abb1-4a8b89434f88","tableNumber":"PT-07","zoneId":"af61d531-754d-4e05-a496-2214757724b3","capacity":8,"startAt":null,"endAt":null}]}
[stress] Summary {
  totalRuns: 4,
  successes: 4,
  failures: 0,
  maxRuns: 4,
  completedTarget: true,
  durationMs: { count: 4, min: 19359, max: 22679, avg: 20612.25, p95: 20740 },
  seatWaste: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  tablesPerBooking: { count: 4, min: 1, max: 1, avg: 1, p95: 1 },
  uniqueTables: [ 'MD-09', 'MD-10', 'OG-06', 'PT-07' ]
}
‚úÖ Stress run completed 4 booking(s) without failure.
